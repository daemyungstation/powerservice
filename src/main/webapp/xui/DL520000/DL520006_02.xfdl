<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="DL520006_02" classname="팝업가이드" inheritanceid="" position="absolute 0 0 730 260" titletext="가상계좌문자전송" onload="DL520006_02_onload">
    <Layouts>
      <Layout>
        <Static id="stc_31" class="sta_popupBg1" enable="false" onclick="stc_31_onclick" position2="absolute l:0 w:728 t:0 h:256" positiontype="position2"/>
        <Button id="btn_Close" taborder="1" onclick="btn_close_onclick" class="btn_popupClose" position2="absolute l:698 w:20 t:10 h:19" positiontype="position2"/>
        <Static id="stc_30" text="가상계좌 SMS 전송" class="sta_popupTitle" transparenthittest="true" position2="absolute l:9 w:311 t:10 h:20" positiontype="position2"/>
        <Calendar id="msk_resr_dt" taborder="2" displaynulltext="____-__-__" dateformat="yyyy-MM-dd" onchanged="cal_00_onchanged" oneditclick="cal_00_oneditclick" class="cal_srch" enable="false" anchor="default" position="absolute 79 47 175 67" positiontype="position"/>
        <Combo id="cbo_resr_tm" taborder="3" codecolumn="codecolumn" datacolumn="datacolumn" onitemchanged="tab_tabpage1_cbo_city_onitemchanged" enable="false" position2="absolute l:255 w:96 t:47 h:20" positiontype="position2">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn">0900</Col>
                <Col id="datacolumn">09:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0930</Col>
                <Col id="datacolumn">09:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1000</Col>
                <Col id="datacolumn">10:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1030</Col>
                <Col id="datacolumn">10:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1100</Col>
                <Col id="datacolumn">11:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1130</Col>
                <Col id="datacolumn">11:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1200</Col>
                <Col id="datacolumn">12:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1230</Col>
                <Col id="datacolumn">12:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1300</Col>
                <Col id="datacolumn">13:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1330</Col>
                <Col id="datacolumn">13:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1400</Col>
                <Col id="datacolumn">14:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1430</Col>
                <Col id="datacolumn">14:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1500</Col>
                <Col id="datacolumn">15:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1530</Col>
                <Col id="datacolumn">15:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1600</Col>
                <Col id="datacolumn">16:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1630</Col>
                <Col id="datacolumn">16:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1700</Col>
                <Col id="datacolumn">17:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1730</Col>
                <Col id="datacolumn">17:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1800</Col>
                <Col id="datacolumn">18:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1830</Col>
                <Col id="datacolumn">18:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1900</Col>
                <Col id="datacolumn">19:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1930</Col>
                <Col id="datacolumn">19:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">2000</Col>
                <Col id="datacolumn">20:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">2030</Col>
                <Col id="datacolumn">20:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">2100</Col>
                <Col id="datacolumn">21:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">2130</Col>
                <Col id="datacolumn">21:30</Col>
              </Row>
            </Rows>
          </Dataset>
        </Combo>
        <Button id="btn_Send" taborder="4" text="보내기" onclick="btn_Send_onclick" position2="absolute r:17 w:72 t:47 h:20" positiontype="position2" tooltiptext="초기화" style="padding:0 0 0 0;"/>
        <Static id="stc_07" text="예약시간" class="sta_workSrcLabel1" position2="absolute l:192 w:62 t:47 h:20" positiontype="position2"/>
        <Static id="stc_06" text="예약일자" class="sta_workSrcLabel1" position2="absolute l:16 w:62 t:47 h:20" positiontype="position2"/>
        <CheckBox id="chk_rightfg" taborder="5" text="즉시발송" value="true" onclick="chk_rightfg_onclick" position="absolute 359 47 429 67"/>
        <Edit id="edt_cntr_rprs_tlno" taborder="6" value="0269582420" inputtype="number" lengthunit="utf8" maxlength="13" onkillfocus="edt_cntr_rprs_tlno_onkillfocus" position2="absolute l:505 w:96 t:47 h:20" positiontype="position2"/>
        <Static id="stc_22" text="발신번호" class="sta_workSrcLabel1" position2="absolute l:442 w:62 t:47 h:20" positiontype="position2"/>
        <Static id="stc_00" text="업체명" class="sta_workSrcLabel1" position2="absolute l:970 w:62 t:54 h:20" positiontype="position2" visible="false"/>
        <Edit id="edt_cntr_rprs_tlno00" taborder="7" value="(주)대명스테이션" inputtype="number" lengthunit="utf8" maxlength="13" onkillfocus="edt_cntr_rprs_tlno_onkillfocus" position2="absolute l:1024 w:120 t:54 h:20" positiontype="position2" visible="false"/>
        <Grid id="grd_list" taborder="8" binddataset="ds_list" useinputpanel="false" autofittype="col" oncellclick="grd_list_oncellclick" position2="absolute l:16 r:17 t:80 b:11" positiontype="position2" onheadclick="tab_tabpage2_Grid00_onheadclick">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="44"/>
                <Column size="90"/>
                <Column size="148"/>
                <Column size="319"/>
                <Column size="89"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="136"/>
              </Rows>
              <Band id="head">
                <Cell text="NO"/>
                <Cell col="1" text="회원명"/>
                <Cell col="2" text="연락처"/>
                <Cell col="3" text="문자내용"/>
                <Cell col="4"/>
              </Band>
              <Band id="body">
                <Cell expr="currow+1"/>
                <Cell col="1" displaytype="text" text="bind:mem_nm"/>
                <Cell col="2" displaytype="text" edittype="text" editfilter="digit" text="bind:cell" mask="expr:gfn_SetTelNoGrdMask(clph_no)" editlimit="12" editdisplay="display" editlimitbymask="integer"/>
                <Cell col="3" displaytype="decoratetext" style="align:left;" text="bind:contents"/>
                <Cell col="4" text="bind:mem_no"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
      </Layout>
    </Layouts>
    <Bind/>
    <Objects>
      <Dataset id="ds_trans_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="strSvcID" type="STRING" size="256"/>
          <Column id="strURL" type="STRING" size="256"/>
          <Column id="strInDatasets" type="STRING" size="256"/>
          <Column id="strOutDatasets" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_inqCndt" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="chat_msg_typ_cd" type="STRING" size="256"/>
          <Column id="chat_msg_titl" type="STRING" size="256"/>
          <Column id="chat_msg_cntn" type="STRING" size="256"/>
          <Column id="use_yn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list_tmp" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_list_chatCnts" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="chat_msg_lngt" type="STRING" size="256"/>
          <Column id="amnt_dttm" type="STRING" size="256"/>
          <Column id="chat_dpms_div_nm" type="STRING" size="256"/>
          <Column id="file_flag" type="STRING" size="256"/>
          <Column id="img_url_addr" type="STRING" size="256"/>
          <Column id="amnd_id" type="STRING" size="256"/>
          <Column id="amnd_nm" type="STRING" size="256"/>
          <Column id="cntr_cd" type="STRING" size="256"/>
          <Column id="chat_msg_typ_nm" type="STRING" size="256"/>
          <Column id="dpms_tlno" type="STRING" size="256"/>
          <Column id="chat_msg_typ_cd" type="STRING" size="256"/>
          <Column id="chat_cnts_div_nm" type="STRING" size="256"/>
          <Column id="chat_dpms_div_cd" type="STRING" size="256"/>
          <Column id="rgsr_id" type="STRING" size="256"/>
          <Column id="rgsn_dttm" type="STRING" size="256"/>
          <Column id="chat_msg_cntn" type="STRING" size="256"/>
          <Column id="rgsr_nm" type="STRING" size="256"/>
          <Column id="file_id" type="STRING" size="256"/>
          <Column id="page_indx" type="STRING" size="256"/>
          <Column id="chat_msg_titl" type="STRING" size="256"/>
          <Column id="use_yn" type="STRING" size="256"/>
          <Column id="chat_cnts_id" type="STRING" size="256"/>
          <Column id="chat_cnts_div_cd" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_chat_msg_typ_cd" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="256"/>
          <Column id="cd_nm" type="STRING" size="256"/>
          <Column id="adtl_cd" type="STRING" size="256"/>
          <Column id="adtl_cd_nm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <FileDialog id="FileDialog00" filter="All(*.*)|*.*|" filterindex="0" defaultextention="false"/>
      <Dataset id="ds_list_tmp2" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_list_excel" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowCheck" type="STRING" size="256"/>
          <Column id="cust_id" type="STRING" size="256"/>
          <Column id="cust_nm" type="STRING" size="256"/>
          <Column id="clph_no" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_inqSend" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="mem_no" type="STRING" size="256"/>
          <Column id="mem_nm" type="STRING" size="256"/>
          <Column id="service_type" type="STRING" size="256"/>
          <Column id="recipient_num" type="STRING" size="256"/>
          <Column id="callback" type="STRING" size="256"/>
          <Column id="subject" type="STRING" size="256"/>
          <Column id="content" type="STRING" size="256"/>
          <Column id="broadcast_yn" type="STRING" size="256"/>
          <Column id="reserve_yn" type="STRING" size="256"/>
          <Column id="reserve_date" type="STRING" size="256"/>
          <Column id="attach_file_name" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_attachFile" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="fileName" type="STRING" size="32"/>
          <Column id="fileSize" type="BIGDECIMAL" size="8"/>
          <Column id="fileType" type="STRING" size="32"/>
          <Column id="filePath" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="fileName"/>
            <Col id="fileType">1</Col>
            <Col id="filePath"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_send_list" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="false" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="mem_no" type="STRING" size="256"/>
          <Column id="mem_nm" type="STRING" size="256"/>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="content" type="STRING" size="256"/>
          <Column id="clph_no" type="STRING" size="256"/>
          <Column id="service_type" type="STRING" size="256"/>
          <Column id="recipient_num" type="STRING" size="256"/>
          <Column id="callback" type="STRING" size="256"/>
          <Column id="subject" type="STRING" size="256"/>
          <Column id="content" type="STRING" size="256"/>
          <Column id="broadcast_yn" type="STRING" size="256"/>
          <Column id="reserve_yn" type="STRING" size="256"/>
          <Column id="reserve_date" type="STRING" size="256"/>
          <Column id="attach_file_name" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="_chk" type="INT" size="256"/>
          <Column id="page_indx" type="STRING" size="256"/>
          <Column id="mem_no" type="STRING" size="256"/>
          <Column id="mem_nm" type="STRING" size="256"/>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="cell" type="STRING" size="256"/>
          <Column id="ichae_no" type="STRING" size="256"/>
          <Column id="result_key" type="STRING" size="256"/>
          <Column id="req_day" type="STRING" size="256"/>
          <Column id="ichae_cd" type="STRING" size="256"/>
          <Column id="deposit_dt" type="STRING" size="256"/>
          <Column id="deposit_name" type="STRING" size="256"/>
          <Column id="result_msg" type="STRING" size="256"/>
          <Column id="dpst_stat" type="STRING" size="256"/>
          <Column id="pay_amt" type="STRING" size="256"/>
          <Column id="req_pay_no" type="STRING" size="256"/>
          <Column id="kstbit" type="STRING" size="256"/>
          <Column id="reg_man" type="STRING" size="256"/>
          <Column id="reg_dm" type="DATE" size="256"/>
          <Column id="deposit_time" type="STRING" size="256"/>
          <Column id="contents" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_bank_typ" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="256"/>
          <Column id="cd_nm" type="STRING" size="256"/>
          <Column id="adtl_cd" type="STRING" size="256"/>
          <Column id="adtl_cd_nm" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="cd">03</Col>
            <Col id="cd_nm">기업</Col>
          </Row>
          <Row>
            <Col id="cd">04</Col>
            <Col id="cd_nm">국민</Col>
          </Row>
          <Row>
            <Col id="cd">07</Col>
            <Col id="cd_nm">수협</Col>
          </Row>
          <Row>
            <Col id="cd">11</Col>
            <Col id="cd_nm">농협</Col>
          </Row>
          <Row>
            <Col id="cd">20</Col>
            <Col id="cd_nm">우리</Col>
          </Row>
          <Row>
            <Col id="cd">23</Col>
            <Col id="cd_nm">제일</Col>
          </Row>
          <Row>
            <Col id="cd">27</Col>
            <Col id="cd_nm">씨티</Col>
          </Row>
          <Row>
            <Col id="cd">31</Col>
            <Col id="cd_nm">대구</Col>
          </Row>
          <Row>
            <Col id="cd">32</Col>
            <Col id="cd_nm">부산</Col>
          </Row>
          <Row>
            <Col id="cd">34</Col>
            <Col id="cd_nm">광주</Col>
          </Row>
          <Row>
            <Col id="cd">39</Col>
            <Col id="cd_nm">경남</Col>
          </Row>
          <Row>
            <Col id="cd">71</Col>
            <Col id="cd_nm">우체국</Col>
          </Row>
          <Row>
            <Col id="cd">81</Col>
            <Col id="cd_nm">하나</Col>
          </Row>
          <Row>
            <Col id="cd">88</Col>
            <Col id="cd_nm">신한</Col>
          </Row>
        </Rows>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/********************************************************************************************/
/* 1. Include Library include, variables Declaration 영역                                  */
/********************************************************************************************/
include "LIB::lib_All.xjs";
var sendmode = "multi";
var fv_svcPath;
var total_count = 0; // 전체건수
var fv_svcPath = gfn_getServiceUrl("fileUrl");
var arrFiles = new Array();	// FileDialog 선택을 통한 File Array
var xNonPay = "";

/********************************************************************************************/
/* 2. Form 관련(onload 및 Form 이벤트) 처리                                           	*/
/********************************************************************************************/
function DL520006_02_onload(obj:Form, e:LoadEventInfo)
{
	var svtr_no = "";
	var sbank_nm = "";
	var smem_nm = "";
	var spay_amt = "";
	var send_day = "";
	
	// 중복회원 제거 추가..
	ds_list.clearData();
	
	//임의등록 전송 시 문자 popup
	if(pSendPosition == "A"){
		ds_list.copyData(opener.ds_send_info, true);				
		ds_list.setColumn(0,"ichae_no",pVtr_acc_no);	
			
		ds_list.addColumn("req_day","string");
		ds_list.addColumn("contents","string");
		ds_list.setColumn(0,"req_day",ds_list.getColumn(0,"end_day"));	
	} else { //이력에서 sms버튼 popup
		opener.ds_list.filter("_chk == '1'");
		ds_list.copyData(opener.ds_list, true);
		opener.ds_list.filter("");
	}
	
	for (var i=0;i<ds_list.rowcount;i++) {
	
		svtr_no = ds_list.getColumn(i,"ichae_no");
		sbank_nm = ds_list.getColumn(i,"ichae_cd");
		smem_nm = ds_list.getColumn(i,"mem_nm");
		spay_amt = ds_list.getColumn(i,"pay_amt");
		send_day = ds_list.getColumn(i,"req_day");
		
		ds_bank_typ.filter("cd == '"+sbank_nm+"'");
		sbank_nm = ds_bank_typ.getColumn(0,"cd_nm");
		
		var strContent = "[대명아임레디]\n";
		    strContent += "가상계좌번호 : "+ svtr_no +"\n"
		    strContent += "은행 : "+ sbank_nm +"\n";
		    strContent += "예금주 : "+ smem_nm +"\n";
		    strContent += "입금금액 : "+ gfn_NumFormat(toNumber(spay_amt),0) +"\n";
		    strContent += "입금마감일자 : "+ send_day +"\n";
			strContent += "* 입금마감일자 경과 후 입금 시\n";
			strContent += "타인에게 입금반영이 될수 있으니\n";
			strContent += "마감일자 꼭 지켜주시기바랍니다.\n";
			strContent += "감사합니다.\n";	
		ds_list.setColumn(i,"contents",strContent);
	}
	/*
	for (var i=0;i<ds_list.rowcount;i++) {
		var dup_chk = true;
		for (var j=0;j<ds_send_list.rowcount;j++) {
			if (ds_list.getColumn(i,"mem_no") == ds_send_list.getColumn(j,"mem_no")) {
				dup_chk = false;
				break;
			}
		}
		if (dup_chk) {
			var nRow = ds_send_list.addRow();
			ds_send_list.copyRow(nRow, ds_list, i);
		}
	}	
	ds_list.copyData(ds_send_list);		
	*/
	xNonPay = pNonPay;	
	if(xNonPay == "Y")	{
		edt_cntr_rprs_tlno.value = "02-6958-2420";
	}
	else	{
		edt_cntr_rprs_tlno.value = "1588-8511";
	}
}

/********************************************************************************************/
/* 3. Callback(gfn_Transaction 호출 후 처리내용)                                   		*/
/********************************************************************************************/
function fn_callBack(svcid, errcd, errmsg) 
{
	if (errcd != 0) {
		trace(errcd)
		return false;
	} else {
		switch (svcid) {
			case "sendMsg":
				alert("발송되었습니다.");
			break;
 		}
 	}
} 		

/********************************************************************************************/
/**   5. 서비스 호출(gfn_Transaction)                                                   	*/
/********************************************************************************************/
//조회
function fn_commSearch(sType)
{
	var szSvcid       = "getChatCntsList";
    var szController  = "/knowledge/chat-cnts/list";
    var szInDs        = "ds_input=ds_inqCndt";
    var szOutDs       = "ds_list_tmp=ds_output";
    var szParam       = "";
    var szRetCallback = "fn_callBack";
	
    // 트랜젝션 공통함수 호출
    gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback);
}

//메시지 전송
function fn_send()
{
	var strSendNo = "";
	var strContens = "";
	var strMemno = "";
	var nRow = 0;
	
	ds_inqSend.clearData()
	
	for (var i=0;i<ds_list.rowcount;i++) {		
		var callback = edt_cntr_rprs_tlno.value;
		
		strSendNo = ds_list.getColumn(i,"cell");
		strMemno = ds_list.getColumn(i,"mem_no");
		strContens = ds_list.getColumn(i,"contents");
		
		nRow = ds_inqSend.addRow();
		ds_inqSend.addRow();
		ds_inqSend.setColumn(nRow, "recipient_num", strSendNo);//수신번호
		ds_inqSend.setColumn(nRow, "mem_no", strMemno);//고유번호
		ds_inqSend.setColumn(nRow, "callback", callback);//발신번호
		ds_inqSend.setColumn(nRow, "subject", "[대명아임레디]");//메시지제목
		ds_inqSend.setColumn(nRow, "content", strContens);//전송메시지
		
		if(chk_rightfg.value == false){
			ds_inqSend.setColumn(nRow, "reserve_yn", "Y");//예약발송 유무
			ds_inqSend.setColumn(nRow, "reserve_date", msk_resr_dt.value + cbo_resr_tm.value);//예약발송 시각
		}else{
			ds_inqSend.setColumn(nRow, "reserve_yn", "N");//예약발송 유무
		}
		
		if(toNumber(strContens) <= 80){//SMS
			ds_inqSend.setColumn(nRow, "service_type", "0");//메시지전송타입
		}else{//LMS
			ds_inqSend.setColumn(nRow, "service_type", "3");//메시지전송타입
		}
	}
		
	var szSvcid       = "sendMsg";
	var szController  = "/chnl/chat-sndg/send_sysone";
	var szInDs        = "ds_input=ds_inqSend ds_input2=ds_list_excel";
	var szOutDs       = "";
	var szParam       = "";
	var szRetCallback = "fn_callBack";	
	
	// 트랜젝션 공통함수 호출
	gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback);
	
	/*
		ds_inqSend.setColumn(0, "mem_no", mem_no);//고객번호
	ds_inqSend.setColumn(0, "mem_nm", mem_nm);//고객명
	
	ds_inqSend.setColumn(0, "recipient_num", edt_clph_no.value);//수신번호
	ds_inqSend.setColumn(0, "callback", edt_cntr_rprs_tlno.value);//발신번호
	
	var sTitle = TextArea_chat_msg_cntn.value;
	ds_inqSend.setColumn(0, "subject", sTitle.substr(0, 10));//메시지제목
	ds_inqSend.setColumn(0, "content", TextArea_chat_msg_cntn.value);//전송메시지
	
	if(chk_rightfg.value == false){
		ds_inqSend.setColumn(0, "reserve_yn", "Y");//예약발송 유무
		ds_inqSend.setColumn(0, "reserve_date", msk_resr_dt.value + cbo_resr_tm.value);//예약발송 시각
	}else{
		ds_inqSend.setColumn(0, "reserve_yn", "N");//예약발송 유무
	}
	
	if(!gfn_isNull(FileUpload00.value)){//첨부파일 있음(MMS)
		var strUrl = fv_svcPath+"fileControll/fileUpload.jsp?PATH=upload";
		var bSucc = FileUpload00.upload(strUrl);
		ds_inqSend.setColumn(0, "service_type", "2");//메시지전송타입
	}else{//첨부파일 없음
		if(toNumber(sta_chat_msg_size.text) <= 80){//SMS
			ds_inqSend.setColumn(0, "service_type", "0");//메시지전송타입
		}else{//LMS
			ds_inqSend.setColumn(0, "service_type", "3");//메시지전송타입
		}
	//	alert(sta_chat_msg_size.text);
		//trace(ds_inqSend.saveXML());
		var szSvcid       = "sendMsg";
		var szController  = "/chnl/chat-sndg/send_sysone";
		var szInDs        = "ds_input=ds_inqSend ds_input2=ds_list_excel";
		var szOutDs       = "";
		var szParam       = "";
		var szRetCallback = "fn_callBack";
		
		// 트랜젝션 공통함수 호출
		gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback);
    }	
	*/

}

/********************************************************************************************/
/**   6. 사용자 함수                                                                   	*/
/********************************************************************************************/
// 초기화
function fn_init()
{

}

/********************************************************************************************/
/**   7. 이벤트(Event) Function                                                          	*/
/********************************************************************************************/
function btn_Search_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_commSearch(gfn_getCommTypeInit());
}

//즉시발송 체크클릭
function chk_rightfg_onclick(obj:CheckBox,  e:ClickEventInfo)
{
	//체크상태
	if(obj.value == true){
		msk_resr_dt.value = "";
		cbo_resr_tm.value = "";
		msk_resr_dt.enable = false;
		cbo_resr_tm.enable = false;
	}else{
		msk_resr_dt.enable = true;
		cbo_resr_tm.enable = true;
	}
}

//헤더클릭
function tab_tabpage2_Grid00_onheadclick(obj:Grid, e:GridClickEventInfo)
{
	gfn_grdHeadClick(obj, e);
}

//보내기버튼클릭
function btn_Send_onclick(obj:Button,  e:ClickEventInfo)
{
	if (fn_checkBefore(sendmode) == false) {
			return false;
	}
	fn_send();
}

//발송전 체크
function fn_checkBefore(sendmode)
{
	var chkCell = false;
	
	for (var i=0;i<ds_list.rowcount;i++) {
		if (ds_list.getColumn(i,"cell") == "" || gfn_GetLength(ds_list.getColumn(i,"cell")) < 10){
			chkCell =true;
		}
	}
	
	if(chkCell){
		alert("고객 전화 번호를 정상적으로 입력하세요");
		return false;
	}
	
	if(gfn_isNull(edt_cntr_rprs_tlno.value)){
		alert("발신번호를 입력하세요");
		edt_cntr_rprs_tlno.setFocus();
		return false;
	}
	
	if(gfn_isNull(edt_cntr_rprs_tlno.value)){
		alert("발신번호를 입력하세요");
		edt_cntr_rprs_tlno.setFocus();
		return false;
	}
	
	if(chk_rightfg.value == false){//예약발송일때
		if(gfn_isNull(msk_resr_dt.value)){
			alert("예약일자를 입력하세요");
			msk_resr_dt.setFocus();
			return false;
		}
		if(gfn_isNull(cbo_resr_tm.value)){
			alert("예약시간을 입력하세요");
			cbo_resr_tm.setFocus();
			return false;
		}
	}
	
	if (!confirm("문자메시지를 발송하시겠습니까?")) {
		return false;
	}
}

//닫기버튼
function btn_close_onclick(obj:Button,  e:ClickEventInfo)
{
	close();
}
]]></Script>
  </Form>
</FDL>
