<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="MN020102_1" classname="MN010111" inheritanceid="" position="absolute 0 0 767 386" titletext="팝업_거래처 정보 등록" onload="frm_onload">
    <Layouts>
      <Layout>
        <Static id="stc_31" class="sta_popupBg1" enable="false" position="absolute 0 1 767 386" onclick="stc_31_onclick"/>
        <Static id="stc_30" text="거래처 정보 등록" class="sta_popupTitle" transparenthittest="true" position="absolute 10 8 185 28"/>
        <Button id="btn_save" taborder="21" tabstop="false" class="btn_WF_Save" position="absolute 624 45 688 65" tooltiptext="저장" style="padding:0 0 0 0;" onclick="btn_save_onclick"/>
        <Button id="btn_init" taborder="20" tabstop="false" text="초기화" onclick="btn_init_onclick" class="btn_WF_Common" position="absolute 550 45 622 65" tooltiptext="초기화" style="border:0 none #000000ff ;padding:0 0 0 0;" visible="false"/>
        <Button id="btn_close" taborder="23" onclick="btn_close_onclick" class="btn_popupClose" position="absolute 731 7 751 26"/>
        <Static id="stc_00" class="sta_workData" position="absolute 9 170 755 196"/>
        <Static id="stc_02" class="sta_workData" position="absolute 9 145 755 171"/>
        <Static id="stc_10" class="sta_workData" position="absolute 9 120 755 146"/>
        <Static id="stc_21" class="sta_workData" position="absolute 9 70 755 96" onclick="stc_21_onclick"/>
        <Static id="stc_04" class="sta_workData" position="absolute 9 95 755 121" style="font:arial,12,bold;"/>
        <Static id="stc_15" text="거래처 정보 " class="sta_workTitle2" position="absolute 9 49 221 69"/>
        <Static id="sta_GrayLine" class="sta_WF_Line1" position="absolute 9 69 755 70" anchor="left top right" onclick="sta_GrayLine_onclick"/>
        <Static id="mem_nm_txt" text="상     호" class="sta_workLabel1_P" position="absolute 9 70 83 96" validate=""/>
        <Static id="stc_09" text="사업자번호" class="sta_workLabel1" position="absolute 377 95 474 121" validate=""/>
        <Static id="stc_03" class="sta_workData" position="absolute 9 320 755 366"/>
        <Static id="stc_110" text="비     고" class="sta_workLabel1" position="absolute 9 320 83 366" validate="" style="align:center middle;font:Dotum,8;"/>
        <Static id="stc_06" class="sta_workData" position="absolute 9 195 755 221"/>
        <Static id="stc_08" text="담 당 자" class="sta_workLabel1" position="absolute 9 195 83 221" validate=""/>
        <Static id="stc_11" class="sta_workData" position="absolute 9 220 755 246"/>
        <Static id="stc_12" text="담당자 이메일" class="sta_workLabel1" position="absolute 377 195 475 221" validate=""/>
        <Static id="stc_13" class="sta_workData" position="absolute 9 245 755 271"/>
        <Static id="stc_14" text="은행코드" class="sta_workLabel1" position="absolute 9 245 83 271" validate=""/>
        <Static id="stc_16" class="sta_workData" position="absolute 9 270 755 296"/>
        <Static id="stc_17" text="예 금 주" class="sta_workLabel1" position="absolute 9 270 83 296" validate=""/>
        <Static id="stc_18" class="sta_workData" position="absolute 9 295 755 321"/>
        <Static id="mem_nm_txt00" text="대표자명" class="sta_workLabel1_P" position="absolute 9 95 83 121" validate=""/>
        <Static id="stc_40" text="주 소 지" class="sta_workLabel1" position="absolute 9 145 83 196" validate="" style="align:center middle;"/>
        <Static id="stc_07" text="전화번호" class="sta_workLabel1" position="absolute 9 120 83 146" validate=""/>
        <Static id="stc_20" text="팩스번호" class="sta_workLabel1" position="absolute 377 120 474 146" validate="" style="align:left top;"/>
        <Static id="stc_22" text="담당자 전화번호" class="sta_workLabel1" position="absolute 9 220 123 246" validate="" style="font:Dotum,8;"/>
        <Static id="stc_23" text="계좌번호" class="sta_workLabel1" position="absolute 378 270 452 296" validate=""/>
        <Static id="mem_nm_txt01" text="업체구분" class="sta_workLabel1_P" position="absolute 9 295 83 321" validate=""/>
        <Button id="btn_delete" taborder="22" tabstop="false" text="삭제" onclick="btn_delete_onclick" class="btn_WF_Common" visible="true" position="absolute 690 45 754 65" tooltiptext="초기화" style="border:0 none #000000ff ;padding:0 0 0 0;" enable="false"/>
        <Edit id="edt_custmr_nm" taborder="0" imemode="hangul" lengthunit="utf8" maxlength="33" position="absolute 85 73 361 93"/>
        <TextArea id="edt_custmr_note" taborder="19" wordwrap="both" position="absolute 85 323 741 363" imemode="hangul"/>
        <Edit id="edt_staff_nm" taborder="10" imemode="hangul" lengthunit="utf8" maxlength="60" position="absolute 85 198 215 218"/>
        <Edit id="edt_staff_email" taborder="11" imemode="alpha" lengthunit="utf8" maxlength="60" position="absolute 477 198 654 218"/>
        <Edit id="edt_custmr_bank_depr" taborder="16" imemode="alpha" lengthunit="utf8" maxlength="60" position="absolute 85 273 215 293"/>
        <Button id="btn_srchAddrPop" taborder="8" tabstop="false" class="btn_workSrcPop" position="absolute 496 148 516 168" onclick="btn_srchAddrPop_onclick"/>
        <Edit id="edt_custmr_addr" taborder="7" enable="true" position="absolute 162 148 494 168" readonly="true" style="background:URL('theme://images/bg_compN.png') stretch 5,5;border:0 none #4c8de4ff ; :disabled {background:URL('theme://images/bg_compD.png') stretch 5,5;}"/>
        <Edit id="edt_custmr_addr2" taborder="9" imemode="hangul" lengthunit="utf8" maxlength="300" position="absolute 85 173 423 193"/>
        <Edit id="edt_custmr_tel" taborder="4" imemode="alpha" lengthunit="utf8" maxlength="60" position="absolute 85 123 215 143"/>
        <Edit id="edt_custmr_fax" taborder="5" imemode="alpha" lengthunit="utf8" maxlength="60" position="absolute 476 123 606 143"/>
        <Button id="btn_funrl" taborder="1" tabstop="false" text="장례식장 조회" class="btn_WF_Common" position="absolute 363 73 459 93" tooltiptext="초기화" style="border:0 none #000000ff ;padding:0 0 0 0;" onclick="btn_funrl_onclick"/>
        <Edit id="edt_staff_tel" taborder="12" imemode="alpha" lengthunit="utf8" maxlength="60" position="absolute 125 223 300 243"/>
        <Button id="btn_bank" taborder="15" tabstop="false" onclick="btn_bank_onclick" class="btn_workSrcPop" position="absolute 261 248 281 268"/>
        <Edit id="edt_custmr_bank_accnt" taborder="17" imemode="alpha" lengthunit="utf8" maxlength="60" position="absolute 454 273 629 293"/>
        <Combo id="cbo_custmr_fg" taborder="18" position2="absolute l:85 w:130 t:299 h:20" positiontype="position2" index="-1" codecolumn="codecolumn" datacolumn="datacolumn">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn">0001</Col>
                <Col id="datacolumn">매입업체</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0002</Col>
                <Col id="datacolumn">행사외주 업</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0003</Col>
                <Col id="datacolumn">매출업체</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0004</Col>
                <Col id="datacolumn">장례식장</Col>
              </Row>
            </Rows>
          </Dataset>
        </Combo>
        <Edit id="edt_custmr_owner" taborder="2" lengthunit="utf8" maxlength="20" position="absolute 85 98 215 118" readonly="false" imemode="hangul"/>
        <Edit id="edt_custmr_zip_cd" taborder="6" enable="true" position="absolute 85 148 159 168" readonly="true" style="background:URL('theme://images/bg_compN.png') stretch 5,5;border:0 none #4c8de4ff ;align:center middle; :disabled {background:URL('theme://images/bg_compD.png') stretch 5,5;}"/>
        <Edit id="edt_bank_cd" taborder="13" imemode="alpha" lengthunit="utf8" maxlength="60" position="absolute 85 248 132 268" readonly="false" style="background:URL('theme://images/bg_compN.png') stretch 5,5;"/>
        <Edit id="edt_bank_nm" taborder="14" imemode="hangul" lengthunit="utf8" maxlength="60" position="absolute 135 248 259 268" readonly="false" style="background:URL('theme://images/bg_compN.png') stretch 5,5;"/>
        <MaskEdit id="medt_custrm_reg_no" taborder="3" type="string" mask="###-##-#####" position="absolute 476 98 567 119" onkeyup="medt_custrm_reg_no_onkeyup"/>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item6" compid="edt_custmr_nm" propid="value" datasetid="ds_list" columnid="custmr_nm"/>
      <BindItem id="item10" compid="edt_custmr_owner" propid="value" datasetid="ds_list" columnid="custmr_owner"/>
      <BindItem id="item12" compid="edt_custmr_addr" propid="value" datasetid="ds_list" columnid="custmr_addr"/>
      <BindItem id="item13" compid="edt_custmr_addr2" propid="value" datasetid="ds_list" columnid="custmr_addr2"/>
      <BindItem id="item24" compid="edt_custmr_note" propid="value" datasetid="ds_list" columnid="custmr_note"/>
      <BindItem id="item3" compid="edt_staff_nm" propid="value" datasetid="ds_list" columnid="staff_nm"/>
      <BindItem id="item4" compid="edt_staff_email" propid="value" datasetid="ds_list" columnid="staff_email"/>
      <BindItem id="item8" compid="edt_custmr_bank_depr" propid="value" datasetid="ds_list" columnid="custmr_bank_depr"/>
      <BindItem id="item15" compid="edt_custmr_tel" propid="value" datasetid="ds_list" columnid="custmr_tel"/>
      <BindItem id="item16" compid="edt_custmr_fax" propid="value" datasetid="ds_list" columnid="custmr_fax"/>
      <BindItem id="item0" compid="edt_staff_tel" propid="value" datasetid="ds_list" columnid="staff_tel"/>
      <BindItem id="item18" compid="edt_custmr_bank_accnt" propid="value" datasetid="ds_list" columnid="custmr_bank_accnt"/>
      <BindItem id="item1" compid="cbo_custmr_fg" propid="value" datasetid="ds_list" columnid="custmr_fg"/>
      <BindItem id="item2" compid="edt_custmr_zip_cd" propid="value" datasetid="ds_list" columnid="custmr_zip_cd"/>
      <BindItem id="item7" compid="edt_bank_cd" propid="value" datasetid="ds_list" columnid="custmr_bank_cd"/>
      <BindItem id="item9" compid="edt_bank_nm" propid="value" datasetid="ds_list" columnid="bank_nm"/>
      <BindItem id="item11" compid="medt_custrm_reg_no" propid="value" datasetid="ds_list" columnid="custmr_reg_no"/>
    </Bind>
    <Objects>
      <Dataset id="ds_trans_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="strSvcID" type="STRING" size="256"/>
          <Column id="strURL" type="STRING" size="256"/>
          <Column id="strInDatasets" type="STRING" size="256"/>
          <Column id="strOutDatasets" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list_tmp" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="custmr_note" type="STRING" size="32"/>
          <Column id="custmr_fax" type="STRING" size="32"/>
          <Column id="seq" type="STRING" size="32"/>
          <Column id="addr" type="STRING" size="32"/>
          <Column id="custmr_zip_cd" type="STRING" size="32"/>
          <Column id="custmr_tel" type="STRING" size="32"/>
          <Column id="custmr_fg" type="STRING" size="32"/>
          <Column id="custmr_nm" type="STRING" size="32"/>
          <Column id="custmr_cd" type="STRING" size="32"/>
          <Column id="jigu" type="STRING" size="32"/>
          <Column id="staff_nm" type="STRING" size="32"/>
          <Column id="staff_tel" type="STRING" size="32"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="custmr_nm" type="STRING" size="256"/>
          <Column id="custmr_owner" type="STRING" size="256"/>
          <Column id="custmr_reg_no" type="STRING" size="256"/>
          <Column id="custmr_tel" type="STRING" size="256"/>
          <Column id="custmr_fax" type="STRING" size="256"/>
          <Column id="custmr_zip_cd" type="STRING" size="256"/>
          <Column id="custmr_addr" type="STRING" size="256"/>
          <Column id="custmr_addr2" type="STRING" size="256"/>
          <Column id="staff_nm" type="STRING" size="256"/>
          <Column id="staff_tel" type="STRING" size="256"/>
          <Column id="staff_email" type="STRING" size="256"/>
          <Column id="custmr_bank_cd" type="STRING" size="256"/>
          <Column id="custmr_bank_depr" type="STRING" size="256"/>
          <Column id="custmr_bank_accnt" type="STRING" size="256"/>
          <Column id="custmr_fg" type="STRING" size="256"/>
          <Column id="custmr_note" type="STRING" size="256"/>
          <Column id="custmr_cd" type="STRING" size="256"/>
          <Column id="bank_nm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cond" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="custmr_nm" type="STRING" size="256"/>
          <Column id="custmr_reg_no" type="STRING" size="256"/>
          <Column id="custmr_owner" type="STRING" size="256"/>
          <Column id="custmr_cd" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/********************************************************************************************/
/* 1. Include Library include, variables Declaration 영역                                  */
/********************************************************************************************/
include "LIB::lib_All.xjs";
var fv_custmr_cd = "";
var fv_custmr_cd2 = "";
var fv_cmd = "";				

/********************************************************************************************/
/* 2. Form 관련(onload 및 Form 이벤트) 처리                                           	*/
/********************************************************************************************/
function frm_onload(obj:Form, e:LoadEventInfo)
{
	if ( !gfn_isEmpty(p_custmr_cd) ) {
		fv_custmr_cd = p_custmr_cd;
		fn_search();  /// 조회일경우 >> 조회함수
		btn_delete.enable = true;
	}
	else {
		ds_list.clearData();
		ds_list.addRow();
	}
}

/********************************************************************************************/
/* 3. Callback(gfn_Transaction 호출 후 처리내용)                                   		*/
/********************************************************************************************/
function fn_callBack(svcid, errcd, errmsg)
{
	switch (svcid) {
		// 조회
		case "search":
			fn_postSearch();
		break;
		
		case "save":
			fn_postSave();
		break;

		//입력
		case "insrtCustmrMng":
			gfn_appendSearchDs(ds_list, ds_list_tmp);
		break;

		case "updateCustmrMng":
			alert("수정하였습니다.");
		break;

		case "deleteCustmr":
			alert("삭제완료했습니다..");
			close();
		break;
	}
}

/********************************************************************************************/
/**   4. Validation 처리                                                                   	*/
/********************************************************************************************/


/********************************************************************************************/
/**   5. 서비스 호출(gfn_Transaction)                                                   	*/
/********************************************************************************************/



/********************************************************************************************/
/**   7. 이벤트(Event) Function                                                          	*/
/********************************************************************************************/

//저장
function btn_save_onclick(obj:Button,  e:ClickEventInfo)
{
	fv_cmd = "저장";
	fn_save();
}


//닫기
function btn_close_onclick(obj:Button,  e:ClickEventInfo)
{
	close();
}

//초기화
function btn_init_onclick(obj:Button,  e:ClickEventInfo)
{
	edt_custmr_nm.value='';
	edt_custmr_owner.value='';
	medt_custrm_reg_no.value='';
	edt_custmr_tel.value='';
	edt_custmr_fax.value='';
	edt_custmr_zip_cd.value='';
	edt_custmr_addr.value='';
	edt_custmr_addr2.value='';
	edt_staff_nm.value='';
	edt_staff_tel.value='';
	edt_staff_email.value='';
	edt_custmr_bank_cd.value='';
	edt_custmr_bank_nm.value='';
	edt_custmr_bank_depr.value='';
	edt_custmr_bank_accnt.value='';
	cbo_custmr_fg.value='';
	edt_custmr_note.value='';
	fv_cmd = "";
}

//삭제 버튼
function btn_delete_onclick(obj:Button,  e:ClickEventInfo)
{
	var userAns = confirm("삭제하시겠습니까?");
	if ( !userAns ) {
		return;
	}
	fv_cmd = "삭제";
	ds_list.deleteRow(0);
	fn_save();
}

//조회전 처리 조회조건셋팅
function fn_preSearch()
{
	ds_cond.clearData();
	ds_cond.addRow();
	ds_cond.setColumn(0, "custmr_cd", fv_custmr_cd);
	return true;
}

//조회
function fn_search(obj, e)
{
	// 유효성 체크
	if ( !fn_preSearch() ) {
		return;
	}
	
	var szSvcid       = "search";
    var szController  = "/dlw/basiDataMng/getCustmrMngList";
    var szInDs        = "ds_input=ds_cond";
    var szOutDs       = "ds_list=ds_output";
    var szParam       = "";
    var szRetCallback = "fn_callBack";

    // 트랜젝션 공통함수 호출
    gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback);
}

//조회 결과 
function fn_postSearch() {
	trace(ds_list.saveXML());
}

//조회전 처리 조회조건셋팅
function fn_preSave()
{
	if ( !gfn_isUpdate(ds_list) ) { // 체크박스가 있는 그리드와 바인드된 데이터셋에는 사용하면 안됨
		alert("변경된 내역이 없습니다.");
		return false;
	}
	
	if ("삭제" != fv_cmd) {	
		if (gfn_isNull(edt_custmr_nm.value)) {
			edt_custmr_nm.setFocus();
			alert("상호명을 입력하세요.");
			return false;
		}
		else if(gfn_isNull(edt_custmr_owner.value)) {
			edt_custmr_owner.setFocus();
			alert("대표자명을 입력하세요.");
			return false;
		}
		else if (gfn_isNull(cbo_custmr_fg.value)) {
			cbo_custmr_fg.setFocus();
			alert("업체구분을 입력하세요.");
			return false;
		}	
	}

	/*
	ds_cond.clearData();
	ds_cond.addRow();
	ds_cond.setColumn(0, "custmr_cd", fv_custmr_cd);
	*/

	return true;
}

//조회
function fn_save(obj, e)
{
	// 유효성 체크
	if ( !fn_preSave() ) {
		return;
	}
	
	var szSvcid       = "save";
    var szController  = "/dlw/basiDataMng/saveCustmr"; // insrtCustmrMng, updateCustmrMng, deleteCustmr
    var szInDs        = "ds_input=ds_list:U";
    var szOutDs       = "";
    var szParam       = "";
    var szRetCallback = "fn_callBack";

    // 트랜젝션 공통함수 호출
    gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback);
}

//조회 결과 
function fn_postSave() {
	alert(fv_cmd + " 되었습니다.");
	
	if (gfn_isEmpty(fv_custmr_cd)) {
		opener.edt_custmr_nm.value = edt_custmr_nm.value;
	}
	
	opener.fn_search();
	fv_cmd = "";
	close();
}

// 우편번호 조회 팝업
function btn_srchAddrPop_onclick(obj:Button,  e:ClickEventInfo)
{
	// 결과는 팝업에서 바로 컴포넌트로 입력
	//var reVal = gfn_diaLog("우편번호조회", -1, -1, -1, -1, "PS990000::PS994100.xfdl", false, {}, false, false, true, null, null, true);
	var sPrmr = {};
	var reVal = gfn_diaLog("주소 조회", -1, -1, 884, 601, "PS990000::PS992099.xfdl", false, sPrmr, false, false, true);	
}

// 주소 값 등록(팝업창 호출)
function fn_daum_addr()
{
	//alert(gv_dpost + " / " + gv_daddr);
	edt_custmr_zip_cd.value = gv_dpost; 
	edt_custmr_addr.value = gv_daddr;	
}

// 은행조회 팝업
function btn_bank_onclick(obj:Button,  e:ClickEventInfo)
{
	var sPrmr ={p_bank_cd:"", p_bank_nm:edt_bank_nm.value};
	var reVal = gfn_diaLog("은행 조회", -1, -1, 884, 601, "PS990000::PS992500.xfdl", false, sPrmr, false, false, true);

	if( reVal != null ) {
		if(reVal.getColumn(0, "cd") != "") {
			ds_list.setColumn(0, "custmr_bank_cd",reVal.getColumn(0, "cd"));
			ds_list.setColumn(0, "bank_nm",reVal.getColumn(0, "cd_nm"));
			return;
		}
	}
}

// 장례식장 조회 팝업
function btn_funrl_onclick(obj:Button,  e:ClickEventInfo)
{
	var sPrmr = {"p_cd_nm":edt_custmr_nm.value};
	var reVal = gfn_diaLog("장례식장 조회", 300, 300, 884, 601, "PS990000::PS994300.xfdl", false, sPrmr, false, false, true);
	
	if( reVal != null ){
		if(reVal.getColumn(0, "cd") != ""){
			// ds_list.setColumn(0, "custmr_cd", reVal.getColumn(0, "cd"));
			ds_list.setColumn(0, "custmr_nm", reVal.getColumn(0, "cd_nm"));
		}
	}
}

// 사업자등록번호 입력완료시 다음 컴포넌트로 포커스
function medt_custrm_reg_no_onkeyup(obj:MaskEdit, e:KeyEventInfo) {
	var sVal = gfn_Trim(obj.value);
	if ( !gfn_isEmpty(sVal) && sVal.length == 10 ) {
		edt_custmr_tel.setFocus();
	}
}
]]></Script>
  </Form>
</FDL>
