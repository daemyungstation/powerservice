<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="test" classname="test" inheritanceid="" position="absolute 0 0 1007 808" titletext="첨부파일 샘플" onload="test_onload">
    <Layouts>
      <Layout>
        <Static id="Static01" text="구분" position="absolute 0 0 130 26" style="background:#edeee6ff;border:1 solid #c6c6c5ff ;align:center middle;font:Tahoma,9,bold antialias;"/>
        <Static id="Static02" text="사용 예" position="absolute 129 0 617 26" style="background:#edeee6ff; border:1 solid #c6c6c5ff ; align:center middle; font:Tahoma,9,bold antialias; "/>
        <Static id="Static18" text="FileList형 파일첨부 샘플" position="absolute 0 25 130 232" style="background:#edeee6ff; border:1 solid #c6c6c5ff ; align:center middle; font:Tahoma,9,bold antialias; "/>
        <Static id="Static19" position="absolute 129 25 617 232" style="background:#ffffffff; border:1 solid #c6c6c5ff ; align:center middle; font:Tahoma,9,bold antialias; "/>
        <Static id="Static09" position="absolute 616 25 987 232" anchor="left top right" style="background:#ffffffff; border:1 solid #c6c6c5ff ; align:center middle; font:Tahoma,9,bold antialias; "/>
        <Static id="Static08" text="처리 가이드" position="absolute 616 0 987 26" anchor="left top right" style="background:#edeee6ff; border:1 solid #c6c6c5ff ; align:center middle; font:Tahoma,9,bold antialias; "/>
        <Uobj_DateBetween id="Uobj_DateBetween00" position2="absolute l:157 w:239 t:85 h:26" positiontype="position2" titletext="New Form" taborder="1" text="Uobj_DateBetween00" scrollbars="none"/>
        <Uobj_TimeBetween id="Uobj_TimeBetween00" position2="absolute l:157 w:297 t:120 h:24" positiontype="position2" titletext="New Form" taborder="1" text="Uobj_TimeBetween00" scrollbars="none"/>
        <Div id="div_FileAttach" taborder="1" text="Div00" position="absolute 138 80 605 215" url="COMM::Comm_FileUpDownload.xfdl"/>
        <Button id="Button00" taborder="1" text="데이타셋 확인용" position="absolute 235 36 352 62" onclick="Button00_onclick"/>
        <Button id="btn_Upload" taborder="1" text="저장(업로드)" position="absolute 141 36 233 62" onclick="btn_Upload_onclick"/>
        <Button id="btn_Search" taborder="1" text="조회처리" position="absolute 354 36 426 62" onclick="btn_Search_onclick"/>
        <Static id="Static00" text="&#9;- gfn_initAttachFileInfo : [필수]파일 업로드 초기화 공통함수(Form Onload시에 호출 처리)&#13;&#10;&#13;&#10;&#9;- gfn_setAttachFileUpload : 파일 업로드 공통함수(저장시에 선처리로 파일 Upload 처리하는 경우 호출 처리)&#13;&#10;&#13;&#10;&#9;- gfn_setAttachFileList : 파일리스트 설정함수(첨부파일정보 조회 후 CallBack에서 호출처리)" position="absolute 625 28 978 226" onclick="Static00_onclick" style="linespace:5;"/>
        <Static id="Static03" text="가로형태 파일업로드&#13;&#10;(Multi) 샘플" position="absolute 0 231 130 323" style="background:#edeee6ff; border:1 solid #c6c6c5ff ; align:center middle; font:Tahoma,9,bold antialias; "/>
        <Static id="Static04" position="absolute 129 231 617 323" style="background:#ffffffff; border:1 solid #c6c6c5ff ; align:center middle; font:Tahoma,9,bold antialias; "/>
        <Static id="Static05" position="absolute 616 231 987 323" anchor="left top right" style="background:#ffffffff; border:1 solid #c6c6c5ff ; align:center middle; font:Tahoma,9,bold antialias; "/>
        <Div id="div_FileAttach2" taborder="1" text="Div00" position="absolute 140 271 607 291" url="COMM::Comm_FileUpload.xfdl" style="background:beige;"/>
        <Static id="Static06" text="가로형태 파일업로드(Single) 샘플" position="absolute 0 322 130 414" style="background:#edeee6ff; border:1 solid #c6c6c5ff ; align:center middle; font:Tahoma,9,bold antialias; "/>
        <Static id="Static07" position="absolute 129 322 617 414" style="background:#ffffffff; border:1 solid #c6c6c5ff ; align:center middle; font:Tahoma,9,bold antialias; "/>
        <Static id="Static10" position="absolute 616 322 987 414" anchor="left top right" style="background:#ffffffff; border:1 solid #c6c6c5ff ; align:center middle; font:Tahoma,9,bold antialias; "/>
        <Div id="div_FileAttach3" taborder="1" url="COMM::Comm_FileUpload.xfdl" style="background:beige;" text="Div00" position="absolute 140 362 404 382"/>
        <Button id="Button01" taborder="1" text="데이타셋 확인용" position="absolute 139 241 256 267" onclick="Button01_onclick"/>
        <Button id="Button02" taborder="1" text="데이타셋 확인용" position="absolute 234 332 351 358" onclick="Button02_onclick"/>
        <Button id="Button03" taborder="1" text="초기화" position="absolute 258 241 320 267" onclick="Button03_onclick"/>
        <Button id="Button04" taborder="1" text="초기화" position="absolute 353 332 415 358" onclick="Button04_onclick"/>
        <Button id="btn_Upload00" taborder="1" text="저장(업로드)" position="absolute 140 332 232 358" onclick="btn_Upload00_onclick"/>
        <Static id="Static11" text="대용량 엑셀파일업로드" position="absolute 0 413 130 650" style="background:#edeee6ff; border:1 solid #c6c6c5ff ; align:center middle; font:Tahoma,9,bold antialias; "/>
        <Static id="Static12" position="absolute 129 413 617 650" style="background:#ffffffff; border:1 solid #c6c6c5ff ; align:center middle; font:Tahoma,9,bold antialias; "/>
        <Button id="Button05" taborder="1" text="엑셀파일선택" position="absolute 140 422 248 448" onclick="Button05_onclick"/>
        <TextArea id="txa_fileInfo" taborder="1" position="absolute 141 454 604 642"/>
        <Static id="Static13" position="absolute 616 413 987 650" anchor="left top right" style="background:#ffffffff; border:1 solid #c6c6c5ff ; align:center middle; font:Tahoma,9,bold antialias; "/>
        <Static id="Static14" onclick="Static00_onclick" position="absolute 623 406 984 644" style="linespace:5;" text="* 대용량 엑셀업로드 처리하는 방법&#13;&#10;&#13;&#10;1.&#9;부모창에 Excel File 선택시 Import할 데이터셋을 생성한다.(필수)&#13;&#10;2.&#9;대용량 엑셀업로드 공통팝업창 호출 공통함수(gfn_openExcelFileUploadBigData)를 호출한다.&#13;&#10;3.&#9;대용량 엑셀업로드 공통팝업창에서 업로드할 엑셀파일을 선택한다.&#13;&#10;4.&#9;&quot;확인&quot;버튼을 클릭하면 파일이 서버로 업로드되고 파일DB에 저장된 파일정보를 공통팝업창이 닫히면서 부모창에 반환한다.(이때, 선택한 엑셀파일과 동일한 CSV파일이 동일한 경로에 생성되고 실제 서버로 전송되는 파일은 새로생성된 CSV파일이다.)&#13;&#10;5.&#9;부모창에서는 전달받은 Upload 파일정보를 이용해서 배치로 대용량 엑셀업로드 작업을 수행한다.&#13;&#10;"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_AttachFileList" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_Result" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_AttachFileList2" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_AttachFileList3" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_ObjDsExcel" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="Column0" type="STRING" size="256"/>
          <Column id="Column1" type="STRING" size="256"/>
          <Column id="Column2" type="STRING" size="256"/>
          <Column id="Column3" type="STRING" size="256"/>
          <Column id="Column4" type="STRING" size="256"/>
          <Column id="Column5" type="STRING" size="256"/>
          <Column id="Column6" type="STRING" size="256"/>
          <Column id="Column7" type="STRING" size="256"/>
          <Column id="Column8" type="STRING" size="256"/>
          <Column id="Column9" type="STRING" size="256"/>
          <Column id="Column10" type="STRING" size="256"/>
          <Column id="Column11" type="STRING" size="256"/>
          <Column id="Column12" type="STRING" size="256"/>
          <Column id="Column13" type="STRING" size="256"/>
          <Column id="Column14" type="STRING" size="256"/>
          <Column id="Column15" type="STRING" size="256"/>
          <Column id="Column16" type="STRING" size="256"/>
          <Column id="Column17" type="STRING" size="256"/>
          <Column id="Column18" type="STRING" size="256"/>
          <Column id="Column19" type="STRING" size="256"/>
          <Column id="Column20" type="STRING" size="256"/>
          <Column id="Column21" type="STRING" size="256"/>
          <Column id="Column22" type="STRING" size="256"/>
          <Column id="Column23" type="STRING" size="256"/>
          <Column id="Column24" type="STRING" size="256"/>
          <Column id="Column25" type="STRING" size="256"/>
          <Column id="Column26" type="STRING" size="256"/>
          <Column id="Column27" type="STRING" size="256"/>
          <Column id="Column28" type="STRING" size="256"/>
          <Column id="Column29" type="STRING" size="256"/>
          <Column id="Column30" type="STRING" size="256"/>
          <Column id="Column31" type="STRING" size="256"/>
          <Column id="Column32" type="STRING" size="256"/>
          <Column id="Column33" type="STRING" size="256"/>
          <Column id="Column34" type="STRING" size="256"/>
          <Column id="Column35" type="STRING" size="256"/>
          <Column id="Column36" type="STRING" size="256"/>
          <Column id="Column37" type="STRING" size="256"/>
          <Column id="Column38" type="STRING" size="256"/>
          <Column id="Column39" type="STRING" size="256"/>
          <Column id="Column40" type="STRING" size="256"/>
          <Column id="Column41" type="STRING" size="256"/>
          <Column id="Column42" type="STRING" size="256"/>
          <Column id="Column43" type="STRING" size="256"/>
          <Column id="Column44" type="STRING" size="256"/>
          <Column id="Column45" type="STRING" size="256"/>
          <Column id="Column46" type="STRING" size="256"/>
          <Column id="Column47" type="STRING" size="256"/>
          <Column id="Column48" type="STRING" size="256"/>
          <Column id="Column49" type="STRING" size="256"/>
          <Column id="Column50" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind/>
    <Script type="xscript4.0"><![CDATA[
include "LIB::lib_All.xjs";

/*
	파일 업로드/다운로드 가이드
	
	gfn_initAttachFileInfo		: [필수]파일 업로드 초기화 공통함수(Form Onload시에 호출 처리)
	gfn_setAttachFileUpload		: 파일 업로드 공통함수(저장시에 선처리로 파일 Upload 처리하는 경우 호출 처리)
	gfn_setAttachFileList		: 파일리스트 설정함수(첨부파일정보 조회 후 CallBack에서 호출처리)
	gfn_setAttachFileInit		: 파일 업로드 후 파일정보 초기화 처리
*/

function test_onload(obj:Form, e:LoadEventInfo)
{
	// 시스템 공통함수 호출
	gfn_commInit(obj);
	
	// 폼 공통함수 호출
	fn_init();
	
	// 공통버튼 상태변경
	gfn_setCommBtn_Status(false,false,false,false,false,false);	
}

function fn_init()
{
	//TO-DO: 폼 초기화 관련 처리
	
	// FileList 첨부파일 처리 샘플
	gfn_initAttachFileInfo(gfn_getAttachDiv_Upload(), div_FileAttach, ds_AttachFileList);							// FileList 첨부파일 처리 샘플(Upload)
	//gfn_initAttachFileInfo(gfn_getAttachDiv_Download(), div_FileAttach, ds_AttachFileList);						// FileList 첨부파일 처리 샘플(Download)	
	
	// 가로형 첨부파일 처리 샘플
	gfn_initAttachFileInfo(gfn_getAttachDiv_Upload(), div_FileAttach2, ds_AttachFileList2, "M");					// Multi File 처리 샘플(Upload)
	//gfn_initAttachFileInfo(gfn_getAttachDiv_Download(), div_FileAttach2, ds_AttachFileList2, "M");				// Multi File 처리 샘플(Download)
	
	
	gfn_initAttachFileInfo(gfn_getAttachDiv_Upload(), div_FileAttach3, ds_AttachFileList3, "S", "", "IMAGE");		// Single File(이미지) 처리 샘플(Upload)
	//gfn_initAttachFileInfo(gfn_getAttachDiv_Download(), div_FileAttach3, ds_AttachFileList3, "S", "", "IMAGE");	// Single File(이미지) 처리 샘플(Download)
}

function Button00_onclick(obj:Button,  e:ClickEventInfo)
{
	trace(this.ds_AttachFileList.saveXML());
}

// 업로드
function btn_Upload_onclick(obj:Button,  e:ClickEventInfo)
{
	if(!confirm("저장(업로드포함) 하시겠습니까?")) return false;

	if(gfn_setAttachFileUpload(div_FileAttach)) {
	
		trace(ds_AttachFileList.saveXML());
	
		// KWData 설정
// 		gfn_kwDataInit();
// 		gfn_setKwData_trscCode("TST0000104");			
// 		
// 		gfn_tranNMCI(gfn_getCommTypeAppend() 
// 					, "FileInfo=ds_AttachFileList:U"
// 					, "ds_Result=FileInfo"
// 					, "fn_commSave_callBack");	
	}				
}

function fn_commSave_callBack(strSvcID, nErrorCode, strErrorMsg)
{
	if(nErrorCode != 0) {
		return;
	}
}	

function btn_Search_onclick(obj:Button,  e:ClickEventInfo)
{
	var nRow = ds_AttachFileList.addRow();
	this.ds_AttachFileList.setColumn(nRow, "fileName", "aaa");

	gfn_setAttachFileList(div_FileAttach);
}

function Static00_onclick(obj:Static,  e:ClickEventInfo)
{
	
}

function Button01_onclick(obj:Button,  e:ClickEventInfo)
{
	alert(this.ds_AttachFileList2.saveXML());
}

function Button02_onclick(obj:Button,  e:ClickEventInfo)
{
	alert(this.ds_AttachFileList3.saveXML());
}

function Button03_onclick(obj:Button,  e:ClickEventInfo)
{
	gfn_setAttachFileInit(div_FileAttach2);
}

function Button04_onclick(obj:Button,  e:ClickEventInfo)
{
	gfn_setAttachFileInit(div_FileAttach3);
}

function btn_Upload00_onclick(obj:Button,  e:ClickEventInfo)
{
	if(!confirm("저장(업로드포함) 하시겠습니까?")) return false;

	if(gfn_setAttachFileUpload(div_FileAttach3)) {
	
		// TO-DO : 첨부파일 저장 이후 로직 처리
		
		//trace(ds_AttachFileList3.saveXML());
	
	}	
}

function Button05_onclick(obj:Button,  e:ClickEventInfo)
{
	txa_fileInfo.value = "";

	var objFileInfoDs = gfn_openExcelFileUploadBigData(ds_ObjDsExcel);
	if(objFileInfoDs instanceof Dataset) {
		txa_fileInfo.value = objFileInfoDs.saveXML();
		trace(objFileInfoDs.saveXML());
	}
}
]]></Script>
  </Form>
</FDL>
