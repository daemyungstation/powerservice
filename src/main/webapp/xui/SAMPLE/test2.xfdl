<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="test2" classname="test2" inheritanceid="" position="absolute 0 0 1024 768" titletext="New Form" onload="test2_onload">
    <Layouts>
      <Layout>
        <Button id="Button00" taborder="0" text="조회" position="absolute 8 11 99 31" onclick="Button00_onclick"/>
        <Grid id="Grid00" taborder="1" useinputpanel="false" position="absolute 9 45 962 427" binddataset="gds_ComCode_Default" formats="&lt;Formats&gt;&#10;  &lt;Format id=&quot;default&quot;&gt;&#10;    &lt;Columns&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;    &lt;/Columns&gt;&#10;    &lt;Rows&gt;&#10;      &lt;Row band=&quot;head&quot; size=&quot;24&quot;/&gt;&#10;      &lt;Row band=&quot;body&quot; size=&quot;24&quot;/&gt;&#10;    &lt;/Rows&gt;&#10;    &lt;Band id=&quot;head&quot;&gt;&#10;      &lt;Cell col=&quot;0&quot; disptype=&quot;normal&quot; text=&quot;COMN_CD_ID&quot;/&gt;&#10;      &lt;Cell col=&quot;1&quot; disptype=&quot;normal&quot; text=&quot;BSWR_NM&quot;/&gt;&#10;      &lt;Cell col=&quot;2&quot; disptype=&quot;normal&quot; text=&quot;CD_VL&quot;/&gt;&#10;      &lt;Cell col=&quot;3&quot; disptype=&quot;normal&quot; text=&quot;CD_VL_NM&quot;/&gt;&#10;      &lt;Cell col=&quot;4&quot; disptype=&quot;normal&quot; text=&quot;CD__FL_NM&quot;/&gt;&#10;    &lt;/Band&gt;&#10;    &lt;Band id=&quot;body&quot;&gt;&#10;      &lt;Cell col=&quot;0&quot; disptype=&quot;normal&quot; text=&quot;bind:COMN_CD_ID&quot;/&gt;&#10;      &lt;Cell col=&quot;1&quot; disptype=&quot;normal&quot; text=&quot;bind:BSWR_NM&quot;/&gt;&#10;      &lt;Cell col=&quot;2&quot; disptype=&quot;normal&quot; text=&quot;bind:CD_VL&quot;/&gt;&#10;      &lt;Cell col=&quot;3&quot; disptype=&quot;normal&quot; text=&quot;bind:CD_VL_NM&quot;/&gt;&#10;      &lt;Cell col=&quot;4&quot; disptype=&quot;normal&quot; text=&quot;bind:CD__FL_NM&quot;/&gt;&#10;    &lt;/Band&gt;&#10;  &lt;/Format&gt;&#10;&lt;/Formats&gt;&#10;">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="289"/>
                <Column size="319"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell text="COMN_CD_ID"/>
                <Cell col="1" text="BSWR_NM"/>
                <Cell col="2" text="CD_VL"/>
                <Cell col="3" text="CD_VL_NM"/>
                <Cell col="4" text="CD_FL_NM"/>
              </Band>
              <Band id="body">
                <Cell text="bind:COMN_CD_ID"/>
                <Cell col="1" text="bind:BSWR_NM"/>
                <Cell col="2" text="bind:CD_VL"/>
                <Cell col="3" style="align:left;" text="bind:CD_VL_NM"/>
                <Cell col="4" style="align:left;" text="bind:CD_FL_NM"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Div id="Div00" taborder="1" text="Div00" position="absolute 710 6 944 40">
          <Layouts>
            <Layout>
              <Radio id="Radio00" taborder="0" innerdataset="@Dataset00" codecolumn="code" datacolumn="name" direction="vertical" position="absolute 15 6 225 29"/>
            </Layout>
          </Layouts>
        </Div>
        <Button id="Button01" taborder="1" text="공통코드 조회" position="absolute 106 11 222 31" onclick="Button01_onclick"/>
        <Tab id="Tab00" taborder="1" tabindex="0" scrollbars="autoboth" position="absolute 97 460 427 595">
          <Tabpages>
            <Tabpage id="tabpage1" text="tabpage1"/>
            <Tabpage id="tabpage5" text="tabpage5"/>
            <Tabpage id="tabpage3" text="tabpage3"/>
          </Tabpages>
        </Tab>
        <Button id="Button02" taborder="1" text="Button02" position="absolute 524 479 624 515" onclick="Button02_onclick"/>
        <Static id="Static00" text="Static00" position="absolute 702 445 804 473"/>
        <Button id="Button03" taborder="1" text="Button03" position="absolute 917 455 990 485" onclick="Button03_onclick"/>
        <Grid id="Grid01" taborder="1" useinputpanel="false" position="absolute 514 668 720 772" binddataset="ds_ComCode_Group" formats="&lt;Formats&gt;&#10;  &lt;Format id=&quot;default&quot;&gt;&#10;    &lt;Columns&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;      &lt;Col size=&quot;80&quot;/&gt;&#10;    &lt;/Columns&gt;&#10;    &lt;Rows&gt;&#10;      &lt;Row band=&quot;head&quot; size=&quot;24&quot;/&gt;&#10;      &lt;Row band=&quot;body&quot; size=&quot;24&quot;/&gt;&#10;    &lt;/Rows&gt;&#10;    &lt;Band id=&quot;head&quot;&gt;&#10;      &lt;Cell col=&quot;0&quot; disptype=&quot;normal&quot; text=&quot;COMN_CD_ID&quot;/&gt;&#10;      &lt;Cell col=&quot;1&quot; disptype=&quot;normal&quot; text=&quot;BSWR_NM&quot;/&gt;&#10;      &lt;Cell col=&quot;2&quot; disptype=&quot;normal&quot; text=&quot;CD_VL&quot;/&gt;&#10;      &lt;Cell col=&quot;3&quot; disptype=&quot;normal&quot; text=&quot;CD_VL_NM&quot;/&gt;&#10;      &lt;Cell col=&quot;4&quot; disptype=&quot;normal&quot; text=&quot;CD_FL_NM&quot;/&gt;&#10;    &lt;/Band&gt;&#10;    &lt;Band id=&quot;body&quot;&gt;&#10;      &lt;Cell col=&quot;0&quot; disptype=&quot;normal&quot; text=&quot;bind:COMN_CD_ID&quot;/&gt;&#10;      &lt;Cell col=&quot;1&quot; disptype=&quot;normal&quot; text=&quot;bind:BSWR_NM&quot;/&gt;&#10;      &lt;Cell col=&quot;2&quot; disptype=&quot;normal&quot; text=&quot;bind:CD_VL&quot;/&gt;&#10;      &lt;Cell col=&quot;3&quot; disptype=&quot;normal&quot; text=&quot;bind:CD_VL_NM&quot;/&gt;&#10;      &lt;Cell col=&quot;4&quot; disptype=&quot;normal&quot; text=&quot;bind:CD_FL_NM&quot;/&gt;&#10;    &lt;/Band&gt;&#10;  &lt;/Format&gt;&#10;&lt;/Formats&gt;&#10;">
          <Formats>
            <Format id="default">
              <Columns>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
                <Col size="80"/>
              </Columns>
              <Rows>
                <Row band="head" size="24"/>
                <Row band="body" size="24"/>
              </Rows>
              <Band id="head">
                <Cell col="0" text="COMN_CD_ID" displaytype="normal"/>
                <Cell col="1" text="BSWR_NM" displaytype="normal"/>
                <Cell col="2" text="CD_VL" displaytype="normal"/>
                <Cell col="3" text="CD_VL_NM" displaytype="normal"/>
                <Cell col="4" text="CD_FL_NM" displaytype="normal"/>
              </Band>
              <Band id="body">
                <Cell col="0" text="bind:COMN_CD_ID" displaytype="normal"/>
                <Cell col="1" text="bind:BSWR_NM" displaytype="normal"/>
                <Cell col="2" text="bind:CD_VL" displaytype="normal"/>
                <Cell col="3" text="bind:CD_VL_NM" displaytype="normal"/>
                <Cell col="4" text="bind:CD_FL_NM" displaytype="normal"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_input" firefirstcount="0" firenextcount="0" oncolumnchanged="ds_input_oncolumnchanged">
        <ColumnInfo>
          <Column id="trscCd" type="STRING" size="256"/>
          <Column id="hnglItemNm" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="trscCd">asdf</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="Dataset00" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="code" type="STRING" size="256"/>
          <Column id="name" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="code">0</Col>
            <Col id="name">선택</Col>
          </Row>
          <Row>
            <Col id="code">1</Col>
            <Col id="name">미선택</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="dsl_code" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CD_VL" type="STRING" size="256"/>
          <Column id="CD_VL_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsl_code2" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CD_VL" type="STRING" size="256"/>
          <Column id="CD_VL_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsl_code3" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="CD_VL" type="STRING" size="256"/>
          <Column id="CD_VL_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ComCode_Default">
        <ColumnInfo>
          <Column id="COMN_CD_ID" type="STRING" size="256"/>
          <Column id="BSWR_NM" type="STRING" size="256"/>
          <Column id="CD_VL" type="STRING" size="256"/>
          <Column id="CD_VL_NM" type="STRING" size="256"/>
          <Column id="CD_FL_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ComCode_Group">
        <ColumnInfo>
          <Column id="COMN_CD_ID" type="STRING" size="256"/>
          <Column id="BSWR_NM" type="STRING" size="256"/>
          <Column id="CD_VL" type="STRING" size="256"/>
          <Column id="CD_VL_NM" type="STRING" size="256"/>
          <Column id="CD_FL_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ComCode_Default_Local">
        <ColumnInfo>
          <Column id="COMN_CD_ID" type="STRING" size="256"/>
          <Column id="BSWR_NM" type="STRING" size="256"/>
          <Column id="CD_VL" type="STRING" size="256"/>
          <Column id="CD_VL_NM" type="STRING" size="256"/>
          <Column id="CD_FL_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ComCode_Group_Local">
        <ColumnInfo>
          <Column id="COMN_CD_ID" type="STRING" size="256"/>
          <Column id="BSWR_NM" type="STRING" size="256"/>
          <Column id="CD_VL" type="STRING" size="256"/>
          <Column id="CD_VL_NM" type="STRING" size="256"/>
          <Column id="CD_FL_NM" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_InputDate" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="StandardDate" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_OutputDate" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="StandardDate" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item0" compid="Static00" propid="text" datasetid="ds_input" columnid="trscCd"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[include "LIB::lib_All.xjs";


function test2_onload(obj:Form, e:LoadEventInfo)
{
	// 시스템 공통함수 호출
	//gfn_commInit(obj);
	
	Div00.Radio00.value = 0;
}

function Button00_onclick(obj:Button,  e:ClickEventInfo)
{
	// 공통코드 가져오기 Sync로 처리

	// 공통코드(Default) 가져오기
	gfn_kwDataInit();
	gfn_setKwData_nameSpace("com.kyowon.krp.sys.dc.generaladmnistrationdc.DCComnCdBasiInfoSqlMap");
	gfn_setKwData_sqlId("getListGnrlCd");

	gfn_tranDIS(gfn_getCommTypeAppend() 
				, ""
				, "gds_ComCode_Default=datas"
				, ""
				, false);
								
	// 공통코드(Group) 가져오기
	gfn_kwDataInit();
	gfn_setKwData_nameSpace("com.kyowon.krp.sys.dc.generaladmnistrationdc.DCComnCdBasiInfoSqlMap");
	gfn_setKwData_sqlId("getListSpcfCd");

	gfn_tranDIS(gfn_getCommTypeAppend() 
				, ""
				, "gds_ComCode_Group=datas"
				, ""
				, false);

	//trace(gds_ComCode_Default.saveXML());
	//trace(gds_ComCode_Group.saveXML());
	
	//gfn_debug(gds_ComCode_Group);
	
	// 공통코드 매핑
	gfn_getCommCode(gfn_getComCodeDefaultAll(), 	"10504", dsl_code);					
	gfn_getCommCode(gfn_getComCodeDefaultSelect(), 	"10348", dsl_code2, gfn_getComCodeCodeTypeGroup(), gfn_getComCodeColTypeMulti());		// 사업자
	gfn_getCommCode(gfn_getComCodeDefaultNone(), 	"10504", dsl_code3);					
	
	
	
// 	trace(dsl_code2.saveXML());
// 	gfn_debug(gds_ComCode_Default);
}

function fn_commSearch_callBack(strSvcID, nErrorCode, strErrorMsg)
{
	trace(gds_ComCode_Default.saveXML());
	//trace(gds_ComCode_Group.saveXML());
	
	//gfn_debug(gds_ComCode_Default);
}


function Button01_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_getTranCommCode();
}

/*****************************************************************************************
 * 함  수  명	: 	fn_getTranCommCode
 * 입      력	: 	
 * 반      환	:   
 * 기      능	: 	공통코드 Transaction으로 Login시에 가져오는 함수
 *****************************************************************************************/
function fn_getTranCommCode()
{
	// 공통코드 가져오기 Sync로 처리
	
	// 공통코드 가져올 대상 기준일자 처리
	var sStandardDate = gfn_getLength(getPrivateProfile("STANDARDDATE"));
	if(sStandardDate > 0) {
		ds_InputDate.setColumn(0, "StandardDate");
	} else {
		ds_InputDate.setColumn(0, "");
	}

	// 기준일자 가져오기
	gfn_kwDataInit();
	gfn_setKwData_nameSpace("com.kyowon.krp.sys.dc.generaladmnistrationdc.DCComnCdBasiInfoSqlMap");
	gfn_setKwData_sqlId("");

	gfn_tranDIS(gfn_getCommTypeAppend() 
				, "ds_InputDate=ds_InputDate"
				, "ds_OutputDate=datas"
				, ""
				, false);
	
	// 기준일자 개인화 설정 
	var sStandardDate = ds_OutputDate.getColumn(0, "STANDARDDATE");
	setPrivateProfile("STANDARDDATE", sStandardDate);			

	// 공통코드(Default) 가져오기
	gfn_kwDataInit();
	gfn_setKwData_nameSpace("com.kyowon.krp.sys.dc.generaladmnistrationdc.DCComnCdBasiInfoSqlMap");
	gfn_setKwData_sqlId("getListGnrlCd");

	gfn_tranDIS(gfn_getCommTypeAppend() 
				, "ds_InputDate=ds_InputDate"
				, "ds_ComCode_Default=datas"
				, ""
				, false);
								
	// 공통코드(Group) 가져오기
	gfn_kwDataInit();
	gfn_setKwData_nameSpace("com.kyowon.krp.sys.dc.generaladmnistrationdc.DCComnCdBasiInfoSqlMap");
	gfn_setKwData_sqlId("getListSpcfCd");

	gfn_tranDIS(gfn_getCommTypeAppend() 
				, "ds_InputDate=ds_InputDate"
				, "ds_ComCode_Group=datas"
				, ""
				, false);
				
	// 공통코드(Default) 파일 처리
	ds_ComCode_Default_Local.clearData();
	var sFileName = system.convertRealPath("%MYDOCUMENT%") + "krp_comcode_default.xml";
	var bExist = VirtualFile.isExist(sFileName);
	
	if(bExist) {		// 공통코드(Default) 읽기
		var vfile = new VirtualFile(sFileName, VirtualFile.openRead | VirtualFile.openBinary);
		var buf = new Buffer(vfile.read(vfile.getFileSize(), "utf-8"), "utf-8");
		var strXml = buf.getUTF8(0);
		vfile.close();
		
		ds_ComCode_Default_Local.loadXML(strXml);
		
		// 이전에 등록된 코드가 있으면 삭제
		for(var i=0;i<ds_ComCode_Default.rowcount;i++)
		{
			var nRow = ds_ComCode_Default_Local.findRow("COMN_CD_ID", ds_ComCode_Default.getColumn(i, "COMN_CD_ID"));
			if(nRow != -1) {
				ds_ComCode_Default_Local.deleteRow(nRow);
			}
		}
	} else {		// 공통코드(Default) 쓰기
		var vf = new VirtualFile;

		buf = ds_ComCode_Default.saveXML();
		bSuccess1 = vf.open(sFileName,VirtualFile.openWrite |VirtualFile.openBinary);
		bSuccess2 = vf.write(buf);
		bSuccess3 = vf.close();			
	}
	
	// 공통코드(Group) 파일 처리
	ds_ComCode_Group_Local.clearData();
	var sFileName = system.convertRealPath("%MYDOCUMENT%") + "krp_comcode_group.xml";
	var bExist = VirtualFile.isExist(sFileName);
	
	if(bExist) {		// 공통코드(Default) 읽기
		var vfile = new VirtualFile(sFileName, VirtualFile.openRead | VirtualFile.openBinary);
		var buf = new Buffer(vfile.read(vfile.getFileSize(), "utf-8"), "utf-8");
		var strXml = buf.getUTF8(0);
		vfile.close();
		
		ds_ComCode_Group_Local.loadXML(strXml);
		
		// 이전에 등록된 코드가 있으면 삭제
		for(var i=0;i<ds_ComCode_Group.rowcount;i++)
		{
			var nRow = ds_ComCode_Group_Local.findRow("COMN_CD_ID", ds_ComCode_Group.getColumn(i, "COMN_CD_ID"));
			if(nRow != -1) {
				ds_ComCode_Group_Local.deleteRow(nRow);
			}
		}
	} else {		// 공통코드(Default) 쓰기
		var vf = new VirtualFile;

		buf = ds_ComCode_Group.saveXML();
		bSuccess1 = vf.open(sFileName,VirtualFile.openWrite | VirtualFile.openBinary);
		bSuccess2 = vf.write(buf);
		bSuccess3 = vf.close();			
	}	
	
	// 공통코드(Local) 데이타셋 추가대상 공통코드 Append
	ds_ComCode_Default_Local.appendData(ds_ComCode_Default, true);
	ds_ComCode_Group_Local.appendData(ds_ComCode_Group, true);

	// 공통코드(Global) 데이타셋 설정 
	gds_ComCode_Default.copyData(ds_ComCode_Default_Local);	
	gds_ComCode_Group.copyData(ds_ComCode_Group_Local);		
		
	//trace(gds_ComCode_Default.saveXML());
	//trace(gds_ComCode_Group.saveXML());
}


function Button02_onclick(obj:Button,  e:ClickEventInfo)
{
// 	var objTabPage = Tab00.components;
// 	
// 	//for(var i=0;i<objTabPage.length;i++)
// 	for(var i in objTabPage)
// 	{
// 		trace("Index : " + i + " id : " + objTabPage[i].name);
// 	}

	trace("TabIndex::"+fn_getTabIndex(Tab00, "tabpage3"));
}


function fn_getTabIndex(objTab, sTabPageNm)
{
	var objTabPage = objTab.components;
	var nIndex;
	
	for(var i=0;i<objTabPage.length;i++)
	{
		if(objTabPage[i].name == sTabPageNm) return i;
	}
	
	return nIndex;
}
function Button03_onclick(obj:Button,  e:ClickEventInfo)
 {
// 	Static00.text = "aa";
// 	Static00.
// 	
// 	trace(ds_input.saveXML());

	var nVal = 700000 % 9;
	trace("nVal::"+nVal);
}

function ds_input_oncolumnchanged(obj:Dataset, e:DSColChangeEventInfo)
{
	trace("aaaaa");
}
]]></Script>
  </Form>
</FDL>
