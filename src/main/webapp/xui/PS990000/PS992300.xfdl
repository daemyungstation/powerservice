<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="PS992300" classname="user" inheritanceid="" position="absolute 0 0 764 475" titletext="사용자 상세정보" onload="PS992300_onload" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="stc_31" class="sta_popupBg1" enable="false" position="absolute 0 0 764 475"/>
        <Button id="btn_Close" taborder="1" onclick="btn_Close_onclick" position="absolute 732 8 752 27" class="btn_popupClose"/>
        <Static id="stc_30" text="사용자 상세정보" class="sta_popupTitle" transparenthittest="true" position="absolute 9 8 184 28"/>
        <Static id="stc_28" class="sta_workData" position2="absolute l:110 r:13px t:436px h:26" positiontype="position2"/>
        <Static id="stc_40" class="sta_workData" position2="absolute l:108 r:13 t:61px h:26" positiontype="position2"/>
        <Static id="stc_41" class="sta_workData" position2="absolute l:108 r:13px t:136px h:26" positiontype="position2"/>
        <Static id="stc_42" class="sta_workData" position2="absolute l:108 r:13px t:161px h:26" positiontype="position2"/>
        <Static id="stc_43" class="sta_workData" position2="absolute l:108 r:13px t:186px h:26" positiontype="position2"/>
        <Static id="stc_44" class="sta_workData" position2="absolute l:108 r:13px t:211px h:26" positiontype="position2"/>
        <Static id="stc_45" class="sta_workData" position2="absolute l:108 r:13px t:236px h:26" positiontype="position2"/>
        <Static id="stc_46" class="sta_workData" position2="absolute l:108 r:13px t:261px h:26" positiontype="position2"/>
        <Static id="stc_47" class="sta_workData" position2="absolute l:110 r:13px t:361px h:26" positiontype="position2"/>
        <Static id="stc_48" text="사용자 상세" class="sta_workTitle2" position2="absolute l:13 w:89 t:40 h:20" positiontype="position2"/>
        <Static id="sta_GrayLine00" class="sta_WF_Line1" position2="absolute l:13 r:13px t:60px h:1" positiontype="position2"/>
        <Static id="stc_49" class="sta_workData" position2="absolute l:108 r:13px t:86px h:26" positiontype="position2"/>
        <Static id="stc_50" class="sta_workData" position2="absolute l:108 r:13px t:111px h:26" positiontype="position2"/>
        <Static id="stc_51" text="근무상태" class="sta_workLabel1" position2="absolute l:13 w:98 t:211 h:26" positiontype="position2" validate=""/>
        <Static id="stc_53" text="CTI사용여부" class="sta_workLabel1" position2="absolute l:13 w:98 t:236 h:26" positiontype="position2" validate=""/>
        <Static id="stc_54" text="파티그룹번호" class="sta_workLabel1" position2="absolute l:13 w:98 t:261 h:26" positiontype="position2" validate=""/>
        <Static id="stc_55" text="담당업무" class="sta_workLabel1" position2="absolute l:13 w:98 t:186 h:26" positiontype="position2" validate=""/>
        <Static id="stc_56" text="직무유형" class="sta_workLabel1" position2="absolute l:13 w:98 t:161 h:26" positiontype="position2" style="font:Dotum,8;" validate=""/>
        <Static id="stc_57" text="성명" class="sta_workLabel1" position2="absolute l:111 w:98 t:61 h:26" positiontype="position2" validate=""/>
        <Static id="stc_58" text="권한유형" class="sta_workLabel1" position2="absolute l:372 w:98 t:161 h:26" positiontype="position2" validate=""/>
        <Button id="btn_update" taborder="8" onclick="btn_update_onclick" class="btn_WF_Modif" position2="absolute l:679 w:72 t:38 h:20" positiontype="position2" tooltiptext="수정"/>
        <Static id="stc_59" text="센터" class="sta_workLabel1" position2="absolute l:111 w:98 t:111 h:26" positiontype="position2" validate=""/>
        <Static id="stc_60" text="사용자ID" class="sta_workLabel1" position2="absolute l:111 w:98 t:86 h:26" positiontype="position2" validate=""/>
        <Static id="stc_61" text="상담그룹" class="sta_workLabel1" position2="absolute l:111 w:98 t:136 h:26" positiontype="position2" validate=""/>
        <Static id="stc_user_nm" position2="absolute l:212 w:228 t:61 h:26" positiontype="position2"/>
        <Static id="stc_lgn_id" position2="absolute l:212 w:478 t:86 h:26" positiontype="position2"/>
        <Static id="stc_cntr_nm" position2="absolute l:212 w:478 t:111 h:26" positiontype="position2"/>
        <Static id="stc_team_nm" position2="absolute l:212 w:478 t:136 h:26" positiontype="position2"/>
        <Static id="stc_duty_nm" position2="absolute l:114 w:252 t:161 h:26" positiontype="position2"/>
        <Static id="stc_athr_nm" position2="absolute l:472 w:269 t:161 h:26" positiontype="position2"/>
        <Static id="stc06" position2="absolute l:114 w:627 t:186 h:26" positiontype="position2"/>
        <Static id="stc_62" text="입사일" class="sta_workLabel1" position2="absolute l:372 w:98 t:211 h:26" positiontype="position2" validate=""/>
        <Static id="stc_63" text="CTI아이디" class="sta_workLabel1" position2="absolute l:372 w:98 t:236 h:26" positiontype="position2" validate=""/>
        <Static id="stc_64" text="ACD그룹번호" class="sta_workLabel1" position2="absolute l:372 w:98 t:261 h:26" positiontype="position2" validate=""/>
        <Static id="stc_pty_grop_no" position2="absolute l:114 w:252 t:261 h:26" positiontype="position2"/>
        <Static id="stc_cti_use_yn" position2="absolute l:114 w:252 t:236 h:26" positiontype="position2"/>
        <Static id="stc_user_stat_nm" position2="absolute l:114 w:252 t:211 h:26" positiontype="position2"/>
        <Static id="stc_enco_dt" position2="absolute l:472 w:268 t:211 h:26" positiontype="position2"/>
        <Static id="stc_cti_id" position2="absolute l:472 w:268 t:236 h:26" positiontype="position2"/>
        <Static id="stc_acd_grop_no" position2="absolute l:472 w:268 t:261 h:26" positiontype="position2"/>
        <Static id="stc_zpcd" class="sta_workData" position2="absolute l:110 r:13px t:286px h:26" positiontype="position2"/>
        <Static id="stc_65" text="주소" class="sta_workLabel1" position2="absolute l:13 w:98 t:286 h:76" positiontype="position2" style="align:left top;" validate=""/>
        <Static id="stc_66" class="sta_workData" position2="absolute l:110 r:13px t:311px h:26" positiontype="position2"/>
        <Static id="stc_67" class="sta_workData" position2="absolute l:110 r:13px t:336px h:26" positiontype="position2"/>
        <Button id="btn_zipSearch" taborder="10" onclick="btn_zipSearch_onclick" class="btn_workZipPop" visible="false" position2="absolute l:160 w:20 t:289 h:20" positiontype="position2"/>
        <Edit id="edt_home_addr" taborder="11" tabstop="false" readonly="true" enable="false" position2="absolute l:113 w:630 t:314 h:20" positiontype="position2"/>
        <Edit id="edt_home_dtpt_addr" taborder="12" tabstop="false" readonly="true" autoselect="true" position2="absolute l:113 w:630 t:339 h:20" positiontype="position2"/>
        <Static id="stc_68" text="수정자" class="sta_workLabel1" position2="absolute l:13 w:98 t:436 h:26" positiontype="position2" validate=""/>
        <Static id="stc_69" text="등록자" class="sta_workLabel1" position2="absolute l:13 w:98 t:411 h:26" positiontype="position2" validate=""/>
        <Static id="stc_70" text="이메일주소" class="sta_workLabel1" position2="absolute l:13 w:98 t:386 h:26" positiontype="position2" validate=""/>
        <Static id="stc_71" text="핸드폰" class="sta_workLabel1" position2="absolute l:13 w:98 t:361 h:26" positiontype="position2" validate=""/>
        <Static id="stc_72" class="sta_workData" position2="absolute l:110 r:13px t:386px h:26" positiontype="position2"/>
        <Static id="stc_73" class="sta_workData" position2="absolute l:110 r:13px t:411px h:26" positiontype="position2"/>
        <Static id="stc_74" text="수정일시" class="sta_workLabel1" position2="absolute l:372 w:98 t:436 h:26" positiontype="position2" validate=""/>
        <Static id="stc_75" text="등록일시" class="sta_workLabel1" position2="absolute l:372 w:98 t:411 h:26" positiontype="position2" validate=""/>
        <Static id="stc_76" text="비상연락처" class="sta_workLabel1" position2="absolute l:372 w:98 t:361 h:26" positiontype="position2" validate=""/>
        <Edit id="edt_emil_addr" taborder="13" tabstop="false" readonly="true" position2="absolute l:113 w:630 t:389 h:21" positiontype="position2"/>
        <Static id="stc_amnd_nm" position2="absolute l:114 w:252 t:437 h:26" positiontype="position2"/>
        <Static id="stc_rgsr_nm" position2="absolute l:114 w:252 t:412 h:26" positiontype="position2"/>
        <Button id="btn_changePass" taborder="14" text="비밀번호 변경" onclick="btn_changePass_onclick" class="btn_WF_act3" visible="false" position2="absolute l:277 w:93 t:64 h:20" positiontype="position2"/>
        <MaskEdit id="Mask_amnt_dttm" taborder="16" tabstop="false" type="string" mask="####-##-## ##:##" autoselect="true" position2="absolute l:469 w:277 t:436 h:26" positiontype="position2" style="align:left middle;" readonly="true"/>
        <MaskEdit id="Mask_rgsn_dttm" taborder="17" tabstop="false" type="string" mask="####-##-## ##:##" autoselect="true" position2="absolute l:469 w:277 t:411 h:26" positiontype="position2" style="align:left middle;" readonly="true"/>
        <Button id="btn_cancel" taborder="19" text="취소" onclick="btn_cancel_onclick" class="btn_WF_Common" visible="false" position2="absolute l:679 w:72 t:38 h:20" positiontype="position2" style="padding:0 0 0 0;"/>
        <Button id="btn_save" taborder="20" onclick="btn_save_onclick" class="btn_WF_Save" visible="false" position2="absolute l:605 w:72 t:38 h:20" positiontype="position2" style="padding:0 0 0 0;"/>
        <ImageViewer id="img_appfm_no" taborder="21" stretch="fit" position2="absolute l:13 w:99 t:61 h:101" positiontype="position2" style="background:#ffffffff;"/>
        <Button id="btn_fileAdd" taborder="22" text="파일 선택" onclick="btn_fileAdd_onclick" visible="false" position2="absolute l:25 w:72 t:132 h:20" positiontype="position2"/>
        <Button id="btn_fileDel" taborder="23" text="파일 삭제" onclick="btn_fileDel_onclick" visible="false" position2="absolute l:25 w:72 t:132 h:20" positiontype="position2"/>
        <Edit id="Mask_zpcd" taborder="24" inputtype="number" readonly="true" lengthunit="utf8" maxlength="5" enable="false" position2="absolute l:113 w:46 t:289 h:20" positiontype="position2"/>
        <Edit id="Mask_clph_no" taborder="25" inputtype="number,symbol" readonly="true" lengthunit="utf8" maxlength="13" onkillfocus="phone_onkillfocus" ontextchanged="phone_ontextchanged" position2="absolute l:113 w:249 t:364 h:21" positiontype="position2"/>
        <Edit id="Mask_tlno" taborder="26" inputtype="number,symbol" readonly="true" lengthunit="utf8" maxlength="13" onkillfocus="phone_onkillfocus" ontextchanged="phone_ontextchanged" position2="absolute l:471 w:273 t:364 h:21" positiontype="position2"/>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item21" compid="stc_user_nm" propid="text" datasetid="ds_user" columnid="user_nm"/>
      <BindItem id="item22" compid="stc_lgn_id" propid="text" datasetid="ds_user" columnid="lgn_id"/>
      <BindItem id="item23" compid="stc_cntr_nm" propid="text" datasetid="ds_user" columnid="cntr_nm"/>
      <BindItem id="item24" compid="stc_team_nm" propid="text" datasetid="ds_user" columnid="team_nm"/>
      <BindItem id="item25" compid="stc_duty_nm" propid="text" datasetid="ds_user" columnid="duty_nm"/>
      <BindItem id="item26" compid="stc_athr_nm" propid="text" datasetid="ds_user" columnid="athr_nm"/>
      <BindItem id="item27" compid="stc06" propid="text" datasetid="ds_user" columnid=""/>
      <BindItem id="item28" compid="stc_pty_grop_no" propid="text" datasetid="ds_user" columnid="pty_grop_no"/>
      <BindItem id="item29" compid="stc_cti_use_yn" propid="text" datasetid="ds_user" columnid="cti_use_yn"/>
      <BindItem id="item30" compid="stc_user_stat_nm" propid="text" datasetid="ds_user" columnid="user_stat_nm"/>
      <BindItem id="item31" compid="stc_enco_dt" propid="text" datasetid="ds_user" columnid="enco_dt"/>
      <BindItem id="item32" compid="stc_cti_id" propid="text" datasetid="ds_user" columnid="cti_id"/>
      <BindItem id="item33" compid="stc_acd_grop_no" propid="text" datasetid="ds_user" columnid="acd_grop_no"/>
      <BindItem id="item35" compid="edt_home_addr" propid="value" datasetid="ds_user" columnid="home_addr"/>
      <BindItem id="item36" compid="edt_home_dtpt_addr" propid="value" datasetid="ds_user" columnid="home_dtpt_addr"/>
      <BindItem id="item37" compid="edt_emil_addr" propid="value" datasetid="ds_user" columnid="emil_addr"/>
      <BindItem id="item38" compid="stc_amnd_nm" propid="text" datasetid="ds_user" columnid="amnd_nm"/>
      <BindItem id="item39" compid="stc_rgsr_nm" propid="text" datasetid="ds_user" columnid="rgsr_nm"/>
      <BindItem id="item41" compid="Mask_amnt_dttm" propid="value" datasetid="ds_user" columnid="amnt_dttm"/>
      <BindItem id="item42" compid="Mask_rgsn_dttm" propid="value" datasetid="ds_user" columnid="rgsn_dttm"/>
      <BindItem id="item16" compid="Mask_zpcd" propid="value" datasetid="ds_user" columnid="zpcd"/>
      <BindItem id="item13" compid="Mask_clph_no" propid="value" datasetid="ds_user" columnid="clph_no"/>
      <BindItem id="item0" compid="Mask_tlno" propid="value" datasetid="ds_user" columnid="tlno"/>
    </Bind>
    <Objects>
      <Dataset id="ds_list_tmp" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_user" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="team_nm" type="STRING" size="256"/>
          <Column id="athr_cd" type="STRING" size="256"/>
          <Column id="cti_id" type="STRING" size="256"/>
          <Column id="pwd_amnt_dttm" type="STRING" size="256"/>
          <Column id="urgn_tlno" type="STRING" size="256"/>
          <Column id="cntr_cd" type="STRING" size="256"/>
          <Column id="empl_no" type="STRING" size="256"/>
          <Column id="memo_no" type="STRING" size="256"/>
          <Column id="dual_mont_yn" type="STRING" size="256"/>
          <Column id="duty_nm" type="STRING" size="256"/>
          <Column id="pty_grop_no" type="STRING" size="256"/>
          <Column id="actv_log_yn" type="STRING" size="256"/>
          <Column id="blng_comp_nm" type="STRING" size="256"/>
          <Column id="rgsn_dttm" type="STRING" size="256"/>
          <Column id="athr_nm" type="STRING" size="256"/>
          <Column id="prcnt_no" type="STRING" size="256"/>
          <Column id="rec_ip_addr" type="STRING" size="256"/>
          <Column id="page_indx" type="STRING" size="256"/>
          <Column id="lgn_id" type="STRING" size="256"/>
          <Column id="home_dtpt_addr" type="STRING" size="256"/>
          <Column id="use_yn" type="STRING" size="256"/>
          <Column id="main_mont_rslu_cd" type="STRING" size="256"/>
          <Column id="user_stat_nm" type="STRING" size="256"/>
          <Column id="team_cd" type="STRING" size="256"/>
          <Column id="astn_mont_rslu_cd" type="STRING" size="256"/>
          <Column id="clph_no" type="STRING" size="256"/>
          <Column id="user_id" type="STRING" size="256"/>
          <Column id="rgsr_id" type="STRING" size="256"/>
          <Column id="mac_addr" type="STRING" size="256"/>
          <Column id="hgrn_team_nm" type="STRING" size="256"/>
          <Column id="extn_no" type="STRING" size="256"/>
          <Column id="athr_gds_cd" type="STRING" size="256"/>
          <Column id="user_typ_cd" type="STRING" size="256"/>
          <Column id="hgrn_team_cd" type="STRING" size="256"/>
          <Column id="duty_cd" type="STRING" size="256"/>
          <Column id="amnd_nm" type="STRING" size="256"/>
          <Column id="rtco_dt" type="STRING" size="256"/>
          <Column id="brdt" type="STRING" size="256"/>
          <Column id="pwd" type="STRING" size="256"/>
          <Column id="lgn_dttm" type="STRING" size="256"/>
          <Column id="cons_bswr_typ_nm" type="STRING" size="256"/>
          <Column id="cons_bswr_typ_cd" type="STRING" size="256"/>
          <Column id="role" type="STRING" size="256"/>
          <Column id="file_id" type="STRING" size="256"/>
          <Column id="pwd_amnt_yn" type="STRING" size="256"/>
          <Column id="tlno" type="STRING" size="256"/>
          <Column id="emil_addr" type="STRING" size="256"/>
          <Column id="amnt_dttm" type="STRING" size="256"/>
          <Column id="user_nm" type="STRING" size="256"/>
          <Column id="user_stat_cd" type="STRING" size="256"/>
          <Column id="user_typ_nm" type="STRING" size="256"/>
          <Column id="ip_addr" type="STRING" size="256"/>
          <Column id="amnd_id" type="STRING" size="256"/>
          <Column id="cntr_nm" type="STRING" size="256"/>
          <Column id="cti_use_yn" type="STRING" size="256"/>
          <Column id="user_expi" type="STRING" size="256"/>
          <Column id="last_logout_dttm" type="STRING" size="256"/>
          <Column id="rgsr_nm" type="STRING" size="256"/>
          <Column id="zpcd" type="STRING" size="256"/>
          <Column id="acd_grop_no" type="STRING" size="256"/>
          <Column id="enco_dt" type="STRING" size="256"/>
          <Column id="athn_falr_tmcnt" type="STRING" size="256"/>
          <Column id="home_addr" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_inqCndt" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rltn_item_id" type="STRING" size="256"/>
          <Column id="rltn_tbl_nm" type="STRING" size="256"/>
          <Column id="file_id" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_trans_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="strSvcID" type="STRING" size="256"/>
          <Column id="strURL" type="STRING" size="256"/>
          <Column id="strInDatasets" type="STRING" size="256"/>
          <Column id="strOutDatasets" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_File" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="file_size_vl" type="STRING" size="256"/>
          <Column id="file_cntn" type="BLOB" size="256"/>
          <Column id="file_id" type="STRING" size="256"/>
          <Column id="file_nm" type="STRING" size="256"/>
          <Column id="atch_typ_cd" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/********************************************************************************************/
/* 1. Include Library include, variables Declaration 영역                                  */
/********************************************************************************************/
include "LIB::lib_All.xjs";

var gv_user_id = "";
var gv_file_id = ""; // appfm_img_path
var gv_rltn_tbl_nm = "TB_USER";
var gv_atch_typ_cd = "20";

var arrFiles = new Array();	// FileDialog 선택을 통한 File Array
var fv_svcPath = gfn_getServiceUrl("fileUrl");

/********************************************************************************************/
/* 2. Form 관련(onload 및 Form 이벤트) 처리                                           	*/
/********************************************************************************************/
function PS992300_onload(obj:Form, e:LoadEventInfo)
{
	fn_commSearch();
}

/********************************************************************************************/
/* 3. Callback(gfn_Transaction 호출 후 처리내용)                                   		*/
/********************************************************************************************/
function fn_callBack(svcid, errcd, errmsg) 
{
	if (errcd != 0) {
		trace(errcd)
		return false;
	} else {
		switch (svcid) {
			case "getUser":
				//trace(ds_list_tmp.saveXML());
				gfn_appendSearchDs(ds_user, ds_list_tmp);
				gfn_phoneNumObj(Mask_clph_no);
				gfn_phoneNumObj(Mask_tlno);
				gv_user_id = ds_user.getColumn(0, "user_id");
				
				if(!gfn_isNull(ds_user.getColumn(0, "file_id"))){
					gv_file_id = ds_user.getColumn(0, "file_id");
					fn_imageLoad();
				}else{
					img_appfm_no.image = "URL('theme://images/xxx_jpg.png')";
				}
				fn_cancel();	
 			break;
 			
 			case "srchAccountNoFile":
				gv_file_id = ds_File.getColumn(0, "file_id");
				fn_imageLoad();
			break;
			
			case "deleteFile":
				gv_file_id = "";
				img_appfm_no.image = "URL('theme://images/xxx_jpg.png')";
				btn_fileAdd.visible = true;
				btn_fileDel.visible = false;
			break;
			
			case "saveUser":
				fn_commSearch();
			break;
 		}	
 	}		
}

/********************************************************************************************/
/**   5. 서비스 호출(gfn_Transaction)                                                   	*/
/********************************************************************************************/
//조회
function fn_commSearch()
{
	ds_user.clearData();
	var szSvcid       = "getUser";
    var szController  = "/mypage/user/view";
    var szInDs        = "";
    var szOutDs       = "ds_list_tmp=ds_output";
    var szParam       = "";
    var szRetCallback = "fn_callBack";
	
    // 트랜젝션 공통함수 호출
    gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback);
}

// 파일 조회
function fn_srchAccntNoFile()
{
	ds_inqCndt.clearData();
	ds_inqCndt.addRow();
	ds_inqCndt.setColumn(0, "rltn_item_id", gv_user_id);
	ds_inqCndt.setColumn(0, "rltn_tbl_nm", gv_rltn_tbl_nm);
	
	var szSvcid       = "srchAccountNoFile";
    var szController  = "/file/list";
    var szInDs        = "ds_input=ds_inqCndt";
    var szOutDs       = "ds_File=ds_output";
    var szParam       = "";
    var szRetCallback = "fn_callBack";

    // 트랜젝션 공통함수 호출
    gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback , false);
}

//파일삭제
function fn_delFile()
{	
	ds_inqCndt.clearData();
	ds_inqCndt.addRow();
	ds_inqCndt.setColumn(0, "file_id", gv_file_id);

	var szSvcid       = "deleteFile";
    var szController  = "/file/delete/real";
    var szInDs        = "ds_input=ds_inqCndt";
    var szOutDs       = "";
    var szParam       = "";
    var szRetCallback = "fn_callBack";;

    // 트랜젝션 공통함수 호출
    gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback , false);
}

//사용자정보 수정
function fn_save()
{	
	var szSvcid       = "saveUser";
    var szController  = "/mypage/user/save";
    var szInDs        = "ds_input=ds_user::U";
    var szOutDs       = "";
    var szParam       = "";
    var szRetCallback = "fn_callBack";;

    // 트랜젝션 공통함수 호출
    gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback , false);
}

/********************************************************************************************/
/**   6. 사용자함수
/********************************************************************************************/
function fn_cancel()
{
	btn_update.visible = true;
	btn_save.visible = false;
	btn_cancel.visible = false;
	
	btn_fileAdd.visible = false;
	btn_fileDel.visible = false;
	btn_changePass.visible = false;
	btn_zipSearch.visible = false;
	
	Mask_zpcd.readonly = true;
	edt_home_addr.readonly = true;
	edt_home_dtpt_addr.readonly = true;
	Mask_clph_no.readonly = true;
	Mask_tlno.readonly = true;
	edt_emil_addr.readonly = true;
}

/********************************************************************************************/
/**   7. 이벤트
/********************************************************************************************/

//수정버튼클릭
function btn_update_onclick(obj:Button,  e:ClickEventInfo)
{	
	btn_update.visible = false;
	btn_save.visible = true;
	btn_cancel.visible = true;
	
	if(img_appfm_no.image == "URL('theme://images/xxx_jpg.png')"){
		btn_fileAdd.visible = true;
	}else{
		btn_fileDel.visible = true;
	}	
	btn_changePass.visible = true;
	btn_zipSearch.visible = true;
	
	Mask_zpcd.readonly = false;
	edt_home_addr.readonly = false;
	edt_home_dtpt_addr.readonly = false;
	Mask_clph_no.readonly = false;
	Mask_tlno.readonly = false;
	edt_emil_addr.readonly = false;
}

//취소버튼클릭
function btn_cancel_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_commSearch();
}

//저장버튼클릭
function btn_save_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_save();
}

//비밀번호 변경클릭
function btn_changePass_onclick(obj:Button,  e:ClickEventInfo)
{
	var objDataset 	= new Dataset();
	objDataset.name = "ds_lgn_info";
	objDataset.addColumn("lgn_id", "string", "255");
	objDataset.addColumn("cntr_cd", "string", "255");
	objDataset.addRow();
	objDataset.setColumn(0, "lgn_id", stc_lgn_id.text);
	objDataset.setColumn(0, "cntr_cd", ds_user.getColumn(0, "cntr_cd"));
	
	var sPrmr = {ds_lgn_info:objDataset};
	
	var reVal = gfn_diaLog("비밀번호 변경", -1, -1, -1, -1, "PS990000::PS991400.xfdl", false, sPrmr, false, false, true);
}

//파일선택
function btn_fileAdd_onclick(obj:Button,  e:ClickEventInfo)
{
	if (!gfn_isNull(gv_file_id)) {
		alert("최대 1개의 파일을 첨부할 수 있습니다.");
		return false;
	}
	var sFilterType, sFilePath, sFileName, nFileSize, objContents;
	
	//다이얼로그 타입 
	sFilterType = "image files (*.jpg;*.jpeg;*.gif;*.png;)|*.jpg;*.jpeg;*.gif;*.png"; // 이미지 파일만 저장 가능
	
	//다이얼로그창 
 	fileDialog = objects["fileDialog"];
 	if (fileDialog == null) {
		fileDialog = new FileDialog();
	}
	fileDialog.defaultextention = true;
	fileDialog.filter = sFilterType;
	
	var vFile = fileDialog.open("파일 추가", FileDialog.LOAD);
    if (!vFile) return;	//파일을 선택하지 않은 경우
        
    arrFiles[0] = vFile;	               // 파일 배열 생성
    vFile.open(VirtualFile.openRead| VirtualFile.openBinary);
    sFilePath = vFile.path;
    sFileName = vFile.filename;
    nFileSize = vFile.getFileSize();
    vFile.close();
            
    ds_File.clearData();
    ds_File.addRow();
    ds_File.addColumn("file_size_vl", "string", 256);
    ds_File.addColumn("file_cntn", "string", 256);
    ds_File.addColumn("file_id", "string", 256);
    ds_File.addColumn("file_nm", "string", 256);
    ds_File.addColumn("atch_typ_cd", "string", 256);
    ds_File.setColumn(0, "file_size_vl", nFileSize);
    ds_File.setColumn(0, "file_nm", sFileName);
	ds_File.setColumn(0, "atch_typ_cd", gv_atch_typ_cd);

    var rVal = fn_fileUpload();
	if (rVal) {
		fn_srchAccntNoFile();
	}
}

//파일저장
function fn_fileUpload()
{
	var bResult;
	sWorkMode = "UPLOAD";
 	httpObjectInput = objects["httpObject"];

 	if (httpObjectInput == null) {
		httpObjectInput = new HttpObject();
	}
	
 	//파일올릴때 파라미터같이 올릴때URL에 파라미터값 붙여서 넘기는방법 추후 좋은방법 있을시 변경
	if (arrFiles.length == 1) {
		var Url = fv_svcPath +"file/insert?";
			Url += 'atch_typ_cd='+gv_atch_typ_cd;
			Url += '&rltn_item_id='+gv_user_id;
			Url += '&rltn_tbl_nm='+gv_rltn_tbl_nm;
		bResult = httpObjectInput.upload(Url, FileDialog.LOAD, arrFiles[0], false);
					
		if(bResult == false) {
			return false;
		}
	}
	
	return true;
}

// 이미지 설정
function fn_imageLoad()
{
	if (!gfn_isNull(gv_file_id)) {
		img_appfm_no.image = "URL('fileUrl::/file/download?file_id="+gv_file_id+"')";
	}
}

//파일삭제
function btn_fileDel_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_delFile();
}

//우편번호 클릭
function btn_zipSearch_onclick(obj:Button,  e:ClickEventInfo)
{	
	// 기존 주소검색 폐지 / 2017.04.10 부로 다음API사용
	var sPrmr = {};
	var reVal = gfn_diaLog("주소 조회", -1, -1, 884, 601, "PS990000::PS992099.xfdl", false, sPrmr, false, false, true);	
}

// 주소 값 등록(팝업창 호출)
function fn_daum_addr()
{
	Mask_zpcd.value = gv_dpost; 
	edt_home_addr.value = gv_daddr;	
}

function btn_Close_onclick(obj:Button,  e:ClickEventInfo)
{
	close();
}

// 전화번호 설정
function phone_ontextchanged(obj:Edit,  e:TextChangedEventInfo)
{
	obj.value = gfn_phoneNumStr(obj.value);
	obj.setCaretPos(-1);
}

function phone_onkillfocus(obj:Edit, e:KillFocusEventInfo)
{
	obj.value = gfn_phoneNumStr(obj.value);
}]]></Script>
  </Form>
</FDL>
