<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="Div_goodsCode" classname="Div_goodsCode" inheritanceid="" position="absolute 0 0 200 21" titletext="품목 다중선택" onload="frm_onload">
    <Layouts>
      <Layout>
        <Edit id="edt_gds_cd" taborder="0" readonly="true" visible="true" position="absolute 0 0 58 21" style="background:URL('theme://images/bg_compD.png') stretch 5,5;" enable="true" anchor="left"/>
        <Edit id="edt_gds_nm" taborder="1" onkeydown="edt_gds_nm_onkeydown" ontextchanged="edt_gds_nm_ontextchanged" position="absolute 60 0 176 21" anchor="left right" imemode="hangul"/>
        <Button id="btn_gds" taborder="2" onclick="btn_gds_onclick" class="btn_workSrcPop" position="absolute 178 0 200 20" anchor="right"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_div_goods_code_cond" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="gds_nm" type="STRING" size="256"/>
          <Column id="gds_cd" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_div_goods_code_list" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="page_indx" type="STRING" size="256"/>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="seq" type="STRING" size="256"/>
          <Column id="event_reg_day" type="STRING" size="256"/>
          <Column id="event_proc_day" type="STRING" size="256"/>
          <Column id="event_comp_day" type="STRING" size="256"/>
          <Column id="event_man" type="STRING" size="256"/>
          <Column id="sort_name" type="STRING" size="256"/>
          <Column id="sort" type="STRING" size="256"/>
          <Column id="val1" type="STRING" size="256"/>
          <Column id="val2" type="STRING" size="256"/>
          <Column id="val3" type="STRING" size="256"/>
          <Column id="val4" type="STRING" size="256"/>
          <Column id="val5" type="STRING" size="256"/>
          <Column id="val6" type="STRING" size="256"/>
          <Column id="val7" type="STRING" size="256"/>
          <Column id="val8" type="STRING" size="256"/>
          <Column id="val9" type="STRING" size="256"/>
          <Column id="ent_day" type="STRING" size="256"/>
          <Column id="ent_tm" type="STRING" size="256"/>
          <Column id="accept_day" type="STRING" size="256"/>
          <Column id="accept_tm" type="STRING" size="256"/>
          <Column id="move_day" type="STRING" size="256"/>
          <Column id="move_tm" type="STRING" size="256"/>
          <Column id="wedding_opt" type="STRING" size="256"/>
          <Column id="annv" type="STRING" size="256"/>
          <Column id="event_place" type="STRING" size="256"/>
          <Column id="note" type="STRING" size="256"/>
          <Column id="pay_amt" type="STRING" size="256"/>
          <Column id="pay_amt_count" type="STRING" size="256"/>
          <Column id="join_dt" type="STRING" size="256"/>
          <Column id="emple_nm" type="STRING" size="256"/>
          <Column id="dept_nm" type="STRING" size="256"/>
          <Column id="erg_tel" type="STRING" size="256"/>
          <Column id="sex" type="STRING" size="256"/>
          <Column id="sex_nm" type="STRING" size="256"/>
          <Column id="rel" type="STRING" size="256"/>
          <Column id="agerng" type="STRING" size="256"/>
          <Column id="die_reson" type="STRING" size="256"/>
          <Column id="loc" type="STRING" size="256"/>
          <Column id="bcnm" type="STRING" size="256"/>
          <Column id="bcloc" type="STRING" size="256"/>
          <Column id="cfn_dt" type="STRING" size="256"/>
          <Column id="cfn_day" type="STRING" size="256"/>
          <Column id="cfn_tm" type="STRING" size="256"/>
          <Column id="rmk" type="STRING" size="256"/>
          <Column id="cnl_reson" type="STRING" size="256"/>
          <Column id="prod_nm" type="STRING" size="256"/>
          <Column id="mem_nm" type="STRING" size="256"/>
          <Column id="mem_no" type="STRING" size="256"/>
          <Column id="emple_no" type="STRING" size="256"/>
          <Column id="emp_cell" type="STRING" size="256"/>
          <Column id="cell" type="STRING" size="256"/>
          <Column id="sms_chk" type="STRING" size="256"/>
          <Column id="work_dept" type="STRING" size="256"/>
          <Column id="del_fg" type="STRING" size="256"/>
          <Column id="bef_emple_nm" type="STRING" size="256"/>
          <Column id="join_cl" type="STRING" size="256"/>
          <Column id="arrive_dt" type="STRING" size="256"/>
          <Column id="bur_cre_cl" type="STRING" size="256"/>
          <Column id="brplot" type="STRING" size="256"/>
          <Column id="rpt_yn" type="STRING" size="256"/>
          <Column id="rpt_no" type="STRING" size="256"/>
          <Column id="rpt_cl" type="STRING" size="256"/>
          <Column id="event_place1" type="STRING" size="256"/>
          <Column id="jidosa" type="STRING" size="256"/>
          <Column id="work_dept1" type="STRING" size="256"/>
          <Column id="yenche" type="STRING" size="256"/>
          <Column id="branch_cl" type="STRING" size="256"/>
          <Column id="mon_tr_yn" type="STRING" size="256"/>
          <Column id="model_cl_nm" type="STRING" size="256"/>
          <Column id="whmv_yn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_trans_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="strSvcID" type="STRING" size="256"/>
          <Column id="strURL" type="STRING" size="256"/>
          <Column id="strInDatasets" type="STRING" size="256"/>
          <Column id="strOutDatasets" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/*********************************************
 * 화면명 : 품목코드 검색 팝업
 * 작성자 : 정출연
 * 작성일 : 2016.11.10
 * 변경이력 : 
*/

include "LIB::lib_All.xjs";

function frm_onload(obj:Form, e:LoadEventInfo) {
	//
}

function fn_callBack(svcid, errcd, errmsg) 
{
	if (errcd != 0) {
	    switch (svcid) {
	        // 공통
  			case "search":
				//
			break;
	    }
		return false;
	}
	
	switch (svcid) {
		case "search":
			fn_postSearch();
			break;
	}
}

//조회전 처리 조회조건셋팅
function fn_preSearch()
{
	ds_div_goods_code_cond.clearData();
	ds_div_goods_code_cond.addRow();	
	
	var condCnt			= 0;
	ds_div_goods_code_cond.setColumn(0, "gds_cd", edt_gds_cd.value);
	ds_div_goods_code_cond.setColumn(0, "gds_nm", edt_gds_nm.value);
	
	return true;
}

//조회
function fn_search()
{	
	// 호출 건수 설정 및 조회여부 설정
	if ( !fn_preSearch() ) {
		return;
	}
	
	var szSvcid       = "search";
    var szController  = "/common/selectGoodsComList";
    var szInDs        = "ds_input=ds_div_goods_code_cond";    
    var szOutDs       = "ds_div_goods_code_list=ds_output";
    
    var szParam       = "";
    var szRetCallback = "fn_callBack";

    // 트랜젝션 공통함수 호출
    gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback);
}

//조회 결과 
function fn_postSearch()
{
	trace(ds_div_goods_code_list.saveXML());
 	
 	if ( ds_div_goods_code_list.rowcount == 1 ) {
		edt_gds_nm.value = ds_div_goods_code_list.getColumn(0, "gds_nm");
		// edt_gds_cd.value = ds_div_goods_code_list.getColumn(0, "real_gds_cd");
		edt_gds_cd.value = ds_div_goods_code_list.getColumn(0, "gds_cd");
 	} else {
		btn_gds_onclick();
 	}
}

function edt_gds_nm_onkeydown(obj:Edit, e:KeyEventInfo)
{
	if (e.keycode == 13 && !gfn_isEmpty(obj.value)) {	
		fn_search();
	}
}

function btn_gds_onclick(obj:Button,  e:ClickEventInfo)
{
	var ret = fn_openEventGoodsPopup("", edt_gds_nm.value, false);
	if ( ret && ret.rowcount > 0 ) {
		// edt_gds_cd.value = ret.getColumn(0, "real_gds_cd");
		edt_gds_cd.value = ret.getColumn(0, "gds_cd");
		edt_gds_nm.value = ret.getColumn(0, "gds_nm");
	}
}

function edt_gds_nm_ontextchanged(obj:Edit,  e:TextChangedEventInfo)
{
	if (ds_div_goods_code_list.rowcount > 0 && !gfn_isEmpty(edt_gds_cd.value) ) {
		if ( edt_gds_nm.value != ds_div_goods_code_list.getColumn(0, "gds_nm") ) {
			edt_gds_cd.value = "";
			edt_gds_nm.value = "";
		}
	}
	else if ( gfn_isEmpty(obj.value) ) {
		edt_gds_cd.value = "";
	}
}

// 거래처 조회 팝업 (관련테이블 : CUSTMR_MNG)
function fn_openEventGoodsPopup(gds_cd, gds_nm) {
    var sPrmr = {p_gds_cd:gds_cd, p_gds_nm:gds_nm};
    var reVal = gfn_diaLog("품목코드 조회", -1, -1, -1, -1, "COMM::EventGoodsPopup_Multi.xfdl", false, sPrmr, false, false, true, null, null, true);	
    return reVal;
}

/***********************************/
// 외부 제공 인터페이스
/***********************************/
function setCd(cd) {
	edt_gds_cd.value = cd;
}

function setNm(nm) {
	edt_gds_nm.value = nm;
}

function getCd() {
	return edt_gds_cd.value;
}

function getNm() {
	return edt_gds_nm.value;
}

function setReadonly(isReadonly) {
	edt_gds_cd.readonly 	= isReadonly;
	edt_gds_nm.readonly 	= isReadonly;
	btn_gds.enable 		= !isReadonly;
}

function showButton(isVisible) {
	btn_gds.visible = isVisible;
}

function bindCd(oDataset, sColumnId) {
	bfn_datasetBinding(oDataset, sColumnId, "edt_gds_cd", "value");
}

function bindNm(oDataset, sColumnId) {
	bfn_datasetBinding(oDataset, sColumnId, "edt_gds_nm", "value");
}

function bfn_datasetBinding(oDataset, sColumnName, sComponentId, sComponentPorp) {
    var bindItemId = this.name+sColumnName+sComponentId+sComponentPorp;
    if (this.all[bindItemId]) {
        var oldBindItem = this.removeChild(bindItemId);
        oldBindItem.destroy();
    }
    var bindItem = new BindItem();
    bindItem.init(bindItemId, sComponentId, sComponentPorp, oDataset.name, sColumnName);
    this.addChild(bindItemId, bindItem);
    bindItem.bind();
}

function setFocusCd() {
	edt_gds_cd.setFocus();
}

function setFocusNm() {
	edt_gds_nm.setFocus();
}

function clear() {
	ds_div_goods_code_list.clearData();
	ds_div_goods_code_cond.clearData();
	edt_gds_cd.value = "";
	edt_gds_nm.value = "";
}
]]></Script>
  </Form>
</FDL>
