<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="DL420703P04" classname="DL420802" inheritanceid="" position="absolute 0 0 381 171" titletext="부가서비스 회수" scrollbars="none" onload="DL420703P04_onload">
    <Layouts>
      <Layout>
        <Static id="stc_pop" class="sta_popupBg1" enable="false" position="absolute 0 0 378 167"/>
        <Button id="btn_close" taborder="1" onclick="btn_close_onclick" class="btn_popupClose" position="absolute 353 8 373 27"/>
        <Static id="stc_30" text="부가서비스 발급" class="sta_popupTitle" transparenthittest="true" position="absolute 10 8 282 28"/>
        <Static id="member_txt" text="부가서비스 자동 발급을 하시겠습니까?" class="sta_workTitle2" position="absolute 13 47 310 67" onclick="member_txt_onclick"/>
        <Button id="btn_save" taborder="61" text="저장" class="btn_WF_Common" position2="absolute r:81 w:64 t:135 h:20" positiontype="position2" tooltiptext="저장" style="padding:0 0 0 0;" onclick="fn_couponRecovery"/>
        <Button id="btn_del" taborder="68" text="취소" onclick="btn_close_onclick" class="btn_WF_Common" position2="absolute r:13 w:64 t:135 h:20" positiontype="position2" tooltiptext="취소" style="padding:0 0 0 0;"/>
        <Static id="stc_01" class="sta_workData" position="absolute 95 78 368 104"/>
        <Static id="stc_00" text="회수일" class="sta_workLabel1_P" position="absolute 13 78 96 104" style="font:Dotum,8;" validate=""/>
        <Calendar id="cal_recov_dt" taborder="69" tabstop="false" displaynulltext="____-__-__" dateformat="yyyy-MM-dd" position="absolute 98 81 187 101"/>
        <Static id="stc_02" class="sta_workData" position="absolute 95 103 368 129"/>
        <Static id="stc_03" text="회수 사유" class="sta_workLabel1_P" position="absolute 13 103 96 129" style="font:Dotum,8;" validate=""/>
        <Combo id="cbo_note_cd" taborder="70" innerdataset="@ds_noteCd" codecolumn="cd" datacolumn="cd_nm" position="absolute 98 106 198 126"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_trans_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="strSvcID" type="STRING" size="256"/>
          <Column id="strURL" type="STRING" size="256"/>
          <Column id="strInDatasets" type="STRING" size="256"/>
          <Column id="strOutDatasets" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cond" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="isMMS" type="STRING" size="256"/>
          <Column id="sController" type="STRING" size="256"/>
          <Column id="dsName" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_noteCd2" reversesubsum="false" useclientlayout="false" enableevent="true" firenextcount="0" loadfiltermode="keep" loadkeymode="keep" firefirstcount="0" updatecontrol="true">
        <ColumnInfo>
          <Column id="seq" type="STRING" size="256"/>
          <Column id="svc_nm" type="STRING" size="256"/>
          <Column id="svc_nm2" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_noteCd" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="256"/>
          <Column id="cd_nm" type="STRING" size="256"/>
          <Column id="adtl_cd" type="STRING" size="256"/>
          <Column id="adtl_cd_nm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item2" compid="cal_recov_dt" propid="value" datasetid="ds_couponInfo" columnid="isu_dt"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[/********************************************************************************************/
/* 1. Include Library include, variables Declaration 영역                                  */
/********************************************************************************************/
include "LIB::lib_All.xjs";

var gv_pay_type = "";
var gv_p_gubun = "";

/********************************************************************************************/
/* 2. Form 관련(onload 및 Form 이벤트) 처리                                           	*/
/********************************************************************************************/
function DL420703P04_onload(obj:Form, e:LoadEventInfo)
{
	gfn_getList("dlwCd","S011","fn_callBack",false);

	gfn_initForm(obj);
	fn_init(); 	
}



/********************************************************************************************/
/* 3. Callback(gfn_Transaction 호출 후 처리내용)                                   		*/
/********************************************************************************************/
function fn_callBack(svcid, errcd, errmsg)
{
	if (errcd != 0) {
		trace(errcd);
		return false;
	} else {
		switch (svcid) {	
			case "selectDlwCode": // 공통코드 조회(SELECT:선택,ALL:전체)
				gfn_getCode("S011", "SELECT", ds_noteCd, gds_DmlCd);	//ds_evt_typ 만 변경 하면 됨 (회수사유)
			break;
		}
	}
}

/********************************************************************************************/
/**   4. Validation 처리                                                                   	*/
/********************************************************************************************/
// 조회 전
function fn_pre_save()
{	

	if (gfn_isNull(cal_recov_dt.value)) {
		alert("회수일를 입력 하세요");
		return false;
	}	
		
	if (gfn_isNull(cbo_note_cd.value)) {
		alert("회수 사유를 선택 하세요");
		return false;
	}			

	return true;
}

/********************************************************************************************/
/**   5. 서비스 호출(gfn_Transaction)                                                   	*/
/********************************************************************************************/

// 부가서비스 쿠폰 발급
function fn_couponRecovery(obj:Button,  e:ClickEventInfo)
{
	// 유효성 체크
	if ( !fn_pre_save() ) {
		return;
	}
	 
	if(!confirm("정말로 부가서비스 회수을 진행 하시겠습니까?")) return false;

	opener.pop_recov_dt.value = cal_recov_dt.value;
	opener.pop_note_cd.value = cbo_note_cd.value;
	
	opener.fn_couponRecovery(gfn_getCommTypeInit());
	close();
}

/********************************************************************************************/
/**   6. 사용자 함수                                                                   	*/
/********************************************************************************************/


// 초기화
function fn_init(){
//	ds_couponInfo.clearData();
//	var nPos = ds_couponInfo.addRow(); // 신규일때 기본값 설정
	
//		var sToday = gfn_getToday();
	cal_recov_dt.value = gfn_getToday();
	cbo_note_cd.index = 0;	
}

/********************************************************************************************/
/**   7. 이벤트(Event) Function                                                          	*/
/********************************************************************************************/
// 닫기
function btn_close_onclick(obj:Button,  e:ClickEventInfo)
{
	close();
}


]]></Script>
  </Form>
</FDL>
