<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="DL420711" classname="MN010111" inheritanceid="" position="absolute 0 0 513 359" titletext="레저팝업)TMS 정보 전송" onload="MN020104_1_onload">
    <Layouts>
      <Layout>
        <Static id="stc_00" class="sta_workData" position="absolute 9 145 501 171"/>
        <Static id="stc_31" class="sta_popupBg1" enable="false" position="absolute 0 1 512 377" onclick="stc_31_onclick"/>
        <Static id="stc_30" text="TMS 정보 전송" class="sta_popupTitle" transparenthittest="true" position="absolute 10 8 185 28"/>
        <Button id="btn_close" taborder="18" onclick="btn_close_onclick" class="btn_popupClose" position="absolute 484 7 504 26"/>
        <Static id="stc_02" class="sta_workData" position="absolute 9 120 501 146"/>
        <Static id="stc_06" class="sta_workData" position="absolute 9 145 501 171"/>
        <Static id="stc_10" class="sta_workData" position="absolute 9 95 501 121"/>
        <Static id="stc_04" class="sta_workData" position="absolute 9 70 501 96" style="font:arial,12,bold;"/>
        <Static id="stc_15" text="TMS 정보 " class="sta_workTitle2" position="absolute 9 49 221 69"/>
        <Static id="sta_GrayLine" class="sta_WF_Line1" position="absolute 9 69 499 70" anchor="left top right" onclick="sta_GrayLine_onclick"/>
        <Static id="stc_07" text="회원번호" class="sta_workLabel1" position="absolute 9 70 86 96" validate=""/>
        <Edit id="edt_accnt_no" taborder="38" imemode="alpha" lengthunit="utf8" maxlength="4" position="absolute 89 73 207 93" readonly="false"/>
        <Edit id="edt_yeun" taborder="24" lengthunit="utf8" maxlength="30" onkeydown="mem_onkeydown" position="absolute 353 73 483 93" readonly="false"/>
        <Static id="stc_01" text="리조트NO" class="sta_workLabel1" position="absolute 9 95 86 121" validate="" style="font:Dotum,8;"/>
        <Static id="stc_05" text="회원이름" class="sta_workLabel1" position="absolute 9 120 86 146" validate=""/>
        <Static id="stc_22" text="행사일자" class="sta_workLabel1" position="absolute 267 145 350 171" validate="" style="font:Dotum,8;"/>
        <Static id="stc_03" text="우대구분" class="sta_workLabel1" position="absolute 267 120 350 146" validate=""/>
        <Static id="stc_08" text="가입일자" class="sta_workLabel1" position="absolute 9 145 86 171" style="font:Dotum,8;" validate=""/>
        <Button id="btn_delete" taborder="56" tabstop="false" text="TMS 전송" onclick="btn_delete_onclick" class="btn_WF_Common" position="absolute 434 45 497 65" tooltiptext="초기화" style="border:0 none #000000ff ;padding:0 0 0 0;"/>
        <Static id="stc_09" text="연동번호" class="sta_workLabel1" position="absolute 267 70 350 96" validate=""/>
        <Edit id="edt_resort_no" taborder="57" imemode="alpha" lengthunit="utf8" maxlength="4" position="absolute 89 98 208 118"/>
        <Static id="stc_11" text="리조트구분" class="sta_workLabel1" position="absolute 267 95 350 121" validate=""/>
        <Edit id="edt_pay_gubun" taborder="58" lengthunit="utf8" maxlength="30" onkeydown="mem_onkeydown" position="absolute 353 98 483 118"/>
        <Edit id="edt_resort_mem_gubun" taborder="59" lengthunit="utf8" maxlength="30" onkeydown="mem_onkeydown" position="absolute 354 123 484 143"/>
        <Edit id="edt_event_proc_day" taborder="60" lengthunit="utf8" maxlength="30" onkeydown="mem_onkeydown" position="absolute 354 148 484 168"/>
        <Edit id="edt_mem_nm" taborder="61" imemode="alpha" lengthunit="utf8" maxlength="4" position="absolute 89 123 207 143"/>
        <Edit id="edt_join_dt" taborder="62" imemode="alpha" lengthunit="utf8" maxlength="4" position="absolute 89 148 208 168"/>
        <Static id="stc_12" class="sta_workData" position="absolute 9 195 501 221"/>
        <Static id="stc_13" class="sta_workData" position="absolute 9 170 501 196"/>
        <Static id="stc_14" class="sta_workData" position="absolute 9 195 501 221"/>
        <Static id="stc_16" text="해약일자" class="sta_workLabel1" position="absolute 9 170 86 196" validate=""/>
        <Static id="stc_17" text="주민번호" class="sta_workLabel1" position="absolute 267 195 350 221" style="font:Dotum,8;" validate=""/>
        <Static id="stc_18" text="연체일" class="sta_workLabel1" position="absolute 267 170 350 196" validate=""/>
        <Edit id="edt_yeunch" taborder="63" lengthunit="utf8" maxlength="30" onkeydown="mem_onkeydown" position="absolute 354 173 484 193"/>
        <Edit id="edt_idn_no" taborder="64" lengthunit="utf8" maxlength="30" onkeydown="mem_onkeydown" position="absolute 354 198 484 218"/>
        <Edit id="edt_resn_acpt_day" taborder="65" imemode="alpha" lengthunit="utf8" maxlength="4" position="absolute 89 173 207 193"/>
        <Edit id="edt_cell" taborder="66" imemode="alpha" lengthunit="utf8" maxlength="4" position="absolute 89 198 208 218"/>
        <Static id="stc_19" text="전화번호" class="sta_workLabel1" position="absolute 9 195 86 221" style="font:Dotum,8;" validate=""/>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item10" compid="edt_yeun" propid="value" datasetid="ds_list"/>
      <BindItem id="item15" compid="edt_accnt_no" propid="value" datasetid="ds_list" columnid="accnt_no"/>
      <BindItem id="item3" compid="edt_resort_no" propid="value" datasetid="ds_list" columnid="resort_no"/>
      <BindItem id="item4" compid="edt_pay_gubun" propid="value" datasetid="ds_list" columnid="pay_gubun"/>
      <BindItem id="item0" compid="edt_resort_mem_gubun" propid="value" datasetid="ds_list" columnid="resort_mem_gubun"/>
      <BindItem id="item1" compid="edt_event_proc_day" propid="value" datasetid="ds_list" columnid="event_proc_day"/>
      <BindItem id="item2" compid="edt_mem_nm" propid="value" datasetid="ds_list" columnid="mem_nm"/>
      <BindItem id="item5" compid="edt_join_dt" propid="value" datasetid="ds_list" columnid="join_dt"/>
      <BindItem id="item6" compid="edt_yeunch" propid="value" datasetid="ds_list" columnid="com_nm"/>
      <BindItem id="item7" compid="edt_idn_no" propid="value" datasetid="ds_list" columnid="idn_no"/>
      <BindItem id="item8" compid="edt_resn_acpt_day" propid="value" datasetid="ds_list" columnid="resn_acpt_day"/>
      <BindItem id="item9" compid="edt_cell" propid="value" datasetid="ds_list" columnid="cell"/>
    </Bind>
    <Objects>
      <Dataset id="ds_trans_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="strSvcID" type="STRING" size="256"/>
          <Column id="strURL" type="STRING" size="256"/>
          <Column id="strInDatasets" type="STRING" size="256"/>
          <Column id="strOutDatasets" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_com_cd" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="com_cd" type="STRING" size="256"/>
          <Column id="cd_nm" type="STRING" size="256"/>
          <Column id="con" type="STRING" size="256"/>
          <Column id="ordr_turn" type="STRING" size="256"/>
          <Column id="use_yn" type="STRING" size="256"/>
          <Column id="grp_cd" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="tr_mem_no" type="STRING" size="256"/>
          <Column id="resort_no" type="STRING" size="256"/>
          <Column id="pay_gubun" type="STRING" size="256"/>
          <Column id="mem_nm" type="STRING" size="256"/>
          <Column id="resort_mem_gubun" type="STRING" size="256"/>
          <Column id="join_dt" type="STRING" size="256"/>
          <Column id="event_proc_day" type="STRING" size="256"/>
          <Column id="resn_acpt_day" type="STRING" size="256"/>
          <Column id="pay_day" type="STRING" size="256"/>
          <Column id="cell" type="STRING" size="256"/>
          <Column id="idn_no" type="STRING" size="256"/>
          <Column id="remain_no" type="STRING" size="256"/>
          <Column id="success" type="STRING" size="256"/>
          <Column id="ls_snd_rslt" type="STRING" size="256"/>
          <Column id="chk" type="STRING" size="256"/>
          <Column id="exception" type="STRING" size="256"/>
          <Column id="use_yn" type="STRING" size="256"/>
          <Column id="emple_no" type="STRING" size="256"/>
          <Column id="emple_nm" type="STRING" size="256"/>
          <Column id="ls_snd_emple_no" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_rslt" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="tr_mem_no" type="STRING" size="256"/>
          <Column id="resort_no" type="STRING" size="256"/>
          <Column id="pay_gubun" type="STRING" size="256"/>
          <Column id="mem_nm" type="STRING" size="256"/>
          <Column id="resort_mem_gubun" type="STRING" size="256"/>
          <Column id="join_dt" type="STRING" size="256"/>
          <Column id="event_proc_day" type="STRING" size="256"/>
          <Column id="resn_acpt_day" type="STRING" size="256"/>
          <Column id="pay_day" type="STRING" size="256"/>
          <Column id="cell" type="STRING" size="256"/>
          <Column id="idn_no" type="STRING" size="256"/>
          <Column id="remain_no" type="STRING" size="256"/>
          <Column id="success" type="STRING" size="256"/>
          <Column id="ls_snd_rslt" type="STRING" size="256"/>
          <Column id="exception" type="STRING" size="256"/>
          <Column id="use_yn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/********************************************************************************************/
/* 1. Include Library include, variables Declaration 영역                                  */
/********************************************************************************************/
include "LIB::lib_All.xjs";
var gv_accnt_no = ""; 
var gv_emple_nm ="";
var gv_emple_no ="";


/********************************************************************************************/
/* 2. Form 관련(onload 및 Form 이벤트) 처리                                           	*/
/********************************************************************************************/


 function MN020104_1_onload(obj:Form, e:LoadEventInfo)
{
		fn_init();
		gv_accnt_no = p_accnt_no;
		gv_emple_nm =p_emple_nm;
		gv_emple_no =p_emple_no;
		ds_list.setColumn("emple_no", gv_emple_no);
		ds_list.setColumn("emple_nm", gv_emple_nm);
		trace(gv_emple_no+'/'+gv_emple_nm);
		ds_list.clearData();
	    var nRow = ds_list.addRow();
		ds_list.setColumn(nRow, "accnt_no", gv_accnt_no);
		//ds_list.setColumn(nRow, "chk", gv_chk);
		
		trace('getCpHist'+ds_list.getColumn(0, "accnt_no"));
		 fn_commSearch("getCpHist") ;  /// 조회일경우.. 조회함수 바로 고고
	
}	
			

/********************************************************************************************/
/* 3. Callback(gfn_Transaction 호출 후 처리내용)                                   		*/
/********************************************************************************************/
function fn_callBack(svcid, errcd, errmsg)
{
	trace("fn_callBack/ svcid="+svcid);
     trace("fn_callBack/errcd="+errcd);
     trace("fn_callBack/errmsg="+errmsg);
     
	if (errcd != 0) {
	  } else {

		switch (svcid) {
				case "tmsSending":
					trace(ds_list.saveXML());
				break;	
			}
		}
}



/********************************************************************************************/
/**   5. 서비스 호출(gfn_Transaction)                                                   	*/
/********************************************************************************************/

// OCB 카드코드 등록
function fn_commSearch(svcid)
{

    if (svcid =='getCpHist') {  //조회
		
		var szSvcid       = "getCpHist";
		var szController  = "/cmpg/extc-trgt/getCpHist";
		var szInDs        = "ds_input=ds_list";
		var szOutDs       = "ds_list=ds_output";
		var szParam       = "";
		var szRetCallback = "fn_callBack";
    
    } 
    
    if (svcid =='tmsSending') {  //TMS 전송
		
		var szSvcid       = "tmsSending";
		var szController  = "/cmpg/extc-trgt/tmsSending";
		var szInDs        = "ds_input=ds_list ";
		var szOutDs       = "ds_list=ds_output ";
		var szParam       = "";
		var szRetCallback = "fn_callBack";
    
    } 
      // 트랜젝션 공통함수 호출
    gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback);

}


/*******************************************************************************************
* 결과 처리 
********************************************************************************************/
		 function postSend(svcid)
		{
			
			if(svcid == 'detailCpList'){
				
			} else if(methodName == 'reRegCpCd'){
				alert('쿠폰재발급 완료.');
			} else if(methodName == 'tmsSendingModule') {//tms 전송 후 결과 처리
				if(isLodingPop){
					cmF.createLoadingPopup(false);
					isLodingPop = false;
				}
				PopUpManager.removePopUp(this);//팝업 종료
			
				if(hm['exception'] == 'cto') {//커넥션 타임아웃 
					alert("연결 실패");
				} else if(ds_ == 'rto') {//응답지연 타임아웃
					alert("응답 지연");
				} else if(hm['exception'] == 'mue') {//URL형식 오류
					alert("URL 형식 오류");
				} else if(hm['exception'] == 'success') {//정상 응답
					alert("정상");
				} else if(hm['exception'] == 'fail') {//정상 응답
					alert("실패");
				}
			}
		}
		 
		/**
		 * Remote Object에서 에러 발생시 
		 */
/* 			public function faultHandler( event:FaultEvent ):void {
				Alert.show(event.fault.message );
			}
 */			 function faultHandler( obj:Object ) {
				alert(obj.ERROR_MESSAGE,"",1,this);
			}


/********************************************************************************************/
/**   7. 이벤트(Event) Function                                                          	*/
/********************************************************************************************/


//닫기
function btn_close_onclick(obj:Button,  e:ClickEventInfo)
{
	close();
}

//초기화 버튼
function btn_init_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_init();
}

//초기화
function fn_init()
{
			edt_accnt_no.value = "";
			edt_yeun.value = "";
			edt_resort_no.value = "";
			edt_pay_gubun.value = "";
			edt_mem_nm.value = "";
			edt_resort_mem_gubun.value = "";
			edt_join_dt.value = "";
			edt_resn_acpt_day.value = "";
			edt_yeunch.value = "";  
			edt_cell.value = "";
			edt_idn_no.value = "";
}

 //조회 결과 
   function fn_postSearch()
   {
		if(ds_list.rowcount < 1) {
			alert("조회된 자료가 없습니다.");
			ds_list.clearData();
		}
		    trace('------------------------------'+ds_list.saveXML());
     }






function btn_delete_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_commSearch("tmsSending");
}
]]></Script>
  </Form>
</FDL>
