<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="TrgtCustAlctMap">
    <sql id="TrgtCustAlctMap.selectCondition_fragment">
        <where>
            <if test="cmpg_id != null and cmpg_id != ''">
               AND TA.CMPG_ID = #{cmpg_id}
            </if>
            <if test="trgt_list_id != null and trgt_list_id != ''">
               AND TA.TRGT_LIST_ID = #{trgt_list_id}
            </if>
            <if test="sub_trgt_list_id != null and sub_trgt_list_id != ''">
               AND TA.SUB_TRGT_LIST_ID = #{sub_trgt_list_id}
            </if>
            <if test="trgt_cust_dtpt_id != null and trgt_cust_dtpt_id != ''">
               AND TA.TRGT_CUST_DTPT_ID = #{trgt_cust_dtpt_id}
            </if>
            <if test="user_id != null and user_id != ''">
               AND TA.CNSR_ID = #{user_id}
            </if>
            <if test="cntr_cd != null and cntr_cd != ''">
               AND TA.CNTR_CD = #{cntr_cd}
            </if>
            <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
               AND TA.DPMS_STAT_CD = #{dpms_stat_cd}
            </if>
            <if test="dpms_resl_cd != null and dpms_resl_cd != ''">
               AND TA.DPMS_RESL_CD = #{dpms_resl_cd}
            </if>
            <if test="dpms_gbn_cd != null and dpms_gbn_cd != ''">
               AND TA.DPMS_GBN_CD = #{dpms_gbn_cd}
            </if>
            <if test="tell_no != null and tell_no != ''">
               <!-- AND ((TG.HOME_TlNO  LIKE  '%' || REPLACE(#{tell_no},'-','')) OR (TG.CLPH_TLNO LIKE '%' || REPLACE(#{tell_no},'-','')) -->
               <!--      OR (TG.COMP_TLNO LIKE '%' ||REPLACE(#{tell_no},'-',''))) -->
            </if>
            <if test="cust_nm != null and cust_nm != ''">
               <!-- AND TG.CUST_NM LIKE  #{cust_nm}||'%' -->
            </if>
            <if test="dpms_tlno != null and dpms_tlno != ''">
               AND TA.DPMS_TLNO LIKE '%' ||REPLACE(#{dpms_tlno},'-','')
            </if>
            <if test="team_cd != null and team_cd != ''">
               AND ST.CMPG_PRFM_TEAM_CD = #{team_cd}
            </if>
            <if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                AND TA.DPMS_DTTM BETWEEN REPLACE(#{stt_dt}, '-', '') || '000000' AND REPLACE(#{end_dt}, '-', '') || '235959'
            </if>

             <if test="cmpg_stt_dt != null and cmpg_stt_dt != '' and cmpg_end_dt != null and cmpg_end_dt != ''">
                AND TG.RGSN_DTTM BETWEEN REPLACE(#{cmpg_stt_dt}, '-', '') || '000000' AND REPLACE(#{cmpg_end_dt}, '-', '') || '235959'
            </if>
            <if test="cmpg_div_cd != '2000' and cmpg_div_cd != '3000'">
                <if test="user_defn1_cntn != null and user_defn1_cntn != ''">
                   AND TG.USER_DEFN1_CNTN LIKE #{user_defn1_cntn}||'%'
                </if>
                <if test="user_defn2_cntn != null and user_defn2_cntn != ''">
                   AND TG.USER_DEFN2_CNTN LIKE #{user_defn2_cntn}||'%'
                </if>
                <if test="user_defn3_cntn != null and user_defn3_cntn != ''">
                   AND TG.USER_DEFN3_CNTN LIKE #{user_defn3_cntn}||'%'
                </if>
                <if test="user_defn4_cntn != null and user_defn4_cntn != ''">
                   AND TG.USER_DEFN4_CNTN LIKE #{user_defn4_cntn}||'%'
                </if>
                <if test="user_defn5_cntn != null and user_defn5_cntn != ''">
                   AND TG.USER_DEFN5_CNTN LIKE #{user_defn5_cntn}||'%'
                </if>
            </if>
            <if test="cmpg_div_cd == '2000' or cmpg_div_cd == '3000'">
                <if test="pay_mthd != null and pay_mthd != ''">
                   AND TG.USER_DEFN5_CNTN = #{pay_mthd}
                </if>
                <if test="ichae_dt != null and ichae_dt != ''">
                   AND TG.USER_DEFN3_CNTN = ${ichae_dt}
                </if>
                <if test="stt_month_cnt != null and stt_month_cnt != '' and end_month_cnt != null and end_month_cnt != ''">
                   AND TG.USER_DEFN1_CNTN >= TO_NUMBER(#{stt_month_cnt}) AND  TG.USER_DEFN1_CNTN <![CDATA[<=]]> TO_NUMBER(#{end_month_cnt})
                </if>
                <if test="stt_true_cnt != null and stt_true_cnt != '' and end_true_cnt != null and end_true_cnt != ''">
                   AND TG.USER_DEFN2_CNTN >= TO_NUMBER(#{stt_true_cnt}) AND  TG.USER_DEFN2_CNTN <![CDATA[<=]]> TO_NUMBER(#{end_true_cnt})
                </if>
                <if test="stt_pay_state != null and stt_pay_state != '' and end_pay_state != null and end_pay_state != ''">
                   AND TG.USER_DEFN6_CNTN >= TO_NUMBER(#{stt_pay_state}) AND  TG.USER_DEFN6_CNTN <![CDATA[<=]]> TO_NUMBER(#{end_pay_state})
                </if>
            </if>

            <if test="searchValue != null and searchValue != ''">
                <if test="searchType == 'cust_nm'">
                    AND TG.CUST_NM LIKE   #{searchValue}||'%'
                </if>
                <if test="searchType == 'mem_no'">
                    AND TG.MEM_NO LIKE  #{searchValue}||'%'
                </if>
                <if test="searchType == 'accnt_no'">
                    AND TG.ACCNT_NO LIKE  #{searchValue}||'%'
                </if>
                <if test="searchType == 'home_tlno'">
                    AND TG.HOME_TLNO  LIKE '%'|| REPLACE(#{searchValue},'-','')
                </if>
                <if test="searchType == 'comp_tlno'">
                    AND TG.COMP_TLNO LIKE  '%'|| REPLACE(#{searchValue},'-','')
                </if>
                <if test="searchType == 'clph_tlno'">
                    AND TG.CLPH_TLNO LIKE '%'|| REPLACE(#{searchValue},'-','')
                </if>
            </if>
        </where>
    </sql>

    <sql id="TrgtCustAlctMap.selectCondition_fragment1">
        <where>
             <if test="alct_yn != null and alct_yn != ''">
                AND  ALCT_YN= #{alct_yn}
             </if>
             <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
                AND  DPMS_STAT_CD= #{dpms_stat_cd}
             </if>
             <if test="sub_trgt_list_id != null and sub_trgt_list_id != ''">
                AND  SUB_TRGT_LIST_ID= #{sub_trgt_list_id}
             </if>
             <if test="dpms_resl_cd != null and dpms_resl_cd != ''">
                AND  DPMS_RESL_CD= #{dpms_resl_cd}
             </if>
             <if test="mem_nm != null and mem_nm != ''">
                AND  CUST_NM LIKE #{mem_nm} || '%'
             </if>
             <if test="total_tlno != null and total_tlno != ''">
                AND ((CLPH_TLNO LIKE '%' || #{total_tlno}) OR (COMP_TLNO LIKE '%' || #{total_tlno})
                 OR (ETC_TLNO LIKE '%' || #{total_tlno}) OR (HOME_TLNO LIKE '%' || #{total_tlno}))
             </if>
             <if test="cnsr_id != null and cnsr_id != ''">
                AND  CNSR_ID = #{cnsr_id}
             </if>
             <if test="cnsr_nm != null and cnsr_nm != ''">
                AND  USER_NM LIKE #{cnsr_nm} || '%'
             </if>
             <if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                AND RGSN_DTTM BETWEEN REPLACE(#{stt_dt}, '-', '') || '000000' AND REPLACE(#{end_dt}, '-', '') || '235959'
            </if>
            <if test="user_defn1_cntn != null and user_defn1_cntn != ''">
               AND USER_DEFN1_CNTN LIKE  #{user_defn1_cntn}|| '%'
            </if>
            <if test="user_defn2_cntn != null and user_defn2_cntn != ''">
               AND USER_DEFN2_CNTN LIKE #{user_defn2_cntn}|| '%'
            </if>
            <if test="user_defn3_cntn != null and user_defn3_cntn != ''">
               AND USER_DEFN3_CNTN LIKE  #{user_defn3_cntn}|| '%'
            </if>
            <if test="user_defn4_cntn != null and user_defn4_cntn != ''">
               AND USER_DEFN4_CNTN LIKE  #{user_defn4_cntn}|| '%'
            </if>
            <if test="user_defn5_cntn != null and user_defn5_cntn != ''">
               AND USER_DEFN5_CNTN LIKE  #{user_defn5_cntn}|| '%'
            </if>
             <if test="dpms_resl_cntn != null and dpms_resl_cntn != ''">
               AND DPMS_RESL_CNTN LIKE '%'|| #{dpms_resl_cntn}|| '%'
            </if>
        </where>
    </sql>

     <!-- 사용 -->
    <select id="TrgtCustAlctMap.getTrgtCustAlctCount" parameterType="map" resultType="int">
        SELECT /* TrgtCustAlctMap.getTrgtCustAlctCount */
             COUNT(*)
          FROM (SELECT
                      (CASE WHEN NVL(TG.CUST_NM,'N') = 'N' THEN MB.MEM_NM ELSE TG.CUST_NM END) AS CUST_NM
                    , TG.ACCNT_NO, TG.MEM_NO AS MEM_NO2
                    , (CASE WHEN NVL(TG.CLPH_TLNO,'N') = 'N' THEN MB.CELL ELSE TG.CLPH_TLNO END) AS CLPH_TLNO
                    , TG.HOME_TLNO, TG.COMP_TLNO, TG.UNTY_CASE_ADTL_YN, TG.PRMV_ID
                    , TG.USER_DEFN1_CNTN, TG.USER_DEFN2_CNTN, TG.USER_DEFN3_CNTN, TG.USER_DEFN4_CNTN, TG.USER_DEFN5_CNTN
                    , TG.USER_DEFN6_CNTN, TG.USER_DEFN7_CNTN, TG.USER_DEFN8_CNTN, TG.USER_DEFN9_CNTN, TG.USER_DEFN10_CNTN
                    , TG.USER_DEFN11_CNTN, TG.USER_DEFN12_CNTN, TG.USER_DEFN13_CNTN, TG.USER_DEFN14_CNTN, TG.USER_DEFN15_CNTN
                    , TG.USER_DEFN16_CNTN, TG.USER_DEFN17_CNTN, TG.USER_DEFN18_CNTN, TG.USER_DEFN19_CNTN, TG.USER_DEFN20_CNTN
                    , TA.DPMS_TMCNT, TO_CHAR(TA.DPMS_DTTM, 'YYYYMMDDHH24MISS') AS DPMS_DTTM, TA.DPMS_RESL_CD, TA.DPMS_STAT_CD
                    , TA.CTI_CRNC_DTL_ID, TG.ETC_TLNO
                    , GETCODENM('CAM090', TA.DPMS_RESL_CD, TA.CNTR_CD) AS DPMS_RESL_NM
                    , GETCODENM('CAM100', TA.DPMS_STAT_CD, TA.CNTR_CD) AS DPMS_STAT_NM
                    , GETCODENM('CAM180', TA.DPMS_GBN_CD, TA.CNTR_CD) AS DPMS_GBN_NM
                    , TA.DPMS_RESL_CNTN, TA.PROD_JOIN_YN , TA.DPMS_TLPH_DIV_CD , TA.DPMS_TLNO
                    , TA.TRGT_LIST_ID, TA.CMPG_ID, TA.SUB_TRGT_LIST_ID, TA.CNTR_CD, TA.CNSR_ID, TA.TRGT_CUST_DTPT_ID
                    , TA.RESERVE_PROC_DT 	/* 예약일자 */
                    , TA.RESERVE_PROC_TM	/* 예약시간 */
                    , TG.RGSN_DTTM
                    , (SELECT USER_NM FROM TB_USER WHERE USER_ID = TA.CNSR_ID) AS CNSR_NM
                    , (SELECT USER_NM FROM TB_USER WHERE USER_ID = TA.AMND_ID) AS AMND_NM
                    , CP.CMPG_INVT_MTHD_CD
                    , (SELECT HGRN_HRCH_CD FROM  TB_HRCH_CD HC  WHERE  TL.CMPG_TYP_CD = HC.HRCH_CD) AS HGRN_HRCH_CD
                    , TL.CMPG_TYP_CD
                    , CP.CMPG_NM
                    , ST.INVT_CNTS_ID , ST.SUB_TRGT_LIST_NM
                    <!-- 나중에 변경  -->
                    , ST.CMPG_PRFM_TEAM_CD

                    , TG.BRTH_MON_DAY
                    , NC.UPP_TX_TYPE
                    , (CASE WHEN NC.UPP_TX_TYPE = '01' THEN '1차접수'
                            WHEN NC.UPP_TX_TYPE = '02' THEN '본인인증'
                            WHEN NC.UPP_TX_TYPE = '03' THEN '신용정보취득'
                            WHEN NC.UPP_TX_TYPE = '04' THEN '2차접수'
                            WHEN NC.UPP_TX_TYPE = '05' THEN '위탁처리동의'
                            WHEN NC.UPP_TX_TYPE = '06' THEN '고객가입완료'
                            ELSE '' END )  UPP_TX_TYPE_NM
                    , NC.ACUON_FITNESS_YN
                    , (CASE WHEN LENGTH(NVL(NC.CI_VAL,'')) = 88 THEN 'Y' ELSE '' END) CI_YN
                    , NC.CI_VAL
                    , NC.GENDER
                    , NC.CREDIT_RATING
                    , NC.SAFEKEY
                    , NC.NICE_NO
                    , TA.DPMS_GBN_CD
                  FROM TB_TRGT_CUST_ALCT TA
                                       INNER JOIN TB_TRGT_CUST_DTPT TG
                                         ON(TA.SUB_TRGT_LIST_ID = TG.SUB_TRGT_LIST_ID
                                         AND TA.TRGT_CUST_DTPT_ID = TG.TRGT_CUST_DTPT_ID)
                                       INNER JOIN TB_CMPG_BASI CP
                                         ON(TA.CMPG_ID = CP.CMPG_ID )
                                       INNER JOIN TB_TRGT_LIST_DTL TL
                                         ON(TL.TRGT_LIST_ID = TA.TRGT_LIST_ID )
                                       INNER JOIN TB_SUB_TRGT_LIST_DTL ST
                                         ON(TA.SUB_TRGT_LIST_ID=ST.SUB_TRGT_LIST_ID)

                                        LEFT JOIN  LF_DMUSER.TB_MEMBER_NICE_INFO NC
                                          ON(TG.SUB_TRGT_LIST_ID = NC.SUB_TRGT_LIST_ID
                                         AND TG.TRGT_CUST_DTPT_ID = NC.TRGT_CUST_DTPT_ID)

                                        LEFT OUTER JOIN LF_DMUSER.MEMBER MB
                                          ON TG.MEM_NO = MB.MEM_NO
                                         AND MB.DEL_FG = 'N'
                   <include refid="TrgtCustAlctMap.selectCondition_fragment" />
                   <if test="upp_tx_type != null and upp_tx_type != ''">
                      AND NC.UPP_TX_TYPE = #{upp_tx_type}
                   </if>
               ) A
        WHERE 1=1
        <if test="cust_nm != null and cust_nm != ''">
          AND A.CUST_NM LIKE #{cust_nm}||'%'
        </if>
        <if test="tell_no != null and tell_no != ''">
          AND ( (A.HOME_TlNO LIKE '%' || REPLACE(#{tell_no},'-',''))
             OR (A.CLPH_TLNO LIKE '%' || REPLACE(#{tell_no},'-',''))
             OR (A.COMP_TLNO LIKE '%' || REPLACE(#{tell_no},'-','')) )
        </if>
    </select>
    
         <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctCount" parameterType="map" resultType="int">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctCount */
		   COUNT(*)
		FROM (SELECT  ROWNUM AS PAGE_INDX
		            , (SELECT ADTL_CD FROM TB_CD WHERE CD = A.DPMS_RESL_CD  AND CD_SET_CD = 'CAM090') AS ADTL_CD
		            , A.CUST_NM, A.ACCNT_NO
		            , A.CLPH_TLNO, A.HOME_TLNO, A.COMP_TLNO, A.UNTY_CASE_ADTL_YN , A.PRMV_ID
		            , A.USER_DEFN1_CNTN, A.USER_DEFN2_CNTN, A.USER_DEFN3_CNTN, A.USER_DEFN4_CNTN, A.USER_DEFN5_CNTN
		            , A.USER_DEFN6_CNTN, A.USER_DEFN7_CNTN, A.USER_DEFN8_CNTN, A.USER_DEFN9_CNTN, A.USER_DEFN10_CNTN
		            , A.USER_DEFN11_CNTN, A.USER_DEFN12_CNTN, A.USER_DEFN13_CNTN, A.USER_DEFN14_CNTN, A.USER_DEFN15_CNTN
		            , A.USER_DEFN16_CNTN, A.USER_DEFN17_CNTN, A.USER_DEFN18_CNTN, A.USER_DEFN19_CNTN, A.USER_DEFN20_CNTN
		            , A.DPMS_TMCNT, A.DPMS_DTTM, A.DPMS_STAT_CD, A.DPMS_STAT_NM, A.DPMS_RESL_CD, A.DPMS_RESL_NM, A.CTI_CRNC_DTL_ID, A.ETC_TLNO
		            , A.DPMS_RESL_CNTN, A.PROD_JOIN_YN, A.DPMS_TLPH_DIV_CD , A.DPMS_TLNO, A.TRGT_LIST_ID, A.CNSR_ID, A.CNSR_NM, A.AMND_NM
		            , A.CMPG_ID, A.SUB_TRGT_LIST_ID, A.CNTR_CD, A.CMPG_INVT_MTHD_CD
		            , GETCODENM('CAM060', A.CMPG_INVT_MTHD_CD, A.CNTR_CD) AS CMPG_INVT_MTHD_NM
		            , A.TRGT_CUST_DTPT_ID , A.CMPG_TYP_CD , A.HGRN_HRCH_CD
		            , FN_GETHRCHCDNM('CAM990', A.CMPG_TYP_CD, A.CNTR_CD) AS CMPG_TYP_NM
		            , FN_GETHRCHCDNM('CAM990', A.HGRN_HRCH_CD, A.CNTR_CD) AS HGRN_HRCH_NM
		            , GETCODENM('CAM130', A.DPMS_TLPH_DIV_CD, A.CNTR_CD) AS DPMS_TLPH_DIV_NM
		            , A.RGSN_DTTM, A.CMPG_NM, A.INVT_CNTS_ID, A.SUB_TRGT_LIST_NM
		            , (SELECT TEAM_NM FROM TB_CONS_TEAM WHERE TEAM_CD= A.CMPG_PRFM_TEAM_CD) AS TEAM_NM
		            , A.RESERVE_PROC_DT 	/* 예약일자 */
		            , TO_CHAR(TO_DATE(A.RESERVE_PROC_TM,'MI:SS'),'MI:SS') AS RESERVE_PROC_TM 	/* 예약시간 */
		            , to_char(SYSDATE,'YYYYMMDDHH24MISS') DTHMS
		             
		            , A.BRTH_MON_DAY
		            , A.UPP_TX_TYPE
		            , A.UPP_TX_TYPE_NM
		            , A.ACUON_FITNESS_YN
		            , A.CI_YN
		            , A.CI_VAL
		            , A.GENDER
		            , A.CREDIT_RATING
		            , A.SAFEKEY
		            , (SELECT MAX(MEM_NO) FROM LF_DMUSER.TB_MEMBER_NICE_INFO_SECOND WHERE NICE_NO  = A.NICE_NO ) AS MEM_NO1
		            , MEM_NO2
		            , DPMS_GBN_CD
		            , DPMS_GBN_NM
		            , A.TEL_YN
                    , A.SMS_YN
                    , A.EMAIL_YN
                    , A.DM_YN
                    , A.MARRY_YN
                    , A.CHILD_CNT
                    , A.MARKET_AGREE
		FROM 
		(
		    SELECT 
		        (CASE WHEN NVL(TCA.MEM_NM,'N') = 'N' THEN MB.MEM_NM ELSE TCA.MEM_NM END) AS CUST_NM
		        , TCA.ACCNT_NO, TCA.MEM_NO AS MEM_NO2
		        , (CASE WHEN NVL(TCA.CELL,'N') = 'N' THEN MB.CELL ELSE TCA.CELL END) AS CLPH_TLNO
		        , '' AS HOME_TLNO, '' AS COMP_TLNO, '' AS UNTY_CASE_ADTL_YN, '' AS PRMV_ID
		        , '' AS USER_DEFN1_CNTN, '' AS USER_DEFN2_CNTN, '' AS USER_DEFN3_CNTN, '' AS USER_DEFN4_CNTN, '' AS USER_DEFN5_CNTN
		        , '' AS USER_DEFN6_CNTN, '' AS USER_DEFN7_CNTN, '' AS USER_DEFN8_CNTN, '' AS USER_DEFN9_CNTN, '' AS USER_DEFN10_CNTN
		        , '' AS USER_DEFN11_CNTN, '' AS USER_DEFN12_CNTN, '' AS USER_DEFN13_CNTN, '' AS USER_DEFN14_CNTN, '' AS USER_DEFN15_CNTN
		        , '' AS USER_DEFN16_CNTN, '' AS USER_DEFN17_CNTN, '' AS USER_DEFN18_CNTN, '' AS USER_DEFN19_CNTN, '' AS USER_DEFN20_CNTN
		        , TA.DPMS_TMCNT, TO_CHAR(TA.DPMS_DTTM, 'YYYYMMDDHH24MISS') AS DPMS_DTTM, TA.DPMS_RESL_CD, TA.DPMS_STAT_CD
		        , TA.CTI_CRNC_DTL_ID, '' AS ETC_TLNO
		        , GETCODENM('CAM090', TA.DPMS_RESL_CD, TA.CNTR_CD) AS DPMS_RESL_NM
		        , GETCODENM('CAM100', TA.DPMS_STAT_CD, TA.CNTR_CD) AS DPMS_STAT_NM
		        , GETCODENM('CAM180', TA.DPMS_GBN_CD, TA.CNTR_CD) AS DPMS_GBN_NM
		        , TA.DPMS_RESL_CNTN, TA.PROD_JOIN_YN , TA.DPMS_TLPH_DIV_CD , TA.DPMS_TLNO
		        , TA.TRGT_LIST_ID, TA.CMPG_ID, TA.SUB_TRGT_LIST_ID, TA.CNTR_CD, TA.CNSR_ID, TA.TRGT_CUST_DTPT_ID
		        , TA.RESERVE_PROC_DT 	/* 예약일자 */
		        , TA.RESERVE_PROC_TM	/* 예약시간 */
		        , TARGET_DM AS RGSN_DTTM
		        , (SELECT USER_NM FROM TB_USER WHERE USER_ID = TA.CNSR_ID) AS CNSR_NM
		        , (SELECT USER_NM FROM TB_USER WHERE USER_ID = TA.AMND_ID) AS AMND_NM
		        , CP.CMPG_INVT_MTHD_CD
		        , (SELECT HGRN_HRCH_CD FROM  TB_HRCH_CD HC  WHERE  TL.CMPG_TYP_CD = HC.HRCH_CD) AS HGRN_HRCH_CD
		        , TL.CMPG_TYP_CD
		        , CP.CMPG_NM
		        , ST.INVT_CNTS_ID , ST.SUB_TRGT_LIST_NM
		
		        , ST.CMPG_PRFM_TEAM_CD
		
		        , NC.BRTH_MON_DAY
		        , NC.UPP_TX_TYPE
		        , (CASE WHEN NC.UPP_TX_TYPE = '01' THEN '1차접수'
		                WHEN NC.UPP_TX_TYPE = '02' THEN '본인인증'
		                WHEN NC.UPP_TX_TYPE = '03' THEN '신용정보취득'
		                WHEN NC.UPP_TX_TYPE = '04' THEN '2차접수'
		                WHEN NC.UPP_TX_TYPE = '05' THEN '위탁처리동의'
		                WHEN NC.UPP_TX_TYPE = '06' THEN '고객가입완료'
		                ELSE '' END )  UPP_TX_TYPE_NM
		        , NC.ACUON_FITNESS_YN
		        , (CASE WHEN LENGTH(NVL(NC.CI_VAL,'')) = 88 THEN 'Y' ELSE '' END) CI_YN
		        , NC.CI_VAL
		        , NC.GENDER
		        , NC.CREDIT_RATING
		        , NC.SAFEKEY
		        , NC.NICE_NO
		        , TA.DPMS_GBN_CD
				, TCA.TEL_YN
				, TCA.SMS_YN
				, TCA.EMAIL_YN
				, TCA.DM_YN
				, TCA.MARRY_YN
				, TCA.CHILD_CNT
				, TCA.MARKET_AGREE
		    FROM TB_TRGT_CUST_ALCT TA INNER JOIN
		        TB_COUNSEL_TARGET TCA ON TA.SUB_TRGT_LIST_ID = TCA.SUB_TRGT_LIST_ID 
		                              AND TA.TRGT_CUST_DTPT_ID = TCA.TRGT_CUST_DTPT_ID INNER JOIN
		        TB_CMPG_BASI CP ON TA.CMPG_ID = CP.CMPG_ID INNER JOIN 
		        TB_TRGT_LIST_DTL TL ON TL.TRGT_LIST_ID = TA.TRGT_LIST_ID INNER JOIN 
		        TB_SUB_TRGT_LIST_DTL ST ON TA.SUB_TRGT_LIST_ID=ST.SUB_TRGT_LIST_ID LEFT JOIN  
		        LF_DMUSER.TB_MEMBER_NICE_INFO NC ON TCA.SUB_TRGT_LIST_ID = NC.SUB_TRGT_LIST_ID AND TCA.TRGT_CUST_DTPT_ID = NC.TRGT_CUST_DTPT_ID LEFT OUTER JOIN 
		        LF_DMUSER.MEMBER MB ON NC.MEM_NO = MB.MEM_NO AND MB.DEL_FG = 'N'     
		        WHERE 1=1                      
                           <if test="upp_tx_type != null and upp_tx_type != ''">
                              AND NC.UPP_TX_TYPE = #{upp_tx_type}
                           </if>
                           <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
				              AND TA.DPMS_STAT_CD = #{dpms_stat_cd}
				           </if>
				           <if test="dpms_resl_cd != null and dpms_resl_cd != ''">
				              AND TA.DPMS_RESL_CD = #{dpms_resl_cd}
				           </if>
                            <choose>
                                <when test="orderBy != null and orderBy != ''">
                                ORDER BY ${orderBy} ${orderDirection}
                                </when>
                                <otherwise>
                                 ORDER BY DPMS_DTTM DESC
                                </otherwise>
                            </choose>
                       ) A
                       WHERE 1=1
                       	 AND A.CNSR_ID = #{user_id}
                       <if test="cust_nm != null and cust_nm != ''">
                         AND A.CUST_NM LIKE #{cust_nm}||'%'
                       </if>
                       <if test="tell_no != null and tell_no != ''">
                         AND ( (A.HOME_TlNO LIKE '%' || REPLACE(#{tell_no},'-',''))
                            OR (A.CLPH_TLNO LIKE '%' || REPLACE(#{tell_no},'-',''))
                            OR (A.COMP_TLNO LIKE '%' || REPLACE(#{tell_no},'-','')) )
                       </if>
               ) B
    </select>

     <!-- 사용 -->
    <select id="TrgtCustAlctMap.getAlctCount" parameterType="map" resultType="int">
        SELECT /* TrgtCustAlctMap.getAlctCount */
               COUNT(*)
          FROM TB_CMPG_BASI A JOIN TB_TRGT_CUST_ALCT B ON A.CMPG_ID = B.CMPG_ID
         WHERE A.CMPG_ID = #{cmpg_id}
    </select>


    <!-- 사용 -->
    <select id="TrgtCustAlctMap.getTrgtCustAlctList" parameterType="map" resultType="resultMap">
        SELECT /* TrgtCustAlctMap.getTrgtCustAlctList */
               B.*
               , CASE WHEN MEM_NO1 IS NULL THEN MEM_NO2 ELSE  MEM_NO1 END AS MEM_NO
               , CASE WHEN nvl(B.RESERVE_PROC_DT,'X') <![CDATA[<>]]> 'X' THEN
                           replace(B.RESERVE_PROC_DT || RESERVE_PROC_TM, ':', '')
                      ELSE
                          NULL
                      END RESERVE_DTHMS
               , (SELECT SUB_TRGT_LIST_NM FROM TB_SUB_TRGT_LIST_DTL WHERE SUB_TRGT_LIST_ID = B.SUB_TRGT_LIST_ID) AS SUB_TRGT_LIST_NM
          FROM (SELECT  ROWNUM AS PAGE_INDX
                        , (SELECT ADTL_CD FROM TB_CD WHERE CD = A.DPMS_RESL_CD  AND CD_SET_CD = 'CAM090') AS ADTL_CD
                        , A.CUST_NM, A.ACCNT_NO
                        , A.CLPH_TLNO, A.HOME_TLNO, A.COMP_TLNO, A.UNTY_CASE_ADTL_YN , A.PRMV_ID
                        , A.USER_DEFN1_CNTN, A.USER_DEFN2_CNTN, A.USER_DEFN3_CNTN, A.USER_DEFN4_CNTN, A.USER_DEFN5_CNTN
                        , A.USER_DEFN6_CNTN, A.USER_DEFN7_CNTN, A.USER_DEFN8_CNTN, A.USER_DEFN9_CNTN, A.USER_DEFN10_CNTN
                        , A.USER_DEFN11_CNTN, A.USER_DEFN12_CNTN, A.USER_DEFN13_CNTN, A.USER_DEFN14_CNTN, A.USER_DEFN15_CNTN
                        , A.USER_DEFN16_CNTN, A.USER_DEFN17_CNTN, A.USER_DEFN18_CNTN, A.USER_DEFN19_CNTN, A.USER_DEFN20_CNTN
                        , A.DPMS_TMCNT, A.DPMS_DTTM, A.DPMS_STAT_CD, A.DPMS_STAT_NM, A.DPMS_RESL_CD, A.DPMS_RESL_NM, A.CTI_CRNC_DTL_ID, A.ETC_TLNO
                        , A.DPMS_RESL_CNTN, A.PROD_JOIN_YN, A.DPMS_TLPH_DIV_CD , A.DPMS_TLNO, A.TRGT_LIST_ID, A.CNSR_ID, A.CNSR_NM, A.AMND_NM
                        , A.CMPG_ID, A.SUB_TRGT_LIST_ID, A.CNTR_CD, A.CMPG_INVT_MTHD_CD
                        , GETCODENM('CAM060', A.CMPG_INVT_MTHD_CD, A.CNTR_CD) AS CMPG_INVT_MTHD_NM
                        , A.TRGT_CUST_DTPT_ID , A.CMPG_TYP_CD , A.HGRN_HRCH_CD
                        , FN_GETHRCHCDNM('CAM990', A.CMPG_TYP_CD, A.CNTR_CD) AS CMPG_TYP_NM
                        , FN_GETHRCHCDNM('CAM990', A.HGRN_HRCH_CD, A.CNTR_CD) AS HGRN_HRCH_NM
                        , GETCODENM('CAM130', A.DPMS_TLPH_DIV_CD, A.CNTR_CD) AS DPMS_TLPH_DIV_NM
                        , A.RGSN_DTTM, A.CMPG_NM, A.INVT_CNTS_ID, A.SUB_TRGT_LIST_NM
                        , (SELECT TEAM_NM FROM TB_CONS_TEAM WHERE TEAM_CD= A.CMPG_PRFM_TEAM_CD) AS TEAM_NM
                        , A.RESERVE_PROC_DT 	/* 예약일자 */
                        , TO_CHAR(TO_DATE(A.RESERVE_PROC_TM,'MI:SS'),'MI:SS') AS RESERVE_PROC_TM 	/* 예약시간 */
                        , to_char(SYSDATE,'YYYYMMDDHH24MISS') DTHMS
                         <!-- 2018.02.07 김찬영 전자서명으로 인한 필드 추가 -->
                        , A.BRTH_MON_DAY
                        , A.UPP_TX_TYPE
                        , A.UPP_TX_TYPE_NM
                        , A.ACUON_FITNESS_YN
                        , A.CI_YN
                        , A.CI_VAL
                        , A.GENDER
                        , A.CREDIT_RATING
                        , A.SAFEKEY
                        , (SELECT MAX(MEM_NO) FROM LF_DMUSER.TB_MEMBER_NICE_INFO_SECOND WHERE NICE_NO  = A.NICE_NO ) AS MEM_NO1
                        , MEM_NO2
                        , DPMS_GBN_CD
                        , DPMS_GBN_NM
                  FROM (SELECT
                              (CASE WHEN NVL(TG.CUST_NM,'N') = 'N' THEN MB.MEM_NM ELSE TG.CUST_NM END) AS CUST_NM
                            , TG.ACCNT_NO, TG.MEM_NO AS MEM_NO2
                            , (CASE WHEN NVL(TG.CLPH_TLNO,'N') = 'N' THEN MB.CELL ELSE TG.CLPH_TLNO END) AS CLPH_TLNO
                            , TG.HOME_TLNO, TG.COMP_TLNO, TG.UNTY_CASE_ADTL_YN, TG.PRMV_ID
                            , TG.USER_DEFN1_CNTN, TG.USER_DEFN2_CNTN, TG.USER_DEFN3_CNTN, TG.USER_DEFN4_CNTN, TG.USER_DEFN5_CNTN
                            , TG.USER_DEFN6_CNTN, TG.USER_DEFN7_CNTN, TG.USER_DEFN8_CNTN, TG.USER_DEFN9_CNTN, TG.USER_DEFN10_CNTN
                            , TG.USER_DEFN11_CNTN, TG.USER_DEFN12_CNTN, TG.USER_DEFN13_CNTN, TG.USER_DEFN14_CNTN, TG.USER_DEFN15_CNTN
                            , TG.USER_DEFN16_CNTN, TG.USER_DEFN17_CNTN, TG.USER_DEFN18_CNTN, TG.USER_DEFN19_CNTN, TG.USER_DEFN20_CNTN
                            , TA.DPMS_TMCNT, TO_CHAR(TA.DPMS_DTTM, 'YYYYMMDDHH24MISS') AS DPMS_DTTM, TA.DPMS_RESL_CD, TA.DPMS_STAT_CD
                            , TA.CTI_CRNC_DTL_ID, TG.ETC_TLNO
                            , GETCODENM('CAM090', TA.DPMS_RESL_CD, TA.CNTR_CD) AS DPMS_RESL_NM
                            , GETCODENM('CAM100', TA.DPMS_STAT_CD, TA.CNTR_CD) AS DPMS_STAT_NM
                            , GETCODENM('CAM180', TA.DPMS_GBN_CD, TA.CNTR_CD) AS DPMS_GBN_NM
                            , TA.DPMS_RESL_CNTN, TA.PROD_JOIN_YN , TA.DPMS_TLPH_DIV_CD , TA.DPMS_TLNO
                            , TA.TRGT_LIST_ID, TA.CMPG_ID, TA.SUB_TRGT_LIST_ID, TA.CNTR_CD, TA.CNSR_ID, TA.TRGT_CUST_DTPT_ID
                            , TA.RESERVE_PROC_DT 	/* 예약일자 */
                            , TA.RESERVE_PROC_TM	/* 예약시간 */
                            , TG.RGSN_DTTM
                            , (SELECT USER_NM FROM TB_USER WHERE USER_ID = TA.CNSR_ID) AS CNSR_NM
                            , (SELECT USER_NM FROM TB_USER WHERE USER_ID = TA.AMND_ID) AS AMND_NM
                            , CP.CMPG_INVT_MTHD_CD
                            , (SELECT HGRN_HRCH_CD FROM  TB_HRCH_CD HC  WHERE  TL.CMPG_TYP_CD = HC.HRCH_CD) AS HGRN_HRCH_CD
                            , TL.CMPG_TYP_CD
                            , CP.CMPG_NM
                            , ST.INVT_CNTS_ID , ST.SUB_TRGT_LIST_NM
                            <!-- 나중에 변경  -->
                            , ST.CMPG_PRFM_TEAM_CD

                            , TG.BRTH_MON_DAY
                            , NC.UPP_TX_TYPE
                            , (CASE WHEN NC.UPP_TX_TYPE = '01' THEN '1차접수'
                                    WHEN NC.UPP_TX_TYPE = '02' THEN '본인인증'
                                    WHEN NC.UPP_TX_TYPE = '03' THEN '신용정보취득'
                                    WHEN NC.UPP_TX_TYPE = '04' THEN '2차접수'
                                    WHEN NC.UPP_TX_TYPE = '05' THEN '위탁처리동의'
                                    WHEN NC.UPP_TX_TYPE = '06' THEN '고객가입완료'
                                    ELSE '' END )  UPP_TX_TYPE_NM
                            , NC.ACUON_FITNESS_YN
                            , (CASE WHEN LENGTH(NVL(NC.CI_VAL,'')) = 88 THEN 'Y' ELSE '' END) CI_YN
                            , NC.CI_VAL
                            , NC.GENDER
                            , NC.CREDIT_RATING
                            , NC.SAFEKEY
                            , NC.NICE_NO
                            , TA.DPMS_GBN_CD
                          FROM TB_TRGT_CUST_ALCT TA
                                               INNER JOIN TB_TRGT_CUST_DTPT TG
                                                 ON(TA.SUB_TRGT_LIST_ID = TG.SUB_TRGT_LIST_ID
                                                 AND TA.TRGT_CUST_DTPT_ID = TG.TRGT_CUST_DTPT_ID)
                                               INNER JOIN TB_CMPG_BASI CP
                                                 ON(TA.CMPG_ID = CP.CMPG_ID )
                                               INNER JOIN TB_TRGT_LIST_DTL TL
                                                 ON(TL.TRGT_LIST_ID = TA.TRGT_LIST_ID )
                                               INNER JOIN TB_SUB_TRGT_LIST_DTL ST
                                                 ON(TA.SUB_TRGT_LIST_ID=ST.SUB_TRGT_LIST_ID)

                                                LEFT JOIN  LF_DMUSER.TB_MEMBER_NICE_INFO NC
                                                  ON(TG.SUB_TRGT_LIST_ID = NC.SUB_TRGT_LIST_ID
                                                 AND TG.TRGT_CUST_DTPT_ID = NC.TRGT_CUST_DTPT_ID)

                                                LEFT OUTER JOIN LF_DMUSER.MEMBER MB
                                                  ON TG.MEM_NO = MB.MEM_NO
                                                 AND MB.DEL_FG = 'N'
                           <include refid="TrgtCustAlctMap.selectCondition_fragment" />
                           <if test="upp_tx_type != null and upp_tx_type != ''">
                              AND NC.UPP_TX_TYPE = #{upp_tx_type}
                           </if>
                            <choose>
                                <when test="orderBy != null and orderBy != ''">
                                ORDER BY ${orderBy} ${orderDirection}
                                </when>
                                <otherwise>
                                 ORDER BY DPMS_DTTM DESC
                                </otherwise>
                            </choose>
                       ) A
                       WHERE 1=1
                       <if test="cust_nm != null and cust_nm != ''">
                         AND A.CUST_NM LIKE #{cust_nm}||'%'
                       </if>
                       <if test="tell_no != null and tell_no != ''">
                         AND ( (A.HOME_TlNO LIKE '%' || REPLACE(#{tell_no},'-',''))
                            OR (A.CLPH_TLNO LIKE '%' || REPLACE(#{tell_no},'-',''))
                            OR (A.COMP_TLNO LIKE '%' || REPLACE(#{tell_no},'-','')) )
                       </if>
               ) B
        <if test="startLine != null and startLine != '' and endLine != null and endLine != ''">
            <![CDATA[
             WHERE PAGE_INDX >= #{startLine}
               AND PAGE_INDX < #{endLine}
            ]]>
        </if>
    </select>
    
    <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctList" parameterType="map" resultType="resultMap">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctList */
		   B.*
		   , CASE WHEN MEM_NO1 IS NULL THEN MEM_NO2 ELSE  MEM_NO1 END AS MEM_NO
		   , CASE WHEN nvl(B.RESERVE_PROC_DT,'X')  !=  'X' THEN
		               replace(B.RESERVE_PROC_DT || RESERVE_PROC_TM, ':', '')
		          ELSE
		              NULL
		          END RESERVE_DTHMS
		   , (SELECT SUB_TRGT_LIST_NM FROM TB_SUB_TRGT_LIST_DTL WHERE SUB_TRGT_LIST_ID = B.SUB_TRGT_LIST_ID) AS SUB_TRGT_LIST_NM
		FROM (SELECT  ROWNUM AS PAGE_INDX
		            , (SELECT ADTL_CD FROM TB_CD WHERE CD = A.DPMS_RESL_CD  AND CD_SET_CD = 'CAM090') AS ADTL_CD
		            , A.CUST_NM, A.ACCNT_NO
		            , A.CLPH_TLNO, A.HOME_TLNO, A.COMP_TLNO, A.UNTY_CASE_ADTL_YN , A.PRMV_ID
		            , A.USER_DEFN1_CNTN, A.USER_DEFN2_CNTN, A.USER_DEFN3_CNTN, A.USER_DEFN4_CNTN, A.USER_DEFN5_CNTN
		            , A.USER_DEFN6_CNTN, A.USER_DEFN7_CNTN, A.USER_DEFN8_CNTN, A.USER_DEFN9_CNTN, A.USER_DEFN10_CNTN
		            , A.USER_DEFN11_CNTN, A.USER_DEFN12_CNTN, A.USER_DEFN13_CNTN, A.USER_DEFN14_CNTN, A.USER_DEFN15_CNTN
		            , A.USER_DEFN16_CNTN, A.USER_DEFN17_CNTN, A.USER_DEFN18_CNTN, A.USER_DEFN19_CNTN, A.USER_DEFN20_CNTN
		            , A.DPMS_TMCNT, A.DPMS_DTTM, A.DPMS_STAT_CD, A.DPMS_STAT_NM, A.DPMS_RESL_CD, A.DPMS_RESL_NM, A.CTI_CRNC_DTL_ID, A.ETC_TLNO
		            , A.DPMS_RESL_CNTN, A.PROD_JOIN_YN, A.DPMS_TLPH_DIV_CD , A.DPMS_TLNO, A.TRGT_LIST_ID, A.CNSR_ID, A.CNSR_NM, A.AMND_NM
		            , A.CMPG_ID, A.SUB_TRGT_LIST_ID, A.CNTR_CD, A.CMPG_INVT_MTHD_CD
		            , GETCODENM('CAM060', A.CMPG_INVT_MTHD_CD, A.CNTR_CD) AS CMPG_INVT_MTHD_NM
		            , A.TRGT_CUST_DTPT_ID , A.CMPG_TYP_CD , A.HGRN_HRCH_CD
		            , FN_GETHRCHCDNM('CAM990', A.CMPG_TYP_CD, A.CNTR_CD) AS CMPG_TYP_NM
		            , FN_GETHRCHCDNM('CAM990', A.HGRN_HRCH_CD, A.CNTR_CD) AS HGRN_HRCH_NM
		            , GETCODENM('CAM130', A.DPMS_TLPH_DIV_CD, A.CNTR_CD) AS DPMS_TLPH_DIV_NM
		            , A.RGSN_DTTM, A.CMPG_NM, A.INVT_CNTS_ID, A.SUB_TRGT_LIST_NM
		            , (SELECT TEAM_NM FROM TB_CONS_TEAM WHERE TEAM_CD= A.CMPG_PRFM_TEAM_CD) AS TEAM_NM
		            , A.RESERVE_PROC_DT 	/* 예약일자 */
		            , TO_CHAR(TO_DATE(A.RESERVE_PROC_TM,'MI:SS'),'MI:SS') AS RESERVE_PROC_TM 	/* 예약시간 */
		            , to_char(SYSDATE,'YYYYMMDDHH24MISS') DTHMS
		             
		            , A.BRTH_MON_DAY
		            , A.UPP_TX_TYPE
		            , A.UPP_TX_TYPE_NM
		            , A.ACUON_FITNESS_YN
		            , A.CI_YN
		            , A.CI_VAL
		            , A.GENDER
		            , A.CREDIT_RATING
		            , A.SAFEKEY
		            , (SELECT MAX(MEM_NO) FROM LF_DMUSER.TB_MEMBER_NICE_INFO_SECOND WHERE NICE_NO  = A.NICE_NO ) AS MEM_NO1
		            , MEM_NO2
		            , DPMS_GBN_CD
		            , DPMS_GBN_NM
		            , A.TEL_YN
                    , A.SMS_YN
                    , A.EMAIL_YN
                    , A.DM_YN
                    , A.MARRY_YN
                    , A.CHILD_CNT
                    , A.MARKET_AGREE
		FROM 
		(
		    SELECT 
		        (CASE WHEN NVL(TCA.MEM_NM,'N') = 'N' THEN MB.MEM_NM ELSE TCA.MEM_NM END) AS CUST_NM
		        , TCA.ACCNT_NO, TCA.MEM_NO AS MEM_NO2
		        , (CASE WHEN NVL(TCA.CELL,'N') = 'N' THEN MB.CELL ELSE TCA.CELL END) AS CLPH_TLNO
		        , '' AS HOME_TLNO, '' AS COMP_TLNO, '' AS UNTY_CASE_ADTL_YN, TCA.TARGET_NO AS PRMV_ID
		        , TCA.COUNSEL_TIME AS USER_DEFN1_CNTN, TCA.MEMO AS USER_DEFN2_CNTN, PROD_R_1 AS USER_DEFN3_CNTN, PROD_T_1 AS USER_DEFN4_CNTN, PROD_R_2 AS USER_DEFN5_CNTN
		        , PROD_T_2 AS USER_DEFN6_CNTN, PAY_MTHD AS USER_DEFN7_CNTN, '' AS USER_DEFN8_CNTN, '' AS USER_DEFN9_CNTN, '' AS USER_DEFN10_CNTN
		        , '' AS USER_DEFN11_CNTN, '' AS USER_DEFN12_CNTN, '' AS USER_DEFN13_CNTN, '' AS USER_DEFN14_CNTN, '' AS USER_DEFN15_CNTN
		        , '' AS USER_DEFN16_CNTN, '' AS USER_DEFN17_CNTN, '' AS USER_DEFN18_CNTN, '' AS USER_DEFN19_CNTN, '' AS USER_DEFN20_CNTN
		        , TA.DPMS_TMCNT, TO_CHAR(TA.DPMS_DTTM, 'YYYYMMDDHH24MISS') AS DPMS_DTTM, TA.DPMS_RESL_CD, TA.DPMS_STAT_CD
		        , TA.CTI_CRNC_DTL_ID, '' AS ETC_TLNO
		        , GETCODENM('CAM090', TA.DPMS_RESL_CD, TA.CNTR_CD) AS DPMS_RESL_NM
		        , GETCODENM('CAM100', TA.DPMS_STAT_CD, TA.CNTR_CD) AS DPMS_STAT_NM
		        , GETCODENM('CAM180', TA.DPMS_GBN_CD, TA.CNTR_CD) AS DPMS_GBN_NM
		        , TA.DPMS_RESL_CNTN, TA.PROD_JOIN_YN , TA.DPMS_TLPH_DIV_CD , TA.DPMS_TLNO
		        , TA.TRGT_LIST_ID, TA.CMPG_ID, TA.SUB_TRGT_LIST_ID, TA.CNTR_CD, TA.CNSR_ID, TA.TRGT_CUST_DTPT_ID
		        , TA.RESERVE_PROC_DT 	/* 예약일자 */
		        , TA.RESERVE_PROC_TM	/* 예약시간 */
		        , TARGET_DM AS RGSN_DTTM
		        , (SELECT USER_NM FROM TB_USER WHERE USER_ID = TA.CNSR_ID) AS CNSR_NM
		        , (SELECT USER_NM FROM TB_USER WHERE USER_ID = TA.AMND_ID) AS AMND_NM
		        , CP.CMPG_INVT_MTHD_CD
		        , (SELECT HGRN_HRCH_CD FROM  TB_HRCH_CD HC  WHERE  TL.CMPG_TYP_CD = HC.HRCH_CD) AS HGRN_HRCH_CD
		        , TL.CMPG_TYP_CD
		        , CP.CMPG_NM
		        , ST.INVT_CNTS_ID , ST.SUB_TRGT_LIST_NM
		
		        , ST.CMPG_PRFM_TEAM_CD
		
		        , NC.BRTH_MON_DAY
		        , NC.UPP_TX_TYPE
		        , (CASE WHEN NC.UPP_TX_TYPE = '01' THEN '1차접수'
		                WHEN NC.UPP_TX_TYPE = '02' THEN '본인인증'
		                WHEN NC.UPP_TX_TYPE = '03' THEN '신용정보취득'
		                WHEN NC.UPP_TX_TYPE = '04' THEN '2차접수'
		                WHEN NC.UPP_TX_TYPE = '05' THEN '위탁처리동의'
		                WHEN NC.UPP_TX_TYPE = '06' THEN '고객가입완료'
		                ELSE '' END )  UPP_TX_TYPE_NM
		        , NC.ACUON_FITNESS_YN
		        , (CASE WHEN LENGTH(NVL(NC.CI_VAL,'')) = 88 THEN 'Y' ELSE '' END) CI_YN
		        , NC.CI_VAL
		        , NC.GENDER
		        , NC.CREDIT_RATING
		        , NC.SAFEKEY
		        , NC.NICE_NO
		        , TA.DPMS_GBN_CD
				, TCA.TEL_YN
				, TCA.SMS_YN
				, TCA.EMAIL_YN
				, TCA.DM_YN
				, TCA.MARRY_YN
				, TCA.CHILD_CNT
				, TCA.MARKET_AGREE
		    FROM TB_TRGT_CUST_ALCT TA INNER JOIN
		        TB_COUNSEL_TARGET TCA ON TA.SUB_TRGT_LIST_ID = TCA.SUB_TRGT_LIST_ID 
		                              AND TA.TRGT_CUST_DTPT_ID = TCA.TRGT_CUST_DTPT_ID INNER JOIN
		        TB_CMPG_BASI CP ON TA.CMPG_ID = CP.CMPG_ID INNER JOIN 
		        TB_TRGT_LIST_DTL TL ON TL.TRGT_LIST_ID = TA.TRGT_LIST_ID INNER JOIN 
		        TB_SUB_TRGT_LIST_DTL ST ON TA.SUB_TRGT_LIST_ID=ST.SUB_TRGT_LIST_ID LEFT JOIN  
		        LF_DMUSER.TB_MEMBER_NICE_INFO NC ON TCA.SUB_TRGT_LIST_ID = NC.SUB_TRGT_LIST_ID AND TCA.TRGT_CUST_DTPT_ID = NC.TRGT_CUST_DTPT_ID LEFT OUTER JOIN 
		        LF_DMUSER.MEMBER MB ON NC.MEM_NO = MB.MEM_NO AND MB.DEL_FG = 'N'     
		        WHERE 1=1                      
                           <if test="upp_tx_type != null and upp_tx_type != ''">
                              AND NC.UPP_TX_TYPE = #{upp_tx_type}
                           </if>
                           <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
				              AND TA.DPMS_STAT_CD = #{dpms_stat_cd}
				           </if>
				           <if test="dpms_resl_cd != null and dpms_resl_cd != ''">
				              AND TA.DPMS_RESL_CD = #{dpms_resl_cd}
				           </if>
                            <choose>
                                <when test="orderBy != null and orderBy != ''">
                                ORDER BY ${orderBy} ${orderDirection}
                                </when>
                                <otherwise>
                                 ORDER BY DPMS_DTTM DESC
                                </otherwise>
                            </choose>
                       ) A
                       WHERE 1=1
                         AND A.CNSR_ID = #{user_id}           
                       
                       <if test="cust_nm != null and cust_nm != ''">
                         AND A.CUST_NM LIKE #{cust_nm}||'%'
                       </if>
                       <if test="tell_no != null and tell_no != ''">
                         AND ( (A.HOME_TlNO LIKE '%' || REPLACE(#{tell_no},'-',''))
                            OR (A.CLPH_TLNO LIKE '%' || REPLACE(#{tell_no},'-',''))
                            OR (A.COMP_TLNO LIKE '%' || REPLACE(#{tell_no},'-','')) )
                       </if>
               ) B
        <if test="startLine != null and startLine != '' and endLine != null and endLine != ''">
            <![CDATA[
             WHERE PAGE_INDX >= #{startLine}
               AND PAGE_INDX < #{endLine}
            ]]>
        </if>
    </select>    

    <select id="TrgtCustAlctMap.getTrgtAlctCustCount" parameterType="map" resultType="int">
        SELECT /* TrgtCustAlctMap.getTrgtAlctCustCount */
               COUNT(*)
          FROM (SELECT TG.TRGT_LIST_ID, TG.CNTR_CD, TG.SUB_TRGT_LIST_ID, TG.TRGT_CUST_DTPT_ID
                    , TG.CUST_NM, TG.MEM_NO, TG.ACCNT_NO ,TG.ETC_TLNO
                    , TG.CLPH_TLNO, TG.HOME_TLNO, TG.COMP_TLNO, TG.UNTY_CASE_ADTL_YN, TG.USER_DEFN1_CNTN, TG.USER_DEFN2_CNTN
                    , TG.USER_DEFN3_CNTN, TG.USER_DEFN4_CNTN, TG.USER_DEFN5_CNTN, TG.USER_DEFN6_CNTN, TG.USER_DEFN7_CNTN, TG.USER_DEFN8_CNTN
                    , TG.USER_DEFN9_CNTN, TG.USER_DEFN10_CNTN, TG.RGSR_ID, TG.RGSN_DTTM, TG.AMND_ID, TG.AMNT_DTTM
                    , (SELECT USER_NM FROM TB_USER WHERE USER_ID = TG.RGSR_ID) AS RGSR_NM
                    , (SELECT USER_NM FROM TB_USER WHERE USER_ID = TG.AMND_ID) AS AMND_NM
                    , TA.DPMS_STAT_CD, TA.DPMS_RESL_CD, TA.CNSR_ID , TA.DPMS_RESL_CNTN
                    , (SELECT USER_NM FROM TB_USER WHERE USER_ID = TA.CNSR_ID) AS USER_NM
                    , NVL2((SELECT 'Y' FROM TB_TRGT_CUST_ALCT
                             WHERE TRGT_LIST_ID=TG.TRGT_LIST_ID AND TRGT_CUST_DTPT_ID = TG.TRGT_CUST_DTPT_ID), 'Y','N') AS ALCT_YN
                  FROM TB_TRGT_CUST_DTPT TG , TB_TRGT_CUST_ALCT TA , TB_CMPG_BASI CP
                 WHERE TG.SUB_TRGT_LIST_ID = TA.SUB_TRGT_LIST_ID(+)
                   AND TG.TRGT_CUST_DTPT_ID = TA.TRGT_CUST_DTPT_ID(+)
                   AND TG.TRGT_LIST_ID = CP.TRGT_LIST_ID
               <if test="cmpg_id != null and cmpg_id != ''">
                   AND CP.CMPG_ID = #{cmpg_id}
               </if>
               <if test="cmpg_prfm_team_cd != null and cmpg_prfm_team_cd != ''">
	                AND SUBSTR(TG.CLPH_TLNO, -1) IN (SELECT COM_CD
			                                         FROM LF_DMUSER.COM_CD
			                                         WHERE GRP_CD = '0231'
			                                         AND CD_NM = #{cmpg_prfm_team_cd} OR SUBSTR(TG.RGSN_DTTM, 0, 8) <![CDATA[<=]]> #{cmpg_day})
	                AND (TA.CNSR_ID IS NULL OR TA.CNSR_ID IN (SELECT USER_ID
	                                                            FROM TB_USER
	                                                            WHERE TEAM_CD = #{cmpg_prfm_team_cd}))
	            </if>
                )
              <include refid="TrgtCustAlctMap.selectCondition_fragment1" />
    </select>
    
    <select id="TrgtCustAlctMap.getTrgtAlctCustList" parameterType="map" resultType="resultMap">
        SELECT /* TrgtCustAlctMap.getTrgtAlctCustList */
               B.*
               , GETCODENM('CAM090', B.DPMS_RESL_CD, B.CNTR_CD) AS DPMS_RESL_NM
               , GETCODENM('CAM100', B.DPMS_STAT_CD, B.CNTR_CD) AS DPMS_STAT_NM
               , GETCODENM('CAM130', B.DPMS_TLPH_DIV_CD, B.CNTR_CD) AS DPMS_TLPH_DIV_NM
               , (SELECT USER_NM FROM TB_USER WHERE USER_ID = B.RGSR_ID) AS RGSR_NM
               , (SELECT USER_NM FROM TB_USER WHERE USER_ID = B.AMND_ID) AS AMND_NM
               , (SELECT ADTL_CD FROM TB_CD WHERE CD = B.DPMS_RESL_CD AND CD_SET_CD = 'CAM090') AS ADTL_CD
          FROM (SELECT  ROWNUM AS PAGE_INDX
                           , A.CNTR_CD, A.TRGT_LIST_ID, A.SUB_TRGT_LIST_ID, A.TRGT_CUST_DTPT_ID, TRIM(A.CUST_NM) AS CUST_NM 
                           , A.MEM_NO, A.ACCNT_NO, A.CLPH_TLNO, A.USER_NM, A.DPMS_RESL_CNTN
                           , A.HOME_TLNO, A.COMP_TLNO, A.UNTY_CASE_ADTL_YN, A.USER_DEFN1_CNTN, A.USER_DEFN2_CNTN ,A.PRMV_ID,A.ETC_TLNO
                           , A.USER_DEFN3_CNTN, A.USER_DEFN4_CNTN, A.USER_DEFN5_CNTN, A.USER_DEFN6_CNTN, A.USER_DEFN7_CNTN, A.USER_DEFN8_CNTN
                           , A.USER_DEFN9_CNTN, A.USER_DEFN10_CNTN, A.USER_DEFN11_CNTN, A.USER_DEFN12_CNTN, A.USER_DEFN13_CNTN, A.USER_DEFN14_CNTN
                           , A.USER_DEFN15_CNTN, A.USER_DEFN16_CNTN, A.USER_DEFN17_CNTN, A.USER_DEFN18_CNTN, A.USER_DEFN19_CNTN, A.USER_DEFN20_CNTN
                           , A.RGSR_ID, A.RGSN_DTTM, A.AMND_ID, A.AMNT_DTTM
                           , A.SUB_TRGT_LIST_NM
                           , A.CNSR_ID, A.CTI_CRNC_DTL_ID, A.ALCT_YN
                           , A.DPMS_RESL_CD , A.DPMS_STAT_CD, A.PROD_JOIN_YN , A.DPMS_TLPH_DIV_CD , A.DPMS_TLNO
                  FROM (SELECT TG.CNTR_CD, TG.TRGT_LIST_ID, TG.SUB_TRGT_LIST_ID, TG.TRGT_CUST_DTPT_ID, TG.CUST_NM
                            , TG.MEM_NO, TG.ACCNT_NO, TG.CLPH_TLNO
                            , TG.HOME_TLNO, TG.COMP_TLNO, TG.UNTY_CASE_ADTL_YN, TG.USER_DEFN1_CNTN, TG.USER_DEFN2_CNTN , TG.PRMV_ID, TG.ETC_TLNO
                            , TG.USER_DEFN3_CNTN, TG.USER_DEFN4_CNTN, TG.USER_DEFN5_CNTN, TG.USER_DEFN6_CNTN, TG.USER_DEFN7_CNTN, TG.USER_DEFN8_CNTN
                            , TG.USER_DEFN9_CNTN, TG.USER_DEFN10_CNTN, TG.USER_DEFN11_CNTN, TG.USER_DEFN12_CNTN, TG.USER_DEFN13_CNTN, TG.USER_DEFN14_CNTN
                            , TG.USER_DEFN15_CNTN, TG.USER_DEFN16_CNTN, TG.USER_DEFN17_CNTN, TG.USER_DEFN18_CNTN, TG.USER_DEFN19_CNTN, TG.USER_DEFN20_CNTN
                            , TG.RGSR_ID, TG.RGSN_DTTM, TG.AMND_ID, TG.AMNT_DTTM
                            , TA.DPMS_STAT_CD, TA.DPMS_RESL_CD, TA.CNSR_ID, TA.PROD_JOIN_YN, TA.DPMS_TLPH_DIV_CD, TA.DPMS_TLNO, TA.CTI_CRNC_DTL_ID
                            , (SELECT USER_NM FROM TB_USER WHERE USER_ID = TA.CNSR_ID) AS USER_NM,TA.DPMS_RESL_CNTN
                            , (SELECT SUB_TRGT_LIST_NM FROM TB_SUB_TRGT_LIST_DTL TS WHERE TS.SUB_TRGT_LIST_ID=TG.SUB_TRGT_LIST_ID) AS SUB_TRGT_LIST_NM
                            , NVL2((SELECT 'Y' FROM TB_TRGT_CUST_ALCT
                                     WHERE SUB_TRGT_LIST_ID=TG.SUB_TRGT_LIST_ID AND TRGT_CUST_DTPT_ID = TG.TRGT_CUST_DTPT_ID), 'Y','N') AS ALCT_YN
                          FROM TB_TRGT_CUST_DTPT TG , TB_TRGT_CUST_ALCT TA , TB_CMPG_BASI CP
                         WHERE TG.SUB_TRGT_LIST_ID = TA.SUB_TRGT_LIST_ID(+)
                           AND TG.TRGT_CUST_DTPT_ID = TA.TRGT_CUST_DTPT_ID(+)
                           AND TG.TRGT_LIST_ID = CP.TRGT_LIST_ID
                       <if test="cmpg_id != null and cmpg_id != ''">
                           AND CP.CMPG_ID = #{cmpg_id}
                       </if>
                       <if test="cmpg_prfm_team_cd != null and cmpg_prfm_team_cd != ''">
			                AND SUBSTR(TG.CLPH_TLNO, -1) IN (SELECT COM_CD
					                                         FROM LF_DMUSER.COM_CD
					                                         WHERE GRP_CD = '0231'
					                                         AND CD_NM = #{cmpg_prfm_team_cd}  OR SUBSTR(TG.RGSN_DTTM, 0, 8) <![CDATA[<=]]> #{cmpg_day})
			                AND (TA.CNSR_ID IS NULL OR TA.CNSR_ID IN (SELECT USER_ID
			                                                            FROM TB_USER
			                                                            WHERE TEAM_CD = #{cmpg_prfm_team_cd}))
			           </if>
			           
                           AND NOT EXISTS (SELECT ACCNT_NO FROM LF_DMUSER.RESCISSION RES WHERE RESON IN ('011', '23') AND DEL_FG = 'N' AND ACCNT_NO = TG.ACCNT_NO) 
                      <choose>
                          <when test="orderBy != null and orderBy != ''">
                          ORDER BY ${orderBy} ${orderDirection}
                          </when>
                          <otherwise>
                           <!--   ORDER BY AMNT_DTTM DESC     웹디비랑 정렬 같이 보여주게 처리.20170221 ,,  문자도 들어가있음 ㅠ  prmv_id  =  웹등록시 순번키 : osc_cnsl_seq  -->
                              ORDER BY (case when  length(prmv_id)     <![CDATA[ <  ]]> 8 then  substr('000000'|| to_char(prmv_id),-7) else prmv_id end )  DESC ,AMNT_DTTM DESC

                          </otherwise>
                      </choose>
                       ) A
                    <include refid="TrgtCustAlctMap.selectCondition_fragment1" />
                ) B
       <if test="startLine != null and startLine != '' and endLine != null and endLine != ''">
           <![CDATA[
            WHERE PAGE_INDX >= #{startLine}
              AND PAGE_INDX < #{endLine}
           ]]>
       </if>
    </select>
    
    <select id="TrgtCustAlctMap.getTrgtAlctCustListExcel" parameterType="map" resultType="resultMap">
        SELECT /* TrgtCustAlctMap.getTrgtAlctCustListExcel */
               B.*
               , GETCODENM('CAM090', B.DPMS_RESL_CD, B.CNTR_CD) AS DPMS_RESL_NM
               , GETCODENM('CAM100', B.DPMS_STAT_CD, B.CNTR_CD) AS DPMS_STAT_NM
               , GETCODENM('CAM130', B.DPMS_TLPH_DIV_CD, B.CNTR_CD) AS DPMS_TLPH_DIV_NM
               , (SELECT USER_NM FROM TB_USER WHERE USER_ID = B.RGSR_ID) AS RGSR_NM
               , (SELECT USER_NM FROM TB_USER WHERE USER_ID = B.AMND_ID) AS AMND_NM
               , (SELECT ADTL_CD FROM TB_CD WHERE CD = B.DPMS_RESL_CD AND CD_SET_CD = 'CAM090') AS ADTL_CD
          FROM (SELECT  ROWNUM AS PAGE_INDX
                           , A.CNTR_CD, A.TRGT_LIST_ID, A.SUB_TRGT_LIST_ID, A.TRGT_CUST_DTPT_ID, TRIM(A.CUST_NM) AS CUST_NM 
                           , A.MEM_NO, A.ACCNT_NO, A.CLPH_TLNO, A.USER_NM, A.DPMS_RESL_CNTN
                           , A.HOME_TLNO, A.COMP_TLNO, A.UNTY_CASE_ADTL_YN, A.USER_DEFN1_CNTN, A.USER_DEFN2_CNTN ,A.PRMV_ID,A.ETC_TLNO
                           , A.USER_DEFN3_CNTN, A.USER_DEFN4_CNTN, A.USER_DEFN5_CNTN, A.USER_DEFN6_CNTN, A.USER_DEFN7_CNTN, A.USER_DEFN8_CNTN
                           , A.USER_DEFN9_CNTN, A.USER_DEFN10_CNTN, A.USER_DEFN11_CNTN, A.USER_DEFN12_CNTN, A.USER_DEFN13_CNTN, A.USER_DEFN14_CNTN
                           , A.USER_DEFN15_CNTN, A.USER_DEFN16_CNTN, A.USER_DEFN17_CNTN, A.USER_DEFN18_CNTN, A.USER_DEFN19_CNTN, A.USER_DEFN20_CNTN
                           , A.RGSR_ID, A.RGSN_DTTM, A.AMND_ID, A.AMNT_DTTM
                           , A.SUB_TRGT_LIST_NM
                           , A.CNSR_ID, A.CTI_CRNC_DTL_ID, A.ALCT_YN
                           , A.DPMS_RESL_CD , A.DPMS_STAT_CD, A.PROD_JOIN_YN , A.DPMS_TLPH_DIV_CD , A.DPMS_TLNO
                  FROM (SELECT TG.CNTR_CD, TG.TRGT_LIST_ID, TG.SUB_TRGT_LIST_ID, TG.TRGT_CUST_DTPT_ID, TG.CUST_NM
                            , TG.MEM_NO, TG.ACCNT_NO, TG.CLPH_TLNO
                            , TG.HOME_TLNO, TG.COMP_TLNO, TG.UNTY_CASE_ADTL_YN, TG.USER_DEFN1_CNTN, TG.USER_DEFN2_CNTN , TG.PRMV_ID, TG.ETC_TLNO
                            , TG.USER_DEFN3_CNTN, TG.USER_DEFN4_CNTN, TG.USER_DEFN5_CNTN, TG.USER_DEFN6_CNTN, TG.USER_DEFN7_CNTN, TG.USER_DEFN8_CNTN
                            , TG.USER_DEFN9_CNTN, TG.USER_DEFN10_CNTN, TG.USER_DEFN11_CNTN, TG.USER_DEFN12_CNTN, TG.USER_DEFN13_CNTN, TG.USER_DEFN14_CNTN
                            , TG.USER_DEFN15_CNTN, TG.USER_DEFN16_CNTN, TG.USER_DEFN17_CNTN, TG.USER_DEFN18_CNTN, TG.USER_DEFN19_CNTN, TG.USER_DEFN20_CNTN
                            , TG.RGSR_ID, TG.RGSN_DTTM, TG.AMND_ID, TG.AMNT_DTTM
                            , TA.DPMS_STAT_CD, TA.DPMS_RESL_CD, TA.CNSR_ID, TA.PROD_JOIN_YN, TA.DPMS_TLPH_DIV_CD, TA.DPMS_TLNO, TA.CTI_CRNC_DTL_ID
                            , (SELECT USER_NM FROM TB_USER WHERE USER_ID = TA.CNSR_ID) AS USER_NM,TA.DPMS_RESL_CNTN
                            , (SELECT SUB_TRGT_LIST_NM FROM TB_SUB_TRGT_LIST_DTL TS WHERE TS.SUB_TRGT_LIST_ID=TG.SUB_TRGT_LIST_ID) AS SUB_TRGT_LIST_NM
                            , NVL2((SELECT 'Y' FROM TB_TRGT_CUST_ALCT
                                     WHERE SUB_TRGT_LIST_ID=TG.SUB_TRGT_LIST_ID AND TRGT_CUST_DTPT_ID = TG.TRGT_CUST_DTPT_ID), 'Y','N') AS ALCT_YN
                          FROM TB_TRGT_CUST_DTPT TG , TB_TRGT_CUST_ALCT TA , TB_CMPG_BASI CP
                         WHERE TG.SUB_TRGT_LIST_ID = TA.SUB_TRGT_LIST_ID(+)
                           AND TG.TRGT_CUST_DTPT_ID = TA.TRGT_CUST_DTPT_ID(+)
                           AND TG.TRGT_LIST_ID = CP.TRGT_LIST_ID
                       <if test="cmpg_id != null and cmpg_id != ''">
                           AND CP.CMPG_ID = #{cmpg_id}
                       </if>
                       <if test="cmpg_prfm_team_cd != null and cmpg_prfm_team_cd != ''">
			                AND SUBSTR(TG.CLPH_TLNO, -1) IN (SELECT COM_CD
					                                         FROM LF_DMUSER.COM_CD
					                                         WHERE GRP_CD = '0231'
					                                         AND CD_NM = #{cmpg_prfm_team_cd}  OR SUBSTR(TG.RGSN_DTTM, 0, 8) <![CDATA[<=]]> #{cmpg_day})
			                AND (TA.CNSR_ID IS NULL OR TA.CNSR_ID IN (SELECT USER_ID
			                                                            FROM TB_USER
			                                                            WHERE TEAM_CD = #{cmpg_prfm_team_cd}))
			           </if>
                           AND NOT EXISTS (SELECT ACCNT_NO FROM LF_DMUSER.RESCISSION RES WHERE RESON IN ('011', '23') AND DEL_FG = 'N' AND ACCNT_NO = TG.ACCNT_NO) 
                      <choose>
                          <when test="orderBy != null and orderBy != ''">
                          ORDER BY ${orderBy} ${orderDirection}
                          </when>
                          <otherwise>
                           <!--   ORDER BY AMNT_DTTM DESC     웹디비랑 정렬 같이 보여주게 처리.20170221 ,,  문자도 들어가있음 ㅠ  prmv_id  =  웹등록시 순번키 : osc_cnsl_seq  -->
                              ORDER BY (case when  length(prmv_id)     <![CDATA[ <  ]]> 8 then  substr('000000'|| to_char(prmv_id),-7) else prmv_id end )  DESC ,AMNT_DTTM DESC

                          </otherwise>
                      </choose>
                       ) A
                    <include refid="TrgtCustAlctMap.selectCondition_fragment1" />
                ) B
    </select>
    
    <select id="TrgtCustAlctMap.getNewTypeTrgtAlctCustCount" parameterType="map" resultType="int">
				SELECT  /* TrgtCustAlctMap.getNewTypeTrgtAlctCustCount */
					COUNT(*)
				FROM			 
				(
				    SELECT
				        ROWNUM AS PAGE_INDX,
				        TARGET_DM,
	                    TCT.TRGT_LIST_ID,
	                    TCT.SUB_TRGT_LIST_ID,
	                    TCT.TRGT_CUST_DTPT_ID,
				        MEM_NM,
				        CELL,                    
	                    (CASE WHEN NVL(TTCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
	                    TTCA.CNSR_ID,	                    
	                    DPMS_RESL_CD,
	                    DPMS_STAT_CD,
	                    GETCODENM('CAM090', TTCA.DPMS_RESL_CD, 'CCA') AS DPMS_RESL_NM,
	                    GETCODENM('CAM100', TTCA.DPMS_STAT_CD, 'CCA') AS DPMS_STAT_NM,
	                    COUNSEL_TIME,
                        PROD_T_1,
                        PROD_R_1,
                        PROD_T_2,
                        PROD_R_2,
                        MEMO
				    FROM PS_WILLVI.TB_COUNSEL_TARGET TCT LEFT OUTER JOIN
				        TB_TRGT_CUST_ALCT TTCA ON TCT.TRGT_CUST_DTPT_ID = TTCA.TRGT_CUST_DTPT_ID
				    WHERE 1=1 
				    AND TCT.TRGT_LIST_ID = #{trgt_list_id}
				    AND NVL(TCT.USE_YN,'N') = 'Y'
					<if test="cnsr_id != null and cnsr_id != ''">
					    AND TTCA.CNSR_ID LIKE #{cnsr_id} ||'%'
					</if>						    				    
					<if test="mem_nm != null and mem_nm != ''">
					    AND TCT.MEM_NM LIKE #{mem_nm} ||'%'
					</if>
					<if test="cell != null and cell != ''">
					    AND TCT.CELL LIKE #{cell}||'%'
					</if>	
					<if test="dpms_stat_cd != null and dpms_stat_cd != ''">
					    AND TTCA.DPMS_STAT_CD = #{dpms_stat_cd}
					</if>
					<if test="dpms_resl_cd != null and dpms_resl_cd != ''">
					    AND TTCA.DPMS_RESL_CD = #{dpms_resl_cd}
					</if>					
					
					<if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                       AND TARGET_DM BETWEEN #{stt_dt} AND #{end_dt}
                    </if>
					ORDER BY TARGET_DM DESC											
		        ) A
		    	WHERE 1=1
		    		<if test="alct_yn != null and alct_yn != ''">
					    AND A.ALCT_YN = #{alct_yn}
					</if>	
    </select>
    
    <select id="TrgtCustAlctMap.getNewTypeTrgtAlctCustList" parameterType="map" resultType="resultMap">
			SELECT /* TrgtCustAlctMap.getNewTypeTrgtAlctCustList */
				MAIN.*
			FROM
			(
				SELECT 
				    ROWNUM AS PAGE_INDX,
					A.*,
                    NVL(USER_NM,'미정') AS CNSR_NM
				FROM			 
				(
				    SELECT
				        TARGET_DM,
	                    TCT.TRGT_LIST_ID,
	                    TCT.SUB_TRGT_LIST_ID,
	                    TCT.TRGT_CUST_DTPT_ID,
				        MEM_NM,
				        CELL,                    
	                    (CASE WHEN NVL(TTCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
	                    TTCA.CNSR_ID,
	                    (SELECT USER_NM FROM TB_USER WHERE USER_ID = TTCA.CNSR_ID) AS USER_NM,
	                    DPMS_RESL_CD,
	                    DPMS_STAT_CD,
	                    GETCODENM('CAM090', TTCA.DPMS_RESL_CD, 'CCA') AS DPMS_RESL_NM,
	                    GETCODENM('CAM100', TTCA.DPMS_STAT_CD, 'CCA') AS DPMS_STAT_NM,
	                    COUNSEL_TIME,
                        PROD_T_1,
                        PROD_R_1,
                        PROD_T_2,
                        PROD_R_2,
                        MEMO
				    FROM PS_WILLVI.TB_COUNSEL_TARGET TCT LEFT OUTER JOIN
				        TB_TRGT_CUST_ALCT TTCA ON TCT.TRGT_CUST_DTPT_ID = TTCA.TRGT_CUST_DTPT_ID
				    WHERE 1=1 
				    AND TCT.TRGT_LIST_ID = #{trgt_list_id}
				    AND NVL(TCT.USE_YN,'N') = 'Y'
					<if test="cnsr_id != null and cnsr_id != ''">
					    AND TTCA.CNSR_ID LIKE #{cnsr_id} ||'%'
					</if>				    				    
					<if test="mem_nm != null and mem_nm != ''">
					    AND TCT.MEM_NM LIKE #{mem_nm} ||'%'
					</if>
					<if test="cell != null and cell != ''">
					    AND TCT.CELL LIKE #{cell}||'%'
					</if>	
					<if test="dpms_stat_cd != null and dpms_stat_cd != ''">
					    AND TTCA.DPMS_STAT_CD = #{dpms_stat_cd}
					</if>
					<if test="dpms_resl_cd != null and dpms_resl_cd != ''">
					    AND TTCA.DPMS_RESL_CD = #{dpms_resl_cd}
					</if>
					<if test="alct_yn != null and alct_yn != ''">
					    AND NVL2(TTCA.CNSR_ID,'Y','N') = #{alct_yn}
					</if>	
					
					<if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                       AND TARGET_DM BETWEEN #{stt_dt} AND #{end_dt}
                    </if>
					ORDER BY TARGET_DM DESC
		        ) A
		    WHERE 1=1
		    		
	        ) MAIN
       <if test="startLine != null and startLine != '' and endLine != null and endLine != ''">
           <![CDATA[
            WHERE PAGE_INDX >= #{startLine}
              AND PAGE_INDX < #{endLine}
           ]]>
       </if>
    </select>    
    
    <select id="TrgtCustAlctMap.getNewTypeTrgtAlctCustListExcel" parameterType="map" resultType="resultMap">
			SELECT /* TrgtCustAlctMap.getNewTypeTrgtAlctCustList */
				MAIN.*
			FROM
			(
				SELECT 
				    ROWNUM AS PAGE_INDX,
					A.*,
                    NVL(USER_NM,'미정') AS CNSR_NM
				FROM			 
				(
				    SELECT
				        TARGET_DM,
	                    TCT.TRGT_LIST_ID,
	                    TCT.SUB_TRGT_LIST_ID,
	                    TCT.TRGT_CUST_DTPT_ID,
				        MEM_NM,
				        CELL,                    
	                    (CASE WHEN NVL(TTCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
	                    TTCA.CNSR_ID,
	                    (SELECT USER_NM FROM TB_USER WHERE USER_ID = TTCA.CNSR_ID) AS USER_NM,
	                    DPMS_RESL_CD,
	                    DPMS_STAT_CD,
	                    GETCODENM('CAM090', TTCA.DPMS_RESL_CD, 'CCA') AS DPMS_RESL_NM,
	                    GETCODENM('CAM100', TTCA.DPMS_STAT_CD, 'CCA') AS DPMS_STAT_NM,
	                    COUNSEL_TIME,
                        PROD_T_1,
                        PROD_R_1,
                        PROD_T_2,
                        PROD_R_2,
                        MEMO
				    FROM PS_WILLVI.TB_COUNSEL_TARGET TCT LEFT OUTER JOIN
				        TB_TRGT_CUST_ALCT TTCA ON TCT.TRGT_CUST_DTPT_ID = TTCA.TRGT_CUST_DTPT_ID
				    WHERE 1=1 
				    AND TCT.TRGT_LIST_ID = #{trgt_list_id}
				    AND NVL(TCT.USE_YN,'N') = 'Y'
					<if test="cnsr_id != null and cnsr_id != ''">
					    AND TTCA.CNSR_ID LIKE #{cnsr_id} ||'%'
					</if>				    				    
					<if test="mem_nm != null and mem_nm != ''">
					    AND TCT.MEM_NM LIKE #{mem_nm} ||'%'
					</if>
					<if test="cell != null and cell != ''">
					    AND TCT.CELL LIKE #{cell}||'%'
					</if>	
					<if test="dpms_stat_cd != null and dpms_stat_cd != ''">
					    AND TTCA.DPMS_STAT_CD = #{dpms_stat_cd}
					</if>
					<if test="dpms_resl_cd != null and dpms_resl_cd != ''">
					    AND TTCA.DPMS_RESL_CD = #{dpms_resl_cd}
					</if>
					<if test="alct_yn != null and alct_yn != ''">
					    AND NVL2(TTCA.CNSR_ID,'Y','N') = #{alct_yn}
					</if>	
					
					<if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                       AND TARGET_DM BETWEEN #{stt_dt} AND #{end_dt}
                    </if>
					ORDER BY TARGET_DM DESC
		        ) A
		    WHERE 1=1
		    		
	        ) MAIN
    </select>    

    <select id="TrgtCustAlctMap.getTgtCustNonAlctList" parameterType="map" resultType="resultMap">
        SELECT /* TrgtCustAlctMap.getTgtCustNonAlctList */
               *
          FROM TB_TRGT_CUST_DTPT A
         WHERE TRGT_LIST_ID = #{trgt_list_id}
           AND CNTR_CD = #{cntr_cd}
           AND SUB_TRGT_LIST_ID = #{sub_trgt_list_id}
           AND NOT EXISTS (SELECT 'Y'
                               FROM TB_TRGT_CUST_ALCT B
                              WHERE B.CMPG_ID = #{cmpg_id}
                                AND B.SUB_TRGT_LIST_ID = A.SUB_TRGT_LIST_ID
                                AND B.TRGT_CUST_DTPT_ID = A.TRGT_CUST_DTPT_ID
                                AND B.CNTR_CD = A.CNTR_CD
                            )
    </select>

    <insert id="TrgtCustAlctMap.insertTgtCustAlct" parameterType="map">
        INSERT /* TrgtCustAlctMap.insertTgtCustAlct */
          INTO TB_TRGT_CUST_ALCT
              (CMPG_ID, TRGT_LIST_ID, SUB_TRGT_LIST_ID, TRGT_CUST_DTPT_ID
             , CNSR_ID, DPMS_STAT_CD, DPMS_TMCNT, CNTR_CD
             , RGSR_ID, RGSN_DTTM, AMND_ID, AMNT_DTTM
             , RESERVE_PROC_DT, RESERVE_PROC_TM)
        VALUES (#{cmpg_id}, #{trgt_list_id}, #{sub_trgt_list_id}, #{trgt_cust_dtpt_id}
              , #{user_id}, '10', 0, #{cntr_cd}
              , #{rgsr_id}, TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS'), #{amnd_id}, TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
              , #{reserve_proc_dt}, #{reserve_proc_tm})
    </insert>

    <insert id="TrgtCustAlctMap.insertTgtCustAlctFromSystem" parameterType="map">
        INSERT /* TrgtCustAlctMap.insertTgtCustAlctFromSystem */
          INTO TB_TRGT_CUST_ALCT
              (CMPG_ID, TRGT_LIST_ID, TRGT_CUST_ID, TRGT_CUST_DTPT_ID
             , CNSR_ID, DPMS_RESL_CD, DPMS_STAT_CD, DPMS_TMCNT, DPMS_DTTM, CNTR_CD
             , RGSR_ID, RGSN_DTTM, AMND_ID, AMNT_DTTM)
        VALUES (#{cmpg_id}, #{trgt_list_id}, #{trgt_cust_id}, #{trgt_cust_dtpt_id}
              , #{user_id}, #{dpms_resl_cd}, #{dpms_stat_cd}, 1, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'), #{cntr_cd}
              , #{rgsr_id}, TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS'), #{amnd_id}, TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS'))
    </insert>

    <delete id="TrgtCustAlctMap.deleteTgtCustAlct" parameterType="map">
        DELETE /* TrgtCustAlctMap.deleteTgtCustAlct */
          FROM TB_TRGT_CUST_ALCT
         WHERE TRGT_LIST_ID    = #{trgt_list_id}
           AND SUB_TRGT_LIST_ID = #{sub_trgt_list_id}
           AND CMPG_ID      = #{cmpg_id}
           AND CNTR_CD        = #{cntr_cd}
           AND ((SELECT ADTL_CD FROM TB_CD WHERE CD = DPMS_RESL_CD  AND CD_SET_CD = 'CAM090') = '99'
                    OR (SELECT ADTL_CD FROM TB_CD WHERE CD = DPMS_RESL_CD  AND CD_SET_CD = 'CAM090') IS NULL)
           AND CNSR_ID = #{user_id}
        <if test="withdrawnum != null and withdrawnum != ''">
           AND TRGT_CUST_DTPT_ID IN (SELECT TRGT_CUST_DTPT_ID
                                  FROM TB_TRGT_CUST_ALCT
                                 WHERE ROWNUM <![CDATA[<=]]> ${withdrawnum}
                                   AND TRGT_LIST_ID    = #{trgt_list_id}
                                   AND SUB_TRGT_LIST_ID = #{sub_trgt_list_id}
                                   AND CMPG_ID      = #{cmpg_id}
                                   AND CNTR_CD        = #{cntr_cd}
                                   AND ((SELECT ADTL_CD FROM TB_CD WHERE CD = DPMS_RESL_CD  AND CD_SET_CD = 'CAM090') = '99'
                                            OR (SELECT ADTL_CD FROM TB_CD WHERE CD = DPMS_RESL_CD  AND CD_SET_CD = 'CAM090') IS NULL)
                                   AND CNSR_ID = #{user_id}
                                   ORDER BY TRGT_CUST_DTPT_ID
                                )
        </if>
         <if test="delOption != null and delOption != ''">
             AND TRGT_CUST_DTPT_ID = #{trgt_cust_dtpt_id}
         </if>
    </delete>

    <select id="TrgtCustAlctMap.getTgtCustAlctCountByCust" parameterType="map" resultType="int">
         SELECT /* TrgtCustAlctMap.getTgtCustAlctCountByCust */
               COUNT(*)
          FROM TB_TRGT_CUST_ALCT TA INNER JOIN TB_TRGT_CUST_DTPT TC
                                    ON (TA.TRGT_LIST_ID  =  TC.TRGT_LIST_ID
                                    AND TA.TRGT_CUST_DTPT_ID  =  TC.TRGT_CUST_DTPT_ID)
          WHERE TA.CMPG_ID = #{cmpg_id}
           <if test="trgt_list_id != null and trgt_list_id != ''">
            AND TA.TRGT_LIST_ID = #{trgt_list_id}
         </if>
           <if test="trgt_cust_id != null and trgt_cust_id != ''">
            AND TA.TRGT_CUST_ID = #{trgt_cust_id}
         </if>
          <if test="trgt_cust_dtpt_id != null and trgt_cust_dtpt_id != ''">
            AND TA.TRGT_CUST_DTPT_ID = #{trgt_cust_dtpt_id}
         </if>
         <if test="user_id != null and user_id != ''">
            AND TA.CNSR_ID = #{user_id}
         </if>
         <if test="mem_no != null and mem_no != ''">
            AND TC.MEM_NO = #{mem_no}
         </if>
         <if test="tryfg != null and tryfg.equalsIgnoreCase('Y')">
            AND TA.DPMS_STAT_CD != '10'
         </if>
    </select>

    <select id="TrgtCustAlctMap.getTrgtCustAlctListByCust" parameterType="map" resultType="resultMap">
        SELECT /* TrgtCustAlctMap.getTrgtCustAlctListByCust */
               C.*
          FROM (SELECT <choose>
                             <when test="orderBy != null and orderBy != ''">
                               ROW_NUMBER() OVER(ORDER BY ${orderBy} ${orderDirection}) PAGE_INDX
                           </when>
                           <otherwise>
                               ROW_NUMBER() OVER(ORDER BY DPMS_DTTM DESC) PAGE_INDX
                           </otherwise>
                       </choose>
                       , B.*
                  FROM (SELECT  TA.TRGT_LIST_ID
                              , TA.CMPG_ID
                              , TA.TRGT_CUST_ID
                              , TA.TRGT_CUST_DTPT_ID
                              , TA.DPMS_DTTM                        /*상담일시*/
                              , CP.CMPG_PRAN_CHNL_CD                  /*실행채널*/
                              , GETCODENM('CAM070', CP.CMPG_PRAN_CHNL_CD , TA.CNTR_CD) AS CMPG_PRAN_CHNL_NM
                              , CP.CMPG_NM                  /*캠페인명*/
                              , TA.CNSR_ID                      /*담당자*/
                              , (SELECT USER_NM FROM TB_USER WHERE CNSR_ID = TA.CNSR_ID) AS USER_NM
                              , TA.DPMS_RESL_CD                    /*통화결과*/
                              , TA.DPMS_STAT_CD                     /*처리상태*/
                              , GETCODENM('CAM090', TA.DPMS_RESL_CD, TA.CNTR_CD) AS DPMS_RESL_NM
                              , GETCODENM('CAM100', TA.DPMS_STAT_CD, TA.CNTR_CD) AS DPMS_STAT_NM
                              , TA.DPMS_RESL_CNTN                  /*상담메모*/
                              , TC.MEM_NO
                              , CP.CMPG_INVT_MTHD_CD
                              , CP.INVT_CNTS_ID
                          FROM TB_TRGT_CUST_ALCT TA INNER JOIN TB_TRGT_CUST_DTPT TC
                                                ON (TA.TRGT_LIST_ID  =  TC.TRGT_LIST_ID
                                                AND TA.TRGT_CUST_DTPT_ID  =  TC.TRGT_CUST_DTPT_ID)
                                                   INNER JOIN TB_CMPG_BASI CP
                                                ON(TA.CMPG_ID = CP.CMPG_ID)
                      <where>
                          <if test="cmpg_id != null and cmpg_id != ''">
                           AND TA.CMPG_ID = #{cmpg_id}
                        </if>
                          <if test="trgt_list_id != null and trgt_list_id != ''">
                           AND TA.TRGT_LIST_ID = #{trgt_list_id}
                        </if>
                          <if test="trgt_cust_id != null and trgt_cust_id != ''">
                           AND TA.TRGT_CUST_ID = #{trgt_cust_id}
                        </if>
                        <if test="trgt_cust_dtpt_id != null and trgt_cust_dtpt_id != ''">
                           AND TA.TRGT_CUST_DTPT_ID = #{trgt_cust_dtpt_id}
                        </if>
                        <if test="user_id != null and user_id != ''">
                           AND TA.CNSR_ID = #{user_id}
                        </if>
                        <if test="mem_no != null and mem_no != ''">
                           AND TC.MEM_NO = #{mem_no}
                        </if>
                        <if test="tryfg != null and tryfg.equalsIgnoreCase('Y')">
                           AND TA.DPMS_STAT_CD != '10'
                        </if>
                     </where>
                       ) B
                ) C
        <if test="startLine != null and startLine != '' and endLine != null and endLine != ''">
        <![CDATA[
         WHERE PAGE_INDX >= #{startLine}
           AND PAGE_INDX < #{endLine}
        ]]>
        </if>
        <choose>
            <when test="orderBy != null and orderBy != ''">
               ORDER BY ${orderBy} ${orderDirection}
            </when>
            <otherwise>
               ORDER BY PAGE_INDX ASC
            </otherwise>
        </choose>
    </select>

    <select id="TrgtCustAlctMap.getTgtCustAlctfg" parameterType="map" resultType="int">
        SELECT /* TrgtCustAlctMap.getTgtCustAlctfg */
               COUNT(*)
          FROM TB_TRGT_CUST_ALCT
         WHERE CNTR_CD = #{cntr_cd}
           AND TRGT_CUST_DTPT_ID
        <foreach collection="selectcheck" item="item" separator="," close=")" open="IN (">
            #{item}
        </foreach>
    </select>

    <delete id="TrgtCustAlctMap.deleteTgtCustAlctByCmpgId" parameterType="map">
        DELETE /* TrgtCustAlctMap.deleteTgtCustAlctByCmpgId */
          FROM TB_TRGT_CUST_ALCT
         WHERE CMPG_ID = #{cmpg_id}
           AND CNTR_CD = #{cntr_cd}
    </delete>

    <delete id="TrgtCustAlctMap.deleteTgtCustAlctByUpdateCmpg" parameterType="map">
        DELETE /* TrgtCustAlctMap.deleteTgtCustAlctByUpdateCmpg */
          FROM TB_TRGT_CUST_ALCT
         WHERE CMPG_ID = #{cmpg_id}
           AND CNTR_CD = #{cntr_cd}
           AND TRGT_LIST_ID != #{trgt_list_id}
    </delete>

    <update id="TrgtCustAlctMap.updateCmpgResult" parameterType="map">
        UPDATE /* TrgtCustAlctMap.updateCmpgResult */
               TB_TRGT_CUST_ALCT
           SET DPMS_STAT_CD = #{dpms_stat_cd}
             , DPMS_RESL_CD = #{dpms_resl_cd}
             , DPMS_GBN_CD = #{dpms_gbn_cd}
             , DPMS_RESL_CNTN = #{dpms_resl_cntn}
             , DPMS_TMCNT = (SELECT MAX(DPMS_TMCNT)+1
                           FROM TB_TRGT_CUST_ALCT
                          WHERE SUB_TRGT_LIST_ID = #{sub_trgt_list_id}
                            AND TRGT_CUST_DTPT_ID = #{trgt_cust_dtpt_id}
                            AND CMPG_ID = #{cmpg_id})
             , DPMS_DTTM = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
             , AMND_ID =#{user_id}
             , DPMS_TLPH_DIV_CD = #{dpms_tlph_div_cd}
             , DPMS_TLNO = REPLACE(#{dpms_tlno},'-','')
             , PROD_JOIN_YN = #{prod_join_yn}
             , AMNT_DTTM = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
             , CNTR_CD = #{cntr_cd}
             , RESERVE_PROC_DT = #{reserve_proc_dt}
             , RESERVE_PROC_TM = #{reserve_proc_tm}
         WHERE SUB_TRGT_LIST_ID = #{sub_trgt_list_id}
           AND CMPG_ID = #{cmpg_id}
           AND CNTR_CD = #{cntr_cd}
           AND TRGT_CUST_DTPT_ID = #{trgt_cust_dtpt_id}
           AND CNSR_ID = #{rgsr_id}
    </update>

    <update id="TrgtCustAlctMap.updateCtiId" parameterType="map">
        UPDATE /* TrgtCustAlctMap.updateCtiId */
               TB_TRGT_CUST_ALCT
           SET
               CTI_CRNC_DTL_ID =#{cti_crnc_dtl_id}
             , AMND_ID =#{user_id}
             , AMNT_DTTM = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
         WHERE SUB_TRGT_LIST_ID = #{sub_trgt_list_id}
           AND CMPG_ID = #{cmpg_id}
           AND CNTR_CD = #{cntr_cd}
           AND TRGT_CUST_DTPT_ID = #{trgt_cust_dtpt_id}
    </update>

    <select id="TrgtCustAlctMap.getCmpgResult" parameterType="map" resultType="resultMap">
        SELECT /* TrgtCustAlctMap.getCmpgResult */
               TRGT_LIST_ID, TRGT_CUST_ID, CMPG_ID, TRGT_CUST_DTPT_ID
             , CNSR_ID, DPMS_RESL_CD, DPMS_RESL_CNTN, DPMS_TMCNT
             , DPMS_DTTM, CNTR_CD
          FROM TB_TRGT_CUST_ALCT
         WHERE CMPG_ID = #{cmpg_id}
           AND TRGT_LIST_ID = #{trgt_list_id}
           AND TRGT_CUST_DTPT_ID = #{trgt_cust_dtpt_id}
    </select>

    <update id="TrgtCustAlctMap.updateTrgtCustCustId" parameterType="map">
        UPDATE /* TrgtCustAlctMap.updateTrgtCustCustId */
               TB_TRGT_CUST_DTPT
           SET MEM_NO = #{mem_no}
             , AMND_ID = #{amnd_id}
             , AMNT_DTTM = TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
         WHERE TRGT_LIST_ID = #{trgt_list_id}
           AND TRGT_CUST_DTPT_ID = #{trgt_cust_dtpt_id}
    </update>


    <select id="TrgtCustAlctMap.getCustHstrCount" parameterType="map" resultType="int">
        SELECT /* TrgtCustAlctMap.getCustHstrCount */
               COUNT(*)
          FROM TB_TRGT_CUST_ALCT
         WHERE TRGT_CUST_DTPT_ID IN (SELECT TRGT_CUST_DTPT_ID
                                   FROM TB_TRGT_CUST_DTPT
                                  WHERE MEM_NO = #{mem_no})
    </select>

    <select id="TrgtCustAlctMap.getCustHstrList" parameterType="map" resultType="resultMap">
        SELECT /* TrgtCustAlctMap.getCustHstrList */
               B.*
             , (SELECT CMPG_NM
                   FROM TB_CMPG_BASI
                  WHERE CMPG_ID = B.CMPG_ID) AS CMPG_NM
             , GETCODENM('CAM090', B.DPMS_RESL_CD, B.CNTR_CD) AS DPMS_RESL_NM
             , GETCODENM('CAM100', B.DPMS_STAT_CD, B.CNTR_CD) AS DPMS_STAT_NM
          FROM (SELECT ROWNUM AS PAGE_INDX, A.*
                  FROM (SELECT TRGT_LIST_ID, TRGT_CUST_ID, TRGT_CUST_DTPT_ID, CMPG_ID
                             , CNSR_ID, DPMS_RESL_CD, DPMS_STAT_CD, DPMS_RESL_CNTN, DPMS_TMCNT
                             , TO_CHAR(DPMS_DTTM, 'YYYYMMDDHH24MI') AS DPMS_DTTM, CNTR_CD
                             , (SELECT USER_NM
                                   FROM TB_USER
                                  WHERE USER_ID = T.CNSR_ID) AS USER_NM
                          FROM TB_TRGT_CUST_ALCT T
                         WHERE TRGT_CUST_DTPT_ID IN (SELECT TRGT_CUST_DTPT_ID
                                                   FROM TB_TRGT_CUST_DTPT
                                                  WHERE MEM_NO = #{mem_no})
                        <if test="orderBy != null and orderBy != ''">
                             ORDER BY ${orderBy} ${orderDirection}
                        </if>
                       ) A
                ) B
        <if test="startLine != null and startLine != '' and endLine != null and endLine != ''">
        <![CDATA[
         WHERE PAGE_INDX >= #{startLine}
           AND PAGE_INDX < #{endLine}
        ]]>
        </if>
    </select>

    <select id="TrgtCustAlctMap.getTrgtCustStatList" parameterType="map" resultType="resultMap">
        SELECT /* TrgtCustAlctMap.getTrgtCustStatList */
               TRGT_CUST_DTPT_ID
          FROM TB_TRGT_CUST_ALCT
         WHERE CNSR_ID = #{user_id}
           AND DPMS_STAT_CD IN ('10','20');
           AND TRGT_CUST_DTPT_ID
           <foreach collection="selectcheck" item="item" separator="," close=")" open="IN (">
            #{item}
           </foreach>
    </select>

    <update id="TrgtCustAlctMap.updateChangeCnsr" parameterType="map">
        UPDATE /* TrgtCustAlctMap.updateChangeCnsr 사용*/
               TB_TRGT_CUST_ALCT
           SET CNSR_ID = #{user_id}
             , AMND_ID = #{amnd_id}
             , AMNT_DTTM = TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
         WHERE CNSR_ID = #{cnsr_id}
         <if test="save_fg != null and save_fg != ''">
           AND TRGT_CUST_DTPT_ID = #{trgt_cust_dtpt_id}
           AND ((SELECT ADTL_CD FROM TB_CD WHERE CD = DPMS_RESL_CD  AND CD_SET_CD = 'CAM090') = '99'
           OR (SELECT ADTL_CD FROM TB_CD WHERE CD = DPMS_RESL_CD  AND CD_SET_CD = 'CAM090') IS NULL)
         </if>
    </update>

    <select id="TrgtCustAlctMap.getTrgtCustAlctByCnsrCount" parameterType="map" resultType="int">
        SELECT /* TrgtCustAlctMap.getTrgtCustAlctByCnsrCount */
               COUNT(*)
          FROM (SELECT CNSR_ID
                  FROM TB_CMPG_ALCT_DTL A
                 WHERE CMPG_ID = #{cmpg_id}
                   AND CNTR_CD = #{cntr_cd}
                <if test="sub_trgt_list_id != null and sub_trgt_list_id != ''">
                   AND SUB_TRGT_LIST_ID = #{sub_trgt_list_id}
                </if>
                 GROUP BY A.CNSR_ID
               ) A
    </select>

    <select id="TrgtCustAlctMap.getTrgtCustAlctByCnsrList" parameterType="map" resultType="resultMap">
        SELECT /* TrgtCustAlctMap.getTrgtCustAlctByCnsrList */
               A.*, T.USER_STAT_CD, GETCODENM('USR020', USER_STAT_CD, T.CNTR_CD) AS USER_STAT_NM,
                        (SELECT COUNT(*)
                       FROM TB_TRGT_CUST_ALCT TTCA
                      WHERE TTCA.CNSR_ID = A.USER_ID
                        AND TTCA.CMPG_ID = #{cmpg_id}
                        AND TTCA.CNTR_CD = #{cntr_cd}
                     <if test="sub_trgt_list_id != null and sub_trgt_list_id != ''">
                        AND TTCA.SUB_TRGT_LIST_ID = #{sub_trgt_list_id}
                     </if>
                     )AS ALCT_CNT
          FROM (SELECT <choose>
                          <when test="orderBy != null and orderBy != ''">
                            ROW_NUMBER() OVER (ORDER BY ${orderBy} ${orderDirection}) AS PAGE_INDX
                          </when>
                          <otherwise>
                            ROW_NUMBER() OVER (ORDER BY CNSR_ID DESC) AS PAGE_INDX
                          </otherwise>
                       </choose>
                     , A.*
                  FROM (SELECT A.*
                             , B.USER_NM, B.USER_ID
                             , C.TEAM_NM
                             , FN_GETHRCHCDNM('CAM990', A.CMPG_TYP_CD, A.CNTR_CD) AS CMPG_TYP_NM
                          FROM (SELECT CNSR_ID, CMPG_TYP_CD, CNTR_CD
                                     , SUM(DECODE(A.DPMS_RESL_CD, '1000', A.CNT, 0)) AS ST1000
                                     , SUM(DECODE(A.DPMS_RESL_CD, '1001', A.CNT, 0)) AS ST1001
                                     , SUM(DECODE(A.DPMS_RESL_CD, '2000', A.CNT, 0)) AS ST2000
                                     , SUM(DECODE(A.DPMS_RESL_CD, '2001', A.CNT, 0)) AS ST2001
                                     , SUM(DECODE(A.DPMS_RESL_CD, '2002', A.CNT, 0)) AS ST2002
                                     , SUM(DECODE(A.DPMS_RESL_CD, '3000', A.CNT, 0)) AS ST3000
                                     , SUM(DECODE(A.DPMS_RESL_CD, '3001', A.CNT, 0)) AS ST3001
                                     , SUM(DECODE(A.DPMS_RESL_CD, '3002', A.CNT, 0)) AS ST3002
                                     , SUM(DECODE(A.DPMS_RESL_CD, '3003', A.CNT, 0)) AS ST3003
                                     , SUM(DECODE(A.DPMS_RESL_CD, '3004', A.CNT, 0)) AS ST3004
                                     , SUM(DECODE(A.DPMS_RESL_CD, '3005', A.CNT, 0)) AS ST3005
                                     , SUM(DECODE(A.DPMS_RESL_CD, '3006', A.CNT, 0)) AS ST3006
                                     , SUM(DECODE(A.DPMS_RESL_CD, '3007', A.CNT, 0)) AS ST3007
                                     , SUM(DECODE(A.DPMS_RESL_CD, '3008', A.CNT, 0)) AS ST3008
                                     , SUM(DECODE(A.DPMS_RESL_CD, '3009', A.CNT, 0)) AS ST3009
                                     , SUM(DECODE(A.DPMS_RESL_CD, '3010', A.CNT, 0)) AS ST3010
                                     , SUM(DECODE(A.DPMS_RESL_CD, '3011', A.CNT, 0)) AS ST3011
                                     , SUM(DECODE(A.DPMS_RESL_CD, '3012', A.CNT, 0)) AS ST3012
                                     , SUM(DECODE(A.DPMS_RESL_CD, '3013', A.CNT, 0)) AS ST3013
                                     , SUM(DECODE(A.DPMS_RESL_CD, '3014', A.CNT, 0)) AS ST3014
                                     , SUM(DECODE(A.DPMS_RESL_CD, '3015', A.CNT, 0)) AS ST3015
                                     , SUM(DECODE(A.DPMS_RESL_CD, '3016', A.CNT, 0)) AS ST3016
                                     , SUM(DECODE(A.DPMS_RESL_CD, '4001', A.CNT, 0)) AS ST4001
                                     , SUM(DECODE(A.DPMS_RESL_CD, '4002', A.CNT, 0)) AS ST4002
                                     , SUM(DECODE(A.DPMS_RESL_CD, '4003', A.CNT, 0)) AS ST4003
                                     , SUM(DECODE(A.DPMS_RESL_CD, '4004', A.CNT, 0)) AS ST4004
                                     , SUM(DECODE(A.DPMS_RESL_CD, '4005', A.CNT, 0)) AS ST4005
                                     , SUM(DECODE(A.DPMS_RESL_CD, '4006', A.CNT, 0)) AS ST4006
                                     , SUM(DECODE(A.DPMS_RESL_CD, '4007', A.CNT, 0)) AS ST4007
                                     , SUM(DECODE(A.DPMS_RESL_CD, '4010', A.CNT, 0)) AS ST4010
                                     , SUM(DECODE(A.DPMS_RESL_CD, '4011', A.CNT, 0)) AS ST4011
                                     , SUM(DECODE(A.DPMS_RESL_CD, '4012', A.CNT, 0)) AS ST4012
                                     , SUM(DECODE(A.DPMS_RESL_CD, '4013', A.CNT, 0)) AS ST4013
                                     , SUM(DECODE(A.DPMS_RESL_CD, '4015', A.CNT, 0)) AS ST4015
                                     , SUM(DECODE(A.DPMS_STAT_CD, '10', A.CNT, 0)) AS ST10
                                     , SUM(DECODE(A.DPMS_STAT_CD, '20', A.CNT, 0)) AS ST20
                                     , SUM(DECODE(A.DPMS_STAT_CD, '30', A.CNT, 0)) AS ST30
                                     , SUM(DECODE(A.DPMS_STAT_CD, '40', A.CNT, 0)) AS ST40
                                     , SUM(DECODE(A.DPMS_STAT_CD, '50', A.CNT, 0)) AS ST50
                                     , SUM(DECODE(A.DPMS_STAT_CD, NULL, 0, A.CNT)) AS STALL
                                     , SUM(TOTL_DPMS_TMCNT) AS TOTL_DPMS_TMCNT
                                     , TO_CHAR(MIN(MIN_DPMS_DTTM),'YYYY-MM-DD HH24:MI:SS') AS MIN_DPMS_DTTM
                                  FROM (SELECT CNSR_ID, CNTR_CD, CMPG_TYP_CD, DPMS_STAT_CD, DPMS_RESL_CD
                                               , COUNT(*) AS CNT
                                               , SUM(DPMS_TMCNT) AS TOTL_DPMS_TMCNT
                                               , MIN(DPMS_DTTM) AS MIN_DPMS_DTTM
                                          FROM (SELECT A.CNSR_ID, A.CNTR_CD
                                                       , B.DPMS_STAT_CD, B.DPMS_RESL_CD, B.DPMS_TMCNT
                                                       , C.CMPG_TYP_CD
                                                       , CASE WHEN TO_CHAR(B.DPMS_DTTM,'YYYYMMDD') = TO_CHAR(SYSDATE,'YYYYMMDD') THEN
                                                                   B.DPMS_DTTM ELSE NULL END DPMS_DTTM
                                                  FROM (SELECT A.*
                                                          FROM TB_CMPG_ALCT_DTL A
                                                         WHERE CMPG_ID = #{cmpg_id}
                                                           AND CNTR_CD = #{cntr_cd}
                                                        <if test="sub_trgt_list_id != null and sub_trgt_list_id != ''">
                                                           AND SUB_TRGT_LIST_ID = #{sub_trgt_list_id}
                                                        </if>
                                                       ) A
                                                  LEFT JOIN TB_TRGT_CUST_ALCT B
                                                    ON B.CMPG_ID = A.CMPG_ID
                                                   AND B.SUB_TRGT_LIST_ID = A.SUB_TRGT_LIST_ID
                                                   AND B.CNSR_ID = A.CNSR_ID
                                                   AND B.CNTR_CD = A.CNTR_CD
                                                <if test="dpms_dttm_sttdt != null and dpms_dttm_sttdt != '' and dpms_dttm_enddt != null and dpms_dttm_enddt != ''">
                                                   AND B.DPMS_DTTM >= #{dpms_dttm_sttdt}||'000000' AND B.DPMS_DTTM  <![CDATA[ <= ]]>  #{dpms_dttm_enddt}||'235959'
                                                </if>
                                                <if test="rgsn_dttm_sttdt != null and rgsn_dttm_sttdt != '' and rgsn_dttm_enddt != null and rgsn_dttm_enddt != ''">
                                                   AND B.RGSN_DTTM >= #{rgsn_dttm_sttdt}||'000000' AND B.RGSN_DTTM  <![CDATA[ <= ]]>  #{rgsn_dttm_enddt}||'235959'
                                                </if>
                                                  LEFT JOIN TB_CMPG_BASI C
                                                    ON C.CMPG_ID = A.CMPG_ID
                                                   AND C.CNTR_CD = A.CNTR_CD
                                               )
                                         GROUP BY CNSR_ID, CNTR_CD, CMPG_TYP_CD, DPMS_STAT_CD, DPMS_RESL_CD
                                       ) A
                                 GROUP BY CNSR_ID, CNTR_CD, CMPG_TYP_CD
                               ) A
                          LEFT JOIN TB_USER B
                            ON B.USER_ID = A.CNSR_ID
                           AND B.CNTR_CD = A.CNTR_CD
                          LEFT JOIN TB_CONS_TEAM C
                            ON C.TEAM_CD = B.TEAM_CD
                           AND C.CNTR_CD = B.CNTR_CD
                       ) A
               ) A
                       LEFT OUTER JOIN TB_USER T ON A.CNSR_ID = T.USER_ID
        <if test="startLine != null and startLine != '' and endLine != null and endLine != ''">
        <![CDATA[
         WHERE PAGE_INDX >= #{startLine}
           AND PAGE_INDX < #{endLine}
        ]]>
        </if>
    </select>

    <select id="TrgtCustAlctMap.getDupAlctCount" parameterType="map" resultType="int">
        SELECT  /* TrgtCustAlctMap.getDupAlctList */
            COUNT(*)
        FROM TB_TRGT_CUST_ALCT A JOIN
             (SELECT TRGT_CUST_DTPT_ID
                FROM TB_TRGT_CUST_ALCT
               WHERE CMPG_ID = #{cmpg_id}
               GROUP BY TRGT_CUST_DTPT_ID  HAVING COUNT(*) > 1) B
          ON A.TRGT_CUST_DTPT_ID = B.TRGT_CUST_DTPT_ID
    </select>

    <select id="TrgtCustAlctMap.getDupAlctList" parameterType="map" resultType="resultMap">
       SELECT  /* TrgtCustAlctMap.getDupAlctList */
             A.*,
            (SELECT CMPG_NM FROM TB_CMPG_BASI WHERE CMPG_ID = A.CMPG_ID ) AS CMPG_NM,
            (SELECT SUB_TRGT_LIST_NM FROM TB_SUB_TRGT_LIST_DTL WHERE SUB_TRGT_LIST_ID = A.SUB_TRGT_LIST_ID ) AS SUB_TRGT_LIST_NM,
            (SELECT USER_NM FROM TB_USER WHERE USER_ID = A.CNSR_ID) AS CNSR_NM,
            (SELECT USER_NM FROM TB_USER WHERE USER_ID = A.RGSR_ID) AS RGSR_NM,
            (SELECT CUST_NM FROM TB_TRGT_CUST_DTPT WHERE TRGT_CUST_DTPT_ID = A.TRGT_CUST_DTPT_ID) AS CUST_NM,
            (SELECT CLPH_TLNO FROM TB_TRGT_CUST_DTPT WHERE TRGT_CUST_DTPT_ID = A.TRGT_CUST_DTPT_ID) AS CLPH_TLNO
        FROM TB_TRGT_CUST_ALCT A JOIN
             (SELECT TRGT_CUST_DTPT_ID
                FROM TB_TRGT_CUST_ALCT
               WHERE CMPG_ID = #{cmpg_id}
               GROUP BY TRGT_CUST_DTPT_ID  HAVING COUNT(*) > 1) B
          ON A.TRGT_CUST_DTPT_ID = B.TRGT_CUST_DTPT_ID
    </select>


    <delete id="TrgtCustAlctMap.deleteDupAlct" parameterType="map">
        DELETE /* TrgtCustAlctMap.deleteDupAlct */
          FROM TB_TRGT_CUST_ALCT
         WHERE CNTR_CD = #{cntr_cd}
           AND CMPG_ID = #{cmpg_id}
           AND TRGT_CUST_DTPT_ID = #{trgt_cust_dtpt_id}
           AND CNSR_ID = #{cnsr_id}
           AND SUB_TRGT_LIST_ID = #{sub_trgt_list_id}
    </delete>
    
         <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctDirectCount" parameterType="map" resultType="int">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctDirectCount */
		   COUNT(*)
		FROM (SELECT ROW_NUMBER() OVER(ORDER BY DOD.REG_DM ASC) AS PAGE_INDX,
			        DOM.CI_VAL,
			        DOM.MEM_NM,
			        DOM.CELL,
			        DOM.BRTH_MON_DAY,
			        DOM.SEX,
			        DOM.HOME_ZIP,
			        DOM.HOME_ADDR,
			        DOM.HOME_ADDR2,
			        DOM.HOME_TEL,
			        DOM.EMAIL,
			        DOM.MARKT_AGR_YN,
			        DOM.DM_YN,
			        DOM.EMAIL_YN,
			        DOM.SMS_YN,
			        DOM.TEL_YN,
			        DOM.MARRY_YN,
			        DOM.CHILD_CNT,
			        DOD.RDP_MST_IDX,
			        DOD.ORD_MST_IDX,
			        DOD.B2B_CD,
			        DOD.PROD_CD,
			        (SELECT PROD_NM FROM lf_dmuser.PRODUCT WHERE PROD_CD = DOD.PROD_CD) AS PROD_NM,
                    (SELECT MODEL_CL_NM FROM lf_dmuser.PRODUCT_MODEL_CL_CD WHERE MODEL_CL_CD = DOD.PROD_KIND) AS MODEL_CL_NM,
			        DOD.PROD_KIND,
			        DOD.MODEL_CD,
			        DOD.INSPL_ZIP,
			        DOD.INSPL_ADDR,
			        DOD.INSPL_ADDR2,
			        DOD.HPCALL_TIME,
			        DOD.MAIN_CONTRACT,
			        CASE WHEN DOD.MAIN_CONTRACT = '01' THEN '상조'
                         WHEN DOD.MAIN_CONTRACT = '02' THEN '해외여행'
                         WHEN DOD.MAIN_CONTRACT = '03' THEN '크루즈'
                         WHEN DOD.MAIN_CONTRACT = '04' THEN '골프'
                         WHEN DOD.MAIN_CONTRACT = '05' THEN '어학연수'
                         ELSE '' END AS MAIN_CONTRACT_NM,
			        TO_CHAR(DOD.REG_DM, 'YYYY-MM-DD HH24:MI') AS REG_DM,
			        (CASE WHEN NVL(TCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
			        TCA.CNSR_ID,
			        NVL((SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID),'미정') AS CNSR_NM,
			        (SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID) AS USER_NM,
			        GETCODENM('CAM090', TCA.DPMS_RESL_CD, 'CCA') AS DPMS_RESL_NM,
			        GETCODENM('CAM100', TCA.DPMS_STAT_CD, 'CCA') AS DPMS_STAT_NM,
                    TCA.TRGT_LIST_ID,
                    TCA.SUB_TRGT_LIST_ID,
                    TCA.TRGT_CUST_DTPT_ID,
                    (SELECT COM_NM FROM lf_dmuser.B2BCOMCD WHERE COM_CD = DOD.B2B_CD) AS B2B_NM,
                    DOD.ORD_MST_VDR_BNF_ID
			FROM TB_DR_I_ORD_MST@DLCCSUB DOM INNER JOIN
			     TB_DR_I_ORD_DTL@DLCCSUB DOD ON DOM.CI_VAL = DOD.CI_VAL LEFT OUTER JOIN 
			     TB_DIRECT_TARGET DT ON DOD.CI_VAL = DT.CI_VAL AND DOD.ORD_MST_IDX = DT.ORD_MST_IDX LEFT OUTER JOIN 
			     TB_TRGT_CUST_ALCT TCA ON DT.CMPG_ID = TCA.CMPG_ID AND DT.TRGT_LIST_ID = TCA.TRGT_LIST_ID AND DT.SUB_TRGT_LIST_ID = TCA.SUB_TRGT_LIST_ID AND DT.TRGT_CUST_DTPT_ID = TCA.TRGT_CUST_DTPT_ID
			WHERE 1=1
			<if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                AND TO_CHAR(DOD.REG_DM, 'YYYYMMDD') BETWEEN REPLACE(#{stt_dt}, '-', '')  AND REPLACE(#{end_dt}, '-', '')
            </if>
			<if test="ci_val != null and ci_val != ''">
                   AND DOM.CI_VAL = #{ci_val}
            </if>
            <if test="dpms_resl_cd != null and dpms_resl_cd != ''">
               AND TCA.DPMS_RESL_CD = #{dpms_resl_cd}
            </if>
            <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
               AND TCA.DPMS_STAT_CD = #{dpms_stat_cd}
            </if>
            <if test="mem_nm != null and mem_nm != ''">
                AND  DOM.MEM_NM LIKE #{mem_nm} || '%'
             </if>
             <if test="cell != null and cell != ''">
			    AND DOM.CELL LIKE #{cell}||'%'
			</if>
			<if test="cnsr_id != null and cnsr_id != ''">
                AND  TCA.CNSR_ID = #{cnsr_id}
             </if>
             <if test="ord_mst_idx != null and ord_mst_idx != ''">
                AND  DOD.ORD_MST_IDX = #{ord_mst_idx}
             </if> 

               ) B
            WHERE 1=1
            <if test="alct_yn != null and alct_yn != ''">
                AND  ALCT_YN= #{alct_yn}
            </if>
    </select>
    
    <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctDirectList" parameterType="map" resultType="resultMap">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctDirectList */
		   *
		   
		FROM (SELECT ROW_NUMBER() OVER(ORDER BY DOD.REG_DM ASC) AS PAGE_INDX,
			        DOM.CI_VAL,
			        DOM.MEM_NM,
			        DOM.CELL,
			        REGEXP_REPLACE(DOM.CELL, '(.{3})(.+)(.{4})', '\1-\2-\3') AS CELL_NO,
			        DOM.BRTH_MON_DAY,
			        DOM.SEX,
			        DOM.HOME_ZIP,
			        DOM.HOME_ADDR,
			        DOM.HOME_ADDR2,
			        DOM.HOME_TEL,
			        REGEXP_REPLACE(DOM.HOME_TEL, '(02|.{3})(.+)(.{4})', '\1-\2-\3') AS HOME_TEL_NO,
			        DOM.EMAIL,
			        DOM.MARKT_AGR_YN,
			        DOM.DM_YN,
			        DOM.EMAIL_YN,
			        DOM.SMS_YN,
			        DOM.TEL_YN,
			        DOM.MARRY_YN,
			        DOM.CHILD_CNT,
			        DOD.RDP_MST_IDX,
			        DOD.ORD_MST_IDX,
			        DOD.B2B_CD,
			        DOD.PROD_CD,
			        (SELECT PROD_NM FROM lf_dmuser.PRODUCT WHERE PROD_CD = DOD.PROD_CD) AS PROD_NM,
                    (SELECT MODEL_CL_NM FROM lf_dmuser.PRODUCT_MODEL_CL_CD WHERE MODEL_CL_CD = DOD.PROD_KIND) AS MODEL_CL_NM,
			        DOD.PROD_KIND,
			        DOD.MODEL_CD,
			        DOD.INSPL_ZIP,
			        DOD.INSPL_ADDR,
			        DOD.INSPL_ADDR2,
			        CASE WHEN DOD.HPCALL_TIME = '01' THEN '빠른상담'
			             WHEN DOD.HPCALL_TIME = '02' THEN '09:30 ~ 11:00'
			             WHEN DOD.HPCALL_TIME = '03' THEN '11:00 ~ 13:00'
			             WHEN DOD.HPCALL_TIME = '04' THEN '13:00 ~ 15:00'
			             WHEN DOD.HPCALL_TIME = '05' THEN '15:00 ~ 17:00'
			             WHEN DOD.HPCALL_TIME = '06' THEN '17:00 ~ 18:30'
			             ELSE '' END AS HPCALL_TIME,
			        DOD.MAIN_CONTRACT,
			        CASE WHEN DOD.MAIN_CONTRACT = '01' THEN '상조'
                         WHEN DOD.MAIN_CONTRACT = '02' THEN '해외여행'
                         WHEN DOD.MAIN_CONTRACT = '03' THEN '크루즈'
                         WHEN DOD.MAIN_CONTRACT = '04' THEN '골프'
                         WHEN DOD.MAIN_CONTRACT = '05' THEN '어학연수'
                         ELSE '' END AS MAIN_CONTRACT_NM,
			        TO_CHAR(DOD.REG_DM, 'YYYY-MM-DD HH24:MI') AS REG_DM,
			        (CASE WHEN NVL(TCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
			        TCA.CNSR_ID,
			        NVL((SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID),'미정') AS CNSR_NM,
			        (SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID) AS USER_NM,
			        GETCODENM('CAM090', TCA.DPMS_RESL_CD, 'CCA') AS DPMS_RESL_NM,
			        GETCODENM('CAM100', TCA.DPMS_STAT_CD, 'CCA') AS DPMS_STAT_NM,
			        TCA.DPMS_STAT_CD,
                    TCA.TRGT_LIST_ID,
                    TCA.SUB_TRGT_LIST_ID,
                    TCA.TRGT_CUST_DTPT_ID,
                    (SELECT COM_NM FROM lf_dmuser.B2BCOMCD WHERE COM_CD = DOD.B2B_CD) AS B2B_NM,
                    NVL2((SELECT MAX(ID_NO) FROM lf_dmuser.MEM_PROD_ACCNT WHERE ID_NO = DOD.ORD_MST_IDX), 'Y', 'N') AS ORD_MST_YN,
                    DOD.ORD_MST_VDR_BNF_ID,
                    DOD.TERMS_YN,
                    DOD.UTM_SOURCE
			FROM TB_DR_I_ORD_MST@DLCCSUB DOM INNER JOIN
			     TB_DR_I_ORD_DTL@DLCCSUB DOD ON DOM.CI_VAL = DOD.CI_VAL LEFT OUTER JOIN 
			     TB_DIRECT_TARGET DT ON DOD.CI_VAL = DT.CI_VAL AND DOD.ORD_MST_IDX = DT.ORD_MST_IDX LEFT OUTER JOIN 
			     TB_TRGT_CUST_ALCT TCA ON DT.CMPG_ID = TCA.CMPG_ID AND DT.TRGT_LIST_ID = TCA.TRGT_LIST_ID AND DT.SUB_TRGT_LIST_ID = TCA.SUB_TRGT_LIST_ID AND DT.TRGT_CUST_DTPT_ID = TCA.TRGT_CUST_DTPT_ID
			WHERE 1=1
			<if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                AND TO_CHAR(DOD.REG_DM, 'YYYYMMDD') BETWEEN REPLACE(#{stt_dt}, '-', '')  AND REPLACE(#{end_dt}, '-', '')
            </if>
			<if test="ci_val != null and ci_val != ''">
                   AND DOM.CI_VAL = #{ci_val}
            </if>
            <if test="dpms_resl_cd != null and dpms_resl_cd != ''">
               AND TCA.DPMS_RESL_CD = #{dpms_resl_cd}
            </if>
            <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
               AND TCA.DPMS_STAT_CD = #{dpms_stat_cd}
            </if>
            <if test="mem_nm != null and mem_nm != ''">
                AND  DOM.MEM_NM LIKE #{mem_nm} || '%'
             </if>
             <if test="cell != null and cell != ''">
			    AND DOM.CELL LIKE #{cell}||'%'
			</if>
			<if test="cnsr_id != null and cnsr_id != ''">
                AND  TCA.CNSR_ID = #{cnsr_id}
             </if>
             <if test="ord_mst_idx != null and ord_mst_idx != ''">
                AND  DOD.ORD_MST_IDX = #{ord_mst_idx}
             </if> 
               ) B
            WHERE 1=1
            <if test="alct_yn != null and alct_yn != ''">
                AND  ALCT_YN= #{alct_yn}
            </if>
        <if test="startLine != null and startLine != '' and endLine != null and endLine != ''">
            <![CDATA[
               AND PAGE_INDX >= #{startLine}
               AND PAGE_INDX < #{endLine}
            ]]>
        </if>
    </select>
    
    <update id="TrgtCustAlctMap.updateChangeDirectCnsr" parameterType="map">
        UPDATE /* TrgtCustAlctMap.updateChangeDirectCnsr 사용*/
               TB_TRGT_CUST_ALCT
           SET CNSR_ID = #{user_id}
             , AMND_ID = #{amnd_id}
             , AMNT_DTTM = TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
         WHERE CNSR_ID = #{cnsr_id}
           AND TRGT_CUST_DTPT_ID = #{trgt_cust_dtpt_id}
           AND ((SELECT ADTL_CD FROM TB_CD WHERE CD = DPMS_RESL_CD  AND CD_SET_CD = 'CAM090') = '99'
           OR (SELECT ADTL_CD FROM TB_CD WHERE CD = DPMS_RESL_CD  AND CD_SET_CD = 'CAM090') IS NULL)
    </update>
    
    <insert id="TrgtCustAlctMap.insertTgtCustDirectAlct" parameterType="map">
        <selectKey keyProperty="trgt_cust_dtpt_id" resultType="String" order="BEFORE">
            SELECT ('TAR' || TO_CHAR(SYSDATE, 'YYYYMMDD') || LPAD(SEQ_COMMON.NEXTVAL, 7, '0')) FROM DUAL
        </selectKey>
        
        BEGIN
        
        INSERT /* TrgtCustAlctMap.insertTgtCustDirectAlct */
          INTO TB_TRGT_CUST_ALCT
              (CMPG_ID, TRGT_LIST_ID, SUB_TRGT_LIST_ID, TRGT_CUST_DTPT_ID
             , CNSR_ID, DPMS_STAT_CD, DPMS_TMCNT, CNTR_CD
             , RGSR_ID, RGSN_DTTM, AMND_ID, AMNT_DTTM)
        VALUES (#{cmpg_id}, #{trgt_list_id}, (SELECT SUB_TRGT_LIST_ID
                                              FROM TB_SUB_TRGT_LIST_DTL
         									  WHERE TRGT_LIST_ID = #{trgt_list_id}), #{trgt_cust_dtpt_id}
              , #{user_id}, '10', 0, #{cntr_cd}
              , #{rgsr_id}, TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS'), #{amnd_id}, TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
              );
              
        INSERT 
          INTO TB_DIRECT_TARGET
              (CI_VAL, ORD_MST_IDX, CMPG_ID, TRGT_LIST_ID, SUB_TRGT_LIST_ID, TRGT_CUST_DTPT_ID)
        VALUES (#{ci_val}, #{ord_mst_idx}, #{cmpg_id}, #{trgt_list_id}, (SELECT SUB_TRGT_LIST_ID
                                              							 FROM TB_SUB_TRGT_LIST_DTL
         									                             WHERE TRGT_LIST_ID = #{trgt_list_id}), #{trgt_cust_dtpt_id});
        
        INSERT 
          INTO TB_DR_I_ORD_RST@DLCCSUB
          (ORD_MST_IDX, ASSIGN_YN, ASSIGN_DT)
          VALUES (#{ord_mst_idx}, 'Y', SYSDATE);   
        
        END;
    </insert>
    
    <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctMainDirectCount" parameterType="map" resultType="int">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctMainDirectCount */
		   COUNT(*)
		FROM (SELECT ROW_NUMBER() OVER(ORDER BY DOD.REG_DM ASC) AS PAGE_INDX,
			        DOM.CI_VAL,
			        DOM.MEM_NM,
			        DOM.CELL,
			        DOM.BRTH_MON_DAY,
			        DOM.SEX,
			        DOM.HOME_ZIP,
			        DOM.HOME_ADDR,
			        DOM.HOME_ADDR2,
			        DOM.HOME_TEL,
			        DOM.EMAIL,
			        DOM.MARKT_AGR_YN,
			        DOM.DM_YN,
			        DOM.EMAIL_YN,
			        DOM.SMS_YN,
			        DOM.TEL_YN,
			        DOM.MARRY_YN,
			        DOM.CHILD_CNT,
			        DOD.RDP_MST_IDX,
			        DOD.ORD_MST_IDX,
			        DOD.B2B_CD,
			        DOD.PROD_CD,
			        DOD.PROD_KIND,
			        DOD.MODEL_CD,
			        DOD.INSPL_ZIP,
			        DOD.INSPL_ADDR,
			        DOD.INSPL_ADDR2,
			        DOD.HPCALL_TIME,
			        DOD.MAIN_CONTRACT,
			        TO_CHAR(DOD.REG_DM, 'YYYYMMDD') AS REG_DM,
			        (CASE WHEN NVL(TCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
			        TCA.CNSR_ID,
			        (SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID) AS USER_NM,
                    TCA.DPMS_TMCNT, TO_CHAR(TCA.DPMS_DTTM, 'YYYYMMDDHH24MISS') AS DPMS_DTTM, TCA.DPMS_RESL_CD, TCA.DPMS_STAT_CD
                    , TCA.CTI_CRNC_DTL_ID, '' AS ETC_TLNO
                    , GETCODENM('CAM090', TCA.DPMS_RESL_CD, TCA.CNTR_CD) AS DPMS_RESL_NM
                    , GETCODENM('CAM100', TCA.DPMS_STAT_CD, TCA.CNTR_CD) AS DPMS_STAT_NM
                    , GETCODENM('CAM180', TCA.DPMS_GBN_CD, TCA.CNTR_CD) AS DPMS_GBN_NM
                    , TCA.DPMS_RESL_CNTN, TCA.PROD_JOIN_YN , TCA.DPMS_TLPH_DIV_CD , TCA.DPMS_TLNO
                    , TCA.TRGT_LIST_ID, TCA.CMPG_ID, TCA.SUB_TRGT_LIST_ID, TCA.CNTR_CD, TCA.TRGT_CUST_DTPT_ID
                    , TCA.RESERVE_PROC_DT 	/* 예약일자 */
                    , TCA.RESERVE_PROC_TM	/* 예약시간 */
                    , NVL((SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID),'미정') AS CNSR_NM
		            , (SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.AMND_ID) AS AMND_NM
                    , TCA.DPMS_GBN_CD
                    , DOM.MEM_NM AS CUST_NM
                    , (SELECT MAX(MEM_NO) FROM lf_dmuser.MEM_PROD_ACCNT WHERE ID_NO = DOD.ORD_MST_IDX) AS MEM_NO
                    , (SELECT MAX(ACCNT_NO) FROM lf_dmuser.MEM_PROD_ACCNT WHERE ID_NO = DOD.ORD_MST_IDX) AS ACCNT_NO
                    , ST.INVT_CNTS_ID 
                    , ST.SUB_TRGT_LIST_NM
		            , ST.CMPG_PRFM_TEAM_CD
			FROM TB_DR_I_ORD_MST@DLCCSUB DOM INNER JOIN
			     TB_DR_I_ORD_DTL@DLCCSUB DOD ON DOM.CI_VAL = DOD.CI_VAL LEFT OUTER JOIN 
			     TB_DIRECT_TARGET DT ON DOD.CI_VAL = DT.CI_VAL AND DOD.ORD_MST_IDX = DT.ORD_MST_IDX LEFT OUTER JOIN 
			     TB_TRGT_CUST_ALCT TCA ON DT.CMPG_ID = TCA.CMPG_ID AND DT.TRGT_LIST_ID = TCA.TRGT_LIST_ID AND DT.SUB_TRGT_LIST_ID = TCA.SUB_TRGT_LIST_ID AND DT.TRGT_CUST_DTPT_ID = TCA.TRGT_CUST_DTPT_ID INNER JOIN 
		         TB_SUB_TRGT_LIST_DTL ST ON TCA.SUB_TRGT_LIST_ID=ST.SUB_TRGT_LIST_ID
			WHERE 1=1
			<if test="cmpg_stt_dt != null and cmpg_stt_dt != '' and cmpg_end_dt != null and cmpg_end_dt != ''">
                AND TO_CHAR(DOD.REG_DM, 'YYYYMMDD') BETWEEN REPLACE(#{cmpg_stt_dt}, '-', '')  AND REPLACE(#{cmpg_end_dt}, '-', '')
            </if>
            <if test="cust_nm != null and cust_nm != ''">
                AND DOM.MEM_NM LIKE  #{cust_nm}||'%'
            </if>
            <if test="tell_no != null and tell_no != ''">
               AND DOM.CELL LIKE  #{tell_no}||'%'
            </if>
            <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
               AND TCA.DPMS_STAT_CD = #{dpms_stat_cd}
            </if>
            <if test="dpms_resl_cd != null and dpms_resl_cd != ''">
               AND TCA.DPMS_RESL_CD = #{dpms_resl_cd}
            </if>
               ) B
    </select>
    
    <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctMainDirectList" parameterType="map" resultType="resultMap">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctMainDirectList */
		   *
		   
		FROM (SELECT ROW_NUMBER() OVER(ORDER BY DOD.REG_DM ASC) AS PAGE_INDX,
			        DOM.CI_VAL,
			        DOM.MEM_NM,
			        DOM.CELL,
			        DOM.BRTH_MON_DAY,
			        DOM.SEX,
			        DOM.HOME_ZIP,
			        DOM.HOME_ADDR,
			        DOM.HOME_ADDR2,
			        DOM.HOME_TEL,
			        DOM.EMAIL,
			        DOM.MARKT_AGR_YN,
			        DOM.DM_YN,
			        DOM.EMAIL_YN,
			        DOM.SMS_YN,
			        DOM.TEL_YN,
			        DOM.MARRY_YN,
			        DOM.CHILD_CNT,
			        DOD.RDP_MST_IDX,
			        DOD.ORD_MST_IDX,
			        DOD.B2B_CD,
			        DOD.PROD_CD,
			        DOD.PROD_KIND,
			        DOD.MODEL_CD,
			        DOD.INSPL_ZIP,
			        DOD.INSPL_ADDR,
			        DOD.INSPL_ADDR2,
			        DOD.HPCALL_TIME,
			        DOD.MAIN_CONTRACT,
			        TO_CHAR(DOD.REG_DM, 'YYYYMMDD') AS REG_DM,
			        (CASE WHEN NVL(TCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
			        TCA.CNSR_ID,
			        (SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID) AS USER_NM,
                    TCA.DPMS_TMCNT, TO_CHAR(TCA.DPMS_DTTM, 'YYYYMMDDHH24MISS') AS DPMS_DTTM, TCA.DPMS_RESL_CD, TCA.DPMS_STAT_CD
                    , TCA.CTI_CRNC_DTL_ID, '' AS ETC_TLNO
                    , GETCODENM('CAM090', TCA.DPMS_RESL_CD, TCA.CNTR_CD) AS DPMS_RESL_NM
                    , GETCODENM('CAM100', TCA.DPMS_STAT_CD, TCA.CNTR_CD) AS DPMS_STAT_NM
                    , GETCODENM('CAM180', TCA.DPMS_GBN_CD, TCA.CNTR_CD) AS DPMS_GBN_NM
                    , TCA.DPMS_RESL_CNTN, TCA.PROD_JOIN_YN , TCA.DPMS_TLPH_DIV_CD , TCA.DPMS_TLNO
                    , TCA.TRGT_LIST_ID, TCA.CMPG_ID, TCA.SUB_TRGT_LIST_ID, TCA.CNTR_CD, TCA.TRGT_CUST_DTPT_ID
                    , TCA.RESERVE_PROC_DT 	/* 예약일자 */
                    , TCA.RESERVE_PROC_TM	/* 예약시간 */
                    , NVL((SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID),'미정') AS CNSR_NM
		            , (SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.AMND_ID) AS AMND_NM
                    , TCA.DPMS_GBN_CD
                    , DOM.MEM_NM AS CUST_NM
                    --, (SELECT MAX(MEM_NO) FROM lf_dmuser.MEMBER WHERE CI_VAL = DOM.CI_VAL) AS MEM_NO
                    , (SELECT MAX(MEM_NO) FROM lf_dmuser.MEM_PROD_ACCNT WHERE ID_NO = DOD.ORD_MST_IDX AND DEL_FG = 'N') AS MEM_NO
                    , (SELECT MAX(ACCNT_NO) FROM lf_dmuser.MEM_PROD_ACCNT WHERE ID_NO = DOD.ORD_MST_IDX AND DEL_FG = 'N') AS ACCNT_NO
                    , ST.INVT_CNTS_ID 
                    , ST.SUB_TRGT_LIST_NM
		            , ST.CMPG_PRFM_TEAM_CD
			FROM TB_DR_I_ORD_MST@DLCCSUB DOM INNER JOIN
			     TB_DR_I_ORD_DTL@DLCCSUB DOD ON DOM.CI_VAL = DOD.CI_VAL LEFT OUTER JOIN 
			     TB_DIRECT_TARGET DT ON DOD.CI_VAL = DT.CI_VAL AND DOD.ORD_MST_IDX = DT.ORD_MST_IDX LEFT OUTER JOIN 
			     TB_TRGT_CUST_ALCT TCA ON DT.CMPG_ID = TCA.CMPG_ID AND DT.TRGT_LIST_ID = TCA.TRGT_LIST_ID AND DT.SUB_TRGT_LIST_ID = TCA.SUB_TRGT_LIST_ID AND DT.TRGT_CUST_DTPT_ID = TCA.TRGT_CUST_DTPT_ID INNER JOIN 
		         TB_SUB_TRGT_LIST_DTL ST ON TCA.SUB_TRGT_LIST_ID=ST.SUB_TRGT_LIST_ID
			WHERE 1=1
			AND TCA.CNSR_ID = #{user_id}
			<if test="cmpg_stt_dt != null and cmpg_stt_dt != '' and cmpg_end_dt != null and cmpg_end_dt != ''">
                AND TO_CHAR(DOD.REG_DM, 'YYYYMMDD') BETWEEN REPLACE(#{cmpg_stt_dt}, '-', '')  AND REPLACE(#{cmpg_end_dt}, '-', '')
            </if>
            <if test="cust_nm != null and cust_nm != ''">
                AND DOM.MEM_NM LIKE  #{cust_nm}||'%'
            </if>
            <if test="tell_no != null and tell_no != ''">
               AND DOM.CELL LIKE  #{tell_no}||'%'
            </if>
            <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
               AND TCA.DPMS_STAT_CD = #{dpms_stat_cd}
            </if>
            <if test="dpms_resl_cd != null and dpms_resl_cd != ''">
               AND TCA.DPMS_RESL_CD = #{dpms_resl_cd}
            </if>
               ) B
        <if test="startLine != null and startLine != '' and endLine != null and endLine != ''">
            <![CDATA[
             WHERE PAGE_INDX >= #{startLine}
               AND PAGE_INDX < #{endLine}
            ]]>
        </if>
    </select>
    
	<update id="TrgtCustAlctMap.updateDirectSessionClose" parameterType="map">
        BEGIN
        	COMMIT;
	        EXECUTE IMMEDIATE ('ALTER SESSION CLOSE DATABASE LINK DLCCSUB');
        END;
    </update>
    
	
	<!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctUplusCount" parameterType="map" resultType="int">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctUplusCount */
		   COUNT(*)
		FROM (SELECT  LT.ID_NO,
                      LT.HOME_PRD_NUM,
                      LT.U_DLR_CD,
                      LT.U_DLR_NM,
                      LT.U_INDC_EMPNO,
                      LT.U_INTG_USER_ID,
                      LT.WH_POS_CD,
                      LT.WH_STORE_NM,
                      LT.MAIN_CONT_TYPE,
                      LT.U_CMMN_CD_NM,
                      LT.SALES_TYPE,
                      LT.PRDCT_NM,
                      LT.PRDCT_NM2,
                      LT.PRDCT_NM3,
                      LT.NAME,
                      LT.HP,
                      LT.DISCOUNT_CTN,
                      LT.U_PROD_NO,
                      LT.U_PROD_NM,
                      LT.REG_DTM,
                      LT.CALL_STTS,
                      LT.MEMO,
                      LT.AGENT_EMP_NM,
                      LT.PRDCT_CD,
                      LT.PRDCT_CD2,
                      LT.PRDCT_CD3,
                      LT.AGENT_EMP_TEL,
                      LT.CNSLR,
                      (CASE WHEN NVL(TCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
                      TCA.CNSR_ID,
                      TCA.DPMS_STAT_CD,
                      TCA.TRGT_LIST_ID,
                      TCA.SUB_TRGT_LIST_ID,
                      TCA.TRGT_CUST_DTPT_ID
               FROM TB_LGUPLUS_TARGET LT LEFT OUTER JOIN 
                    TB_TRGT_CUST_ALCT TCA ON LT.CMPG_ID = TCA.CMPG_ID AND LT.TRGT_LIST_ID = TCA.TRGT_LIST_ID AND LT.SUB_TRGT_LIST_ID = TCA.SUB_TRGT_LIST_ID AND LT.TRGT_CUST_DTPT_ID = TCA.TRGT_CUST_DTPT_ID
			WHERE 1=1
				AND TO_CHAR(LT.REG_DTM, 'YYYYMMDD') > '20210302'
			<if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                AND TO_CHAR(LT.REG_DTM, 'YYYYMMDD') BETWEEN REPLACE(#{stt_dt}, '-', '')  AND REPLACE(#{end_dt}, '-', '')
            </if>
            <if test="join_method != null and join_method != ''">
               AND LT.JOIN_METHOD = #{join_method}
            </if>
			<if test="dpms_resl_cd != null and dpms_resl_cd != ''">
               AND TCA.DPMS_RESL_CD = #{dpms_resl_cd}
            </if>
            <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
               AND TCA.DPMS_STAT_CD = #{dpms_stat_cd}
            </if>
			<if test="cnsr_id != null and cnsr_id != ''">
                AND  TCA.CNSR_ID = #{cnsr_id}
             </if>
             <if test="id_no != null and id_no != ''">
                AND  LT.ID_NO = #{id_no}
             </if>  
             <if test="home_prd_num != null and home_prd_num != ''">
                AND  LT.HOME_PRD_NUM = #{home_prd_num}
             </if>  
             <if test="u_dlr_nm != null and u_dlr_nm != ''">
                AND  LT.U_DLR_NM LIKE #{u_dlr_nm} || '%'
             </if>  
             <if test="agent_emp_nm != null and agent_emp_nm != ''">
                AND  LT.AGENT_EMP_NM LIKE #{agent_emp_nm} || '%'
             </if>  
            <if test="mem_nm != null and mem_nm != ''">
                AND  LT.NAME LIKE #{mem_nm} || '%'
             </if>
             <if test="cell != null and cell != ''">
			    AND REPLACE(LT.HP, '-', '') = REPLACE( #{cell}, '-', '')
			</if>
            <if test="memo != null and memo != ''">
                AND  LT.MEMO LIKE #{memo} || '%'
             </if>  
            <if test="dpms_resl_cntn != null and dpms_resl_cntn != ''">
                AND  TCA.DPMS_RESL_CNTN LIKE #{dpms_resl_cntn} || '%'
             </if>  
             <if test="call_date != null and call_date != ''">
                AND  REPLACE(LT.CALL_DATE, '-', '') = REPLACE(#{call_date}, '-', '')
             </if>
             <if test="call_time != null and call_time != ''">
                AND REPLACE(SUBSTR(LT.CALL_TIME, 1, 5), ':', '') <![CDATA[<=]]> #{call_time}
				AND REPLACE(SUBSTR(LT.CALL_TIME, 9, 5), ':', '') <![CDATA[>=]]> #{call_time}
             </if>
             <if test="cmpg_prfm_team_cd != null and cmpg_prfm_team_cd != ''">
	             AND SUBSTR(LT.HP, -1) IN (SELECT COM_CD
	                                       FROM LF_DMUSER.COM_CD
	                                       WHERE GRP_CD = '0231'
	                                       AND CD_NM = #{cmpg_prfm_team_cd} OR TO_CHAR(LT.REG_DTM, 'YYYYMMDD') <![CDATA[<=]]> #{cmpg_day})
	             AND (TCA.CNSR_ID IS NULL OR TCA.CNSR_ID IN (SELECT USER_ID
	                                                         FROM TB_USER
	                                                         WHERE TEAM_CD = #{cmpg_prfm_team_cd}))
	         </if>
               ) B
            WHERE 1=1
            <if test="alct_yn != null and alct_yn != ''">
                AND  ALCT_YN= #{alct_yn}
            </if>
    </select>
    
    <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctUplusList" parameterType="map" resultType="resultMap">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctUplusList */
		   *
		   
		FROM (SELECT ROW_NUMBER() OVER(ORDER BY LT.REG_DTM DESC) AS PAGE_INDX,
			          LT.ID_NO,
                      LT.HOME_PRD_NUM,
                      LT.U_DLR_CD,
                      LT.U_DLR_NM,
                      LT.U_INDC_EMPNO,
                      LT.U_INTG_USER_ID,
                      LT.WH_POS_CD,
                      LT.WH_STORE_NM,
                      LT.MAIN_CONT_TYPE,
                      LT.U_CMMN_CD_NM,
                      LT.SALES_TYPE,
                      LT.PRDCT_NM,
                      LT.PRDCT_NM2,
                      LT.PRDCT_NM3,
                      LT.NAME,
                      LT.HP,
                      LT.DISCOUNT_CTN,
                      LT.U_PROD_NO,
                      LT.U_PROD_NM,
                      TO_CHAR(LT.REG_DTM, 'YYYY-MM-DD HH24:MI') AS REG_DTM,
                      --TO_CHAR(LT.REG_DTM, 'YYYYMMDDHH24MISS') AS REG_DTM,
                      LT.CALL_STTS,
                      LT.MEMO,
                      LT.AGENT_EMP_NM,
                      LT.PRDCT_CD,
                      LT.PRDCT_CD2,
                      LT.PRDCT_CD3,
                      LT.AGENT_EMP_TEL,
                      LT.CNSLR,
                      (CASE WHEN NVL(TCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
                      TCA.CNSR_ID,
                      NVL((SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID),'미정') AS CNSR_NM,
                      (SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID) AS USER_NM,
                      GETCODENM('CAM090', TCA.DPMS_RESL_CD, 'CCA') AS DPMS_RESL_NM,
                      GETCODENM('CAM100', TCA.DPMS_STAT_CD, 'CCA') AS DPMS_STAT_NM,
                      TCA.DPMS_STAT_CD,
                      TCA.TRGT_LIST_ID,
                      TCA.SUB_TRGT_LIST_ID,
                      TCA.TRGT_CUST_DTPT_ID,
                      TCA.DPMS_RESL_CNTN,
                      NVL2((SELECT MAX(ACCNT_NO) FROM LF_DMUSER.MEM_PROD_ACCNT WHERE ID_NO = LT.ID_NO AND DEL_FG = 'N'), 'Y', 'N') AS CHK,
--                      OCI.BRTH_MON_DAY,
--                      OCI.SEX,
--                      OCI.CI_VAL,
--                      OCI.HOME_ZIP,
--                      OCI.HOME_ADDR,
--                      OCI.HOME_ADDR2,
--                      OCI.HOME_TEL,
--                      OCI.PAY_MTHD,
--                      OCI.CARD_NM,
--                      OCI.CARD_NO,
--                      OCI.EXPIRE_DT,
--                      OCI.BANK_NM,
--                      OCI.BANK_ACCNT_NO,
--                      OCI.PAY_DT,
                      CASE WHEN LT.JOIN_METHOD = 'fixedLine' THEN '유선'
		                   WHEN LT.JOIN_METHOD = 'electronicContract' THEN '전자'
		                   ELSE LT.JOIN_METHOD END AS JOIN_METHOD,
		              CASE WHEN LT.CALL_TYPE = 'quickTell' THEN '빠른통화'
                           WHEN LT.CALL_TYPE = 'chooseTell' THEN '희망통화'
                           ELSE '' END CALL_TYPE_NM,
	                  CASE WHEN LT.CONTRACT_TYPE = 'oldContract' THEN '재접수'
	                       WHEN LT.CONTRACT_TYPE = 'newContract' THEN '신규'
	                       ELSE '' END CONTRACT_TYPE_NM,
	                  LT.CALL_DATE,
	                  LT.CALL_TIME
               FROM TB_LGUPLUS_TARGET LT LEFT OUTER JOIN 
                    TB_TRGT_CUST_ALCT TCA ON LT.CMPG_ID = TCA.CMPG_ID AND LT.TRGT_LIST_ID = TCA.TRGT_LIST_ID AND LT.SUB_TRGT_LIST_ID = TCA.SUB_TRGT_LIST_ID AND LT.TRGT_CUST_DTPT_ID = TCA.TRGT_CUST_DTPT_ID
			WHERE 1=1
				AND TO_CHAR(LT.REG_DTM, 'YYYYMMDD') > '20210302'
			<if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                AND TO_CHAR(LT.REG_DTM, 'YYYYMMDD') BETWEEN REPLACE(#{stt_dt}, '-', '')  AND REPLACE(#{end_dt}, '-', '')
            </if>
            <if test="join_method != null and join_method != ''">
               AND LT.JOIN_METHOD = #{join_method}
            </if>
			<if test="dpms_resl_cd != null and dpms_resl_cd != ''">
               AND TCA.DPMS_RESL_CD = #{dpms_resl_cd}
            </if>
            <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
               AND TCA.DPMS_STAT_CD = #{dpms_stat_cd}
            </if>
			<if test="cnsr_id != null and cnsr_id != ''">
                AND  TCA.CNSR_ID = #{cnsr_id}
             </if>
             <if test="id_no != null and id_no != ''">
                AND  LT.ID_NO = #{id_no}
             </if>  
             <if test="home_prd_num != null and home_prd_num != ''">
                AND  LT.HOME_PRD_NUM = #{home_prd_num}
             </if>  
             <if test="u_dlr_nm != null and u_dlr_nm != ''">
                AND  LT.U_DLR_NM LIKE #{u_dlr_nm} || '%'
             </if>  
             <if test="agent_emp_nm != null and agent_emp_nm != ''">
                AND  LT.AGENT_EMP_NM LIKE #{agent_emp_nm} || '%'
             </if>  
            <if test="mem_nm != null and mem_nm != ''">
                AND  LT.NAME LIKE #{mem_nm} || '%'
             </if>
             <if test="cell != null and cell != ''">
			    AND REPLACE(LT.HP, '-', '') = REPLACE( #{cell}, '-', '')
			</if>
            <if test="memo != null and memo != ''">
                AND  LT.MEMO LIKE '%' || #{memo} || '%'
             </if>  
            <if test="dpms_resl_cntn != null and dpms_resl_cntn != ''">
                AND  TCA.DPMS_RESL_CNTN LIKE '%' || #{dpms_resl_cntn} || '%'
             </if>
             <if test="call_date != null and call_date != ''">
                AND  REPLACE(LT.CALL_DATE, '-', '') = REPLACE(#{call_date}, '-', '')
             </if>
             <if test="call_time != null and call_time != ''">
                AND REPLACE(SUBSTR(LT.CALL_TIME, 1, 5), ':', '') <![CDATA[<=]]> #{call_time}
				AND REPLACE(SUBSTR(LT.CALL_TIME, 9, 5), ':', '') <![CDATA[>=]]> #{call_time}
             </if>
             
             <if test="cmpg_prfm_team_cd != null and cmpg_prfm_team_cd != ''">
	             AND SUBSTR(LT.HP, -1) IN (SELECT COM_CD
	                                       FROM LF_DMUSER.COM_CD
	                                       WHERE GRP_CD = '0231'
	                                       AND CD_NM = #{cmpg_prfm_team_cd} OR TO_CHAR(LT.REG_DTM, 'YYYYMMDD') <![CDATA[<=]]> #{cmpg_day})
	             AND (TCA.CNSR_ID IS NULL OR TCA.CNSR_ID IN (SELECT USER_ID
	                                                         FROM TB_USER
	                                                         WHERE TEAM_CD = #{cmpg_prfm_team_cd}))
	         </if>
               ) B
            WHERE 1=1
            <if test="alct_yn != null and alct_yn != ''">
                AND  ALCT_YN= #{alct_yn}
            </if>
        <if test="startLine != null and startLine != '' and endLine != null and endLine != ''">
            <![CDATA[
               AND PAGE_INDX >= #{startLine}
               AND PAGE_INDX < #{endLine}
            ]]>
        </if>
    </select>
    
    
    <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctUplusPopList" parameterType="map" resultType="resultMap">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctUplusPopList */
		   *
		   
		FROM (SELECT ROW_NUMBER() OVER(ORDER BY LT.REG_DTM DESC) AS PAGE_INDX,
			          LT.ID_NO,
                      LT.HOME_PRD_NUM,
                      LT.U_DLR_CD,
                      LT.U_DLR_NM,
                      LT.U_INDC_EMPNO,
                      LT.U_INTG_USER_ID,
                      LT.WH_POS_CD,
                      LT.WH_STORE_NM,
                      LT.MAIN_CONT_TYPE,
                      LT.U_CMMN_CD_NM,
                      LT.SALES_TYPE,
                      LT.PRDCT_NM,
                      LT.PRDCT_NM2,
                      LT.PRDCT_NM3,
                      LT.NAME,
                      LT.HP,
                      LT.DISCOUNT_CTN,
                      LT.U_PROD_NO,
                      LT.U_PROD_NM,
                      TO_CHAR(LT.REG_DTM, 'YYYY-MM-DD HH24:MI') AS REG_DTM,
                      --TO_CHAR(LT.REG_DTM, 'YYYYMMDDHH24MISS') AS REG_DTM,
                      LT.CALL_STTS,
                      LT.MEMO,
                      LT.AGENT_EMP_NM,
                      LT.PRDCT_CD,
                      LT.PRDCT_CD2,
                      LT.PRDCT_CD3,
                      LT.AGENT_EMP_TEL,
                      LT.CNSLR,
                      (CASE WHEN NVL(TCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
                      TCA.CNSR_ID,
                      NVL((SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID),'미정') AS CNSR_NM,
                      (SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID) AS USER_NM,
                      GETCODENM('CAM090', TCA.DPMS_RESL_CD, 'CCA') AS DPMS_RESL_NM,
                      GETCODENM('CAM100', TCA.DPMS_STAT_CD, 'CCA') AS DPMS_STAT_NM,
                      TCA.DPMS_STAT_CD,
                      TCA.TRGT_LIST_ID,
                      TCA.SUB_TRGT_LIST_ID,
                      TCA.TRGT_CUST_DTPT_ID,
                      NVL2((SELECT MAX(ACCNT_NO) FROM LF_DMUSER.MEM_PROD_ACCNT WHERE ID_NO = LT.ID_NO AND DEL_FG = 'N'), 'Y', 'N') AS CHK,
                      OCI.BRTH_MON_DAY,
                      OCI.SEX,
                      OCI.CI_VAL,
                      OCI.HOME_ZIP,
                      OCI.HOME_ADDR,
                      OCI.HOME_ADDR2,
                      OCI.HOME_TEL,
                      OCI.PAY_MTHD,
                      OCI.CARD_NM,
                      OCI.CARD_NO,
                      OCI.EXPIRE_DT,
                      OCI.BANK_NM,
                      OCI.BANK_ACCNT_NO,
                      OCI.PAY_DT,
                      CASE WHEN LT.JOIN_METHOD = 'fixedLine' THEN '유선'
		                   WHEN LT.JOIN_METHOD = 'electronicContract' THEN '전자'
		                   ELSE LT.JOIN_METHOD END AS JOIN_METHOD,
		              CASE WHEN LT.CALL_TYPE = 'quickTell' THEN '빠른통화'
                           WHEN LT.CALL_TYPE = 'chooseTell' THEN '희망통화'
                           ELSE '' END CALL_TYPE_NM,
	                  CASE WHEN LT.CONTRACT_TYPE = 'oldContract' THEN '재접수'
	                       WHEN LT.CONTRACT_TYPE = 'newContract' THEN '신규'
	                       ELSE '' END CONTRACT_TYPE_NM,
	                  LT.CALL_DATE,
	                  LT.CALL_TIME
               FROM TB_LGUPLUS_TARGET LT LEFT OUTER JOIN 
                    TB_LGUPLUS_CNSL_INFO@DMWEB OCI ON LT.ID_NO = OCI.ID_NO LEFT OUTER JOIN
                    TB_TRGT_CUST_ALCT TCA ON LT.CMPG_ID = TCA.CMPG_ID AND LT.TRGT_LIST_ID = TCA.TRGT_LIST_ID AND LT.SUB_TRGT_LIST_ID = TCA.SUB_TRGT_LIST_ID AND LT.TRGT_CUST_DTPT_ID = TCA.TRGT_CUST_DTPT_ID
			WHERE 1=1
				AND TO_CHAR(LT.REG_DTM, 'YYYYMMDD') > '20210302'
				AND  LT.ID_NO = #{id_no}
			<if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                AND TO_CHAR(LT.REG_DTM, 'YYYYMMDD') BETWEEN REPLACE(#{stt_dt}, '-', '')  AND REPLACE(#{end_dt}, '-', '')
            </if>
			<if test="dpms_resl_cd != null and dpms_resl_cd != ''">
               AND TCA.DPMS_RESL_CD = #{dpms_resl_cd}
            </if>
            <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
               AND TCA.DPMS_STAT_CD = #{dpms_stat_cd}
            </if>
            <if test="mem_nm != null and mem_nm != ''">
                AND  LT.NAME LIKE #{mem_nm} || '%'
             </if>
             <if test="cell != null and cell != ''">
			    AND REPLACE(LT.HP, '-', '') = REPLACE( #{cell}, '-', '')
			</if>
			<if test="cnsr_id != null and cnsr_id != ''">
                AND  TCA.CNSR_ID = #{cnsr_id}
             </if>
                
               ) B
            WHERE 1=1
            <if test="alct_yn != null and alct_yn != ''">
                AND  ALCT_YN= #{alct_yn}
            </if>
    </select>
    
    <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctUplusPopList2" parameterType="map" resultType="resultMap">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctUplusPopList2 */
		   *
		   
		FROM (SELECT ROW_NUMBER() OVER(ORDER BY LT.REG_DTM DESC) AS PAGE_INDX,
			          LT.ID_NO,
                      LT.HOME_PRD_NUM,
                      LT.U_DLR_CD,
                      LT.U_DLR_NM,
                      LT.U_INDC_EMPNO,
                      LT.U_INTG_USER_ID,
                      LT.WH_POS_CD,
                      LT.WH_STORE_NM,
                      LT.MAIN_CONT_TYPE,
                      LT.U_CMMN_CD_NM,
                      LT.SALES_TYPE,
                      LT.PRDCT_NM,
                      LT.PRDCT_NM2,
                      LT.PRDCT_NM3,
                      LT.NAME,
                      LT.HP,
                      LT.DISCOUNT_CTN,
                      LT.U_PROD_NO,
                      LT.U_PROD_NM,
                      TO_CHAR(LT.REG_DTM, 'YYYY-MM-DD HH24:MI') AS REG_DTM,
                      --TO_CHAR(LT.REG_DTM, 'YYYYMMDDHH24MISS') AS REG_DTM,
                      LT.CALL_STTS,
                      LT.MEMO,
                      LT.AGENT_EMP_NM,
                      LT.PRDCT_CD,
                      LT.PRDCT_CD2,
                      LT.PRDCT_CD3,
                      LT.AGENT_EMP_TEL,
                      LT.CNSLR,
                      (CASE WHEN NVL(TCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
                      TCA.CNSR_ID,
                      NVL((SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID),'미정') AS CNSR_NM,
                      (SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID) AS USER_NM,
                      GETCODENM('CAM090', TCA.DPMS_RESL_CD, 'CCA') AS DPMS_RESL_NM,
                      GETCODENM('CAM100', TCA.DPMS_STAT_CD, 'CCA') AS DPMS_STAT_NM,
                      TCA.DPMS_STAT_CD,
                      TCA.TRGT_LIST_ID,
                      TCA.SUB_TRGT_LIST_ID,
                      TCA.TRGT_CUST_DTPT_ID,
                      NVL2((SELECT MAX(ACCNT_NO) FROM LF_DMUSER.MEM_PROD_ACCNT WHERE ID_NO = LT.ID_NO AND DEL_FG = 'N'), 'Y', 'N') AS CHK,
                      OCI.BRTH_MON_DAY,
                      OCI.SEX,
                      OCI.CI_VAL,
                      OCI.HOME_ZIP,
                      OCI.HOME_ADDR,
                      OCI.HOME_ADDR2,
                      OCI.HOME_TEL,
                      OCI.PAY_MTHD,
                      OCI.CARD_NM,
                      OCI.CARD_NO,
                      OCI.EXPIRE_DT,
                      OCI.BANK_NM,
                      OCI.BANK_ACCNT_NO,
                      OCI.PAY_DT,
                      CASE WHEN LT.JOIN_METHOD = 'fixedLine' THEN '유선'
		                   WHEN LT.JOIN_METHOD = 'electronicContract' THEN '전자'
		                   ELSE LT.JOIN_METHOD END AS JOIN_METHOD,
		              CASE WHEN LT.CALL_TYPE = 'quickTell' THEN '빠른통화'
                           WHEN LT.CALL_TYPE = 'chooseTell' THEN '희망통화'
                           ELSE '' END CALL_TYPE_NM,
	                  CASE WHEN LT.CONTRACT_TYPE = 'oldContract' THEN '재접수'
	                       WHEN LT.CONTRACT_TYPE = 'newContract' THEN '신규'
	                       ELSE '' END CONTRACT_TYPE_NM,
	                  LT.CALL_DATE,
	                  LT.CALL_TIME
               FROM TB_LGUPLUS_TARGET LT LEFT OUTER JOIN 
                    TB_LGUPLUS_CNSL_INFO@DMWEB OCI ON LT.ID_NO = OCI.ID_NO LEFT OUTER JOIN
                    TB_TRGT_CUST_ALCT TCA ON LT.CMPG_ID = TCA.CMPG_ID AND LT.TRGT_LIST_ID = TCA.TRGT_LIST_ID AND LT.SUB_TRGT_LIST_ID = TCA.SUB_TRGT_LIST_ID AND LT.TRGT_CUST_DTPT_ID = TCA.TRGT_CUST_DTPT_ID
			WHERE 1=1
			AND TO_CHAR(LT.REG_DTM, 'YYYYMMDD') > '20210302'
			AND  LT.NAME LIKE #{mem_nm} || '%'
            AND REPLACE(LT.HP, '-', '') = REPLACE( #{cell}, '-', '')
                
               ) B
            WHERE 1=1
            AND  ALCT_YN= #{alct_yn}
    </select>
    
    <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctUplusCountExcel" parameterType="map" resultType="int">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctUplusCountExcel */
		   COUNT(*)
		FROM (SELECT  LT.ID_NO,
                      LT.HOME_PRD_NUM,
                      LT.U_DLR_CD,
                      LT.U_DLR_NM,
                      LT.U_INDC_EMPNO,
                      LT.U_INTG_USER_ID,
                      LT.WH_POS_CD,
                      LT.WH_STORE_NM,
                      LT.MAIN_CONT_TYPE,
                      LT.U_CMMN_CD_NM,
                      LT.SALES_TYPE,
                      LT.PRDCT_NM,
                      LT.PRDCT_NM2,
                      LT.PRDCT_NM3,
                      LT.NAME,
                      LT.HP,
                      LT.DISCOUNT_CTN,
                      LT.U_PROD_NO,
                      LT.U_PROD_NM,
                      LT.REG_DTM,
                      LT.CALL_STTS,
                      LT.MEMO,
                      LT.AGENT_EMP_NM,
                      LT.PRDCT_CD,
                      LT.PRDCT_CD2,
                      LT.PRDCT_CD3,
                      LT.AGENT_EMP_TEL,
                      LT.CNSLR,
                      (CASE WHEN NVL(TCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
                      TCA.CNSR_ID,
                      TCA.DPMS_STAT_CD,
                      TCA.TRGT_LIST_ID,
                      TCA.SUB_TRGT_LIST_ID,
                      TCA.TRGT_CUST_DTPT_ID
               FROM TB_LGUPLUS_TARGET LT LEFT OUTER JOIN 
                    TB_TRGT_CUST_ALCT TCA ON LT.CMPG_ID = TCA.CMPG_ID AND LT.TRGT_LIST_ID = TCA.TRGT_LIST_ID AND LT.SUB_TRGT_LIST_ID = TCA.SUB_TRGT_LIST_ID AND LT.TRGT_CUST_DTPT_ID = TCA.TRGT_CUST_DTPT_ID
			WHERE 1=1
				AND TO_CHAR(LT.REG_DTM, 'YYYYMMDD') > '20210302'
			<if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                AND TO_CHAR(LT.REG_DTM, 'YYYYMMDD') BETWEEN REPLACE(#{stt_dt}, '-', '')  AND REPLACE(#{end_dt}, '-', '')
            </if>
            <if test="join_method != null and join_method != ''">
               AND LT.JOIN_METHOD = #{join_method}
            </if>
			<if test="dpms_resl_cd != null and dpms_resl_cd != ''">
               AND TCA.DPMS_RESL_CD = #{dpms_resl_cd}
            </if>
            <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
               AND TCA.DPMS_STAT_CD = #{dpms_stat_cd}
            </if>
			<if test="cnsr_id != null and cnsr_id != ''">
                AND  TCA.CNSR_ID = #{cnsr_id}
             </if>
             <if test="id_no != null and id_no != ''">
                AND  LT.ID_NO = #{id_no}
             </if>  
             <if test="home_prd_num != null and home_prd_num != ''">
                AND  LT.HOME_PRD_NUM = #{home_prd_num}
             </if>  
             <if test="u_dlr_nm != null and u_dlr_nm != ''">
                AND  LT.U_DLR_NM LIKE #{u_dlr_nm} || '%'
             </if>  
             <if test="wh_store_nm != null and wh_store_nm != ''">
                AND  LT.WH_STORE_NM LIKE #{wh_store_nm} || '%'
             </if>  
            <if test="mem_nm != null and mem_nm != ''">
                AND  LT.NAME LIKE #{mem_nm} || '%'
             </if>
             <if test="cell != null and cell != ''">
			    AND REPLACE(LT.HP, '-', '') = REPLACE( #{cell}, '-', '')
			</if>
            <if test="memo != null and memo != ''">
                AND  LT.MEMO LIKE #{memo} || '%'
             </if>  
            <if test="dpms_resl_cntn != null and dpms_resl_cntn != ''">
                AND  TCA.DPMS_RESL_CNTN LIKE #{dpms_resl_cntn} || '%'
             </if>
			<if test="cmpg_prfm_team_cd != null and cmpg_prfm_team_cd != ''">
	             AND SUBSTR(LT.HP, -1) IN (SELECT COM_CD
	                                       FROM LF_DMUSER.COM_CD
	                                       WHERE GRP_CD = '0231'
	                                       AND CD_NM = #{cmpg_prfm_team_cd} OR TO_CHAR(LT.REG_DTM, 'YYYYMMDD') <![CDATA[<=]]> #{cmpg_day})
	             AND (TCA.CNSR_ID IS NULL OR TCA.CNSR_ID IN (SELECT USER_ID
	                                                         FROM TB_USER
	                                                         WHERE TEAM_CD = #{cmpg_prfm_team_cd}))
	         </if>
               ) B
            WHERE 1=1
            <if test="alct_yn != null and alct_yn != ''">
                AND  ALCT_YN= #{alct_yn}
            </if>
    </select>
    
    <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctUplusListExcel" parameterType="map" resultType="resultMap">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctUplusListExcel */
		   *
		   
		FROM (SELECT ROW_NUMBER() OVER(ORDER BY LT.REG_DTM DESC) AS PAGE_INDX,
			          LT.ID_NO,
                      LT.HOME_PRD_NUM,
                      LT.U_DLR_CD,
                      LT.U_DLR_NM,
                      LT.U_INDC_EMPNO,
                      LT.U_INTG_USER_ID,
                      LT.WH_POS_CD,
                      LT.WH_STORE_NM,
                      LT.MAIN_CONT_TYPE,
                      LT.U_CMMN_CD_NM,
                      LT.SALES_TYPE,
                      LT.PRDCT_NM,
                      LT.PRDCT_NM2,
                      LT.PRDCT_NM3,
                      LT.NAME,
                      LT.HP,
                      LT.DISCOUNT_CTN,
                      LT.U_PROD_NO,
                      LT.U_PROD_NM,
                      TO_CHAR(LT.REG_DTM, 'YYYY-MM-DD HH24:MI') AS REG_DTM,
                      --TO_CHAR(LT.REG_DTM, 'YYYYMMDDHH24MISS') AS REG_DTM,
                      LT.CALL_STTS,
                      LT.MEMO,
                      LT.AGENT_EMP_NM,
                      LT.PRDCT_CD,
                      LT.PRDCT_CD2,
                      LT.PRDCT_CD3,
                      LT.AGENT_EMP_TEL,
                      LT.CNSLR,
                      (CASE WHEN NVL(TCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
                      TCA.CNSR_ID,
                      NVL((SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID),'미정') AS CNSR_NM,
                      (SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID) AS USER_NM,
                      GETCODENM('CAM090', TCA.DPMS_RESL_CD, 'CCA') AS DPMS_RESL_NM,
                      GETCODENM('CAM100', TCA.DPMS_STAT_CD, 'CCA') AS DPMS_STAT_NM,
                      TCA.DPMS_STAT_CD,
                      TCA.TRGT_LIST_ID,
                      TCA.SUB_TRGT_LIST_ID,
                      TCA.TRGT_CUST_DTPT_ID,
                      TCA.DPMS_RESL_CNTN,
                      NVL2((SELECT MAX(ACCNT_NO) FROM LF_DMUSER.MEM_PROD_ACCNT WHERE ID_NO = LT.ID_NO AND DEL_FG = 'N'), 'Y', 'N') AS CHK,
--                      OCI.BRTH_MON_DAY,
--                      OCI.SEX,
--                      OCI.CI_VAL,
--                      OCI.HOME_ZIP,
--                      OCI.HOME_ADDR,
--                      OCI.HOME_ADDR2,
--                      OCI.HOME_TEL,
--                      OCI.PAY_MTHD,
--                      OCI.CARD_NM,
--                      OCI.CARD_NO,
--                      OCI.EXPIRE_DT,
--                      OCI.BANK_NM,
--                      OCI.BANK_ACCNT_NO,
--                      OCI.PAY_DT,
                      CASE WHEN LT.JOIN_METHOD = 'fixedLine' THEN '유선'
		                   WHEN LT.JOIN_METHOD = 'electronicContract' THEN '전자'
		                   ELSE LT.JOIN_METHOD END AS JOIN_METHOD
               FROM TB_LGUPLUS_TARGET LT LEFT OUTER JOIN 
                    TB_TRGT_CUST_ALCT TCA ON LT.CMPG_ID = TCA.CMPG_ID AND LT.TRGT_LIST_ID = TCA.TRGT_LIST_ID AND LT.SUB_TRGT_LIST_ID = TCA.SUB_TRGT_LIST_ID AND LT.TRGT_CUST_DTPT_ID = TCA.TRGT_CUST_DTPT_ID
			WHERE 1=1
				AND TO_CHAR(LT.REG_DTM, 'YYYYMMDD') > '20210302'
			<if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                AND TO_CHAR(LT.REG_DTM, 'YYYYMMDD') BETWEEN REPLACE(#{stt_dt}, '-', '')  AND REPLACE(#{end_dt}, '-', '')
            </if>
            <if test="join_method != null and join_method != ''">
               AND LT.JOIN_METHOD = #{join_method}
            </if>
			<if test="dpms_resl_cd != null and dpms_resl_cd != ''">
               AND TCA.DPMS_RESL_CD = #{dpms_resl_cd}
            </if>
            <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
               AND TCA.DPMS_STAT_CD = #{dpms_stat_cd}
            </if>
			<if test="cnsr_id != null and cnsr_id != ''">
                AND  TCA.CNSR_ID = #{cnsr_id}
             </if>
             <if test="id_no != null and id_no != ''">
                AND  LT.ID_NO = #{id_no}
             </if>  
             <if test="home_prd_num != null and home_prd_num != ''">
                AND  LT.HOME_PRD_NUM = #{home_prd_num}
             </if>  
             <if test="u_dlr_nm != null and u_dlr_nm != ''">
                AND  LT.U_DLR_NM LIKE #{u_dlr_nm} || '%'
             </if>  
             <if test="agent_emp_nm != null and agent_emp_nm != ''">
                AND  LT.AGENT_EMP_NM LIKE #{agent_emp_nm} || '%'
             </if>  
            <if test="mem_nm != null and mem_nm != ''">
                AND  LT.NAME LIKE #{mem_nm} || '%'
             </if>
             <if test="cell != null and cell != ''">
			    AND REPLACE(LT.HP, '-', '') = REPLACE( #{cell}, '-', '')
			</if>
            <if test="memo != null and memo != ''">
                AND  LT.MEMO LIKE #{memo} || '%'
             </if>  
            <if test="dpms_resl_cntn != null and dpms_resl_cntn != ''">
                AND  TCA.DPMS_RESL_CNTN LIKE #{dpms_resl_cntn} || '%'
             </if>  
             <if test="call_date != null and call_date != ''">
                AND  REPLACE(LT.CALL_DATE, '-', '') = REPLACE(#{call_date}, '-', '')
             </if>
             <if test="call_time != null and call_time != ''">
                AND REPLACE(SUBSTR(LT.CALL_TIME, 1, 5), ':', '') <![CDATA[<=]]> #{call_time}
				AND REPLACE(SUBSTR(LT.CALL_TIME, 9, 5), ':', '') <![CDATA[>=]]> #{call_time}
             </if>
             <if test="cmpg_prfm_team_cd != null and cmpg_prfm_team_cd != ''">
	             AND SUBSTR(LT.HP, -1) IN (SELECT COM_CD
	                                       FROM LF_DMUSER.COM_CD
	                                       WHERE GRP_CD = '0231'
	                                       AND CD_NM = #{cmpg_prfm_team_cd} OR TO_CHAR(LT.REG_DTM, 'YYYYMMDD') <![CDATA[<=]]> #{cmpg_day})
	             AND (TCA.CNSR_ID IS NULL OR TCA.CNSR_ID IN (SELECT USER_ID
	                                                         FROM TB_USER
	                                                         WHERE TEAM_CD = #{cmpg_prfm_team_cd}))
	         </if> 
               ) B
            WHERE 1=1
            <if test="alct_yn != null and alct_yn != ''">
                AND  ALCT_YN= #{alct_yn}
            </if>
    </select>
    
    <update id="TrgtCustAlctMap.updateUplusSessionClose" parameterType="map">
        BEGIN
        	COMMIT;
	        EXECUTE IMMEDIATE ('ALTER SESSION CLOSE DATABASE LINK DMWEB');
        END;
    </update>
    
    <update id="TrgtCustAlctMap.updateChangeUplusCnsr" parameterType="map">
        UPDATE /* TrgtCustAlctMap.updateChangeUplusCnsr 사용*/
               TB_TRGT_CUST_ALCT
           SET CNSR_ID = #{user_id}
             , AMND_ID = #{amnd_id}
             , AMNT_DTTM = TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
         WHERE CNSR_ID = #{cnsr_id}
           AND TRGT_CUST_DTPT_ID = #{trgt_cust_dtpt_id}
           AND ((SELECT ADTL_CD FROM TB_CD WHERE CD = DPMS_RESL_CD  AND CD_SET_CD = 'CAM090') = '99'
           OR (SELECT ADTL_CD FROM TB_CD WHERE CD = DPMS_RESL_CD  AND CD_SET_CD = 'CAM090') IS NULL)
    </update>
    
    <insert id="TrgtCustAlctMap.insertTgtCustUplusAlct" parameterType="map">
        <selectKey keyProperty="trgt_cust_dtpt_id" resultType="String" order="BEFORE">
            SELECT ('TAR' || TO_CHAR(SYSDATE, 'YYYYMMDD') || LPAD(SEQ_COMMON.NEXTVAL, 7, '0')) FROM DUAL
        </selectKey>
        
        BEGIN
        
        INSERT /* TrgtCustAlctMap.insertTgtCustUplusAlct */
          INTO TB_TRGT_CUST_ALCT
              (CMPG_ID, TRGT_LIST_ID, SUB_TRGT_LIST_ID, TRGT_CUST_DTPT_ID
             , CNSR_ID, DPMS_STAT_CD, DPMS_TMCNT, CNTR_CD
             , RGSR_ID, RGSN_DTTM, AMND_ID, AMNT_DTTM)
        VALUES (#{cmpg_id}, #{trgt_list_id}, (SELECT SUB_TRGT_LIST_ID
                                              FROM TB_SUB_TRGT_LIST_DTL
         									  WHERE TRGT_LIST_ID = #{trgt_list_id}), #{trgt_cust_dtpt_id}
              , #{user_id}, '10', 0, #{cntr_cd}
              , #{rgsr_id}, TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS'), #{amnd_id}, TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
              );
        
        UPDATE TB_LGUPLUS_TARGET
        SET CMPG_ID = #{cmpg_id}
           ,TRGT_LIST_ID = #{trgt_list_id}
           ,SUB_TRGT_LIST_ID = (SELECT SUB_TRGT_LIST_ID
                                FROM TB_SUB_TRGT_LIST_DTL
                                WHERE TRGT_LIST_ID = #{trgt_list_id})
           ,TRGT_CUST_DTPT_ID = #{trgt_cust_dtpt_id}
        WHERE ID_NO = #{id_no};
        
        END;
    </insert>
    
    <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctMainUplusCount" parameterType="map" resultType="int">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctMainUplusCount */
		   COUNT(*)
		FROM (SELECT 
				    ROW_NUMBER() OVER(ORDER BY TA.REG_DTM DESC) AS PAGE_INDX,
				    TA.ID_NO,
				    TA.HOME_PRD_NUM,
				    TA.U_DLR_CD,
				    TA.U_DLR_NM,
				    TA.U_INDC_EMPNO,
				    TA.U_INTG_USER_ID,
				    TA.WH_POS_CD,
				    TA.WH_STORE_NM,
				    TA.MAIN_CONT_TYPE,
				    TA.U_CMMN_CD_NM,
				    TA.SALES_TYPE,
				    TA.PRDCT_NM,
				    TA.PRDCT_NM2,
				    TA.PRDCT_NM3,
				    TA.NAME,
				    TA.HP,
				    TA.DISCOUNT_CTN,
				    TA.U_PROD_NO,
				    TA.U_PROD_NM,
				    TO_CHAR(TA.REG_DTM, 'YYYYMMDD') AS REG_DM,
				    TA.CALL_STTS,
				    TA.MEMO,
				    TA.AGENT_EMP_NM,
				    TA.PRDCT_CD,
				    TA.PRDCT_CD2,
				    TA.PRDCT_CD3,
				    TA.AGENT_EMP_TEL,
				    TA.CNSLR,
				    (CASE WHEN NVL(TCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
				    TCA.CNSR_ID,
				    (SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID) AS USER_NM,
				    TCA.DPMS_TMCNT,
				    TO_CHAR(TCA.DPMS_DTTM, 'YYYYMMDDHH24MISS') AS DPMS_DTTM,
				    TCA.DPMS_RESL_CD,
				    TCA.DPMS_STAT_CD,
				    TCA.CTI_CRNC_DTL_ID,
				    '' AS ETC_TLNO,
				    GETCODENM('CAM090', TCA.DPMS_RESL_CD, TCA.CNTR_CD) AS DPMS_RESL_NM,
				    GETCODENM('CAM100', TCA.DPMS_STAT_CD, TCA.CNTR_CD) AS DPMS_STAT_NM,
				    GETCODENM('CAM180', TCA.DPMS_GBN_CD, TCA.CNTR_CD) AS DPMS_GBN_NM,
				    TCA.DPMS_RESL_CNTN,
				    TCA.PROD_JOIN_YN ,
				    TCA.DPMS_TLPH_DIV_CD ,
				    TCA.DPMS_TLNO,
				    TCA.TRGT_LIST_ID,
				    TCA.CMPG_ID,
				    TCA.SUB_TRGT_LIST_ID,
				    TCA.CNTR_CD,
				    TCA.TRGT_CUST_DTPT_ID,
				    TCA.RESERVE_PROC_DT, 	/* 예약일자 */
				    TCA.RESERVE_PROC_TM,	/* 예약시간 */
				    NVL((SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID),'미정') AS CNSR_NM,
				    (SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.AMND_ID) AS AMND_NM,
				    TCA.DPMS_GBN_CD,
				    TA.NAME AS CUST_NM,
				    MPA.MEM_NO,
				    MPA.ACCNT_NO,
				    ST.INVT_CNTS_ID ,
				    ST.SUB_TRGT_LIST_NM,
				    ST.CMPG_PRFM_TEAM_CD,
				    TA.HP AS CLPH_TLNO,
				    TCA.RGSN_DTTM
				FROM TB_TRGT_CUST_ALCT TCA INNER JOIN
				    TB_LGUPLUS_TARGET TA ON TCA.TRGT_CUST_DTPT_ID = TA.TRGT_CUST_DTPT_ID LEFT OUTER JOIN
				    LF_DMUSER.MEM_PROD_ACCNT MPA ON TA.ID_NO = MPA.ID_NO AND MPA.DEL_FG = 'N' LEFT OUTER JOIN
				    TB_SUB_TRGT_LIST_DTL ST ON TCA.CNTR_CD = ST.CNTR_CD AND TCA.TRGT_LIST_ID = ST.TRGT_LIST_ID AND TCA.SUB_TRGT_LIST_ID=ST.SUB_TRGT_LIST_ID
				WHERE 1=1
			AND TCA.CMPG_ID = #{cmpg_id}
			AND TCA.CNSR_ID = #{user_id}
			<if test="cmpg_stt_dt != null and cmpg_stt_dt != '' and cmpg_end_dt != null and cmpg_end_dt != ''">
                AND TCA.RGSN_DTTM BETWEEN #{cmpg_stt_dt} || '000000'  AND #{cmpg_end_dt} || '235959'
            </if>
            <if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                AND TCA.DPMS_DTTM BETWEEN #{stt_dt} || '000000'  AND #{end_dt} || '235959'
            </if>
            <if test="cust_nm != null and cust_nm != ''">
                AND TA.NAME LIKE #{cust_nm} || '%'
            </if>
            <if test="tell_no != null and tell_no != ''">
               AND REPLACE(TA.HP, '-', '') = REPLACE(#{tell_no}, '-', '')
            </if>
            <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
               AND TCA.DPMS_STAT_CD = #{dpms_stat_cd}
            </if>
            <if test="dpms_resl_cd != null and dpms_resl_cd != ''">
               AND TCA.DPMS_RESL_CD = #{dpms_resl_cd}
            </if>
            <if test="user_defn1_cntn != null and user_defn1_cntn != ''">
               AND (TA.PRDCT_NM LIKE #{user_defn1_cntn} || '%' OR TA.PRDCT_NM2 LIKE #{user_defn1_cntn} || '%')
            </if>
            <if test="user_defn2_cntn != null and user_defn2_cntn != ''">
               AND TA.U_DLR_NM LIKE #{user_defn2_cntn} || '%'
            </if>
            <if test="user_defn3_cntn != null and user_defn3_cntn != ''">
               AND TA.MAIN_CONT_TYPE = #{user_defn3_cntn}
            </if>
            <if test="user_defn4_cntn != null and user_defn4_cntn != ''">
               AND TA.WH_STORE_NM LIKE #{user_defn4_cntn} || '%'
            </if>
            <if test="user_defn5_cntn != null and user_defn5_cntn != ''">
               AND TA.ID_NO LIKE #{user_defn5_cntn} || '%'
            </if>
            <if test="user_defn9_cntn != null and user_defn9_cntn != ''">
               AND TA.HOME_PRD_NUM = #{user_defn9_cntn}
            </if>
            <if test="join_method != null and join_method != ''">
               AND TA.JOIN_METHOD = #{join_method}
            </if>
            <if test="call_date != null and call_date != ''">
                AND  REPLACE(TA.CALL_DATE, '-', '') = REPLACE(#{call_date}, '-', '')
            </if>
            <if test="call_time != null and call_time != ''">
                AND REPLACE(SUBSTR(TA.CALL_TIME, 1, 5), ':', '') <![CDATA[<=]]> #{call_time}
				AND REPLACE(SUBSTR(TA.CALL_TIME, 9, 5), ':', '') <![CDATA[>=]]> #{call_time}
            </if>
               ) B
    </select>
    
    <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctMainUplusList" parameterType="map" resultType="resultMap">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctMainUplusList */
		   *
		   
		FROM (SELECT 
				    ROW_NUMBER() OVER(ORDER BY TA.REG_DTM DESC) AS PAGE_INDX,
				    TA.ID_NO,
				    TA.HOME_PRD_NUM,
				    TA.U_DLR_CD,
				    TA.U_DLR_NM,
				    TA.U_INDC_EMPNO,
				    TA.U_INTG_USER_ID,
				    TA.WH_POS_CD,
				    TA.WH_STORE_NM,
				    TA.MAIN_CONT_TYPE,
				    TA.U_CMMN_CD_NM,
				    TA.SALES_TYPE,
				    TA.PRDCT_NM,
				    TA.PRDCT_NM2,
				    TA.PRDCT_NM3,
				    TA.NAME,
				    TA.HP,
				    TA.DISCOUNT_CTN,
				    TA.U_PROD_NO,
				    TA.U_PROD_NM,
				    TO_CHAR(TA.REG_DTM, 'YYYYMMDD') AS REG_DM,
				    TA.CALL_STTS,
				    TA.MEMO,
				    TA.AGENT_EMP_NM,
				    TA.PRDCT_CD,
				    TA.PRDCT_CD2,
				    TA.PRDCT_CD3,
				    TA.AGENT_EMP_TEL,
				    TA.CNSLR,
				    (CASE WHEN NVL(TCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
				    TCA.CNSR_ID,
				    (SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID) AS USER_NM,
				    TCA.DPMS_TMCNT,
				    TO_CHAR(TCA.DPMS_DTTM, 'YYYYMMDDHH24MISS') AS DPMS_DTTM,
				    TCA.DPMS_RESL_CD,
				    TCA.DPMS_STAT_CD,
				    TCA.CTI_CRNC_DTL_ID,
				    '' AS ETC_TLNO,
				    GETCODENM('CAM090', TCA.DPMS_RESL_CD, TCA.CNTR_CD) AS DPMS_RESL_NM,
				    GETCODENM('CAM100', TCA.DPMS_STAT_CD, TCA.CNTR_CD) AS DPMS_STAT_NM,
				    GETCODENM('CAM180', TCA.DPMS_GBN_CD, TCA.CNTR_CD) AS DPMS_GBN_NM,
				    TCA.DPMS_RESL_CNTN,
				    TCA.PROD_JOIN_YN ,
				    TCA.DPMS_TLPH_DIV_CD ,
				    TCA.DPMS_TLNO,
				    TCA.TRGT_LIST_ID,
				    TCA.CMPG_ID,
				    TCA.SUB_TRGT_LIST_ID,
				    TCA.CNTR_CD,
				    TCA.TRGT_CUST_DTPT_ID,
				    TCA.RESERVE_PROC_DT, 	/* 예약일자 */
				    TCA.RESERVE_PROC_TM,	/* 예약시간 */
				    NVL((SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID),'미정') AS CNSR_NM,
				    (SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.AMND_ID) AS AMND_NM,
				    TCA.DPMS_GBN_CD,
				    TA.NAME AS CUST_NM,
				    MPA.MEM_NO,
				    MPA.ACCNT_NO,
				    ST.INVT_CNTS_ID ,
				    ST.SUB_TRGT_LIST_NM,
				    ST.CMPG_PRFM_TEAM_CD,
				    TA.HP AS CLPH_TLNO,
				    TCA.RGSN_DTTM,
				    CASE WHEN TA.PRDCT_NM IS NOT NULL THEN TA.PRDCT_NM
				         ELSE TA.PRDCT_NM2 END AS USER_DEFN1_CNTN,
				    TA.U_DLR_NM AS USER_DEFN2_CNTN,
				    TA.MAIN_CONT_TYPE AS USER_DEFN3_CNTN,
				    TA.AGENT_EMP_NM AS USER_DEFN4_CNTN,     
				    TA.ID_NO AS USER_DEFN5_CNTN,     
				    TA.AGENT_EMP_TEL AS USER_DEFN6_CNTN,
				    TA.DISCOUNT_CTN AS USER_DEFN7_CNTN,
				    TA.CALL_DATE AS USER_DEFN8_CNTN,
				    TA.HOME_PRD_NUM AS USER_DEFN9_CNTN,
				    TA.CALL_TIME AS USER_DEFN10_CNTN,
				    CASE WHEN TA.JOIN_METHOD = 'fixedLine' THEN '유선'
	                     WHEN TA.JOIN_METHOD = 'electronicContract' THEN '전자'
	                     ELSE TA.JOIN_METHOD END AS JOIN_METHOD   
				FROM TB_TRGT_CUST_ALCT TCA INNER JOIN
				    TB_LGUPLUS_TARGET TA ON TCA.TRGT_CUST_DTPT_ID = TA.TRGT_CUST_DTPT_ID LEFT OUTER JOIN
				    LF_DMUSER.MEM_PROD_ACCNT MPA ON TA.ID_NO = MPA.ID_NO AND MPA.DEL_FG = 'N' LEFT OUTER JOIN
				    TB_SUB_TRGT_LIST_DTL ST ON TCA.CNTR_CD = ST.CNTR_CD AND TCA.TRGT_LIST_ID = ST.TRGT_LIST_ID AND TCA.SUB_TRGT_LIST_ID=ST.SUB_TRGT_LIST_ID
				WHERE 1=1
			AND TCA.CMPG_ID = #{cmpg_id}
			AND TCA.CNSR_ID = #{user_id}
			<if test="cmpg_stt_dt != null and cmpg_stt_dt != '' and cmpg_end_dt != null and cmpg_end_dt != ''">
                AND TCA.RGSN_DTTM BETWEEN #{cmpg_stt_dt} || '000000'  AND #{cmpg_end_dt} || '235959'
            </if>
            <if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                AND TCA.DPMS_DTTM BETWEEN #{stt_dt} || '000000'  AND #{end_dt} || '235959'
            </if>
            <if test="cust_nm != null and cust_nm != ''">
                AND TA.NAME LIKE #{cust_nm} || '%'
            </if>
            <if test="tell_no != null and tell_no != ''">
               AND REPLACE(TA.HP, '-', '') = REPLACE(#{tell_no}, '-', '')
            </if>
            <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
               AND TCA.DPMS_STAT_CD = #{dpms_stat_cd}
            </if>
            <if test="dpms_resl_cd != null and dpms_resl_cd != ''">
               AND TCA.DPMS_RESL_CD = #{dpms_resl_cd}
            </if>
            <if test="user_defn1_cntn != null and user_defn1_cntn != ''">
               AND (TA.PRDCT_NM LIKE #{user_defn1_cntn} || '%' OR TA.PRDCT_NM2 LIKE #{user_defn1_cntn} || '%')
            </if>
            <if test="user_defn2_cntn != null and user_defn2_cntn != ''">
               AND TA.U_DLR_NM LIKE #{user_defn2_cntn} || '%'
            </if>
            <if test="user_defn3_cntn != null and user_defn3_cntn != ''">
               AND TA.MAIN_CONT_TYPE = #{user_defn3_cntn}
            </if>
            <if test="user_defn4_cntn != null and user_defn4_cntn != ''">
               AND TA.WH_STORE_NM LIKE #{user_defn4_cntn} || '%'
            </if>
            <if test="user_defn5_cntn != null and user_defn5_cntn != ''">
               AND TA.ID_NO LIKE #{user_defn5_cntn} || '%'
            </if>
            <if test="user_defn9_cntn != null and user_defn9_cntn != ''">
               AND TA.HOME_PRD_NUM = #{user_defn9_cntn}
            </if>
            <if test="join_method != null and join_method != ''">
               AND TA.JOIN_METHOD = #{join_method}
            </if>
            <if test="call_date != null and call_date != ''">
                AND REPLACE(TA.CALL_DATE, '-', '') = REPLACE(#{call_date}, '-', '')
            </if>
            <if test="call_time != null and call_time != ''">
                AND REPLACE(SUBSTR(TA.CALL_TIME, 1, 5), ':', '') <![CDATA[<=]]> #{call_time}
				AND REPLACE(SUBSTR(TA.CALL_TIME, 9, 5), ':', '') <![CDATA[>=]]> #{call_time}
            </if>
            ) B
        <if test="startLine != null and startLine != '' and endLine != null and endLine != ''">
            <![CDATA[
             WHERE PAGE_INDX >= #{startLine}
               AND PAGE_INDX < #{endLine}
            ]]>
        </if>
    </select>
	
    <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctMangiCount" parameterType="map" resultType="int">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctMangiCount */
		   COUNT(*)
		FROM (SELECT RS.RESN_ACPT_DAY,
                     MB.MEM_NM,
                     MB.CELL,
                     TCA.CNSR_ID,
                     NVL((SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID),'미정') AS CNSR_NM,
                     (CASE WHEN NVL(TCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
                     GETCODENM('CAM100', TCA.DPMS_STAT_CD, 'CCA') AS DPMS_STAT_NM,
                     GETCODENM('CAM090', TCA.DPMS_RESL_CD, 'CCA') AS DPMS_RESL_NM,
                     TCA.DPMS_RESL_CNTN, --상담메모
                     MPA.ACCNT_NO,
                     MPA.MEM_NO,
                     MT.CMPG_ID,
                     MT.TRGT_LIST_ID,
                     MT.SUB_TRGT_LIST_ID,
                     MT.TRGT_CUST_DTPT_ID
                FROM LF_DMUSER.MEM_PROD_ACCNT MPA 
                     INNER JOIN LF_DMUSER.MEMBER MB ON MPA.MEM_NO = MB.MEM_NO AND MB.DEL_FG = 'N'
                     INNER JOIN LF_DMUSER.RESCISSION RS ON MPA.ACCNT_NO = RS.ACCNT_NO AND RS.DEL_FG = 'N' AND RS.RESON = '23' AND NVL(RESN_PROC_YN,'N') != 'Y'
                     LEFT OUTER JOIN TB_MANGI_TARGET MT ON MPA.ACCNT_NO = MT.ACCNT_NO
                     LEFT OUTER JOIN TB_TRGT_CUST_ALCT TCA ON MT.CMPG_ID = TCA.CMPG_ID AND MT.TRGT_LIST_ID = TCA.TRGT_LIST_ID AND MT.SUB_TRGT_LIST_ID = TCA.SUB_TRGT_LIST_ID AND MT.TRGT_CUST_DTPT_ID = TCA.TRGT_CUST_DTPT_ID
                WHERE 1=1
                AND LENGTH(NVL(MB.IDN_NO, 'N')) != 10
                AND MPA.DEL_FG = 'N'
                AND MPA.KSTBIT = '03'
			<if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                AND RS.RESN_ACPT_DAY BETWEEN REPLACE(#{stt_dt}, '-', '')  AND REPLACE(#{end_dt}, '-', '')
            </if>
            <if test="dpms_resl_cd != null and dpms_resl_cd != ''">
               AND TCA.DPMS_RESL_CD = #{dpms_resl_cd}
            </if>
            <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
               AND TCA.DPMS_STAT_CD = #{dpms_stat_cd}
            </if>
			<if test="cnsr_id != null and cnsr_id != ''">
               AND  TCA.CNSR_ID = #{cnsr_id}
            </if>
            <if test="mem_nm != null and mem_nm != ''">
                AND  MB.MEM_NM LIKE #{mem_nm} || '%'
             </if>
             <if test="cell != null and cell != ''">
			    AND MB.CELL1 = REPLACE( #{cell}, '-', '')
			</if>			
            <if test="accnt_no != null and accnt_no != ''">
                AND  MPA.ACCNT_NO = #{accnt_no} 
             </if> 			
            <if test="dpms_resl_cntn != null and dpms_resl_cntn != ''">
                AND  TCA.DPMS_RESL_CNTN LIKE #{dpms_resl_cntn} || '%'
            </if>  
               ) B
            WHERE 1=1
            <if test="alct_yn != null and alct_yn != ''">
                AND  ALCT_YN= #{alct_yn}
            </if>
    </select>
    
    <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctMangilist" parameterType="map" resultType="resultMap">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctMangilist */
		   *
		   
		FROM (SELECT ROW_NUMBER() OVER(ORDER BY RS.RESN_ACPT_DAY DESC) AS PAGE_INDX,
		             RS.RESN_ACPT_DAY,
                     MB.MEM_NM,
                     MB.CELL,
                     TCA.CNSR_ID,
                     NVL((SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID),'미정') AS CNSR_NM,
                     (CASE WHEN NVL(TCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
                     GETCODENM('CAM100', TCA.DPMS_STAT_CD, 'CCA') AS DPMS_STAT_NM, 
                     GETCODENM('CAM090', TCA.DPMS_RESL_CD, 'CCA') AS DPMS_RESL_NM,
                     TCA.DPMS_RESL_CNTN, --상담메모
                     MPA.ACCNT_NO,
                     MPA.MEM_NO,
                     MT.CMPG_ID,
                     MT.TRGT_LIST_ID,
                     MT.SUB_TRGT_LIST_ID,
                     MT.TRGT_CUST_DTPT_ID
                FROM LF_DMUSER.MEM_PROD_ACCNT MPA 
                     INNER JOIN LF_DMUSER.MEMBER MB ON MPA.MEM_NO = MB.MEM_NO AND MB.DEL_FG = 'N'
                     INNER JOIN LF_DMUSER.RESCISSION RS ON MPA.ACCNT_NO = RS.ACCNT_NO AND RS.DEL_FG = 'N' AND RS.RESON = '23' AND NVL(RESN_PROC_YN,'N') != 'Y'
                     LEFT OUTER JOIN TB_MANGI_TARGET MT ON MPA.ACCNT_NO = MT.ACCNT_NO
                     LEFT OUTER JOIN TB_TRGT_CUST_ALCT TCA ON MT.CMPG_ID = TCA.CMPG_ID AND MT.TRGT_LIST_ID = TCA.TRGT_LIST_ID AND MT.SUB_TRGT_LIST_ID = TCA.SUB_TRGT_LIST_ID AND MT.TRGT_CUST_DTPT_ID = TCA.TRGT_CUST_DTPT_ID
                WHERE 1=1
                AND LENGTH(NVL(MB.IDN_NO, 'N')) != 10
                AND MPA.DEL_FG = 'N'
                AND MPA.KSTBIT = '03'
			<if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                AND RS.RESN_ACPT_DAY BETWEEN REPLACE(#{stt_dt}, '-', '')  AND REPLACE(#{end_dt}, '-', '')
            </if>
            <if test="dpms_resl_cd != null and dpms_resl_cd != ''">
               AND TCA.DPMS_RESL_CD = #{dpms_resl_cd}
            </if>
            <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
               AND TCA.DPMS_STAT_CD = #{dpms_stat_cd} 
            </if>
			<if test="cnsr_id != null and cnsr_id != ''">
               AND  TCA.CNSR_ID = #{cnsr_id}
            </if>
            <if test="mem_nm != null and mem_nm != ''">
                AND  MB.MEM_NM LIKE #{mem_nm} || '%'
             </if>
            <if test="accnt_no != null and accnt_no != ''">
                AND  MPA.ACCNT_NO = #{accnt_no}
             </if>             
             <if test="cell != null and cell != ''">
			    AND MB.CELL1 = REPLACE( #{cell}, '-', '')
			</if>
            <if test="dpms_resl_cntn != null and dpms_resl_cntn != ''">
                AND  TCA.DPMS_RESL_CNTN LIKE #{dpms_resl_cntn} || '%'
            </if>  
               ) B
            WHERE 1=1
            <if test="alct_yn != null and alct_yn != ''">
                AND  ALCT_YN= #{alct_yn}
            </if>
        <if test="startLine != null and startLine != '' and endLine != null and endLine != ''">
            <![CDATA[
               AND PAGE_INDX >= #{startLine}
               AND PAGE_INDX < #{endLine}
            ]]>
        </if>
    </select>
    
    <update id="TrgtCustAlctMap.updateChangeMangiCnsr" parameterType="map">
        UPDATE /* TrgtCustAlctMap.updateChangeMangiCnsr 사용*/
               TB_TRGT_CUST_ALCT
           SET CNSR_ID = #{user_id}
             , AMND_ID = #{amnd_id}
             , AMNT_DTTM = TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
         WHERE CNSR_ID = #{cnsr_id}
           AND TRGT_CUST_DTPT_ID = #{trgt_cust_dtpt_id}
           AND ((SELECT ADTL_CD FROM TB_CD WHERE CD = DPMS_RESL_CD  AND CD_SET_CD = 'CAM090') = '99'
           OR (SELECT ADTL_CD FROM TB_CD WHERE CD = DPMS_RESL_CD  AND CD_SET_CD = 'CAM090') IS NULL)
    </update>
    
    <insert id="TrgtCustAlctMap.insertTgtCustMangiAlct" parameterType="map">
        <selectKey keyProperty="trgt_cust_dtpt_id" resultType="String" order="BEFORE">
            SELECT ('TAR' || TO_CHAR(SYSDATE, 'YYYYMMDD') || LPAD(SEQ_COMMON.NEXTVAL, 7, '0')) FROM DUAL
        </selectKey>
        
        BEGIN
        
        INSERT /* TrgtCustAlctMap.insertTgtCustMangiAlct */
          INTO TB_TRGT_CUST_ALCT
              (CMPG_ID, TRGT_LIST_ID, SUB_TRGT_LIST_ID, TRGT_CUST_DTPT_ID
             , CNSR_ID, DPMS_STAT_CD, DPMS_TMCNT, CNTR_CD
             , RGSR_ID, RGSN_DTTM, AMND_ID, AMNT_DTTM)
        VALUES (#{cmpg_id}, #{trgt_list_id}, (SELECT SUB_TRGT_LIST_ID
                                              FROM TB_SUB_TRGT_LIST_DTL
         									  WHERE TRGT_LIST_ID = #{trgt_list_id}), #{trgt_cust_dtpt_id}
              , #{user_id}, '10', 0, #{cntr_cd}
              , #{rgsr_id}, TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS'), #{amnd_id}, TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
              );
        
        INSERT INTO TB_MANGI_TARGET 
        (MEM_NO, ACCNT_NO, CMPG_ID, TRGT_LIST_ID, SUB_TRGT_LIST_ID, TRGT_CUST_DTPT_ID, REG_MAN, REG_DM)
        VALUES
        (#{mem_no}, #{accnt_no}, #{cmpg_id}, #{trgt_list_id}, (SELECT SUB_TRGT_LIST_ID
				                                               FROM TB_SUB_TRGT_LIST_DTL
				         									   WHERE TRGT_LIST_ID = #{trgt_list_id}), #{trgt_cust_dtpt_id}, #{rgsr_id}, SYSDATE);
        
        END;
    </insert>
    
    <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctMangiCountExcel" parameterType="map" resultType="int">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctMangiCountExcel */
		   COUNT(*)
		FROM (SELECT RS.RESN_ACPT_DAY,
                     MB.MEM_NM,
                     MB.CELL,
                     TCA.CNSR_ID,
                     NVL((SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID),'미정') AS CNSR_NM,
                     (CASE WHEN NVL(TCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
                     GETCODENM('CAM100', TCA.DPMS_STAT_CD, 'CCA') AS DPMS_STAT_NM,
                     GETCODENM('CAM090', TCA.DPMS_RESL_CD, 'CCA') AS DPMS_RESL_NM,
                     TCA.DPMS_RESL_CNTN, --상담메모
                     MPA.ACCNT_NO,
                     MPA.MEM_NO
                FROM LF_DMUSER.MEM_PROD_ACCNT MPA 
                     INNER JOIN LF_DMUSER.MEMBER MB ON MPA.MEM_NO = MB.MEM_NO AND MB.DEL_FG = 'N'
                     INNER JOIN LF_DMUSER.RESCISSION RS ON MPA.ACCNT_NO = RS.ACCNT_NO AND RS.DEL_FG = 'N' AND RS.RESON = '23' AND NVL(RESN_PROC_YN,'N') != 'Y'
                     LEFT OUTER JOIN TB_MANGI_TARGET MT ON MPA.ACCNT_NO = MT.ACCNT_NO
                     LEFT OUTER JOIN TB_TRGT_CUST_ALCT TCA ON MT.CMPG_ID = TCA.CMPG_ID AND MT.TRGT_LIST_ID = TCA.TRGT_LIST_ID AND MT.SUB_TRGT_LIST_ID = TCA.SUB_TRGT_LIST_ID AND MT.TRGT_CUST_DTPT_ID = TCA.TRGT_CUST_DTPT_ID
                WHERE 1=1
                AND LENGTH(NVL(MB.IDN_NO, 'N')) != 10
                AND MPA.DEL_FG = 'N'
                AND MPA.KSTBIT = '03'
			<if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                AND RS.RESN_ACPT_DAY BETWEEN REPLACE(#{stt_dt}, '-', '')  AND REPLACE(#{end_dt}, '-', '')
            </if>
            <if test="dpms_resl_cd != null and dpms_resl_cd != ''">
               AND TCA.DPMS_RESL_CD = #{dpms_resl_cd}
            </if>
            <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
               AND TCA.DPMS_STAT_CD = #{dpms_stat_cd}
            </if>
			<if test="cnsr_id != null and cnsr_id != ''">
               AND  TCA.CNSR_ID = #{cnsr_id}
            </if>
            <if test="mem_nm != null and mem_nm != ''">
                AND  MB.MEM_NM LIKE #{mem_nm} || '%'
             </if>
             <if test="cell != null and cell != ''">
			    AND MB.CELL1 = REPLACE( #{cell}, '-', '')
			</if>
            <if test="dpms_resl_cntn != null and dpms_resl_cntn != ''">
                AND  TCA.DPMS_RESL_CNTN LIKE #{dpms_resl_cntn} || '%'
            </if>  
               ) B
            WHERE 1=1
            <if test="alct_yn != null and alct_yn != ''">
                AND  ALCT_YN= #{alct_yn}
            </if>
    </select>
    
    <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctMangilistExcel" parameterType="map" resultType="resultMap">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctMangilistExcel */
		   *
		   
		FROM (SELECT ROW_NUMBER() OVER(ORDER BY RS.RESN_ACPT_DAY DESC) AS PAGE_INDX,
		             RS.RESN_ACPT_DAY,
                     MB.MEM_NM,
                     MB.CELL,
                     TCA.CNSR_ID,
                     NVL((SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID),'미정') AS CNSR_NM,
                     (CASE WHEN NVL(TCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
                     GETCODENM('CAM100', TCA.DPMS_STAT_CD, 'CCA') AS DPMS_STAT_NM,
                     GETCODENM('CAM090', TCA.DPMS_RESL_CD, 'CCA') AS DPMS_RESL_NM,
                     TCA.DPMS_RESL_CNTN, --상담메모
                     MPA.ACCNT_NO,
                     MPA.MEM_NO
                FROM LF_DMUSER.MEM_PROD_ACCNT MPA 
                     INNER JOIN LF_DMUSER.MEMBER MB ON MPA.MEM_NO = MB.MEM_NO AND MB.DEL_FG = 'N'
                     INNER JOIN LF_DMUSER.RESCISSION RS ON MPA.ACCNT_NO = RS.ACCNT_NO AND RS.DEL_FG = 'N' AND RS.RESON = '23' AND NVL(RESN_PROC_YN,'N') != 'Y'
                     LEFT OUTER JOIN TB_MANGI_TARGET MT ON MPA.ACCNT_NO = MT.ACCNT_NO
                     LEFT OUTER JOIN TB_TRGT_CUST_ALCT TCA ON MT.CMPG_ID = TCA.CMPG_ID AND MT.TRGT_LIST_ID = TCA.TRGT_LIST_ID AND MT.SUB_TRGT_LIST_ID = TCA.SUB_TRGT_LIST_ID AND MT.TRGT_CUST_DTPT_ID = TCA.TRGT_CUST_DTPT_ID
                WHERE 1=1
                AND LENGTH(NVL(MB.IDN_NO, 'N')) != 10
                AND MPA.DEL_FG = 'N'
                AND MPA.KSTBIT = '03'
			<if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                AND RS.RESN_ACPT_DAY BETWEEN REPLACE(#{stt_dt}, '-', '')  AND REPLACE(#{end_dt}, '-', '')
            </if>
            <if test="dpms_resl_cd != null and dpms_resl_cd != ''">
               AND TCA.DPMS_RESL_CD = #{dpms_resl_cd}
            </if>
            <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
               AND TCA.DPMS_STAT_CD = #{dpms_stat_cd}
            </if>
			<if test="cnsr_id != null and cnsr_id != ''">
               AND  TCA.CNSR_ID = #{cnsr_id}
            </if>
            <if test="mem_nm != null and mem_nm != ''">
                AND  MB.MEM_NM LIKE #{mem_nm} || '%'
             </if>
             <if test="cell != null and cell != ''">
			    AND MB.CELL1 = REPLACE( #{cell}, '-', '')
			</if>
            <if test="dpms_resl_cntn != null and dpms_resl_cntn != ''">
                AND  TCA.DPMS_RESL_CNTN LIKE #{dpms_resl_cntn} || '%'
            </if>  
               ) B
            WHERE 1=1
            <if test="alct_yn != null and alct_yn != ''">
                AND  ALCT_YN= #{alct_yn}
            </if>
    </select>
    
    <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctMainMangiCount" parameterType="map" resultType="int">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctMainMangiCount */
		   COUNT(*)
		FROM (SELECT 
				    ROW_NUMBER() OVER(ORDER BY TCA.RGSN_DTTM DESC) AS PAGE_INDX,
				    MB.MEM_NO,
				    MB.CELL,
				    (CASE WHEN NVL(TCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
				    TCA.CNSR_ID,
				    (SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID) AS USER_NM,
				    TCA.DPMS_TMCNT,
				    TO_CHAR(TCA.DPMS_DTTM, 'YYYYMMDDHH24MISS') AS DPMS_DTTM,
				    TCA.DPMS_RESL_CD,
				    TCA.DPMS_STAT_CD,
				    TCA.CTI_CRNC_DTL_ID,
				    '' AS ETC_TLNO,
				    GETCODENM('CAM090', TCA.DPMS_RESL_CD, TCA.CNTR_CD) AS DPMS_RESL_NM,
				    GETCODENM('CAM100', TCA.DPMS_STAT_CD, TCA.CNTR_CD) AS DPMS_STAT_NM,
				    GETCODENM('CAM180', TCA.DPMS_GBN_CD, TCA.CNTR_CD) AS DPMS_GBN_NM,
				    TCA.DPMS_RESL_CNTN,
				    TCA.PROD_JOIN_YN ,
				    TCA.DPMS_TLPH_DIV_CD ,
				    TCA.DPMS_TLNO,
				    TCA.TRGT_LIST_ID,
				    TCA.CMPG_ID,
				    TCA.SUB_TRGT_LIST_ID,
				    TCA.CNTR_CD,
				    TCA.TRGT_CUST_DTPT_ID,
				    TCA.RESERVE_PROC_DT, 	/* 예약일자 */
				    TCA.RESERVE_PROC_TM,	/* 예약시간 */
				    NVL((SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID),'미정') AS CNSR_NM,
				    (SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.AMND_ID) AS AMND_NM,
				    TCA.DPMS_GBN_CD,
				    MB.MEM_NM AS CUST_NM,
				    MPA.MEM_NO,
				    MPA.ACCNT_NO,
				    ST.INVT_CNTS_ID ,
				    ST.SUB_TRGT_LIST_NM,
				    ST.CMPG_PRFM_TEAM_CD,
				    MB.CELL AS CLPH_TLNO,
				    TCA.RGSN_DTTM
				FROM TB_TRGT_CUST_ALCT TCA INNER JOIN
				    TB_MANGI_TARGET TA ON TCA.TRGT_CUST_DTPT_ID = TA.TRGT_CUST_DTPT_ID LEFT OUTER JOIN
				    LF_DMUSER.MEM_PROD_ACCNT MPA ON TA.ACCNT_NO = MPA.ACCNT_NO AND MPA.DEL_FG = 'N' LEFT OUTER JOIN
				    LF_DMUSER.MEMBER MB ON MB.MEM_NO = MPA.MEM_NO AND MB.DEL_FG = 'N' LEFT OUTER JOIN
				    LF_DMUSER.PRODUCT PD ON MPA.PROD_CD = PD.PROD_CD LEFT OUTER JOIN
				    TB_SUB_TRGT_LIST_DTL ST ON TCA.CNTR_CD = ST.CNTR_CD AND TCA.TRGT_LIST_ID = ST.TRGT_LIST_ID AND TCA.SUB_TRGT_LIST_ID=ST.SUB_TRGT_LIST_ID
				WHERE 1=1
			AND TCA.CNSR_ID = #{user_id}
			<if test="cmpg_stt_dt != null and cmpg_stt_dt != '' and cmpg_end_dt != null and cmpg_end_dt != ''">
                AND TCA.RGSN_DTTM BETWEEN #{cmpg_stt_dt} || '000000'  AND #{cmpg_end_dt} || '235959'
            </if>
            <if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                AND TCA.DPMS_DTTM BETWEEN #{stt_dt} || '000000'  AND #{end_dt} || '235959'
            </if>
            <if test="cust_nm != null and cust_nm != ''">
                AND MB.MEM_NM LIKE #{cust_nm} || '%'
            </if>
            <if test="tell_no != null and tell_no != ''">
               AND MB.CELL1 = REPLACE(#{tell_no}, '-', '')
            </if>
            <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
               AND TCA.DPMS_STAT_CD = #{dpms_stat_cd}
            </if>
            <if test="dpms_resl_cd != null and dpms_resl_cd != ''">
               AND TCA.DPMS_RESL_CD = #{dpms_resl_cd}
            </if>
            <if test="user_defn1_cntn != null and user_defn1_cntn != ''">
               AND TO_CHAR(MPA.REG_DM, 'YYYYMMDD') = REPLACE(#{user_defn1_cntn}, '-', '') 
            </if>
            <if test="user_defn2_cntn != null and user_defn2_cntn != ''">
               AND PD.PROD_NM LIKE #{user_defn2_cntn} || '%'
            </if>
               ) B
    </select>
    
    <!-- 사용 -->
    <select id="TrgtCustAlctMap.getNewTypeTrgtCustAlctMainMangiList" parameterType="map" resultType="resultMap">
		SELECT /* TrgtCustAlctMap.getNewTypeTrgtCustAlctMainMangiList */
		   *
		   
		FROM (SELECT 
				    ROW_NUMBER() OVER(ORDER BY TCA.RGSN_DTTM DESC) AS PAGE_INDX,
				    MB.MEM_NM,
				    MB.CELL,
				    (CASE WHEN NVL(TCA.CNSR_ID,'N') = 'N' THEN 'N' ELSE 'Y' END) ALCT_YN,
				    TCA.CNSR_ID,
				    (SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID) AS USER_NM,
				    TCA.DPMS_TMCNT,
				    TO_CHAR(TCA.DPMS_DTTM, 'YYYYMMDDHH24MISS') AS DPMS_DTTM,
				    TCA.DPMS_RESL_CD,
				    TCA.DPMS_STAT_CD,
				    TCA.CTI_CRNC_DTL_ID,
				    '' AS ETC_TLNO,
				    GETCODENM('CAM090', TCA.DPMS_RESL_CD, TCA.CNTR_CD) AS DPMS_RESL_NM,
				    GETCODENM('CAM100', TCA.DPMS_STAT_CD, TCA.CNTR_CD) AS DPMS_STAT_NM,
				    GETCODENM('CAM180', TCA.DPMS_GBN_CD, TCA.CNTR_CD) AS DPMS_GBN_NM,
				    TCA.DPMS_RESL_CNTN,
				    TCA.PROD_JOIN_YN ,
				    TCA.DPMS_TLPH_DIV_CD ,
				    TCA.DPMS_TLNO,
				    TCA.TRGT_LIST_ID,
				    TCA.CMPG_ID,
				    TCA.SUB_TRGT_LIST_ID,
				    TCA.CNTR_CD,
				    TCA.TRGT_CUST_DTPT_ID,
				    TCA.RESERVE_PROC_DT, 	/* 예약일자 */
				    TCA.RESERVE_PROC_TM,	/* 예약시간 */
				    NVL((SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.CNSR_ID),'미정') AS CNSR_NM,
				    (SELECT USER_NM FROM TB_USER WHERE USER_ID = TCA.AMND_ID) AS AMND_NM,
				    TCA.DPMS_GBN_CD,
				    MB.MEM_NM AS CUST_NM,
				    MPA.MEM_NO,
				    MPA.ACCNT_NO,
				    ST.INVT_CNTS_ID ,
				    ST.SUB_TRGT_LIST_NM,
				    ST.CMPG_PRFM_TEAM_CD,
				    MB.CELL AS CLPH_TLNO,
				    TCA.RGSN_DTTM,
				    TO_CHAR(MPA.REG_DM, 'YYYY-MM-DD') AS USER_DEFN1_CNTN,
				    PD.PROD_NM AS USER_DEFN2_CNTN,
				    '' AS USER_DEFN3_CNTN,
				    '' AS USER_DEFN4_CNTN,     
				    '' AS USER_DEFN5_CNTN,     
				    '' AS USER_DEFN6_CNTN,
				    '' AS USER_DEFN7_CNTN,
				    '' AS USER_DEFN8_CNTN,
				    '' AS USER_DEFN9_CNTN,
				    '' AS USER_DEFN10_CNTN
				FROM TB_TRGT_CUST_ALCT TCA INNER JOIN
				    TB_MANGI_TARGET TA ON TCA.TRGT_CUST_DTPT_ID = TA.TRGT_CUST_DTPT_ID LEFT OUTER JOIN
				    LF_DMUSER.MEM_PROD_ACCNT MPA ON TA.ACCNT_NO = MPA.ACCNT_NO AND MPA.DEL_FG = 'N' LEFT OUTER JOIN
				    LF_DMUSER.MEMBER MB ON MB.MEM_NO = MPA.MEM_NO AND MB.DEL_FG = 'N' LEFT OUTER JOIN
				    LF_DMUSER.PRODUCT PD ON MPA.PROD_CD = PD.PROD_CD LEFT OUTER JOIN
				    TB_SUB_TRGT_LIST_DTL ST ON TCA.CNTR_CD = ST.CNTR_CD AND TCA.TRGT_LIST_ID = ST.TRGT_LIST_ID AND TCA.SUB_TRGT_LIST_ID=ST.SUB_TRGT_LIST_ID
				WHERE 1=1
			AND TCA.CNSR_ID = #{user_id}
			<if test="cmpg_stt_dt != null and cmpg_stt_dt != '' and cmpg_end_dt != null and cmpg_end_dt != ''">
                AND TCA.RGSN_DTTM BETWEEN #{cmpg_stt_dt} || '000000'  AND #{cmpg_end_dt} || '235959'
            </if>
            <if test="stt_dt != null and stt_dt != '' and end_dt != null and end_dt != ''">
                AND TCA.DPMS_DTTM BETWEEN #{stt_dt} || '000000'  AND #{end_dt} || '235959'
            </if>
            <if test="cust_nm != null and cust_nm != ''">
                AND MB.MEM_NM LIKE #{cust_nm} || '%'
            </if>
            <if test="tell_no != null and tell_no != ''">
               AND MB.CELL1 = REPLACE(#{tell_no}, '-', '')
            </if>
            <if test="dpms_stat_cd != null and dpms_stat_cd != ''">
               AND TCA.DPMS_STAT_CD = #{dpms_stat_cd}
            </if>
            <if test="dpms_resl_cd != null and dpms_resl_cd != ''">
               AND TCA.DPMS_RESL_CD = #{dpms_resl_cd}
            </if>
            <if test="user_defn1_cntn != null and user_defn1_cntn != ''">
               AND TO_CHAR(MPA.REG_DM, 'YYYYMMDD') = REPLACE(#{user_defn1_cntn}, '-', '') 
            </if>
            <if test="user_defn2_cntn != null and user_defn2_cntn != ''">
               AND PD.PROD_NM LIKE #{user_defn2_cntn} || '%'
            </if>
            ) B
        <if test="startLine != null and startLine != '' and endLine != null and endLine != ''">
            <![CDATA[
             WHERE PAGE_INDX >= #{startLine}
               AND PAGE_INDX < #{endLine}
            ]]>
        </if>
    </select>
</mapper>
