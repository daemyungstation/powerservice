<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="Frame_Todo_Test" classname="Frame_Todo" inheritanceid="" position="absolute 0 0 849 264" scrollbars="none" onload="Frame_Todo_onload" ontimer="totalCount_ontimer">
    <Layouts>
      <Layout>
        <Div id="Div00" taborder="11" position="absolute 4 1 844 254" style="background:blanchedalmond;">
          <Layouts>
            <Layout width="840" height="253"/>
          </Layouts>
        </Div>
        <Static id="Static17" position="absolute -4 1 -2 27" style="background:transparent URL('IMG::img_todo_line.png') repeat-y;"/>
        <Static id="Static00" position="absolute -1 46 0 112" style="background:black;color:black;"/>
        <Button id="btn_miniBoard" taborder="4" text="미니전광판 해제" style="padding:0 0 0 0;" onclick="btn_miniBoard_onclick" position2="absolute r:15 w:100 t:36 h:20" positiontype="position2"/>
        <Static id="Static01" position="absolute 135 8 137 20" style="background:transparent URL('IMG::img_todo_line.png') repeat-y;"/>
        <Static id="stc_todo_cnt04" text="12" onclick="todo_onclick" position="absolute 204 5 225 24" style="color:#f96400ff;padding:0 0 0 0;align:center middle;font:Dotum,9,bold;" tabstop="false"/>
        <Static id="stc_todo_cnt13" text="대기호" onclick="todo_onclick" position="absolute 162 5 202 24" style="color:#707070ff;align:center middle;"/>
        <Static id="Static02" position="absolute 241 8 243 20" style="background:transparent URL('IMG::img_todo_line.png') repeat-y;"/>
        <Static id="stc_todo_cnt21" text="인콜" onclick="todo_onclick" position="absolute 262 5 302 24" style="color:#707070ff;align:center middle;"/>
        <Static id="stc_todo_cnt23" text="인콜타임" onclick="todo_onclick" position="absolute 341 5 401 24" style="color:#707070ff;"/>
        <Static id="inTimeText" text="00:00:00" onclick="todo_onclick" position="absolute 392 5 452 24" style="color:#f96400ff;padding:0 0 0 0;align:center middle;font:Dotum,9,bold;" tabstop="false"/>
        <Static id="outTimeText" text="00:00:00" onclick="todo_onclick" position="absolute 647 5 707 24" style="color:#f96400ff;padding:0 0 0 0;align:center middle;font:Dotum,9,bold;" tabstop="false"/>
        <Static id="stc_todo_cnt26" text="아웃콜타임" onclick="todo_onclick" position="absolute 584 5 655 24" style="color:#707070ff;"/>
        <Static id="stc_todo_cnt28" text="아웃콜" onclick="todo_onclick" position="absolute 495 5 535 24" style="color:#707070ff;align:center middle;"/>
        <Static id="Static03" position="absolute 468 8 470 20" style="background:transparent URL('IMG::img_todo_line.png') repeat-y;"/>
        <Static id="stc_todo_cnt30" onclick="todo_onclick" position="absolute 156 11 160 17" style="background:transparent URL('IMG::ico_headinfo.png');"/>
        <Static id="stc_todo_cnt31" onclick="todo_onclick" position="absolute 262 11 266 17" style="background:transparent URL('IMG::ico_headinfo.png');"/>
        <Static id="stc_todo_cnt32" onclick="todo_onclick" position="absolute 333 11 337 17" style="background:transparent URL('IMG::ico_headinfo.png');"/>
        <Static id="stc_todo_cnt33" onclick="todo_onclick" position="absolute 489 11 493 17" style="background:transparent URL('IMG::ico_headinfo.png');"/>
        <Static id="stc_todo_cnt34" onclick="todo_onclick" position="absolute 576 11 580 17" style="background:transparent URL('IMG::ico_headinfo.png');"/>
        <Button id="Button05" taborder="5" text="시작" onclick="Button05_onclick" position="absolute 16 40 79 77"/>
        <Button id="Button06" taborder="6" text="정지" onclick="Button06_onclick" position="absolute 83 40 146 77"/>
        <Button id="Button03" taborder="7" text="시작" onclick="Button03_onclick" position="absolute 17 80 80 117"/>
        <Button id="Button04" taborder="8" text="정지" onclick="Button04_onclick" position="absolute 83 79 146 116"/>
        <Static id="ctiStatusTime" text="00:00:00" onclick="todo_onclick" position="absolute 59 5 119 24" style="color:#f96400ff;padding:0 0 0 0;align:center middle;font:Dotum,9,bold;" tabstop="false"/>
        <Static id="ctiStatusName" text="상태" onclick="todo_onclick" position="absolute 8 5 68 24" style="color:#707070ff;"/>
        <Static id="stc_todo_cnt02" onclick="todo_onclick" position="absolute 0 11 4 17" style="background:transparent URL('IMG::ico_headinfo.png');"/>
        <Static id="stc_todo_cnt00" text="999" onclick="todo_onclick" position="absolute 535 5 568 24" style="color:#f96400ff;padding:0 0 0 0;align:center middle;font:Dotum,9,bold;" tabstop="false"/>
        <Static id="stc_todo_cnt01" text="999" onclick="todo_onclick" position="absolute 296 5 329 24" style="color:#f96400ff;padding:0 0 0 0;align:center middle;font:Dotum,9,bold;" tabstop="false"/>
        <Button id="Button00" taborder="9" text="CLOSE" onclick="Button04_onclick" position="absolute 752 5 815 28"/>
        <Combo id="cbo_markt_agr_yn" taborder="10" displaynulltext="선택" codecolumn="codecolumn" datacolumn="datacolumn" position="absolute 248 46 509 66">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn"/>
                <Col id="datacolumn">선택</Col>
              </Row>
              <Row>
                <Col id="codecolumn">Y</Col>
                <Col id="datacolumn">예</Col>
              </Row>
              <Row>
                <Col id="codecolumn">N</Col>
                <Col id="datacolumn">아니오</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1</Col>
                <Col id="datacolumn">3</Col>
              </Row>
              <Row>
                <Col id="codecolumn">2</Col>
                <Col id="datacolumn">3</Col>
              </Row>
              <Row>
                <Col id="codecolumn">3</Col>
                <Col id="datacolumn">3</Col>
              </Row>
              <Row>
                <Col id="codecolumn">4</Col>
                <Col id="datacolumn">3</Col>
              </Row>
              <Row>
                <Col id="codecolumn">4</Col>
                <Col id="datacolumn">3</Col>
              </Row>
              <Row>
                <Col id="codecolumn">5</Col>
                <Col id="datacolumn">1</Col>
              </Row>
            </Rows>
          </Dataset>
        </Combo>
        <Button id="Button01" taborder="12" text="시작" position="absolute 17 121 80 158" onclick="Button01_onclick"/>
        <Button id="Button02" taborder="13" text="정지" onclick="Button04_onclick" position="absolute 83 120 146 157"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_MenuAll" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_MenuM" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_MenuS" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_trans_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="strSvcID" type="STRING" size="256"/>
          <Column id="strURL" type="STRING" size="256"/>
          <Column id="strInDatasets" type="STRING" size="256"/>
          <Column id="strOutDatasets" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_miniBoardData" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="open_cnt" type="STRING" size="256"/>
          <Column id="proc_cnt" type="STRING" size="256"/>
          <Column id="close_cnt" type="STRING" size="256"/>
          <Column id="trans_cnt" type="STRING" size="256"/>
          <Column id="todo_cnt" type="STRING" size="256"/>
          <Column id="recrnc_cnt" type="STRING" size="256"/>
          <Column id="recrnc_alarm_cnt" type="STRING" size="256"/>
          <Column id="calb_cnt" type="STRING" size="256"/>
          <Column id="hpcl_cnt" type="STRING" size="256"/>
          <Column id="cons_trct_cnt" type="STRING" size="256"/>
          <Column id="new_nmsg_cnt" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_userNm" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="userNm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_user" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="team_nm" type="STRING" size="256"/>
          <Column id="athr_cd" type="STRING" size="256"/>
          <Column id="cti_id" type="STRING" size="256"/>
          <Column id="pwd_amnt_dttm" type="STRING" size="256"/>
          <Column id="urgn_tlno" type="STRING" size="256"/>
          <Column id="cntr_cd" type="STRING" size="256"/>
          <Column id="empl_no" type="STRING" size="256"/>
          <Column id="memo_no" type="STRING" size="256"/>
          <Column id="dual_mont_yn" type="STRING" size="256"/>
          <Column id="duty_nm" type="STRING" size="256"/>
          <Column id="pty_grop_no" type="STRING" size="256"/>
          <Column id="actv_log_yn" type="STRING" size="256"/>
          <Column id="blng_comp_nm" type="STRING" size="256"/>
          <Column id="rgsn_dttm" type="STRING" size="256"/>
          <Column id="athr_nm" type="STRING" size="256"/>
          <Column id="prcnt_no" type="STRING" size="256"/>
          <Column id="rec_ip_addr" type="STRING" size="256"/>
          <Column id="page_indx" type="STRING" size="256"/>
          <Column id="lgn_id" type="STRING" size="256"/>
          <Column id="home_dtpt_addr" type="STRING" size="256"/>
          <Column id="use_yn" type="STRING" size="256"/>
          <Column id="main_mont_rslu_cd" type="STRING" size="256"/>
          <Column id="user_stat_nm" type="STRING" size="256"/>
          <Column id="team_cd" type="STRING" size="256"/>
          <Column id="astn_mont_rslu_cd" type="STRING" size="256"/>
          <Column id="clph_no" type="STRING" size="256"/>
          <Column id="user_id" type="STRING" size="256"/>
          <Column id="rgsr_id" type="STRING" size="256"/>
          <Column id="mac_addr" type="STRING" size="256"/>
          <Column id="hgrn_team_nm" type="STRING" size="256"/>
          <Column id="extn_no" type="STRING" size="256"/>
          <Column id="athr_gds_cd" type="STRING" size="256"/>
          <Column id="user_typ_cd" type="STRING" size="256"/>
          <Column id="hgrn_team_cd" type="STRING" size="256"/>
          <Column id="duty_cd" type="STRING" size="256"/>
          <Column id="amnd_nm" type="STRING" size="256"/>
          <Column id="rtco_dt" type="STRING" size="256"/>
          <Column id="brdt" type="STRING" size="256"/>
          <Column id="pwd" type="STRING" size="256"/>
          <Column id="lgn_dttm" type="STRING" size="256"/>
          <Column id="cons_bswr_typ_nm" type="STRING" size="256"/>
          <Column id="cons_bswr_typ_cd" type="STRING" size="256"/>
          <Column id="role" type="STRING" size="256"/>
          <Column id="file_id" type="STRING" size="256"/>
          <Column id="pwd_amnt_yn" type="STRING" size="256"/>
          <Column id="tlno" type="STRING" size="256"/>
          <Column id="emil_addr" type="STRING" size="256"/>
          <Column id="amnt_dttm" type="STRING" size="256"/>
          <Column id="user_nm" type="STRING" size="256"/>
          <Column id="user_stat_cd" type="STRING" size="256"/>
          <Column id="user_typ_nm" type="STRING" size="256"/>
          <Column id="ip_addr" type="STRING" size="256"/>
          <Column id="amnd_id" type="STRING" size="256"/>
          <Column id="cntr_nm" type="STRING" size="256"/>
          <Column id="cti_use_yn" type="STRING" size="256"/>
          <Column id="user_expi" type="STRING" size="256"/>
          <Column id="last_logout_dttm" type="STRING" size="256"/>
          <Column id="rgsr_nm" type="STRING" size="256"/>
          <Column id="zpcd" type="STRING" size="256"/>
          <Column id="acd_grop_no" type="STRING" size="256"/>
          <Column id="enco_dt" type="STRING" size="256"/>
          <Column id="athn_falr_tmcnt" type="STRING" size="256"/>
          <Column id="home_addr" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="outCallCount" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="outCallCount" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="inCallCount" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="inCallCount" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item2" compid="stc_todo_cnt00" propid="text" datasetid="outCallCount" columnid="outCallCount"/>
      <BindItem id="item1" compid="stc_todo_cnt01" propid="text" datasetid="inCallCount" columnid="inCallCount"/>
      <BindItem id="item0" compid="cbo_markt_agr_yn" propid="value" datasetid="ds_member" columnid="markt_agr_yn"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[/**
 * Program ID  		: Frame_Todo
 * Program Name    	: 상담관리 - Top Todo
 * Author          	: hyeonsuk.Ryu
 * Created On      	: 2016-01-30
 * Description      : 상담관리 - Top
 */

/********************************************************************************************/
/* 페이지 로드시 실행될 함수                          */
/********************************************************************************************/

/*
function Frame_Todo_onload(obj:Form, e:LoadEventInfo)
{
	trace("테스트!!!");
}
*/
 
/********************************************************************************************/
/* 1. Include Library include, variables Declaration 영역                                  */
/********************************************************************************************/
include "LIB::lib_All.xjs"; 
include "LIB::lib_CTIButton_Gen.xjs";

var srch_mini_board_flag = true; // 미니보드 사용여부
var ctmpCntFlag = false; // ctmp 대기상담원, 대기회원수 조회여부


var globalIn = false;
var globalOut = false;
var globalTest = false;

/********************************************************************************************/
/* 2. Form 관련(onload 및 Form 이벤트) 처리                                           	*/
/********************************************************************************************/

/********************************************************************************************/
/* 3. Callback(gfn_Transaction 호출 후 처리내용)                                   		*/
/********************************************************************************************/
function fn_callBack(svcid, errcd, errmsg) 
{
	if (errcd != 0) {
		trace("Frame_Todo" + svcid + " Callback [" + errcd + "] " + errmsg);
		if (errmsg.indexOf("[AccessSession") == 0) { // 세션 오류
		    form.killTimer(1);
		    alert("[세션 오류] 프로그램이 종료 됩니다.");
		    exit();
		} else if (errmsg.indexOf("[UserSession") == 0) { // 중복 로그인 오류
		    form.killTimer(1);
		    alert("[중복 로그인 오류] 프로그램이 종료 됩니다.");
		    exit();
		}
		return false;
	}
	
	switch (svcid) {
		case "srchMiniBoardData":
			//trace(ds_miniBoardData.saveXML());
			// 상담업무일 경우에만 출력
			if (GV_SYSTEMDIV != "DLCC") {
				break;
			}
			if (ds_miniBoardData.rowcount < 1) {
				break;
			}
			// TODO
			// stc_todo_cnt3.text = ds_miniBoardData.getColumn(0, "todo_cnt"); 	// 미처리 건수
			stc_recrnc_cnt3.text = ds_miniBoardData.getColumn(0, "recrnc_cnt"); // 재통화 건수
			stc_calb_cnt3.text = ds_miniBoardData.getColumn(0, "calb_cnt"); 	// IVR콜백 건수
			stc_voc_cnt3.text = ds_miniBoardData.getColumn(0, "hpcl_cnt"); 		// VOC 건수
			stc_cons_trct_cnt3.text = ds_miniBoardData.getColumn(0, "cons_trct_cnt"); // 상담이관 건수
			
			// 상담현황
			var sOpenCnt = ds_miniBoardData.getColumn(0, "open_cnt"); 	// 접수
			var sProcCnt = ds_miniBoardData.getColumn(0, "proc_cnt"); 	// 처리중
			var sCloseCnt = ds_miniBoardData.getColumn(0, "close_cnt"); // 처리완료
			var sTransCnt = ds_miniBoardData.getColumn(0, "trans_cnt"); // 이관
			stc_ing_cnt.text = Number(sOpenCnt) + Number(sProcCnt) + Number(sTransCnt); // 처리중 건수
			stc_end_cnt.text = sCloseCnt; 								// 상담완료 건수
			
			var sRecrncAlarmCnt = ds_miniBoardData.getColumn(0, "recrnc_alarm_cnt");	// 재통화건수
			if (sRecrncAlarmCnt > 0) {
				application.mainframe.VFrameSet.BottomFrame.form.img_cnt.image = "URL('IMG::img_recrnc_cnt.gif')";
				application.mainframe.VFrameSet.BottomFrame.form.stc_alarmCnt.text = sRecrncAlarmCnt;
				
				application.mainframe.VFrameSet.BottomFrame.form.img_cnt.visible = true;
				application.mainframe.VFrameSet.BottomFrame.form.stc_alarmCnt.visible = true;
				//application.mainframe.VFrameSet.BottomFrame.form.stc_alarm_txt.text = "10분 내에 처리해야 하는 예약통화 " + sRecrncAlarmCnt + " 건이 있습니다."; 
			} else {
				application.mainframe.VFrameSet.BottomFrame.form.img_cnt.visible = false;
				application.mainframe.VFrameSet.BottomFrame.form.stc_alarmCnt.visible = false;
				//application.mainframe.VFrameSet.BottomFrame.form.stc_alarm_txt.text = "";
			}
			
			// 새 쪽지 건수
			var nNewNmsgCnt = ds_miniBoardData.getColumn(0, "new_nmsg_cnt");
			application.mainframe.titlebar.div_Title_R.sta_NmsgCnt.text = nNewNmsgCnt;
		break;
		
		case "pgmAthr":
			var sFilter  = "pgm_cd.toString().indexOf('MN') >= 0 && gds_cd=='1'";
			gds_Pgm.filter(sFilter);
		break;
	}
}

/********************************************************************************************/
/**   4. Validation 처리                                                                   	*/
/********************************************************************************************/




/********************************************************************************************/
/**   5. 서비스 호출(gfn_Transaction)                                                   	*/
/********************************************************************************************/
// 프로그램별 권한정보 설정
function fn_pgm_athr()
{	
	var szSvcid       = "pgmAthr";
	var szController  = "/syst/pgm-athr/list";
	var szInDs        = "";
	var szOutDs       = "gds_Pgm=ds_output";
	var szParam       = "menu_flag=Y";
	//var szParam       = "menu_flag=Y gds_cd=1";
	var szRetCallback = "fn_callBack";

	// 트랜젝션 공통함수 호출
	gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback);
}

// 상담현황정보 타이머 설정
function fn_getMiniBoardDataStart()
{	
	fn_getMiniBoardData();
	
	if (gds_UserInfo.getColumn(0, "cti_use_yn") == "Y" && ap_TopFrame.form.gv_ctiSrvrConnSucc == 1) {
		ctmpCntFlag = true;
	}
	
	setTimer(1, 10000);
}

function fn_setCtmpCnt()
{
	ap_TopFrame.form.callCtmpMethod("AgentReadyGet");
	ap_TopFrame.form.callCtmpMethod("WaitTimeGet");
}

// info total count
function fn_getMiniBoardData()
{	
    // 대기고객수, 대기상담사수 API 확인
    // CTI콜인입이 많은 경우 EVENT LOSS 발생하여 임시 주석처리
	//if (ctmpCntFlag) fn_setCtmpCnt();
	
	var strURL = "/main/info/total-count";
	
	var szSvcid       = "srchMiniBoardData";
    //var szController  = gfn_getSrvcReqUrl(strURL); // 사용자IP로 서비스요청 분기
    var szController  = "SVC::" + strURL;
    var szInDs        = "";
    var szOutDs       = "ds_miniBoardData=ds_output";
    var szParam       = "";
    var szRetCallback = "fn_callBack";

    // 트랜젝션 공통함수 호출
    //gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback, null, false);
    transaction(szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback, false, 0, false);
}

/********************************************************************************************/
/**   6. 사용자 함수                                                                   	*/
/********************************************************************************************/
// 1,2 Level 에따른 메뉴 보이기
function setMenuFilter() {
	var strFilter = arguments[0];


	//업무구분별로 Filter	
	gds_Pgm.filter(strFilter);
	ds_MenuAll.assign(gds_Pgm);
	ds_MenuAll.filter(strFilter);
	//Static_title.style.background = 'URL("' + ds_menuAll.lookup("MENULEVEL", "1", "BG") + '") left middle';

	// 1 LEVEL 갯수만큼 category(title_static) 생성
	ds_MenuM.copyData(ds_MenuAll, true);
	ds_MenuM.filter(strFilter + " && lvl_cnt=='1'");

	var nCategoryCnt = ds_MenuM.rowcount;
	var nRowCnt = 0;

	var nLeft = 0;
	var nRight = 130;
	var nBottom = 0;
	
	var nSubTitleHeight = 22;
	var nSubMenuTopGap = 4;
	var nPdivHeight= 0;
	var bFlag = false;
	var nTotAddWidth = 0;
	
	for(var k=0; k<nCategoryCnt; k++) {

		// 2 LEVEL 
		var subFilter = strFilter + " && lvl_cnt=='2' && hgrn_pgm_cd=='" + ds_MenuM.getColumn(k, "pgm_cd") + "'";
		ds_MenuAll.filter(subFilter);
		ds_MenuS.copyData(ds_MenuAll, true);
		
		nRowCnt = ds_MenuS.rowcount;
		
		var objFont = gfn_getObjFont(9,"Dotum");
		objFont.bold = true;
		var objTitleTextSize = gfn_getTextSize(ds_MenuM.getColumn(k, "pgm_nm"), objFont);

		// Category SubMenu Div 생성
		var name = "div_SubMenu_" + k;
		
		//이미 생성되어 있다면
		if (pdv_Menu.isValidObject(name)) break;;
		
		var nMaxWidth = 0;
		var nAddWidth = 0;
		for (var ms=0; ms<ds_MenuS.rowcount; ms++) {
			var sPgmNm = ds_MenuS.getColumn(ms, "pgm_nm");
			if(sPgmNm.length > 8 && sPgmNm.length > nMaxWidth) {
				nMaxWidth = sPgmNm.length;
				nAddWidth = (nMaxWidth-8)*7;
			}
		}
		nTotAddWidth += nAddWidth;
		
		// Top + title 높이 + 데이타수 + title과 하위메뉴사이의 간격
		nBottom = nSubTitleHeight + (nRowCnt * 22) + nSubMenuTopGap + 10;
		//if (nRowCnt>0)	nBottom = nBottom + (nSubMenuBtmGap);	//nSubMenuTopGap 은 2Level 과 그리드서브메뉴 사이간의 간격

		var oDiv = new Div(name, nLeft, 0, nLeft+nRight+nAddWidth, nBottom);
		oDiv.scrollbars = "none";
		oDiv.asyncmode = false;
		oDiv.url = "FRAME::Frame_TodoSub.xfdl";
		oDiv.style.background = "transparent";
		oDiv.style.border = "0px solid #5f5f5fff";
		oDiv.style.bordertype = "normal";
		oDiv.position2 = "absolute l:4 r8 t:24px b:4px";
		pdv_Menu.addChild(name, oDiv);
		oDiv.show();

		oDiv._index = k;
		//oDiv.posinittop = oDiv.position.top;		
        //oDiv.posinitbottom = oDiv.position.bottom;		
		oDiv.sta_MenuTitle.text = ds_MenuM.getColumn(k, "pgm_nm");		
		oDiv.sta_MenuTitle.usrMenuId = ds_MenuM.getColumn(k, "pgm_cd");
		oDiv.grd_MenuList.position.height = (nRowCnt * 22) + 10;
		oDiv.sta_CountBar.position.height = (nRowCnt * 22) + 10;

		//ds_MenuAll.filter("");
		//oDiv.ds_MenuF.binddataset = ds_MenuAll;
		//oDiv.ds_MenuF.filterstr = subFilter;
		oDiv.ds_MenuF.copyData(ds_MenuS, true);		
		oDiv.ds_MenuF.rowposition = -1;

		nLeft = nLeft + nRight + nAddWidth + 4;
	
		if (nPdivHeight < nBottom) {
			nPdivHeight = nBottom + 15;
		}
		
		bFlag = true;
	}
	
	if (bFlag) {
		//popupMenu Size 설정
		setPopupMenuSize(nLeft+5 ,nPdivHeight);
	}
}

//popupMenu Size 설정
function setPopupMenuSize(nWidth, nHeight){
	pdv_Menu.position.width = nWidth;
	pdv_Menu.position.height = nHeight;
}


//1Level Menu Title 영역 Static 생성
// function fn_objLevelTitleStatic(basicObj, arg_id){
// 
// 	var newTitle = new Static();
// 	newTitle.init(arg_id, 10, 10, 400, fv_setBoxHeight);
// 	newTitle.onclick.addHandler(divPannel_staOver_onclick);
// 	
// 	var pIndex = basicObj.addChild(newTitle.name, newTitle);
// 	if( pIndex == -1 ) {
// 		alert("static 추가 실패...");
// 		return;
// 	}
// 
// 	newTitle.usebitmapcache = false;
// 	newTitle.asyncmode = false;
// 	newTitle.scrollbars = "none";
// 	newTitle.show();
// 	//newTitle.position2 = "absolute l:0px r:0px t:0px b:0px";
// 
// 	return newTitle;
// }

/********************************************************************************************/
/**   7. 이벤트(Event) Function                                                          	*/
/********************************************************************************************/
function btn_menu_onclick(obj:Button,  e:ClickEventInfo)
{
	topPopupMenu();
}

function sta_menu_onclick(obj:Static,  e:ClickEventInfo)
{
	topPopupMenu();
}

function topPopupMenu() 
{
	//var nX   = system.clientToScreenX(obj, 0)+obj.position.width-pdv_FamilySite.position.width;
	var nX   = system.clientToScreenX(sta_bar, 0);		//system.clientToScreenX(obj, 0)
	var nY   = system.clientToScreenY(sta_bar, 0) +sta_bar.position.bottom;
	
	if(!pdv_Menu.isPopup()) {
		var RetVal = pdv_Menu.trackPopup(nX, nY);
	} else {
		pdv_Menu.closePopup();
	}
}

function sta_infoTitle1_onclick(obj:Static,  e:ClickEventInfo)
{
	fn_pgm_athr();
}

// TO-DO onclick
function todo_onclick(obj:Static,  e:ClickEventInfo)
{
	// 인바운드 권한이 없을 경우 return
	var sConsBswrTypCds = gds_UserInfo.getColumn(0, "cons_bswr_typ_cd");
	if (gfn_isNull(sConsBswrTypCds) || sConsBswrTypCds.indexOf("10") == -1) {
		return;
	}
	if (obj.name == "stc_todo_cnt0" || obj.name == "stc_todo_cnt1" || obj.name == "stc_todo_cnt2"
	 || obj.name == "stc_todo_cnt3") {
		var reVal = gfn_diaLog("미처리", -1, -1, 884, 601, "PS020000::PS020701.xfdl", false, {p_srch_yn:"Y"}, true, false, true, null, null, true);
	} else if (obj.name == "stc_recrnc_cnt0" || obj.name == "stc_recrnc_cnt1" || obj.name == "stc_recrnc_cnt2"
	 || obj.name == "stc_recrnc_cnt3") {
		var reVal = gfn_diaLog("재통화", -1, -1, 884, 601, "PS020000::PS020702.xfdl", false, {p_srch_yn:"Y"}, true, false, true, null, null, true);
	} else if (obj.name == "stc_calb_cnt0" || obj.name == "stc_calb_cnt1" || obj.name == "stc_calb_cnt2"
	 || obj.name == "stc_calb_cnt3") {
		var reVal = gfn_diaLog("IVR콜백", -1, -1, 884, 601, "PS020000::PS020703.xfdl", false, {p_srch_yn:"Y"}, true, false, true, null, null, true);
	} else if (obj.name == "stc_voc_cnt0" || obj.name == "stc_voc_cnt1" || obj.name == "stc_voc_cnt2"
	 || obj.name == "stc_voc_cnt3") {
		var reVal = gfn_diaLog("해피콜", -1, -1, 884, 601, "PS020000::PS020705.xfdl", false, {p_srch_yn:"Y"}, true, false, true, null, null, true);
	} else if (obj.name == "stc_cons_trct_cnt0" || obj.name == "stc_cons_trct_cnt1" || obj.name == "stc_cons_trct_cnt2"
	 || obj.name == "stc_cons_trct_cnt3") {
		var reVal = gfn_diaLog("상담이관", -1, -1, 884, 601, "PS020000::PS020707.xfdl", false, {p_srch_yn:"Y"}, true, false, true, null, null, true);
	}
}

function getInCallCount() {
	trace("getInCallCount() 호출 ===================");
	
	var strURL = "/main/info/getInCallCount";
	var szSvcid       = "getInCallCount";
    var szController  = "SVC::" + strURL;
    var szInDs        = "";
    var szOutDs       = "inCallCount=ds_output";
    var szParam       = "";
    //var szRetCallback = "fn_callBack";
	
	transaction(szSvcid, szController, szInDs, szOutDs, szParam, false, false, 0, false);
}

function getOutCallCount() {
	trace("getOutCallCount() 호출 ===================");
	
	var strURL = "/main/info/getOutCallCount";
	var szSvcid       = "getOutCallCount";
    var szController  = "SVC::" + strURL;
    var szInDs        = "";
    var szOutDs       = "outCallCount=ds_output";
    var szParam       = "";
    //var szRetCallback = "fn_callBack";
	
	transaction(szSvcid, szController, szInDs, szOutDs, szParam, false, false, 0, false);
}


var outTime = 0;
var inTime = 0;
var TestTime = 0;

var startInFlag = true;
var startOutFlag = true;


function initializeIn()
{
	trace("인콜초기화==========");

	inTimeText.text = "00:00:00";
}

function initializeOut()
{
	trace("아웃콜초기화==========");

	outTimeText.text = "00:00:00";
}





function Button04_onclick(obj:Button,  e:ClickEventInfo)
{
	this.killTimer(1);
	this.close();
}

function Button05_onclick(obj:Button,  e:ClickEventInfo)
{
	globalIn = true;
	this.setTimer(1,1000);
	//globalOut = false;
	//globalTest = false;
}

function Button03_onclick(obj:Button,  e:ClickEventInfo)
{
	globalIn = true;
	globalOut = true;	
	//globalTest = false;
	this.setTimer(1,1000);
}


function Button01_onclick(obj:Button,  e:ClickEventInfo)
{
	globalIn = true;
	globalOut = true;
	globalTest = true;
	this.setTimer(1,1000);
}

function Button06_onclick(obj:Button,  e:ClickEventInfo)
{
	inTimeStop();
}

function outTimeStop() {

	trace("멈춤 클릭======");
	
	var outCallTime = outTimeText.text;
	trace("아웃콜타임 : " + outCallTime);
	
	if(outTime != 0){
      this.killTimer(1);
      startOutFlag = true;
      outTime = 0;
      initializeOut();
    }
}

function inTimeStop() {

	trace("멈춤 클릭======");
	
	var inCallTime = inTimeText.text;
	trace("인콜타임 : " + inCallTime);
	
	if(inTime != 0){
      this.killTimer(1);
      startInFlag = true;
      inTime = 0;
      initializeIn();
    }

}


// ontimer
function totalCount_ontimer(obj:Form, e:TimerEventInfo)
{
	prtSec = "";
	prtMin = ""
	prtHour = "";
	
	//globalTest = false;
	//	trace("ontimer호출!!!");	
	if(globalIn){
		inTime++;
					
		min = Math.floor(inTime/60);
		hour = Math.floor(min/60);
		sec = inTime%60;
		min = min%60;

		prtSec = gfn_Right("0" + sec,2)
		prtMin = gfn_Right("0" + min,2)
		prtHour = gfn_Right("0" + hour,2)

		inTimeText.text = prtHour + ":" + prtMin + ":" + prtSec;	
	}
		
	if(globalOut){	
		outTime++;
		min = Math.floor(outTime/60);
		hour = Math.floor(min/60);
		sec = outTime%60;
		min = min%60;
			
		prtSec = gfn_Right("0" + sec,2)
		prtMin = gfn_Right("0" + min,2)
		prtHour = gfn_Right("0" + hour,2)
					
		outTimeText.text = prtHour + ":" + prtMin + ":" + prtSec;		
	}
	
	if(globalTest){		
		TestTime++;
		min = Math.floor(TestTime/60);
		hour = Math.floor(min/60);
		sec = TestTime%60;
		min = min%60;
		
		prtSec = gfn_Right("0" + sec,2)
		prtMin = gfn_Right("0" + min,2)
		prtHour = gfn_Right("0" + hour,2)
					
		ctiStatusTime.text = prtHour + ":" + prtMin + ":" + prtSec;			
	}	
}

// 미니전광판 설정 버튼
/*
function btn_miniBoard_onclick(obj:Button,  e:ClickEventInfo)
{
	if (srch_mini_board_flag) {
		if (confirm("미니전광판을 해제하시겠습니까?")) {
			btn_miniBoard.text = "미니전광판 설정";
			srch_mini_board_flag = false;
		}
	} else {
		if (confirm("미니전광판 설정하시겠습니까?")) {
			btn_miniBoard.text = "미니전광판 해제";
			srch_mini_board_flag = true;
		}
	}
}
*/


]]></Script>
  </Form>
</FDL>
