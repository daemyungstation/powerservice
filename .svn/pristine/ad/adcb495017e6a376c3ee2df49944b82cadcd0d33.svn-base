<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="PS994001" classname="팝업가이드" inheritanceid="" position="absolute 0 0 950 681" titletext="문자메시지전송(NEW)" onload="PS994000_onload">
    <Layouts>
      <Layout>
        <Static id="stc_31" class="sta_popupBg1" enable="false" onclick="stc_31_onclick" position2="absolute l:0 w:950 t:-8 h:688" positiontype="position2"/>
        <Button id="btn_Close" taborder="1" onclick="btn_close_onclick" class="btn_popupClose" position2="absolute l:923 w:20 t:2 h:19" positiontype="position2"/>
        <Static id="stc_30" text="문자메시지전송(NEW)" class="sta_popupTitle" transparenthittest="true" position2="absolute l:9 w:175 t:2 h:20" positiontype="position2"/>
        <Tab id="tab" taborder="1" tabindex="0" scrollbars="autoboth" position2="absolute l:189 w:751 t:36 h:627" positiontype="position2" onchanged="tab_onchanged">
          <Tabpages>
            <Tabpage id="tabpage1" text="메시지목록">
              <Layouts>
                <Layout width="739" height="223">
                  <Static id="stc_23" class="sta_workSrcBg" position2="absolute l:12 w:724 t:12 h:42" positiontype="position2"/>
                  <Combo id="cbo_chat_msg_typ_cd" taborder="1" index="-1" onitemchanged="tab_tabpage1_cbo_city_onitemchanged" position2="absolute l:107 w:91 t:23 h:20" positiontype="position2" innerdataset="@ds_chat_msg_typ_cd" datacolumn="cd_nm" codecolumn="cd"/>
                  <Static id="stc_22" text="메시지 유형" class="sta_workSrcLabel1" position2="absolute l:27 w:78 t:23 h:20" positiontype="position2"/>
                  <Grid id="Grid00" taborder="2" binddataset="ds_list_chatCnts" useinputpanel="false" selecttype="row" autofittype="col" onvscrolllastover="grd_list_onvscrolllastover" nodatatext="검색결과가 없습니다." position2="absolute l:12 w:725 t:85 h:507" positiontype="position2" oncellclick="tab_tabpage1_grd_consTyp_list_oncellclick" oncelldblclick="tab_tabpage1_Grid00_oncelldblclick">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="30"/>
                          <Column size="75"/>
                          <Column size="519"/>
                          <Column size="59"/>
                          <Column size="40"/>
                        </Columns>
                        <Rows>
                          <Row size="25" band="head"/>
                          <Row size="25"/>
                        </Rows>
                        <Band id="head">
                          <Cell text="NO"/>
                          <Cell col="1" text="메시지 유형"/>
                          <Cell col="2" text="메시지 내용"/>
                          <Cell col="3" text="바이트"/>
                          <Cell col="4"/>
                        </Band>
                        <Band id="body">
                          <Cell text="bind:page_indx"/>
                          <Cell col="1" style="align:center middle;" text="bind:chat_msg_typ_nm"/>
                          <Cell col="2" style="align:left top;" text="bind:chat_msg_cntn"/>
                          <Cell col="3" style="align:center middle;" text="bind:chat_msg_lngt"/>
                          <Cell col="4" displaytype="button" style="align:center middle;" text="선택"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <Static id="stc_00" text="메시지 제목" class="sta_workSrcLabel1" position2="absolute l:211 w:78 t:23 h:20" positiontype="position2"/>
                  <Button id="btn_search" taborder="8" onclick="btn_Search_onclick" class="btn_WF_Search" tooltiptext="조회" style="shadow:drop 0,0 0 #00000033;" position2="absolute l:573 w:72 t:24 h:20" positiontype="position2"/>
                  <Edit id="edt_chat_msg_titl" taborder="9" position2="absolute l:292 w:83 t:23 h:20" positiontype="position2"/>
                  <Button id="btn_Init" taborder="10" onclick="btn_Init_onclick" class="btn_WF_Return" position2="absolute r:30 w:72 t:24 h:20" positiontype="position2" tooltiptext="초기화" style="padding:0 0 0 0;"/>
                  <Static id="stc_01" text="메시지 내용" class="sta_workSrcLabel1" position2="absolute l:385 w:78 t:23 h:20" positiontype="position2"/>
                  <Edit id="edt_chat_msg_cntn" taborder="11" position2="absolute l:466 w:83 t:23 h:20" positiontype="position2"/>
                  <Static id="sta_totalCnt" text="검색결과   &lt;fs v='9'&gt;&lt;fc v='#f0850c'&gt;&lt;b v='true'&gt;0&lt;/b&gt;&lt;/fc&gt;&lt;/fs&gt; &lt;fc v='#a1a1a1'&gt;건&lt;/fc&gt; / 전체   &lt;fs v='9'&gt;&lt;fc v='#f0850c'&gt;&lt;b v='true'&gt;0&lt;/b&gt;&lt;/fc&gt;&lt;/fs&gt; &lt;fc v='#a1a1a1'&gt;건&lt;/fc&gt;" usedecorate="true" class="sta_workTitle5" position2="absolute l:15 w:216 t:65 h:20" positiontype="position2"/>
                </Layout>
              </Layouts>
            </Tabpage>
            <Tabpage id="tabpage2" text="일괄발송">
              <Layouts>
                <Layout>
                  <Static id="stc_00" text="일괄발송정보 추출" class="sta_workLabel1" position2="absolute l:12 w:724 t:12 h:26" positiontype="position2" style="font:arial,8,bold;" validate=""/>
                  <Button id="btn_excelImport" taborder="3" text="엑셀업로드" onclick="btn_excelImport_onclick" position2="absolute l:603 w:64 t:16 h:18" positiontype="position2"/>
                  <Grid id="Grid00" taborder="4" binddataset="ds_list_excel" useinputpanel="false" autofittype="col" nodatatext="검색결과가 없습니다." position2="absolute l:12 w:725 t:53 h:539" positiontype="position2" onheadclick="tab_tabpage2_Grid00_onheadclick">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="50"/>
                          <Column size="50"/>
                          <Column size="180"/>
                          <Column size="150"/>
                          <Column size="150"/>
                          <Column size="110"/>
                        </Columns>
                        <Rows>
                          <Row size="25" band="head"/>
                          <Row size="25"/>
                        </Rows>
                        <Band id="head">
                          <Cell displaytype="checkbox"/>
                          <Cell col="1" text="NO"/>
                          <Cell col="2" text="고객번호"/>
                          <Cell col="3" text="성명"/>
                          <Cell col="4" text="전화번호"/>
                          <Cell col="5" text="수신거부일자"/>
                        </Band>
                        <Band id="body">
                          <Cell displaytype="checkbox" edittype="expr:reject_dt == undefined ? 'checkbox' : 'none'" text="bind:rowCheck"/>
                          <Cell col="1" text="expr:currow+1"/>
                          <Cell col="2" style="align:center middle;" text="bind:cust_id"/>
                          <Cell col="3" style="align:center middle;" text="bind:cust_nm"/>
                          <Cell col="4" style="align:center middle;" text="bind:clph_no"/>
                          <Cell col="5" displaytype="expr:reject_dt == undefined ? 'normal' : 'date'" text="bind:reject_dt"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <FileDownload id="fdl_btn_fixedFormDown" taborder="5" downloadurl="/file/download-template?file_nm=CustomerList_sample.xlsx" retry="0" downloadfilename="CustomerList_sample.xlsx" text="파일양식" wordwrap="none" visible="false" position2="absolute l:813 w:66 t:22 h:21" positiontype="position2" style="background:URL('theme://images/btn_WF_CommN.png') stretch 5,5;border:0 none #808080ff ;color:#444444ff;font:맑은 고딕,9,bold antialias;cursor:hand;shadow:drop 1,1 1 #0000004a;gradation:none 0,0 white 100,100 black;"/>
                  <Button id="btn_fileDown" taborder="6" text="파일 양식" onclick="tab_tabpage2_btn_fileDown_onclick" position2="absolute l:669 w:64 t:16 h:18" positiontype="position2"/>
                </Layout>
              </Layouts>
            </Tabpage>
          </Tabpages>
        </Tab>
        <Static id="stc_00" text="파일첨부" class="sta_workLabel1" position2="absolute l:974 w:751 t:196 h:26" positiontype="position2" style="font:arial,8,bold;" validate="" visible="false"/>
        <Static id="stc_01" class="sta_workData" position2="absolute l:974 w:751 t:221 h:30" positiontype="position2" visible="false"/>
        <TextArea id="TextArea_chat_msg_cntn" taborder="2" readonly="false" lengthunit="utf8" maxlength="2000" position2="absolute l:10 w:164 t:36 h:359" positiontype="position2" wordwrap="word" onkeyup="TextArea_chat_msg_cntn_onkeyup"/>
        <Static id="stc_22" text="발신번호" class="sta_workSrcLabel1" position2="absolute l:11 w:62 t:432 h:20" positiontype="position2"/>
        <Edit id="edt_cntr_rprs_tlno" taborder="3" position2="absolute l:74 w:96 t:432 h:20" positiontype="position2" inputtype="number" onkillfocus="edt_cntr_rprs_tlno_onkillfocus" lengthunit="utf8" maxlength="13"/>
        <Static id="stc_03" text="수신번호" class="sta_workSrcLabel1" position2="absolute l:11 w:62 t:456 h:20" positiontype="position2"/>
        <Edit id="edt_clph_no" taborder="4" position2="absolute l:74 w:96 t:456 h:20" positiontype="position2" inputtype="number" maxlength="12" lengthunit="utf8" onkillfocus="edt_clph_no_onkillfocus"/>
        <Static id="stc_04" text="수신인명" class="sta_workSrcLabel1" position2="absolute l:11 w:62 t:480 h:20" positiontype="position2"/>
        <Edit id="edt_cust_nm" taborder="5" position2="absolute l:74 w:96 t:480 h:20" positiontype="position2"/>
        <Static id="stc_05" text="접수번호" class="sta_workSrcLabel1" position2="absolute l:11 w:62 t:504 h:20" positiontype="position2" visible="false"/>
        <Edit id="edt_consno" taborder="6" position2="absolute l:74 w:96 t:504 h:20" positiontype="position2" visible="false"/>
        <CheckBox id="chk_rightfg" taborder="7" text="즉시발송" position="absolute 20 534 90 554" value="true" onclick="chk_rightfg_onclick"/>
        <Static id="stc_06" text="예약일자" class="sta_workSrcLabel1" position2="absolute l:11 w:62 t:560 h:20" positiontype="position2"/>
        <Static id="stc_07" text="예약시간" class="sta_workSrcLabel1" position2="absolute l:11 w:62 t:584 h:20" positiontype="position2"/>
        <Button id="btn_Send" taborder="10" position2="absolute r:860 w:70 t:638 h:20" positiontype="position2" tooltiptext="초기화" style="padding:0 0 0 0;" text="보내기" onclick="btn_Send_onclick"/>
        <Button id="btn_init" taborder="11" text="초기화" onclick="btn_init_onclick" position2="absolute r:780 w:72 t:638 h:20" positiontype="position2" tooltiptext="초기화" style="padding:0 0 0 0;"/>
        <Static id="sta_totalCnt" usedecorate="true" position2="absolute l:1360 w:360 t:200 h:20" positiontype="position2" style="color:red;" text="※ 문자메시지 전송 이미지는 500Kb이하의 파일만 가능합니다." visible="false"/>
        <Combo id="cbo_resr_tm" taborder="14" codecolumn="codecolumn" datacolumn="datacolumn" onitemchanged="tab_tabpage1_cbo_city_onitemchanged" position2="absolute l:74 w:96 t:585 h:20" positiontype="position2" enable="false">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn">0000</Col>
                <Col id="datacolumn">00:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0030</Col>
                <Col id="datacolumn">00:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0100</Col>
                <Col id="datacolumn">01:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0130</Col>
                <Col id="datacolumn">01:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0200</Col>
                <Col id="datacolumn">02:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0230</Col>
                <Col id="datacolumn">02:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0300</Col>
                <Col id="datacolumn">03:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0330</Col>
                <Col id="datacolumn">03:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0400</Col>
                <Col id="datacolumn">04:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0430</Col>
                <Col id="datacolumn">04:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0500</Col>
                <Col id="datacolumn">05:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0530</Col>
                <Col id="datacolumn">05:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0600</Col>
                <Col id="datacolumn">06:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0630</Col>
                <Col id="datacolumn">06:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0700</Col>
                <Col id="datacolumn">07:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0730</Col>
                <Col id="datacolumn">07:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0800</Col>
                <Col id="datacolumn">08:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0830</Col>
                <Col id="datacolumn">08:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0900</Col>
                <Col id="datacolumn">09:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0930</Col>
                <Col id="datacolumn">09:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1000</Col>
                <Col id="datacolumn">10:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1030</Col>
                <Col id="datacolumn">10:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1100</Col>
                <Col id="datacolumn">11:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1130</Col>
                <Col id="datacolumn">11:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1200</Col>
                <Col id="datacolumn">12:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1230</Col>
                <Col id="datacolumn">12:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1300</Col>
                <Col id="datacolumn">13:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1330</Col>
                <Col id="datacolumn">13:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1400</Col>
                <Col id="datacolumn">14:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1430</Col>
                <Col id="datacolumn">14:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1500</Col>
                <Col id="datacolumn">15:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1530</Col>
                <Col id="datacolumn">15:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1600</Col>
                <Col id="datacolumn">16:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1630</Col>
                <Col id="datacolumn">16:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1700</Col>
                <Col id="datacolumn">17:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1730</Col>
                <Col id="datacolumn">17:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1800</Col>
                <Col id="datacolumn">18:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1830</Col>
                <Col id="datacolumn">18:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1900</Col>
                <Col id="datacolumn">19:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1930</Col>
                <Col id="datacolumn">19:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">2000</Col>
                <Col id="datacolumn">20:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">2030</Col>
                <Col id="datacolumn">20:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">2100</Col>
                <Col id="datacolumn">21:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">2130</Col>
                <Col id="datacolumn">21:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">2200</Col>
                <Col id="datacolumn">22:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">2230</Col>
                <Col id="datacolumn">22:30</Col>
              </Row>
              <Row>
                <Col id="codecolumn">2300</Col>
                <Col id="datacolumn">23:00</Col>
              </Row>
              <Row>
                <Col id="codecolumn">2330</Col>
                <Col id="datacolumn">23:30</Col>
              </Row>
            </Rows>
          </Dataset>
        </Combo>
        <Static id="sta_chat_msg_cntn_max_lgth" usedecorate="true" position2="absolute l:79 w:56 t:394 h:20" positiontype="position2" text="/2000Byte"/>
        <Static id="sta_chat_msg_size" text="0" usedecorate="true" position2="absolute l:22 w:56 t:394 h:20" positiontype="position2" style="align:right middle;"/>
        <FileDownload id="fdl_btn_fixedFormDown" taborder="15" downloadurl="/file/download-template?file_nm=smsall_sample.xlsx" retry="0" downloadfilename="smsall_sample.xlsx" text="양식받기" wordwrap="none" visible="false" position="absolute 957 326 1023 347" style="background:URL('theme://images/btn_WF_CommN.png') stretch 5,5;border:0 none #808080ff ;color:#444444ff;font:맑은 고딕,9,bold antialias;cursor:hand;shadow:drop 1,1 1 #0000004a;gradation:none 0,0 white 100,100 black;"/>
        <Calendar id="msk_resr_dt" taborder="18" displaynulltext="____-__-__" dateformat="yyyy-MM-dd" onchanged="cal_00_onchanged" oneditclick="cal_00_oneditclick" class="cal_srch" position2="absolute l:74 w:96 b:100 h:20" positiontype="position2" enable="false"/>
        <FileUpload id="FileUpload00" taborder="20" timeout="0" retry="0" async="true" innerdataset="@ds_attachFile" filecolumn="filePath" index="0" onload="FileUpload00_onload" onitemchanged="FileUpload00_onitemchanged" position2="absolute l:988 r:-410 t:226 b:454" positiontype="position2" visible="false"/>
        <Button id="btn_checkReject" taborder="21" text="수신거부체크" position="absolute 19 613 170 633" onclick="fn_getInfobankSmsRejectList" enable="false"/>
        <CheckBox id="ckb_ad" taborder="22" text="광고여부" position="absolute 97 534 167 554" onclick="ckb_ad_onclick"/>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item2" compid="TextArea_chat_msg_cntn" propid="value" datasetid="ds_list_evltExec" columnid="evlt_resl_cntn"/>
    </Bind>
    <Objects>
      <Dataset id="ds_trans_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="strSvcID" type="STRING" size="256"/>
          <Column id="strURL" type="STRING" size="256"/>
          <Column id="strInDatasets" type="STRING" size="256"/>
          <Column id="strOutDatasets" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_inqCndt" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="chat_msg_typ_cd" type="STRING" size="256"/>
          <Column id="chat_msg_titl" type="STRING" size="256"/>
          <Column id="chat_msg_cntn" type="STRING" size="256"/>
          <Column id="use_yn" type="STRING" size="256"/>
          <Column id="accnt_no" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list_tmp" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_list_chatCnts" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="chat_msg_lngt" type="STRING" size="256"/>
          <Column id="amnt_dttm" type="STRING" size="256"/>
          <Column id="chat_dpms_div_nm" type="STRING" size="256"/>
          <Column id="file_flag" type="STRING" size="256"/>
          <Column id="img_url_addr" type="STRING" size="256"/>
          <Column id="amnd_id" type="STRING" size="256"/>
          <Column id="amnd_nm" type="STRING" size="256"/>
          <Column id="cntr_cd" type="STRING" size="256"/>
          <Column id="chat_msg_typ_nm" type="STRING" size="256"/>
          <Column id="dpms_tlno" type="STRING" size="256"/>
          <Column id="chat_msg_typ_cd" type="STRING" size="256"/>
          <Column id="chat_cnts_div_nm" type="STRING" size="256"/>
          <Column id="chat_dpms_div_cd" type="STRING" size="256"/>
          <Column id="rgsr_id" type="STRING" size="256"/>
          <Column id="rgsn_dttm" type="STRING" size="256"/>
          <Column id="chat_msg_cntn" type="STRING" size="256"/>
          <Column id="rgsr_nm" type="STRING" size="256"/>
          <Column id="file_id" type="STRING" size="256"/>
          <Column id="page_indx" type="STRING" size="256"/>
          <Column id="chat_msg_titl" type="STRING" size="256"/>
          <Column id="use_yn" type="STRING" size="256"/>
          <Column id="chat_cnts_id" type="STRING" size="256"/>
          <Column id="chat_cnts_div_cd" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_chat_msg_typ_cd" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="256"/>
          <Column id="cd_nm" type="STRING" size="256"/>
          <Column id="adtl_cd" type="STRING" size="256"/>
          <Column id="adtl_cd_nm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <FileDialog id="FileDialog00" filter="All(*.*)|*.*|" filterindex="0" defaultextention="false"/>
      <Dataset id="ds_list_tmp2" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_list_excel" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowCheck" type="STRING" size="256"/>
          <Column id="cust_id" type="STRING" size="256"/>
          <Column id="cust_nm" type="STRING" size="256"/>
          <Column id="clph_no" type="STRING" size="256"/>
          <Column id="reject_dt" type="STRING" size="256"/>
          <Column id="reject_yn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_inqSend" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="mem_no" type="STRING" size="256"/>
          <Column id="mem_nm" type="STRING" size="256"/>
          <Column id="service_type" type="STRING" size="256"/>
          <Column id="recipient_num" type="STRING" size="256"/>
          <Column id="callback" type="STRING" size="256"/>
          <Column id="subject" type="STRING" size="256"/>
          <Column id="content" type="STRING" size="256"/>
          <Column id="broadcast_yn" type="STRING" size="256"/>
          <Column id="reserve_yn" type="STRING" size="256"/>
          <Column id="reserve_date" type="STRING" size="256"/>
          <Column id="attach_file_name" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_attachFile" firefirstcount="0" firenextcount="0" useclientlayout="true" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="fileName" type="STRING" size="32"/>
          <Column id="fileSize" type="BIGDECIMAL" size="8"/>
          <Column id="fileType" type="STRING" size="32"/>
          <Column id="filePath" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="fileName"/>
            <Col id="fileType">1</Col>
            <Col id="filePath"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_reject" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cid" type="STRING" size="256"/>
          <Column id="rseq" type="STRING" size="256"/>
          <Column id="rdatetime" type="STRING" size="256"/>
          <Column id="callnum" type="STRING" size="256"/>
          <Column id="rbit" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list_excel_tmp" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="rowCheck" type="STRING" size="256"/>
          <Column id="cust_id" type="STRING" size="256"/>
          <Column id="cust_nm" type="STRING" size="256"/>
          <Column id="clph_no" type="STRING" size="256"/>
          <Column id="reject_dt" type="STRING" size="256"/>
          <Column id="reject_yn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_meminfo" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/********************************************************************************************/
/* 1. Include Library include, variables Declaration 영역                                  */
/********************************************************************************************/
include "LIB::lib_All.xjs";
var sendmode = "single";
var fv_svcPath;
var total_count = 0; // 전체건수
var fv_svcPath = gfn_getServiceUrl("fileUrl");
var arrFiles = new Array();	// FileDialog 선택을 통한 File Array
var fv_reject_include_cnt = -1; // 체크를 하지 않은 경우는 -1
var g_isu_no = "";
var g_appr_no = "";
var g_amt = "";
var g_accnt_no = "";

/********************************************************************************************/
/* 2. Form 관련(onload 및 Form 이벤트) 처리                                           	*/
/********************************************************************************************/
function PS994000_onload(obj:Form, e:LoadEventInfo)
{	
	if(!gfn_isNull(cell)){
		edt_clph_no.value = cell.replace("-","");
	}
	try {
		g_accnt_no = p_accnt_no;  // 회원코드
	} catch(e) {
		//
	}	
	fv_svcPath = gfn_getServiceUrl("fileUrl");	
	edt_cust_nm.value = mem_nm;
	gfn_createPagingDataset(obj); // 페이징처리 위한 데이터셋 설정
	gfn_getList("cd","KMS070");   //코드조회
	fn_commSearch(gfn_getCommTypeInit());
	
	try {
		g_isu_no = p_isu_no;  // 발행번호
	} catch(e) {
		//
	}
	
	try {
		g_appr_no = p_appr_no;  // 승인번호
	} catch(e) {
		//
	}
	
	try {
		g_amt = p_amt;  // 발행금액
	} catch(e) {
		//
	}
	
// 	g_isu_no = p_isu_no;  // 발행번호
// 	g_appr_no = p_appr_no;// 승인번호
//  g_amt = p_amt;        // 발행금액
}

/********************************************************************************************/
/* 3. Callback(gfn_Transaction 호출 후 처리내용)                                   		*/
/********************************************************************************************/
function fn_callBack(svcid, errcd, errmsg) 
{
	if (errcd != 0) {
		trace(errcd)
		return false;
	} else {
		switch (svcid) {
			case "selectCode":
				gfn_getCode("KMS070", "ALL", ds_chat_msg_typ_cd); //메시지유형
				
				var sAuthCd = gds_UserInfo.getColumn(0, "athr_cd");
	
				if(sAuthCd == "OP30") // 부서권한이 "의전" 일경우 (OP30)
				{
					tab.tabpage1.cbo_chat_msg_typ_cd.index = 3;
				}
				else
				{
					tab.tabpage1.cbo_chat_msg_typ_cd.index = 0;
				}
 			break;
 			
 			case "getInfobankSmsRejectList":
				fn_postGetInfobankSmsRejectList();
 			break;
 			
 			case "getChatCntsList":
				//trace(ds_list_tmp.saveXML());
				gfn_appendSearchDs(ds_list_chatCnts, ds_list_tmp); // 조회된 결과를 실제보여줄 데이타셋으로 Append처리
				gfn_setTotalRowCount(ds_list_chatCnts, tab.tabpage1.sta_totalCnt, total_count); // 페이지건수 표출
				fn_mem_srch(); // 행사정보 조회
			break;
			
			case "sendMsg":
				alert("발송되었습니다.");
				fv_reject_include_cnt = -1; // 수신거부 체크 플래그 초기화
			break;
			
			case "getEvntChatInfo":
				//trace(ds_meminfo.saveXML());
			break;
 		}
 	}
} 		

/********************************************************************************************/
/**   5. 서비스 호출(gfn_Transaction)                                                   	*/
/********************************************************************************************/
//조회
function fn_commSearch(sType)
{
	ds_list_chatCnts.clearData();
	ds_inqCndt.clearData();
	
	ds_inqCndt.addRow();
	ds_inqCndt.setColumn(0, "chat_msg_typ_cd", tab.tabpage1.cbo_chat_msg_typ_cd.value);
	ds_inqCndt.setColumn(0, "chat_msg_titl", tab.tabpage1.edt_chat_msg_titl.value);
	ds_inqCndt.setColumn(0, "chat_msg_cntn", tab.tabpage1.edt_chat_msg_cntn.value);
	ds_inqCndt.setColumn(0, "use_yn", "Y");
		
	var szSvcid       = "getChatCntsList";
    var szController  = "/knowledge/chat-cnts/list";
    var szInDs        = "ds_input=ds_inqCndt";
    var szOutDs       = "ds_list_tmp=ds_output";
    var szParam       = "";
    var szRetCallback = "fn_callBack";
	
    // 트랜젝션 공통함수 호출
    gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback, false);
}

//메시지 전송
function fn_send()
{
	ds_inqSend.setColumn(0, "mem_no", mem_no);//고객번호
	ds_inqSend.setColumn(0, "mem_nm", mem_nm);//고객명
	
	ds_inqSend.setColumn(0, "recipient_num", edt_clph_no.value);//수신번호
	ds_inqSend.setColumn(0, "callback", edt_cntr_rprs_tlno.value);//발신번호
	
	var sTitle = TextArea_chat_msg_cntn.value;
	ds_inqSend.setColumn(0, "subject", sTitle.substr(0, 10));//메시지제목
	ds_inqSend.setColumn(0, "content", TextArea_chat_msg_cntn.value);//전송메시지
	
	if(chk_rightfg.value == false){
		ds_inqSend.setColumn(0, "reserve_yn", "Y");//예약발송 유무
		ds_inqSend.setColumn(0, "reserve_date", msk_resr_dt.value + cbo_resr_tm.value);//예약발송 시각
	}else{
		ds_inqSend.setColumn(0, "reserve_yn", "N");//예약발송 유무
	}
	
	if(!gfn_isNull(FileUpload00.value)){//첨부파일 있음(MMS)
		var strUrl = fv_svcPath+"fileControll/fileUpload.jsp?PATH=upload";
		var bSucc = FileUpload00.upload(strUrl);
		ds_inqSend.setColumn(0, "service_type", "2");//메시지전송타입
	}else{//첨부파일 없음
		if(toNumber(sta_chat_msg_size.text) <= 80){//SMS
			ds_inqSend.setColumn(0, "service_type", "0");//메시지전송타입
		}else{//LMS
			ds_inqSend.setColumn(0, "service_type", "3");//메시지전송타입
		}
	//	alert(sta_chat_msg_size.text);
		//trace(ds_inqSend.saveXML());
		var szSvcid       = "sendMsg";
		var szController  = "/chnl/chat-sndg/send_sysone";
		var szInDs        = "ds_input=ds_inqSend ds_input2=ds_list_excel";
		var szOutDs       = "";
		var szParam       = "";
		var szRetCallback = "fn_callBack";
		
		// 트랜젝션 공통함수 호출
		gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback);
    }
}

// 행사회원 조회
function fn_mem_srch()
{
	ds_meminfo.clearData();
	ds_inqCndt.clearData();
	
	ds_inqCndt.addRow();
	ds_inqCndt.setColumn(0, "accnt_no", g_accnt_no);
	
	var szSvcid       = "getEvntChatInfo";
    var szController  = "/dlw/evnt/chatmeminfo";
    var szInDs        = "ds_input=ds_inqCndt";
    var szOutDs       = "ds_meminfo=ds_output";
    var szParam       = "";
    var szRetCallback = "fn_callBack";
	
    // 트랜젝션 공통함수 호출
    gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback, false);
}

/********************************************************************************************/
/**   6. 사용자 함수                                                                   	*/
/********************************************************************************************/
// 초기화
function fn_init()
{
	tab.tabpage1.cbo_chat_msg_typ_cd.index = 0;
	tab.tabpage1.edt_chat_msg_titl.value = "";
	tab.tabpage1.edt_chat_msg_cntn.value = "";
}

//특수문자
function Static_onclick(obj:Static,  e:ClickEventInfo)
{
	//alert(obj.text);
	if(gfn_isNull(TextArea_chat_msg_cntn.value)){
		TextArea_chat_msg_cntn.value = obj.text;
	}else{	
		TextArea_chat_msg_cntn.value = TextArea_chat_msg_cntn.value + obj.text;
	}
	
	//메시지 사이즈 표시
	var sMsgSize = gfn_getLengthB(TextArea_chat_msg_cntn.value);
	sta_chat_msg_size.text = sMsgSize;
}

/********************************************************************************************/
/**   7. 이벤트(Event) Function                                                          	*/
/********************************************************************************************/
//메시지창 초기화
function btn_init_onclick(obj:Button,  e:ClickEventInfo)
{
	TextArea_chat_msg_cntn.value = "";
	sta_chat_msg_size.text = "0";
	ckb_ad.value = false;
}

function btn_Init_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_init();
}

function btn_Search_onclick(obj:Button,  e:ClickEventInfo)
{

   if ( tab.tabpage1.cbo_chat_msg_typ_cd.value =="40") {
       alert('알림톡은 미구현된 서비스입니다. 발송불가합니다.');
       return;
   }
	fn_commSearch(gfn_getCommTypeInit());
}

//그리드 선택버튼클릭
function tab_tabpage1_grd_consTyp_list_oncellclick(obj:Grid, e:GridClickEventInfo)
{
	if(e.cell == 4){
	    /* 더블클릭 이벤트 연동으로 주석처리 - 2018.06.26
		//alert(ds_list_chatCnts.getColumn(e.row, "chat_msg_cntn"));
		TextArea_chat_msg_cntn.value = "";
		TextArea_chat_msg_cntn.value = ds_list_chatCnts.getColumn(e.row, "chat_msg_cntn");
		//메시지 사이즈 표시
		var sMsgSize = gfn_getLengthB(ds_list_chatCnts.getColumn(e.row, "chat_msg_cntn"));
		sta_chat_msg_size.text = sMsgSize;
		*/
		
		// 문자템플릿 선택시 더블클릭이벤트 연동 - 2018.06.26
		tab_tabpage1_Grid00_oncelldblclick(obj, e);
	}
}

//즉시발송 체크클릭
function chk_rightfg_onclick(obj:CheckBox,  e:ClickEventInfo)
{
	//체크상태
	if(obj.value == true){
		msk_resr_dt.value = "";
		cbo_resr_tm.value = "";
		msk_resr_dt.enable = false;
		cbo_resr_tm.enable = false;
	}else{
		msk_resr_dt.enable = true;
		cbo_resr_tm.enable = true;
	}
}

//발신번호 - 제거
function edt_cntr_rprs_tlno_onkillfocus(obj:Edit, e:KillFocusEventInfo)
{
	var sCntrRprsTlno = edt_cntr_rprs_tlno.value;
	if(!gfn_isNull(sCntrRprsTlno)){
		edt_cntr_rprs_tlno.value = sCntrRprsTlno.replace("-","");
	}	
}

//수신번호 - 제거
function edt_clph_no_onkillfocus(obj:Edit, e:KillFocusEventInfo)
{
	var sClphNo = edt_clph_no.value;
	if(!gfn_isNull(sClphNo)){
		edt_clph_no.value = sClphNo.replace("-","");
	}
}

//tab 변경시
function tab_onchanged(obj:Tab, e:TabIndexChangeEventInfo)
{
	if(obj.tabindex == "0"){
		sendmode = "single";//단건
		edt_clph_no.enable = true;
		edt_cust_nm.enable = true;
		ds_list_excel.clearData();//tab전화시 그리드 초기화
	}else{
		sendmode = "multi";//일괄(동보)
		edt_clph_no.value = "";
		edt_cust_nm.value = "";
		edt_clph_no.enable = false;
		edt_cust_nm.enable = false;
	}
	//alert(sendmode);	
}

//닫기버튼
function btn_close_onclick(obj:Button,  e:ClickEventInfo)
{
	close();
}

//메시지 사이즈 표시
function TextArea_chat_msg_cntn_onkeyup(obj:TextArea, e:KeyEventInfo)
{
	if (gfn_isNull(TextArea_chat_msg_cntn.value)){ 
		sta_chat_msg_size.text = 0;
	} else {
	    var sMsgSize = gfn_getLengthB(TextArea_chat_msg_cntn.value);
		sta_chat_msg_size.text = sMsgSize;
	}
}

//엑셀업로드버튼
function btn_excelImport_onclick(obj:Button,  e:ClickEventInfo)
{
	var varRet = FileDialog00.open("FileOpen", FileDialog.LOAD, "%DOCUMENT%");
	var objExtComm = new ExtCommon(); // ExtCommon 오브젝트 생성
	//trace(varRet.fullpath);
	var v_Ret = objExtComm.excelImportByIndex(varRet.fullpath, 0/*시트INDEX*/, "ds_list_tmp2", 0);
	
	ds_list_tmp2.deleteRow(0);//헤더삭제
	
	if(ds_list_tmp2.rowcount > 0){
		ds_list_excel.clearData();
	}
	//trace(ds_list_tmp2.saveXML());
	for(i=0; i<ds_list_tmp2.rowcount; i++){
		var nAddRow = ds_list_excel.addRow();
		var sClphNo = ds_list_tmp2.getColumn(i, "Col03");
		//trace(sClphNo);
		sClphNo = sClphNo.replace("-","");
		ds_list_excel.setColumn(nAddRow , "cust_id", ds_list_tmp2.getColumn(i, "Col01"));
		ds_list_excel.setColumn(nAddRow , "cust_nm", ds_list_tmp2.getColumn(i, "Col02"));
		ds_list_excel.setColumn(nAddRow , "clph_no", sClphNo);
	}
	fv_reject_include_cnt = -1;
}

//헤더클릭
function tab_tabpage2_Grid00_onheadclick(obj:Grid, e:GridClickEventInfo)
{
	gfn_grdHeadClick(obj, e);
}

//파일양식다운로드
function tab_tabpage2_btn_fileDown_onclick(obj:Button,  e:ClickEventInfo)
{
	//FileDown컴포넌트를 이용한 다운로드
	fdl_btn_fixedFormDown.downloadfilename = "smsall_sample.xlsx";			
	fdl_btn_fixedFormDown.downloadurl = fv_svcPath +"/file/download-template?file_nm=smsall_sample.xlsx";
	var bSucc = fdl_btn_fixedFormDown.download();
	if(bSucc){
		alert('다운로드 완료');
	}
	return false;//기본으로 뜨는 파일 다이얼로그를 띄우지 않도록 처리함.	
}

//보내기버튼클릭
function btn_Send_onclick(obj:Button,  e:ClickEventInfo)
{     
	ds_inqSend.clearData();
	ds_inqSend.addRow();
	if(sendmode == "single"){//단건(개별)
		//발송 전 체크
		if (fn_checkBefore(sendmode) == false) {
			return false;
		}
		ds_inqSend.setColumn(0, "broadcast_yn", "N");//동보발송유무
	}else{//일괄(동보)
		//발송 전 체크
		if (fn_checkBefore(sendmode) == false) {
			return false;
		}
		var nCnt = ds_list_excel.getCaseCount("rowCheck=='1'");		
		
		if(nCnt ==1){
			ds_inqSend.setColumn(0, "broadcast_yn", "N");//동보발송유무
		}else{
			ds_inqSend.setColumn(0, "broadcast_yn", "Y");//동보발송유무
		}
	}
	fn_send();
}

//발송전 체크
function fn_checkBefore(sendmode)
{
	// 메시지 사이즈 표시
	TextArea_chat_msg_cntn_onkeyup();

	if (gfn_isEmpty(gfn_trim(TextArea_chat_msg_cntn.value))) {
		alert("메시지 내용을 입력하세요");
		TextArea_chat_msg_cntn.value = "";
		TextArea_chat_msg_cntn.setFocus();
		return false;
	}

	if(gfn_isNull(TextArea_chat_msg_cntn.value)){
		alert("메시지 내용을 입력하세요");
		TextArea_chat_msg_cntn.setFocus();
		return false;
	}
	
	if(gfn_isNull(edt_cntr_rprs_tlno.value)){
		alert("발신번호를 입력하세요");
		edt_cntr_rprs_tlno.setFocus();
		return false;
	}
	var sCntrRprsTlno = edt_cntr_rprs_tlno.value.replace(/\D/g, "");
	if (sCntrRprsTlno.length > 12) {
	    alert("발신번호를 확인하세요");
		edt_cntr_rprs_tlno.setFocus();
		return false;
	}
	
	if(chk_rightfg.value == false){//예약발송일때
		if(gfn_isNull(msk_resr_dt.value)){
			alert("예약일자를 입력하세요");
			msk_resr_dt.setFocus();
			return false;
		}
		if(gfn_isNull(cbo_resr_tm.value)){
			alert("예약시간을 입력하세요");
			cbo_resr_tm.setFocus();
			return false;
		}
	}
	
	if (ckb_ad.value) {
		if (fv_reject_include_cnt < 0) {
			alert("수신자거부 체크를 해주세요.");
			return false;	
		}	
	}
	
	if(sendmode == "single"){//단건
		if(gfn_isNull(edt_clph_no.value)){//수신번호
			alert("수신번호를 입력하세요");
			edt_clph_no.setFocus();
			return false;
		}
		
		if (ckb_ad.value) {
			if (fv_reject_include_cnt > 0) {
				alert("메시지 수신을 거부한 고객입니다.");
				return false;
			}
		}
				
	}else{//일괄(동보)
		if(ds_list_excel.rowcount > 0){
			var nCnt = ds_list_excel.getCaseCount("rowCheck=='1'");		
			if(nCnt == 0){
				alert("일괄 발송할 목록을 선택하세요")
				return false;
			}
		}else{
			alert("일괄 발송할 목록을 업로드하세요")
			return false;	
		}
		
		
		if (ckb_ad.value) {
			if ( fv_reject_include_cnt >= ds_list_excel.rowcount ) {
				alert("모두 메시지 수신을 거부한 고객입니다.");
				return false;
			}
		}
	}
	
	if (!confirm("문자메시지를 발송하시겠습니까?")) {
		return false;
	}
}

//파일업로드 후 이벤트
function FileUpload00_onload(obj:FileUpload,  e:FileUploadLoadEventInfo)
{
	/*
	trace(e.datasets[0].getColumn(0,"fileSize"));
	var nFileSize = e.datasets[0].getColumn(0,"fileSize");
	if (nFileSize > 512000) { // 500 * 1024 = 512000
		alert("문자메시지 전송 이미지는 500Kb이하의 jpg파일만 가능합니다.");
		return false;
    }
    */
	//업로드 성공 후 받은 데이터셋에서 해당 파일의 파일명을 데이터셋에 저장.
	ds_inqSend.setColumn(0, "attach_file_name", e.datasets[0].getColumn(0,"fileName"));//첨부파일명
	
	//trace(ds_inqSend.saveXML());
	var szSvcid       = "sendMsg";
	var szController  = "/chnl/chat-sndg/send_sysone";
	var szInDs        = "ds_input=ds_inqSend ds_input2=ds_list_excel";
	var szOutDs       = "";
	var szParam       = "";
	var szRetCallback = "fn_callBack";
	
	// 트랜젝션 공통함수 호출
	gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback);
}

// 의전 문자 자동완성
function tab_tabpage1_Grid00_oncelldblclick(obj:Grid, e:GridClickEventInfo)
{
		var sUserAthrCd =gds_UserInfo.getColumn(gds_UserInfo.rowposition,'athr_cd');		
		var ch_id = ds_list_chatCnts.getColumn(e.row, "chat_cnts_id");
		
		if(sUserAthrCd == "OP30"){
			edt_cntr_rprs_tlno.value = '15882227'; // 의전일경우 발신번호 자동입력
		}
		if(ch_id == "CCT201510230017129"){ //현금영수증 보낼시에만 변경
			TextArea_chat_msg_cntn.value = "";
			var pay_text = ds_list_chatCnts.getColumn(e.row, "chat_msg_cntn");
			pay_text = pay_text.replace("◇◇", g_isu_no);
			pay_text = pay_text.replace("☆☆", g_amt);
			pay_text = pay_text.replace("§§", g_appr_no);
			TextArea_chat_msg_cntn.value = pay_text;
			//메시지 사이즈 표시
			var sMsgSize = gfn_getLengthB(ds_list_chatCnts.getColumn(e.row, "chat_msg_cntn"));
			sta_chat_msg_size.text = sMsgSize;
		}else if(ch_id == "CCT201704105812381" || ch_id == "CCT201704105813956" || ch_id == "CCT201704105813992" || 
		         ch_id == "CCT201704105814010" || ch_id == "CCT201704105814136" || ch_id == "CCT201704105814254" || ch_id == "CCT201704105814431"){ // 행사접수/취소/완료
			TextArea_chat_msg_cntn.value = "";
			var pay_text = ds_list_chatCnts.getColumn(e.row, "chat_msg_cntn");
			pay_text = pay_text.replace("○○○", gfn_NullToEmpty(ds_meminfo.getColumn(0, "mem_nm")));
			pay_text = pay_text.replace("☆☆☆", gfn_NullToEmpty(ds_meminfo.getColumn(0, "emple_nm")));
			pay_text = pay_text.replace("◇◇◇◇◇◇", gfn_NullToEmpty(ds_meminfo.getColumn(0, "funrl_hall")));
			pay_text = pay_text.replace("□□□", gfn_NullToEmpty(ds_meminfo.getColumn(0, "evt_mngr_nm")));
			pay_text = pay_text.replace("△△△", gfn_NullToEmpty(ds_meminfo.getColumn(0, "prod_nm")));
			pay_text = pay_text.replace("♡♡♡", gfn_NullToEmpty(ds_meminfo.getColumn(0, "accnt_no")));
			pay_text = pay_text.replace("■■■", gfn_NullToEmpty(ds_meminfo.getColumn(0, "cpcell")));
			pay_text = pay_text.replace("◎◎◎", gfn_NullToEmpty(ds_meminfo.getColumn(0, "cell")));
			pay_text = pay_text.replace("♤♤", gfn_NullToEmpty(ds_meminfo.getColumn(0, "cnt")));
			pay_text = pay_text.replace("◁◁◁", gfn_commaStr(gfn_NullToEmpty(ds_meminfo.getColumn(0, "namt"))));
			pay_text = pay_text.replace("▷▷▷", gfn_commaStr(gfn_NullToEmpty(ds_meminfo.getColumn(0, "jamt"))));
			pay_text = pay_text.replace("▽▽▽", gfn_NullToEmpty(ds_meminfo.getColumn(0, "join_dt")));
			pay_text = pay_text.replace("§§§", gfn_NullToEmpty(ds_meminfo.getColumn(0, "val1")));
			pay_text = pay_text.replace("OOOO", gfn_NullToEmpty(ds_meminfo.getColumn(0, "cncl_nm")));
			TextArea_chat_msg_cntn.value = pay_text;
			//메시지 사이즈 표시
			var sMsgSize = gfn_getLengthB(ds_list_chatCnts.getColumn(e.row, "chat_msg_cntn"));						
		}else if(ch_id == "CCT201802091659720") { // 2018.06.26 회원몰 안내문자 템플릿에 고유번호 자동매칭 요청에 따라 추가
				TextArea_chat_msg_cntn.value = "";
				var pay_text = ds_list_chatCnts.getColumn(e.row, "chat_msg_cntn");
				pay_text = pay_text.replace("★★★", mem_no);
				TextArea_chat_msg_cntn.value = pay_text;
				//메시지 사이즈 표시
				var sMsgSize = gfn_getLengthB(ds_list_chatCnts.getColumn(e.row, "chat_msg_cntn"));
				sta_chat_msg_size.text = sMsgSize;
		}else{
			TextArea_chat_msg_cntn.value = "";
			TextArea_chat_msg_cntn.value = ds_list_chatCnts.getColumn(e.row, "chat_msg_cntn");
			//메시지 사이즈 표시
			var sMsgSize = gfn_getLengthB(ds_list_chatCnts.getColumn(e.row, "chat_msg_cntn"));
			sta_chat_msg_size.text = sMsgSize;
		}
}

function ckb_ad_onclick(obj:CheckBox,  e:ClickEventInfo)
{
	fn_appendAdMsg(obj.value);
}

function fn_appendAdMsg(isAd) {
	
	var sAdMsgHeader = "(광고)";
	var sAdMsgFooter = "무료수신거부 : 080-879-8899";
	var sMsg = gfn_trim(TextArea_chat_msg_cntn.value);
	var sArrMsg = [];
	
	if (isAd) {
		btn_checkReject.enable = true;
		
		if (!gfn_isEmpty(sMsg)) {
			sArrMsg = sMsg.split("\n");
			sArrMsg[0] = sAdMsgHeader + sArrMsg[0];
			sArrMsg.push(sAdMsgFooter);
			sMsg = sArrMsg.join("\n");
			TextArea_chat_msg_cntn.value = sMsg;
		} else {
			TextArea_chat_msg_cntn.value = sAdMsgHeader + "\n\n" + sAdMsgFooter;
		}	
		
	} else {
		btn_checkReject.enable = false;
		fv_reject_include_cnt = -1;
		
		if (!gfn_isEmpty(sMsg)) {
			var sTmp = sMsg.substr(0,4);
			if (sTmp == sAdMsgHeader) {
				sMsg = sMsg.substr(4);
				sMsg = sMsg.replace(sAdMsgFooter, "");
				sMsg = gfn_trim(sMsg);
				TextArea_chat_msg_cntn.value = sMsg;
			}
		}	
	}
}

// SMS 수신거부 목록 조회
function fn_getInfobankSmsRejectList()
{
	if (!ckb_ad.value) {
		fv_reject_include_cnt = 0;
		return;
	}
	
	ds_list_chatCnts.clearData();
	ds_inqCndt.clearData();
	
	ds_inqCndt.addRow();
	ds_inqCndt.setColumn(0, "chat_msg_typ_cd", tab.tabpage1.cbo_chat_msg_typ_cd.value);
	ds_inqCndt.setColumn(0, "chat_msg_titl", tab.tabpage1.edt_chat_msg_titl.value);
	ds_inqCndt.setColumn(0, "chat_msg_cntn", tab.tabpage1.edt_chat_msg_cntn.value);
	ds_inqCndt.setColumn(0, "use_yn", "Y");
	
	ds_list_excel_tmp.clearData();
	ds_list_excel_tmp.copyData(ds_list_excel);
	
	if (!gfn_isEmpty(edt_clph_no.value)) {
		var nPos = ds_list_excel_tmp.addRow();
		ds_list_excel_tmp.setColumn(nPos, "clph_no", edt_clph_no.value);
	}
	
	if (ds_list_excel_tmp.rowcount < 1) {
		alert("수신거부를 체크할 수신번호가 없습니다.");
		return;
	}

	var szSvcid       = "getInfobankSmsRejectList";
    var szController  = "/chnl/chat-sndg-hstr/getInfobankSmsRejectList";
    var szInDs        = "ds_input=ds_list_excel_tmp";
    var szOutDs       = "ds_reject=ds_output";
    var szParam       = "";
    var szRetCallback = "fn_callBack";
	
    // 트랜젝션 공통함수 호출
    gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback);
}

// SMS 수신거부 목록 조회 후처리
function fn_postGetInfobankSmsRejectList()
{
	fv_reject_include_cnt = 0;
	
	var i, nPos;
	ds_list_excel.enableevent = false;
	for (i=0; i<ds_reject.rowcount; ++i) {
	
		nPos = ds_list_excel.findRow("clph_no", ds_reject.getColumn(i, "callnum"));
		if (nPos >= 0) {
			ds_list_excel.setColumn(nPos, "reject_dt", ds_reject.getColumn(i, "reject_dt"));
			ds_list_excel.setColumn(nPos, "reject_yn", "Y");
			ds_list_excel.setColumn(nPos, "rowCheck", "");
		}
	}
	ds_list_excel.enableevent = false;
	tab.tabpage2.Grid00.redraw();
	
	fv_reject_include_cnt = ds_list_excel.getCaseCount("reject_yn == 'Y' && rowCheck=='1'");
	
	if (!gfn_isEmpty(edt_clph_no.value)) {
		var nPos = ds_list_excel_tmp.addRow();
		ds_list_excel_tmp.setColumn(nPos, "clph_no", edt_clph_no.value);
		
		nPos = ds_reject.findRow("callnum", edt_clph_no.value);
		if (nPos >= 0) {
			fv_reject_include_cnt++;
		}
	}
	
	if (fv_reject_include_cnt > 0) {
		alert("수신거부한 고객이 " + fv_reject_include_cnt + " 명 있습니다.");
	} else {
		alert("수신거부 체크를 완료하였습니다.");
	}
}


function tab_tabpage1_cbo_city_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
{
    //alert(e.prevalue);
    if (e.postvalue =="40") 
    {
        alert('알림톡은 미구현된 서비스입니다. 발송불가합니다.');
    }
   
    if(e.postvalue == "50")
    {
	   edt_cntr_rprs_tlno.value = "0269582420";
    }
    else
    {
	   edt_cntr_rprs_tlno.value = "";
    }
}]]></Script>
  </Form>
</FDL>
