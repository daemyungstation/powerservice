<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="MN020105_1" classname="MN010111" inheritanceid="" position="absolute 0 0 770 336" titletext="지부입력창" onload="frm_onload">
    <Layouts>
      <Layout>
        <Static id="stc_31" class="sta_popupBg1" enable="false" position="absolute 0 0 632 334" onclick="stc_31_onclick"/>
        <Static id="stc_05" class="sta_workData" position="absolute 17 213 625 239" style="font:arial,12,bold;"/>
        <Static id="stc_00" class="sta_workData" position="absolute 17 225 625 251" style="font:arial,12,bold;"/>
        <Static id="stc_30" class="sta_popupTitle" transparenthittest="true" position="absolute 10 8 185 28" onclick="stc_30_onclick" text="지부 정보"/>
        <Button id="btn_close" taborder="15" onclick="btn_close_onclick" class="btn_popupClose" position="absolute 595 7 615 26"/>
        <Static id="stc_02" class="sta_workData" position="absolute 17 275 625 301"/>
        <Static id="stc_10" class="sta_workData" position="absolute 17 250 625 276"/>
        <Static id="stc_21" class="sta_workData" position="absolute 17 75 625 101"/>
        <Static id="stc_04" class="sta_workData" position="absolute 17 200 625 226" style="font:arial,12,bold;"/>
        <Static id="stc_15" text="등록" class="sta_workTitle2" position="absolute 17 44 229 64"/>
        <Static id="Static00" text="." position="absolute 133 206 137 223" style="font:arial,14,bold;"/>
        <Edit id="mem_no" taborder="14" readonly="true" enable="false" position="absolute 133 73 305 93"/>
        <Static id="sta_GrayLine" class="sta_WF_Line1" position="absolute 17 72 624 73" anchor="left top right"/>
        <Static id="mem_nm_txt" text="지부코드" class="sta_workLabel1_P" position="absolute 17 75 107 101" validate=""/>
        <Static id="stc_07" text="전화번호" class="sta_workLabel1" position="absolute 17 202 107 228" validate=""/>
        <Edit id="branch_office_tel" taborder="5" inputtype="number,symbol" lengthunit="utf8" maxlength="13" onkillfocus="phone_onkillfocus" onkeydown="mem_onkeydown" ontextchanged="phone_ontextchanged" position="absolute 109 203 263 224"/>
        <Static id="stc_40" text="주소지" class="sta_workLabel1" position="absolute 17 250 107 301" validate=""/>
        <MaskEdit id="branch_zipcode_1" taborder="8" readonly="true" type="string" class="mae_clssEnable" position="absolute 648 246 700 266" style=":disabled {align:center middle;}" oneditclick="funrl_zip_cd_oneditclick" mask="#####" visible="false"/>
        <Button id="btn_srchAddrPop" taborder="7" tabstop="false" onclick="btn_onclick" class="btn_workSrcPop" position="absolute 163 253 183 273"/>
        <Edit id="branch_addr1" taborder="9" enable="false" position="absolute 185 253 621 273"/>
        <Edit id="branch_addr2" taborder="10" imemode="hangul" lengthunit="utf8" maxlength="300" position="absolute 109 278 591 298"/>
        <Button id="btn_save" taborder="11" tabstop="false" onclick="btn_save_onclick" class="btn_WF_Save" position="absolute 479 48 551 68" tooltiptext="저장" style="padding:0 0 0 0;"/>
        <Button id="btn_init" taborder="12" tabstop="false" text="삭제" onclick="btn_delete_onclick" class="btn_WF_Common" position="absolute 553 48 625 68" tooltiptext="초기화" style="border:0 none #000000ff ;padding:0 0 0 0;"/>
        <Static id="stc_01" text="팩스번호" class="sta_workLabel1" position="absolute 17 227 107 253" validate=""/>
        <Edit id="branch_fax_tel" taborder="6" inputtype="number,symbol" lengthunit="utf8" maxlength="13" onkillfocus="phone_onkillfocus" onkeydown="mem_onkeydown" ontextchanged="phone_ontextchanged" position="absolute 109 228 263 249"/>
        <Edit id="branch_cd" taborder="13" imemode="hangul" lengthunit="utf8" maxlength="33" onkeydown="mem_onkeydown" position="absolute 108 77 262 98" readonly="true" style="border:1 solid darkgray transparent;"/>
        <Edit id="branch_nm" taborder="0" imemode="hangul" lengthunit="utf8" maxlength="33" position="absolute 396 77 614 98"/>
        <Static id="mem_nm_txt00" text="지부명" class="sta_workLabel1_P" position="absolute 305 75 395 101" validate=""/>
        <Static id="stc_03" class="sta_workData" position="absolute 17 175 625 201" style="font:arial,12,bold;"/>
        <Static id="Static01" text="." position="absolute 133 181 137 198" style="font:arial,14,bold;"/>
        <Static id="stc_06" text="담당연락처" class="sta_workLabel1" position="absolute 17 177 107 203" validate=""/>
        <Edit id="branch_mngr_tel" taborder="4" inputtype="number,symbol" lengthunit="utf8" maxlength="13" onkillfocus="phone_onkillfocus" onkeydown="mem_onkeydown" ontextchanged="phone_ontextchanged" position="absolute 109 178 263 199"/>
        <Static id="stc_08" class="sta_workData" position="absolute 17 100 625 126"/>
        <Static id="stc_09" class="sta_workData" position="absolute 17 125 625 151"/>
        <Edit id="branch_mngr_nm" taborder="2" imemode="hangul" lengthunit="utf8" maxlength="33" onkeydown="mem_onkeydown" position="absolute 108 127 262 148"/>
        <Static id="stc_11" class="sta_workData" position="absolute 17 150 625 176"/>
        <Edit id="branch_email" taborder="3" imemode="hangul" lengthunit="utf8" maxlength="33" onkeydown="mem_onkeydown" position="absolute 108 152 262 173"/>
        <Static id="stc_12" text="담당 email" class="sta_workLabel1" position="absolute 17 151 108 177" validate=""/>
        <Static id="stc_13" text="담당자명" class="sta_workLabel1" position="absolute 17 125 107 151" validate=""/>
        <Static id="stc_14" text="구분" class="sta_workLabel1" position="absolute 17 100 107 126" validate=""/>
        <Combo id="Combo_gubun" taborder="1" text="전체" position="absolute 108 103 262 123" codecolumn="codecolumn" datacolumn="datacolumn" index="0" onitemchanged="Combo_gubun_onitemchanged">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn"/>
                <Col id="datacolumn">전체</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0001</Col>
                <Col id="datacolumn">직영</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0002</Col>
                <Col id="datacolumn">외주</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0003</Col>
                <Col id="datacolumn">위촉</Col>
              </Row>
            </Rows>
          </Dataset>
        </Combo>
        <Edit id="lgn_id" taborder="20" imemode="hangul" lengthunit="utf8" maxlength="33" onkeydown="mem_onkeydown" position="absolute 158 339 312 360" visible="false"/>
        <Static id="mem_nm_txt01" text="사용여부" class="sta_workLabel1" position="absolute 305 100 395 126" validate=""/>
        <Combo id="cbo_use_yn" taborder="21" value="Y" text="사용" codecolumn="codecolumn" datacolumn="datacolumn" index="0" position="absolute 396 103 496 123">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn">Y</Col>
                <Col id="datacolumn">사용</Col>
              </Row>
              <Row>
                <Col id="codecolumn">N</Col>
                <Col id="datacolumn">미사용</Col>
              </Row>
            </Rows>
          </Dataset>
        </Combo>
        <Edit id="branch_zipcode" taborder="22" readonly="true" position="absolute 108 253 162 273" style="background:URL('theme://images/bg_compD.png') stretch 5,5;color:#999999ff;align:center middle;"/>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item6" compid="branch_cd" propid="value" datasetid="ds_ocbCardCode" columnid="branch_cd"/>
      <BindItem id="item0" compid="mem_no" propid="value" datasetid="ds_member" columnid="mem_no"/>
      <BindItem id="item10" compid="branch_office_tel" propid="value" datasetid="ds_ocbCardCode" columnid="branch_office_tel"/>
      <BindItem id="item14" compid="branch_zipcode_1" propid="value" datasetid="ds_ocbCardCode" columnid="branch_zipcode"/>
      <BindItem id="item12" compid="branch_addr1" propid="value" datasetid="ds_ocbCardCode" columnid="branch_addr1"/>
      <BindItem id="item13" compid="branch_addr2" propid="value" datasetid="ds_ocbCardCode" columnid="branch_addr2"/>
      <BindItem id="item3" compid="branch_fax_tel" propid="value" datasetid="ds_ocbCardCode" columnid="branch_fax_tel"/>
      <BindItem id="item1" compid="branch_nm" propid="value" datasetid="ds_ocbCardCode" columnid="branch_nm"/>
      <BindItem id="item2" compid="branch_mngr_tel" propid="value" datasetid="ds_ocbCardCode" columnid="branch_mngr_tel"/>
      <BindItem id="item7" compid="branch_mngr_nm" propid="value" datasetid="ds_ocbCardCode" columnid="branch_mngr_nm"/>
      <BindItem id="item9" compid="branch_email" propid="value" datasetid="ds_ocbCardCode" columnid="branch_email"/>
      <BindItem id="item4" compid="Combo_gubun" propid="value" datasetid="ds_ocbCardCode" columnid="dir_out_gubun"/>
      <BindItem id="item5" compid="lgn_id" propid="value" datasetid="ds_ocbCardCode" columnid="lgn_id"/>
      <BindItem id="item23" compid="cbo_use_yn" propid="value" datasetid="ds_evt_mana_mng" columnid="use_yn"/>
      <BindItem id="item25" compid="branch_zipcode" propid="value" datasetid="ds_ocbCardCode" columnid="branch_zipcode"/>
    </Bind>
    <Objects>
      <Dataset id="ds_trans_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="strSvcID" type="STRING" size="256"/>
          <Column id="strURL" type="STRING" size="256"/>
          <Column id="strInDatasets" type="STRING" size="256"/>
          <Column id="strOutDatasets" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ocbCardCode" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="seq" type="STRING" size="256"/>
          <Column id="branch_cd" type="STRING" size="256"/>
          <Column id="branch_nm" type="STRING" size="256"/>
          <Column id="branch_mngr_nm" type="STRING" size="256"/>
          <Column id="branch_mngr_tel" type="STRING" size="256"/>
          <Column id="branch_office_tel" type="STRING" size="256"/>
          <Column id="branch_fax_tel" type="STRING" size="256"/>
          <Column id="branch_email" type="STRING" size="256"/>
          <Column id="branch_zipcode" type="STRING" size="256"/>
          <Column id="branch_addr1" type="STRING" size="256"/>
          <Column id="dir_out_gubun" type="STRING" size="256"/>
          <Column id="branch_addr2" type="STRING" size="256"/>
          <Column id="lgn_id" type="STRING" size="256"/>
          <Column id="use_yn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list_tmp" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="seq" type="STRING" size="256"/>
          <Column id="branch_cd" type="STRING" size="256"/>
          <Column id="branch_nm" type="STRING" size="256"/>
          <Column id="branch_mngr_nm" type="STRING" size="256"/>
          <Column id="branch_mngr_tel" type="STRING" size="256"/>
          <Column id="branch_office_tel" type="STRING" size="256"/>
          <Column id="branch_fax_tel" type="STRING" size="256"/>
          <Column id="branch_email" type="STRING" size="256"/>
          <Column id="branch_zipcode" type="STRING" size="256"/>
          <Column id="branch_addr1" type="STRING" size="256"/>
          <Column id="dir_out_gubun" type="STRING" size="256"/>
          <Column id="branch_addr2" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/********************************************************************************************/
/* 1. Include Library include, variables Declaration 영역                                  */
/********************************************************************************************/
include "LIB::lib_All.xjs";
var gv_jab_sel = "";				// 입력인지 조회인지  입력이면 1  조회면 2
var gv_branch_cd = "";				// 회원고유번호
//온로드

function frm_onload(obj:Form, e:LoadEventInfo)
{   
 
	gv_branch_cd = p_branch_cd;
	//trace(gv_funrl_cd);
	if ( gv_branch_cd != ""  && gv_branch_cd != null ) {
		gv_jab_sel  ="2";
		trace(gv_branch_cd);
		fn_OcbCardSave("select") ;  /// 조회일경우.. 조회함수 바로 고고
   	} else {
		gv_jab_sel  ="1"; 
		ds_ocbCardCode.clearData();
		ds_ocbCardCode.addRow();
	    branch_cd.enable=false;
	    cbo_use_yn.index = 0;
	   	}
}




/********************************************************************************************/
/* 3. Callback(gfn_Transaction 호출 후 처리내용)                                   		*/
/********************************************************************************************/
function fn_callBack(svcid, errcd, errmsg) 
{
	switch (svcid) {
		case "branch_insert":

		ds_ocbCardCode.clear();
		gfn_appendSearchDs(ds_ocbCardCode, ds_list_tmp);
		alert("저장완료하였습니다.");
		//fn_postSearch();
		close();
		break;
		
		case "branch_update":
			//ds_ocbCardCode.clear();
			//gfn_appendSearchDs(ds_ocbCardCode, ds_list_tmp);
			alert("수정하였습니다.");
			//trace(ds_ocbCardCode.saveXML());
			fn_postSearch();
		break;
		case "branch_select":
		  
			ds_ocbCardCode.clear();
			gfn_appendSearchDs(ds_ocbCardCode, ds_list_tmp);
			//trace(ds_ocbCardCode.saveXML());
			fn_postSearch();
		break;
		
		case "branch_delete":
		    alert("삭제완료했습니다..");
			close();
		break;

	}

}

/********************************************************************************************/
/**   4. Validation 처리                                                                   	*/
/********************************************************************************************/
// 저장  전
function fn_preOcbCardSave(){
     
	if (gfn_isNull(branch_nm.value)) {
		
			alert("장례식장명을 입력하세요.");
			return false;
		
	/*	}else if(gfn_isNull(branch_tel.value)){
		
			alert("전화번호를 입력하세요.");
				return false;
				
		
		}else if(gfn_isNull(funrl_zip_cd.value)){
		
			alert("우편번호를 입력하세요.");
		    return false;
	
		}else if(gfn_isNull(funrl_addr.value) && gfn_isNull(funrl_addr2.value)  ){
		
			alert("주소를 입력하세요.");
		    return false;
			*/
		}else{
		//	alert("enter validate");
	

       var oUser = gfn_getUserInfo();    
		ds_ocbCardCode.setColumn(0, "branch_nm", branch_nm.value);
		ds_ocbCardCode.setColumn(0, "dir_out_gubun", Combo_gubun.value);
		ds_ocbCardCode.setColumn(0, "branch_mngr_nm", branch_mngr_nm.value);
		ds_ocbCardCode.setColumn(0, "branch_mngr_tel", branch_mngr_tel.value);
		ds_ocbCardCode.setColumn(0, "branch_email", branch_email.value);
		ds_ocbCardCode.setColumn(0, "branch_office_tel", branch_office_tel.value);
		ds_ocbCardCode.setColumn(0, "branch_fax_tel", branch_fax_tel.value);
		ds_ocbCardCode.setColumn(0, "branch_zipcode", branch_zipcode.value);
		ds_ocbCardCode.setColumn(0, "branch_addr1", branch_addr1.value);
		ds_ocbCardCode.setColumn(0, "branch_addr2", branch_addr2.value);
		ds_ocbCardCode.setColumn(0, "lgn_id", oUser.lgn_id);
		ds_ocbCardCode.setColumn(0, "use_yn", cbo_use_yn.value);		
	}

	return true;
}




/********************************************************************************************/
/**   5. 서비스 호출(gfn_Transaction)                                                   	*/
/********************************************************************************************/

// OCB 카드코드 등록
function fn_OcbCardSave(sid)
{     
    var oUser = gfn_getUserInfo();    /// 유저아이디 가져오기
  
     
	if (sid !='select' && sid !='update' && sid !='delete') {                 ///  조회가 아닐경우만 체크
		if (!fn_preOcbCardSave()) return false;
	}
	
	if (sid =='insert') {
	trace(ds_ocbCardCode.saveXML());
		var szSvcid       = "branch_insert";
		var szController  = "/dlw/basiDataMng/branch_insert";
		var szInDs        = "ds_input=ds_ocbCardCode";
		var szOutDs       = "";
		var szParam       = "";
		var szRetCallback = "fn_callBack";
    } 
    if (sid =='update') {
    
        lgn_id.value=oUser.lgn_id;
		var szSvcid       = "branch_update";
		var szController  = "/dlw/basiDataMng/branch_update";
		var szInDs        = "ds_input=ds_ocbCardCode";
		var szOutDs       = "";
		var szParam       = "";
		var szRetCallback = "fn_callBack";
    } 
    if (sid =='select') {
        ds_ocbCardCode.clearData();
		var nRow = ds_ocbCardCode.addRow();
		ds_ocbCardCode.setColumn(nRow, "branch_cd", gv_branch_cd); 
		
	   
		var szSvcid       = "branch_select";
		var szController  = "/dlw/basiDataMng/branch_select";
		var szInDs        = "ds_input=ds_ocbCardCode";
		var szOutDs       = "ds_list_tmp=ds_output";
		var szParam       = "";
		var szRetCallback = "fn_callBack";
	 }
	 if (sid =='delete') {
        ds_ocbCardCode.clearData();
		var nRow = ds_ocbCardCode.addRow();
		ds_ocbCardCode.setColumn(nRow, "branch_cd", gv_branch_cd); 
		var szSvcid       = "branch_delete";
		var szController  = "/dlw/basiDataMng/branch_delete";
		var szInDs        = "ds_input=ds_ocbCardCode";
		var szOutDs       = "";
		var szParam       = "";
		var szRetCallback = "fn_callBack";
	 }
	 

    // 트랜젝션 공통함수 호출
    gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback);
}



/********************************************************************************************/
/**   7. 이벤트(Event) Function                                                          	*/
/********************************************************************************************/

//저장
function btn_save_onclick(obj:Button,  e:ClickEventInfo)
{
   
 
   if  (gv_jab_sel  =="1") { 
		fn_OcbCardSave("insert");
	} else {
		fn_OcbCardSave("update");
	}
}

//닫기
function btn_close_onclick(obj:Button,  e:ClickEventInfo)
{
	close();
}


   //조회 결과 
   function fn_postSearch()
   {
   	if(ds_ocbCardCode.rowcount < 1) {
   		alert("조회된 자료가 없습니다.");
   		ds_ocbCardCode.clearData();
   	}
   }
   
function btn_delete_onclick(obj:Button,  e:ClickEventInfo)
{
   trace("aaaaaaaaaa:"+gv_jab_sel);
  if (gv_jab_sel =="2" ) {
	 fn_OcbCardSave("delete");
   } else {
     alert("조회후 삭제가 가능합니다.");
     return;
   }	 
}

function Combo_gubun_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
{
	
}

function btn_onclick(obj:Button,  e:ClickEventInfo)
{	
	//var reVal = gfn_diaLog("우편번호조회", -1, -1, -1, -1, "PS990000::PS994100.xfdl", false, {}, true, false, true, null, null, true);
	// 기존 주소검색 폐지 / 2017.04.10 부로 다음API사용
	var sPrmr = {};
	var reVal = gfn_diaLog("주소 조회", -1, -1, 884, 601, "PS990000::PS992099.xfdl", false, sPrmr, false, false, true);		
}

// 주소 값 등록(팝업창 호출)
function fn_daum_addr()
{
	branch_zipcode.value = gv_dpost; 
	branch_addr1.value = gv_daddr;	
}
]]></Script>
  </Form>
</FDL>
