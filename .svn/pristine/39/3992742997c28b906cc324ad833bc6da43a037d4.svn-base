<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="DL520001_05" classname="srch_dept_pop" inheritanceid="" position="absolute 0 0 558 325" titletext="임의등록_NEW" onload="PS993102_onload" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="stc_popup_free" class="sta_popupBg1" enable="false" position="absolute 0 -1 556 439" visible="false"/>
        <Static id="stc_03" class="sta_workData" position="absolute 100 144 554 170"/>
        <Static id="stc_popup" class="sta_popupBg1" enable="false" position="absolute 0 -1 556 319"/>
        <Button id="btn_Close" taborder="0" onclick="btn_close_onclick" class="btn_popupClose" position="absolute 532 8 552 27"/>
        <Static id="stc_title" text="임의등록_INIC" class="sta_popupTitle" transparenthittest="true" position="absolute 10 8 297 28"/>
        <Static id="sta_GrayLine" class="sta_WF_Line1" position="absolute 5 65 551 66"/>
        <Static id="stc_17" class="sta_workData" position="absolute 98 66 552 92"/>
        <Static id="stc_01" onclick="div_Work_tab_02_tabpage1_stc_01_onclick" class="sta_workData" position="absolute 100 91 552 117"/>
        <Static id="stc_04" class="sta_workData" position="absolute 668 116 1120 142" enable="false" visible="false"/>
        <Static id="stc_09" text="청구납입금액" class="sta_workLabel1" position="absolute 289 91 383 117" style="font:Dotum,8;" validate=""/>
        <Edit id="edt_accnt_no" taborder="1" enable="true" position="absolute 101 68 262 90" readonly="false" visible="true" onkeydown="edt_accnt_onkeydown" maxlength="12" inputmode="upper" inputfilter="dot,comma,space" imemode="none" inputtype="numberandenglish"/>
        <Edit id="edt_pay_amt" taborder="3" inputtype="number" position="absolute 384 93 550 115" maxlength="16" enable="false" visible="true"/>
        <Edit id="edt_mem_nm" taborder="2" position="absolute 384 68 525 90" enable="true" onkeydown="edt_accnt_onkeydown"/>
        <Button id="btn_Cancel" taborder="4" text="닫기" onclick="btn_close_onclick" class="btn_Cancel" position="absolute 476 42 548 62" tooltiptext="취" style="border:0 none #000000ff ;padding:0 0 0 0;"/>
        <Button id="btn_addWdrw" taborder="5" text="등록" class="btn_Cancel" position="absolute 330 42 402 62" tooltiptext="취" style="border:0 none #000000ff ;padding:0 0 0 0;" onclick="btn_addWdrw_onclick" visible="true" enable="false"/>
        <Static id="stc_brdt" text="회원명" class="sta_workLabel1" position="absolute 289 66 383 92" style="font:Dotum,8;" validate=""/>
        <Static id="stc_bank_accnt_no" text="계좌/카드No" class="sta_workLabel1" position="absolute 857 116 951 142" style="font:Dotum,8;" validate="" visible="false"/>
        <Static id="stc_bank" text="은행/카드사" class="sta_workLabel1" position="absolute 573 116 667 142" style="font:Dotum,8;" validate="" visible="false"/>
        <Static id="stc_11" text="회원번호" class="sta_workLabel1" position="absolute 5 66 99 92" style="font:Dotum,8;" validate=""/>
        <Static id="stc_12" text="청구납입횟수" class="sta_workLabel1" position="absolute 5 91 99 117" style="font:Dotum,8;" validate=""/>
        <Button id="btn_accnt_no" taborder="6" onclick="btn_accnt_onclick" class="btn_workSrcPop" position="absolute 265 69 285 89"/>
        <Button id="btn_mem_nm" taborder="7" onclick="btn_accnt_onclick" class="btn_workSrcPop" position="absolute 528 69 548 89"/>
        <Spin id="spn_inv_gunsu" taborder="8" position="absolute 102 92 196 115" max="999" onspin="spn_inv_gunsu_onspin" enable="false" visible="true" onkeydown="spn_inv_gunsu_onkeydown" min="1"/>
        <Static id="stc_inv_dt" text="청구일자" class="sta_workLabel1" position="absolute 5 116 99 142" style="font:Dotum,8;" validate=""/>
        <Static id="stc_alert2" visible="true" style="color:red;font:arial,8;" anchor="default" position="absolute 248 94 278 117"/>
        <Grid id="grd_list" taborder="9" binddataset="ds_wdrwList" useinputpanel="false" cellsizingtype="col" oncellclick="Grid_oncellclick" onheadclick="grd_onheadclick" position2="absolute l:3 r:6 t:239 b:254" positiontype="position2" visible="false">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="29"/>
                <Column size="44"/>
                <Column size="100"/>
                <Column size="103"/>
                <Column size="59"/>
                <Column size="81"/>
                <Column size="158"/>
                <Column size="85"/>
                <Column size="62"/>
                <Column size="84"/>
                <Column size="97"/>
                <Column size="77"/>
                <Column size="87"/>
                <Column size="102"/>
                <Column size="152"/>
                <Column size="74"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="checkbox"/>
                <Cell col="1" text="순번"/>
                <Cell col="2" text="구회원번호"/>
                <Cell col="3" text="회원번호"/>
                <Cell col="4" text="회원명"/>
                <Cell col="5" text="카드사"/>
                <Cell col="6" text="카드번호"/>
                <Cell col="7" text="결제일"/>
                <Cell col="8" text="유효기간"/>
                <Cell col="9" text="납입상태"/>
                <Cell col="10" text="산출구분"/>
                <Cell col="11" text="청구횟수"/>
                <Cell col="12" text="할부개월수"/>
                <Cell col="13" text="청구금액"/>
                <Cell col="14" text="청구내역"/>
                <Cell col="15" text="출금회차"/>
                <Cell col="16"/>
              </Band>
              <Band id="body">
                <Cell displaytype="checkbox" edittype="checkbox" text="bind:_chk"/>
                <Cell col="1" expr="currow+1"/>
                <Cell col="2" displaytype="text" edittype="readonly" text="bind:old_mid" editdisplay="display" combodisplay="edit"/>
                <Cell col="2" displaytype="text" edittype="readonly" text="bind:old_mid" editdisplay="display" combodisplay="edit"/>
                <Cell col="3" displaytype="text" edittype="readonly" text="bind:accnt_no" editdisplay="display"/>
                <Cell col="4" text="bind:mem_nm"/>
                <Cell col="5" text="bind:card_nm"/>
                <Cell col="6" text="bind:card_no" expr="gfn_CardStr(card_no)"/>
                <Cell col="7" text="bind:pay_dt"/>
                <Cell col="8" text="bind:expire_date"/>
                <Cell col="9" text="bind:delay_stat"/>
                <Cell col="10" text="bind:cl"/>
                <Cell col="11" text="bind:inv_gunsu"/>
                <Cell col="12" text="bind:install_period"/>
                <Cell col="13" style="align:right;" text="bind:wdrw_req_amt" expr="gfn_commaStr(wdrw_req_amt)"/>
                <Cell col="14" text="bind:bank_filin_brkdn"/>
                <Cell col="15" text="bind:inv_no"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="stc_07" onclick="div_Work_tab_02_tabpage1_stc_01_onclick" class="sta_workData" position="absolute 100 116 552 142"/>
        <Button id="btn_delWdrw" taborder="10" text="삭제" onclick="btn_delWdrw_onclick" enable="false" position="absolute 403 42 475 62" tooltiptext="취" style="border:0 none #000000ff ;padding:0 0 0 0;" class="btn_Cancel"/>
        <Edit id="edt_ichaeCd" taborder="11" enable="false" visible="false" position="absolute 668 118 856 140"/>
        <Calendar id="cal_req_day" taborder="12" dateformat="yyyy-MM-dd" position="absolute 102 118 197 140" enable="false" ontextchanged="cal_req_day_ontextchanged"/>
        <Edit id="edt_ichaeNo" taborder="13" position="absolute 952 118 1118 140" enable="false" visible="false"/>
        <Static id="stc_05" text="산출(청구) 현황" class="sta_workTitle2" position2="absolute l:5 w:147 t:188 h:20" positiontype="position2"/>
        <Button id="btn_realtime" taborder="14" position="absolute 78 42 150 62" tooltiptext="취" style="border:0 none #000000ff ;padding:0 0 0 0;" text="실시간 결제" enable="true" onclick="btn_realtime_onclick"/>
        <Grid id="grdList" taborder="15" binddataset="ds_wdrw_accnt_info" useinputpanel="false" position="absolute 5 215 551 312" autosizingtype="col" autofittype="col" oncellclick="grdList_oncellclick">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="0"/>
                <Column size="70"/>
                <Column size="70"/>
                <Column size="70"/>
                <Column size="300"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="normal" text="회원번호"/>
                <Cell col="1" text="청구일"/>
                <Cell col="2" text="청구회차"/>
                <Cell col="3" text="청구금액"/>
                <Cell col="4" displaytype="normal" text="내역"/>
              </Band>
              <Band id="body">
                <Cell displaytype="normal" text="bind:accnt_no"/>
                <Cell col="1" displaytype="date" style="align: ;" text="bind:req_day"/>
                <Cell col="2" displaytype="number" text="bind:req_pay_no"/>
                <Cell col="3" displaytype="number" style="align:right;" text="bind:pay_amt"/>
                <Cell col="4" displaytype="normal" style="align:left;color:expr:del_fg=='N' ? &quot;red&quot; : del_fg == 'V' ? &quot;red&quot; : (del_fg == 'R' ? &quot;red&quot; : &quot;&quot;);color2:expr:del_fg=='N' ? &quot;red&quot; : del_fg == 'V' ? &quot;red&quot; : (del_fg == 'R' ? &quot;red&quot; : &quot;&quot;);font:arial,8,bold;selectcolor:expr:del_fg=='N' ? &quot;red&quot; : del_fg == 'V' ? &quot;red&quot; : (del_fg == 'R' ? &quot;red&quot; : &quot;&quot;);selectfont:arial,8,bold;" text="bind:del_fg" expr="req_temp == '02' ? &quot;산출중인 회원입니다.&quot; : (req_temp == '03' ? &quot;청구중인 회원입니다.&quot; : req_temp =='01' ? &quot;가상계좌 청구중인 회원입니다.&quot; : &quot;완료 성공 또는 완료 실패&quot;)"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Edit id="edit_pay_bit" taborder="16" inputtype="number" maxlength="16" enable="false" position="absolute 384 118 474 140"/>
        <Static id="stc_00" text="PAY_BIT" class="sta_workLabel1" position="absolute 289 116 383 142" style="font:Dotum,8;" validate=""/>
        <Static id="stc_06" text="오류내역" class="sta_workLabel1" position="absolute 5 141 99 175" style="font:Dotum,8;" validate=""/>
        <Static id="sta_GrayLine01" class="sta_WF_Line1" position="absolute 6 174 552 175"/>
        <Static id="stc_alert1" style="color:mediumblue;font:arial,8;" anchor="default" position="absolute 205 94 235 117"/>
        <Static id="stc_errorMsg" position2="absolute l:105 w:415 t:145 h:28" positiontype="position2" style="color:red;"/>
        <Static id="stc_alert3" position2="absolute r:280 w:75 t:118 h:23" positiontype="position2" style="color:red;align:center;font:arial,8;" visible="false"/>
        <Edit id="edit_pay_mthd" taborder="17" inputtype="number" maxlength="16" enable="false" position="absolute 476 118 550 140"/>
        <Button id="btn_open_free_realtime" taborder="18" text="자유 결제" onclick="btn_open_free_realtime_onclick" position="absolute 5 42 77 62" style="border:0 none #000000ff ;padding:0 0 0 0;" visible="false"/>
        <Edit id="edt_expr_no" taborder="19" tabstop="false" readonly="true" class="edt_clssEnable" visible="false" position2="absolute l:702 w:36 t:362 h:22" positiontype="position2"/>
        <Edit id="edt_prod_cl" taborder="20" tabstop="false" readonly="true" class="edt_clssEnable" visible="false" position2="absolute l:205 w:36 t:358 h:22" positiontype="position2"/>
        <Edit id="edt_gbn" taborder="21" tabstop="false" readonly="true" class="edt_clssEnable" visible="false" position2="absolute l:205 w:36 t:382 h:22" positiontype="position2"/>
        <Static id="stc_16" text="카드 결제 정보" class="sta_workTitle2" position2="absolute l:6 w:115 t:327 h:20" positiontype="position2"/>
        <Static id="stc_18" text="결제일" class="sta_workLabel1" position="absolute 6 406 74 432" style="padding:6 10 0 10;font:Dotum,8;" validate=""/>
        <Static id="stc_08" class="sta_workData" position="absolute 73 406 547 432"/>
        <Static id="stc_02" text="생년월일" class="sta_workLabel1" position="absolute 6 381 74 407" style="padding:6 10 0 10;align:left top;font:Dotum,8;" validate=""/>
        <Static id="stc_10" class="sta_workData" position="absolute 73 381 547 407"/>
        <Static id="stc_13" text="카드사" class="sta_workLabel1" position="absolute 6 356 74 382" style="padding:6 10 0 10;font:Dotum,8;" validate=""/>
        <Static id="stc_14" class="sta_workData" position="absolute 73 356 547 383"/>
        <Static id="sta_GrayLine02" class="sta_WF_Line1" position="absolute 6 355 548 356"/>
        <Static id="Static01" text="월" position2="absolute l:525 w:13 t:361 h:19" positiontype="position2"/>
        <Edit id="edt_idn_no" taborder="26" inputtype="number" maxlength="7" ontextchanged="common_ontextchanged" class="edt_clssEnable" position="absolute 75 383 158 405"/>
        <Static id="Static00" text="년" position2="absolute l:471 w:20 t:361 h:19" positiontype="position2"/>
        <Edit id="edt_card_mon" taborder="25" inputtype="number" maxlength="2" ontextchanged="common_ontextchanged" class="edt_clssEnable" position2="absolute l:491 w:29 t:358 h:22" positiontype="position2"/>
        <Edit id="edt_card_year" taborder="24" inputtype="number" maxlength="2" ontextchanged="common_ontextchanged" class="edt_clssEnable" position2="absolute l:437 w:29 t:358 h:22" positiontype="position2"/>
        <Edit id="edt_card_no" taborder="23" inputtype="number" maxlength="19" onkillfocus="card_onkillfocus" ontextchanged="card_ontextchanged" class="edt_clssEnable" position2="absolute l:232 w:135 t:358 h:22" positiontype="position2"/>
        <Combo id="cbo_cardCd" taborder="22" innerdataset="ds_card_typ" codecolumn="cd" datacolumn="cd_nm" class="edt_clssEnable" position="absolute 75 358 158 380" onitemchanged="cbo_cardCd_onitemchanged"/>
        <Edit id="edt_pay_dt" taborder="29" tabstop="false" readonly="true" class="edt_clssEnable" position2="absolute l:75 w:83 t:408 h:22" positiontype="position2"/>
        <Edit id="edt_free_pay_amt" taborder="28" inputtype="number" maxlength="10" class="edt_clssEnable" position2="absolute l:437 w:94 t:383 h:22" positiontype="position2"/>
        <Spin id="spn_dc_no" taborder="27" max="12" position="absolute 231 408 294 430" tabstop="true" value="0"/>
        <Static id="stc_15" text="할부기간" class="sta_workLabel1" position="absolute 159 406 230 432" style="padding:6 10 0 10;font:Dotum,8;" validate=""/>
        <Static id="stc_19" text="결제금액" class="sta_workLabel1" position="absolute 368 381 435 407" style="padding:6 10 0 10;font:Dotum,8;" validate=""/>
        <Static id="stc_20" text="유효기간" class="sta_workLabel1" position="absolute 368 356 435 382" style="padding:6 10 0 10;font:Dotum,8;" validate=""/>
        <Static id="stc_21" text="카드번호" class="sta_workLabel1" position="absolute 160 356 230 382" style="padding:6 10 0 10;font:Dotum,8;" validate=""/>
        <Static id="sta_GrayLine03" class="sta_WF_Line1" position="absolute 4 319 550 320" visible="true"/>
        <Button id="btn_free_realtime_init" taborder="30" tabstop="false" class="btn_WF_Return" position="absolute 589 332 661 352" tooltiptext="초기화" onclick="btn_free_realtime_init_onclick" visible="false"/>
        <Button id="btn_Del03" taborder="31" tabstop="false" text="닫기" onclick="btn_close_onclick" class="btn_Cancel" position="absolute 580 196 652 216" tooltiptext="취" style="border:0 none #000000ff ;padding:0 0 0 0;" visible="false"/>
        <Button id="btn_free_realtime" taborder="32" tabstop="false" text="가상계좌등록" class="btn_Cancel" position="absolute 459 325 547 345" tooltiptext="취" style="border:0 none #000000ff ;padding:0 0 0 0;" onclick="btn_free_realtime_onclick"/>
        <CheckBox id="ckb_niceBillkey" taborder="34" text="나이스 전용 체크" value="1" truevalue="100" falsevalue="1" position2="absolute r:-234 w:164 t:452 h:20" positiontype="position2" visible="false"/>
        <Button id="btn_open_virtual" taborder="35" text="가상 계좌" visible="false" position="absolute 589 304 661 324" tooltiptext="취" style="border:0 none #000000ff ;padding:0 0 0 0;" onclick="btn_open_virtual_onclick"/>
        <Calendar id="cal_vir_day" taborder="36" dateformat="yyyy-MM-dd" ontextchanged="cal_req_day_ontextchanged" enable="true" position="absolute 273 324 368 346"/>
        <Combo id="cbo_bankCd" taborder="37" innerdataset="@ds_bank_typ" codecolumn="cd" datacolumn="cd_nm" onitemchanged="cbo_cardCd_onitemchanged" class="edt_clssEnable" position="absolute 187 324 270 346"/>
        <Static id="stc_22" text="은행" class="sta_workLabel1" position="absolute 136 324 186 347" style="padding:6 10 0 10;font:Dotum,8;" validate=""/>
        <CheckBox id="ckb_virtualYn" taborder="38" text="가상계좌" value="1" truevalue="100" falsevalue="1" visible="true" position2="absolute r:210 w:92 t:42 h:20" positiontype="position2" onchanged="ckb_virtualYn_onchanged"/>
        <CheckBox id="ckb_event" taborder="39" text="행사회원" value="100" truevalue="100" falsevalue="1" visible="true" position2="absolute r:28 w:83 t:411 h:20" positiontype="position2" readonly="true"/>
        <Spin id="spn_free_gunsu" taborder="40" max="999" min="1" enable="false" position="absolute 232 383 294 405" type="noneditable" onspin="spn_free_gunsu_onspin" ontextchanged="spn_free_gunsu_ontextchanged"/>
        <Static id="stc_23" text="청구회차" class="sta_workLabel1" position="absolute 160 381 230 407" style="padding:6 10 0 10;font:Dotum,8;" validate=""/>
        <Static id="stc_alert_free" position="absolute 302 383 365 407" style="color:red;font:arial,9,bold;"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_trans_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="strSvcID" type="STRING" size="256"/>
          <Column id="strURL" type="STRING" size="256"/>
          <Column id="strInDatasets" type="STRING" size="256"/>
          <Column id="strOutDatasets" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_inqCndt" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="mode" type="STRING" size="256"/>
          <Column id="wdrw_gubun" type="STRING" size="256"/>
          <Column id="sController" type="STRING" size="256"/>
          <Column id="dsName" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_accntInqCndt" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="srch_typ" type="STRING" size="256"/>
          <Column id="srch_vl" type="STRING" size="256"/>
          <Column id="option" type="STRING" size="256"/>
          <Column id="ns_yn" type="STRING" size="256"/>
          <Column id="popup_yn" type="STRING" size="256"/>
          <Column id="orderBy" type="STRING" size="256"/>
          <Column id="orderDirection" type="STRING" size="256"/>
          <Column id="sController" type="STRING" size="256"/>
          <Column id="dsName" type="STRING" size="256"/>
          <Column id="req_gunsu" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_wdrwInqCndt" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="mode" type="STRING" size="256"/>
          <Column id="wdrw_gubun" type="STRING" size="256"/>
          <Column id="sController" type="STRING" size="256"/>
          <Column id="dsName" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_wdrw_accnt_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="del_fg" type="STRING" size="256"/>
          <Column id="req_temp" type="STRING" size="256"/>
          <Column id="pay_amt" type="BIGDECIMAL" size="256"/>
          <Column id="req_day" type="STRING" size="256"/>
          <Column id="ichae_cd" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_accnt_base_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="mem_nm" type="STRING" size="256"/>
          <Column id="prod_nm" type="STRING" size="256"/>
          <Column id="emple_nm" type="STRING" size="256"/>
          <Column id="pay_mthd" type="STRING" size="256"/>
          <Column id="brth_mon_day" type="STRING" size="256"/>
          <Column id="ichae_cd" type="STRING" size="256"/>
          <Column id="ichae_no" type="STRING" size="256"/>
          <Column id="ichae_nm" type="STRING" size="256"/>
          <Column id="mem_no" type="STRING" size="256"/>
          <Column id="req_pay_no" type="STRING" size="256"/>
          <Column id="req_pay_bit" type="STRING" size="256"/>
          <Column id="pay_amt" type="STRING" size="256"/>
          <Column id="tot_pay_cnt" type="STRING" size="256"/>
          <Column id="event_req_yn" type="STRING" size="256"/>
          <Column id="refund_proc_yn" type="STRING" size="256"/>
          <Column id="ini_yn" type="STRING" size="256"/>
          <Column id="cell" type="STRING" size="256"/>
          <Column id="kstbit" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_tempAccnt_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="prod_cd" type="STRING" size="256"/>
          <Column id="pay_mthd" type="STRING" size="256"/>
          <Column id="req_bit" type="STRING" size="256"/>
          <Column id="stat" type="STRING" size="256"/>
          <Column id="kstbit" type="STRING" size="256"/>
          <Column id="true_cnt" type="STRING" size="256"/>
          <Column id="inv_gunsu" type="STRING" size="256"/>
          <Column id="pay_bit" type="STRING" size="256"/>
          <Column id="bid" type="STRING" size="256"/>
          <Column id="ichae_cd" type="STRING" size="256"/>
          <Column id="ichae_no" type="STRING" size="256"/>
          <Column id="req_day" type="STRING" size="256"/>
          <Column id="bank_filin_brkdn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_delWdrwAccnt" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="req_day" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_accnt_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="page_indx" type="STRING" size="6"/>
          <Column id="accnt_no" type="STRING" size="100"/>
          <Column id="mem_no" type="STRING" size="100"/>
          <Column id="mem_nm" type="STRING" size="100"/>
          <Column id="home_tel" type="STRING" size="100"/>
          <Column id="cell" type="STRING" size="100"/>
          <Column id="wrpl_tel" type="STRING" size="100"/>
          <Column id="idn_no" type="STRING" size="100"/>
          <Column id="prod_cd" type="STRING" size="100"/>
          <Column id="prod_nm" type="STRING" size="100"/>
          <Column id="prod_amt" type="STRING" size="100"/>
          <Column id="mon_pay_amt" type="STRING" size="100"/>
          <Column id="expr_no" type="STRING" size="100"/>
          <Column id="emple_no" type="STRING" size="100"/>
          <Column id="emple_nm" type="STRING" size="100"/>
          <Column id="appfm_no" type="STRING" size="100"/>
          <Column id="join_dt" type="STRING" size="100"/>
          <Column id="compt_dt" type="STRING" size="100"/>
          <Column id="bef_emple_cd" type="STRING" size="100"/>
          <Column id="pay_perd" type="STRING" size="100"/>
          <Column id="pay_mthd" type="STRING" size="100"/>
          <Column id="join_prod" type="STRING" size="100"/>
          <Column id="new_chan_gunsu" type="STRING" size="100"/>
          <Column id="certf_rcv_chk" type="STRING" size="100"/>
          <Column id="pay_stat_1no" type="STRING" size="100"/>
          <Column id="ichae_dt" type="STRING" size="100"/>
          <Column id="old_mid" type="STRING" size="100"/>
          <Column id="reg_dm" type="STRING" size="100"/>
          <Column id="reg_man" type="STRING" size="100"/>
          <Column id="upd_dm" type="STRING" size="100"/>
          <Column id="upd_man" type="STRING" size="100"/>
          <Column id="accnt_stat" type="STRING" size="100"/>
          <Column id="total_pay" type="STRING" size="100"/>
          <Column id="last_no" type="STRING" size="100"/>
          <Column id="real_pay_no" type="STRING" size="100"/>
          <Column id="ded_no" type="STRING" size="100"/>
          <Column id="join_cl" type="STRING" size="100"/>
          <Column id="trans_gubun" type="STRING" size="100"/>
          <Column id="brth_mon_day" type="STRING" size="100"/>
          <Column id="pay_mthd" type="STRING" size="100"/>
          <Column id="emp_cell" type="STRING" size="100"/>
          <Column id="join_stat" type="STRING" size="100"/>
          <Column id="pay_stat" type="STRING" size="100"/>
          <Column id="pay_no" type="STRING" size="100"/>
          <Column id="pay_allt_no" type="STRING" size="100"/>
          <Column id="pay_add_no" type="STRING" size="100"/>
          <Column id="pay_amt" type="BIGDECIMAL" size="100"/>
          <Column id="inv_gunsu" type="BIGDECIMAL" size="256"/>
          <Column id="pay_allt_amt" type="STRING" size="100"/>
          <Column id="pay_add_amt" type="STRING" size="100"/>
          <Column id="model_cl_nm" type="STRING" size="100"/>
          <Column id="bank_cd" type="STRING" size="256"/>
          <Column id="bank_accnt_no" type="BIGDECIMAL" size="100"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_accntInqCndt_2" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="req_month" type="STRING" size="256"/>
          <Column id="orderBy" type="STRING" size="256"/>
          <Column id="orderDirection" type="STRING" size="256"/>
          <Column id="sController" type="STRING" size="256"/>
          <Column id="dsName" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_card_typ" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="256"/>
          <Column id="cd_nm" type="STRING" size="256"/>
          <Column id="adtl_cd" type="STRING" size="256"/>
          <Column id="adtl_cd_nm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_wdrw_accnt_freeInfo" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="del_fg" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_bank_typ" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="256"/>
          <Column id="cd_nm" type="STRING" size="256"/>
          <Column id="adtl_cd" type="STRING" size="256"/>
          <Column id="adtl_cd_nm" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="cd">03</Col>
            <Col id="cd_nm">기업</Col>
          </Row>
          <Row>
            <Col id="cd">04</Col>
            <Col id="cd_nm">국민</Col>
          </Row>
          <Row>
            <Col id="cd">07</Col>
            <Col id="cd_nm">수협</Col>
          </Row>
          <Row>
            <Col id="cd">11</Col>
            <Col id="cd_nm">농협</Col>
          </Row>
          <Row>
            <Col id="cd">20</Col>
            <Col id="cd_nm">우리</Col>
          </Row>
          <Row>
            <Col id="cd">23</Col>
            <Col id="cd_nm">제일</Col>
          </Row>
          <Row>
            <Col id="cd">27</Col>
            <Col id="cd_nm">씨티</Col>
          </Row>
          <Row>
            <Col id="cd">31</Col>
            <Col id="cd_nm">대구</Col>
          </Row>
          <Row>
            <Col id="cd">32</Col>
            <Col id="cd_nm">부산</Col>
          </Row>
          <Row>
            <Col id="cd">34</Col>
            <Col id="cd_nm">광주</Col>
          </Row>
          <Row>
            <Col id="cd">39</Col>
            <Col id="cd_nm">경남</Col>
          </Row>
          <Row>
            <Col id="cd">71</Col>
            <Col id="cd_nm">우체국</Col>
          </Row>
          <Row>
            <Col id="cd">81</Col>
            <Col id="cd_nm">하나</Col>
          </Row>
          <Row>
            <Col id="cd">88</Col>
            <Col id="cd_nm">신한</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_send_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="accnt_no" type="STRING" size="100"/>
          <Column id="mem_no" type="STRING" size="100"/>
          <Column id="mem_nm" type="STRING" size="100"/>
          <Column id="pay_amt" type="STRING" size="256"/>
          <Column id="end_day" type="STRING" size="256"/>
          <Column id="ichae_cd" type="STRING" size="256"/>
          <Column id="ichae_no" type="STRING" size="256"/>
          <Column id="cell" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <InitValue>
      <Spin id="spn_free_gunsu" type="normal"/>
    </InitValue>
    <Script type="xscript4.0"><![CDATA[/********************************************************************************************/
/* 1. Include Library include, variables Declaration 영역                                  */
/********************************************************************************************/
include "LIB::lib_All.xjs";

var tc_Acnt = 0; // 임의등록 회원조회 카운트
var tc_chkWdrwAcntCnt = 0; // 임의 등록시 산출체크 카운트
var mon_pay_amt = 0; //총액 리턴값
//var g_req_month_changeYN = false; // 요청월 변경시 구분변수
//var g_req_month; // 요청월 전역변수

var g_result_msg = ""; // 입력유효성체크 실패메시지
var g_max_pay_cnt; // 회원별 최대 청구납입횟수

var result_cd = "";
var result_msg = "";

var result = "";
var sPostProcessBit = "";
var vtr_acc_no = "";

var iFreeAmt = 0;   //초기화
var iFreePreNo = 0;	//과거청구회차
var iFreePreAmt = 0 //과거청구금액	

/********************************************************************************************/
/* 2. Form 관련(onload 및 Form 이벤트) 처리                                           	*/
/********************************************************************************************/
function PS993102_onload(obj:Form, e:LoadEventInfo)
{
	gfn_initForm(obj);
	gfn_createPagingDataset(obj); // 페이징처리 위한 데이터셋 설정;
	
	fn_init();
}

/********************************************************************************************/
/* 3. Callback(gfn_Transaction 호출 후 처리내용)                                   		*/
/********************************************************************************************/
function fn_callBack(svcid, errcd, errmsg) 
{
	if (errcd != 0) {
	    switch (svcid) {
			case "getAccntBaseInfo":
			break;
			
	        case "getWdrwAccntInfo":
	        break;
	        
	        case "addWdrwTemp":
	        break;
	        
	        case "addVtrTemp":
				gfn_OpenMenu("MN161007", "");
				close();
	        break;
	        
	        case "deleteWdrwTemp":
	        break;
	        
	        case "srchInvAmt":
	        break;
	        
	        case "realTimeReq":
	        
	        break;
	        case "free-realtime": 
				alert("치명적인 오류가 발생하였습니다[전산팀 전달 요망]");
	        break;
	        
			case "selectDlwCode":
			break;
			
	    }
		return false;
	} 
	
	else {
		switch (svcid) {	
			// 회원 기본정보 조회
		    case "getAccntBaseInfo":
		    
				//trace("=============================회원 기본정보 조회완료");
				//trace(ds_accnt_base_info.saveXML());
				
				// 회원이 1명인 경우 
				if(tc_Acnt == 1) {
					// 회원 기본정보 SET
					fn_setAccntBaseInfo();
				} 
				// 회원이 2명 이상인 경우 
				else if (tc_Acnt > 1) {
					btn_accnt_onclick(null, "Y");
				} 
				// 회원조회 조건에 해당하지 않는 경우
				else {
					alert("회원정보가 없습니다.");
					fn_clear("Y");
				}
		    
		    break;
		    
		    // (산출) 회원현황 조회
		    case "getWdrwAccntInfo":
		    
				// Components 사용여부 SET
				fn_setComponentsUseYN();
				ds_wdrw_accnt_info.rowposition = -1;
				fn_postProcess("getWdrwAccntInfo");
		    break;
		    
		    // 임의등록
		    case "addWdrwTemp":
				//alert("임의건 등록완료");
				//fn_clear("Y");
				
				if(gfn_isNull(g_result_msg)) {
					//alert("등록 완료");
					//spn_inv_gunsu.value = 0;
					//edt_pay_amt.value = 0;
					fn_commSearch(gfn_getCommTypeInit(), "getWdrwAccntInfo"); // 재조회
				} else { // 휴일인 경우 등록불가 및 청구일자를 금일+1 로 SET
					alert(g_result_msg);
					g_result_msg = "";
					
					// 청구일자는 금일+1 로 SET
					//cal_req_day.value = gfn_addDate(gfn_getToday(),1);
				}
		    break;
		    
		    // 가상계좌등록
		    case "addVtrTemp":			
				if(gfn_isNull(g_result_msg)) {
					fn_commSearch(gfn_getCommTypeInit(), "getWdrwAccntInfo"); // 재조회
				} else { // 휴일인 경우 등록불가 및 청구일자를 금일+1 로 SET
					alert(g_result_msg);
					g_result_msg = "";					
				}
				btn_open_virtual_onclick();
				btn_realtime.enable =false;
		    break;	
		    	    
			case "sendVtrTemp":
				gfn_setWaitCursor(false);
				if (result == "success") {

					//가상계좌 전송 후 문자 전송		
					if(confirm("전송완료 하였습니다. 문자 전송 하시겠습니까?")) {
						var sPrmr = {pNonPay:"N", pSendPosition:"A", pVtr_acc_no:vtr_acc_no};
						var reVal = gfn_diaLog("가상계좌문자발송", -1, -1, 884, 601, "DL520000::DL520006_02.xfdl", false, sPrmr, false, false, true);
					}										
				} else {
					alert("가상계좌 전송 실패[" + result+ "]");
				}
				fn_commSearch(gfn_getCommTypeInit(), "getAccntBaseInfo", "accnt_no"); // 회원기본정보 조회
			break;					    	    
		    
		    // 임의삭제(산출삭제)
		    case "deleteWdrwTemp":
				//alert("임의건 삭제완료");
				//fn_clear("Y");
				//spn_inv_gunsu.value = 0;
				//edt_pay_amt.value = 0;
				fn_commSearch(gfn_getCommTypeInit(), "getWdrwAccntInfo"); // 재조회
		    break;
		    
		    
		    case "srchInvAmt":		    
				edt_pay_amt.value  = ds_accnt_base_info.getColumn(0, "pay_amt");								
				edit_pay_bit.value  = ds_accnt_base_info.getColumn(0, "req_pay_bit");
				stc_alert2.text = "(" + ds_accnt_base_info.getColumn(0, "tot_pay_cnt") + ")";		
				stc_alert1.text = "(" + ds_accnt_base_info.getColumn(0, "req_pay_no") + ")";
							
				// 청구납입횟수가 있으면 
				if(spn_inv_gunsu.value > 0) {
					// 임의등록 가능
					btn_addWdrw.enable = true;
					ckb_virtualYn.enable = true;
					
					// 카드회원인 경우 실시간 결제 가능
					if(ds_accnt_base_info.getColumn(0, "pay_mthd") == "06") btn_realtime.enable = true;
					else btn_realtime.visible = false;
				} else {
					btn_addWdrw.enable = false;
					ckb_virtualYn.enable = false;
					btn_realtime.visible = false;
				}														    
		    break;
		    
		    case "srchFreeInvAmt":
				var iReq_No = toNumber(ds_accnt_base_info.getColumn(0, "req_pay_no"));
				var iReq_Amt = toNumber(ds_accnt_base_info.getColumn(0, "pay_amt"));								
				iFreePreAmt = toNumber(edt_free_pay_amt.value);
						
				if(iFreePreNo == 0){	
				    iFreePreNo = 1;
					iFreeAmt = iFreePreAmt + iReq_Amt;					
				} else {
					if(iReq_No > iFreePreNo){						
						iFreeAmt = toNumber(iFreePreAmt) + toNumber(iReq_Amt);
					} else {
						iFreeAmt = toNumber(iFreePreAmt) - toNumber(iReq_Amt);
					}
				}							
				iFreePreNo = iReq_No;

				stc_alert_free.text = iReq_No + "회청구";
				edt_free_pay_amt.value = iFreeAmt;		    				
		    break;
		    
		    case "realTimeReq":
				alert("[" + result_cd + "] " + result_msg);
				sPostProcessBit = "saveProcess";
				fn_commSearch(gfn_getCommTypeInit(), "getWdrwAccntInfo"); // 재조회
	        break;
	        
	        
	        // 자유 결제
	        case "free-realtime":
				// 자유결제 성공시
				if ("00" == result_cd) {
					//alert("[" + result_cd + "] " + result_msg);
					alert("["+result_cd+"]"+result_msg+"\n자유결제가 정상 처리되었습니다.");
					
					// 자유결제정보 초기화 및 표시안함
					fn_freeInit();
	
					fn_commSearch(gfn_getCommTypeInit(), "getWdrwAccntInfo"); // 재조회
					
				} else {
						alert("["+result_cd+"]"+result_msg+"\n자유 결제에 실패하였습니다.");
				}
				
	        break;
	        
	        // 회차별 자유 결제
	        case "req_free-realtime":
				// 자유결제 성공시
				if ("00" == result_cd) {
					alert("["+result_cd+"]"+result_msg+"\n자유결제가 정상 처리되었습니다.");										
				} else {
					alert("["+result_cd+"] "+result_msg);
				}
				close();
	        break;	        
	        
	        // 공통코드 검색
	        case "selectDlwCode": 
				gfn_getCode("0120", "SELECT", ds_card_typ, gds_DmlCd); // 코드조회결과 필터
				cbo_cardCd.index = 0;
			break;
		}
	}
}

/* 회원 기본정보 SET */
function fn_setAccntBaseInfo() {
trace("====== 회원 기본정보 SET");

	spn_inv_gunsu.value = 1;
	edt_pay_amt.value = 0;
	edt_ichaeCd.value = '';
	edt_ichaeNo.value = '';
	
	// 자유결제정보 초기화
	fn_freeInit();

	if(ds_accnt_base_info.rowcount > 0) {
		
		// 회원번호, 회원명 SET	
		edt_accnt_no.value = ds_accnt_base_info.getColumn(0, "accnt_no");
		edt_mem_nm.value   = ds_accnt_base_info.getColumn(0, "mem_nm");
		trace(ds_accnt_base_info.getColumn(0, "pay_amt"));
		edt_pay_amt.value  = ds_accnt_base_info.getColumn(0, "pay_amt");
		edit_pay_bit.value  = ds_accnt_base_info.getColumn(0, "req_pay_bit");
		stc_alert2.text = "(" + ds_accnt_base_info.getColumn(0, "tot_pay_cnt") + ")";		
		stc_alert1.text = "(" + ds_accnt_base_info.getColumn(0, "req_pay_no") + ")";
		stc_alert_free.text = ds_accnt_base_info.getColumn(0, "req_pay_no") + "회청구";
		
		/*
		// 은행(카드)사, 계좌(카드)NO SET
		edt_ichaeNo.value = ds_accnt_base_info.getColumn(0, "ichae_no");
		if(ds_accnt_base_info.getColumn(0, "pay_mthd") == "06")
			edt_ichaeCd.value = ds_accnt_base_info.getColumn(0, "ichae_nm");
		else
			edt_ichaeCd.value = "(" + ds_accnt_base_info.getColumn(0, "ichae_cd") + ")" +  ds_accnt_base_info.getColumn(0, "ichae_nm");
	    */
	    
	    // 오류내역 초기화
	    stc_errorMsg.text = "";
	    
	    // 오류내역 체크 및 표시
	    var vStat = ds_accnt_base_info.getColumn(0, "stat");
	    var vIchaeCd = ds_accnt_base_info.getColumn(0, "ichae_cd");
	    var vPayMthd = ds_accnt_base_info.getColumn(0, "pay_mthd");
	    var vEvtReqYn = ds_accnt_base_info.getColumn(0, "event_req_yn");
	    var vRefundProcYn = ds_accnt_base_info.getColumn(0, "refund_proc_yn");
	    
	    if(vPayMthd == "04") 
			vPayMthd = "CMS";
	    else if(vPayMthd == "06") 
			vPayMthd = "Card";
			
		edit_pay_mthd.value = vPayMthd;
	    
	    if(vStat != '01' && vStat != '0111') 
			stc_errorMsg.text += "해피콜상태가 승인(재승인) 상태가 아닙니다.\n";
			
		if(vIchaeCd == "X") {
			if(vPayMthd == "CMS" || vPayMthd == "Card")
				stc_errorMsg.text += "해당 회원의 " + vPayMthd + " 정보가 정확하지 않습니다.\n";
		    else
				stc_errorMsg.text += "해당 회원은 CMS 또는 CARD 회원이 아닙니다.\n";
		}
		
		if(vRefundProcYn == "N") {
				stc_errorMsg.text += "해당 회원은 환불미처리 상태입니다.\n";
		}
		
		//alert("vEvtReqYn : " + vEvtReqYn);
		
		switch(vEvtReqYn){
			case 'F' : 
				stc_errorMsg.text += "해당 회원은 결합 청구 대상자가 아닙니다(CMS청구 체크 확인).";
			break;
			/*
			case 'E' : 
				stc_errorMsg.text += "해당 회원은 행사 상태로 청구 불가입니다.";
			break;
			*/
		}
			
		
		// 청구납입횟수 스핀 맥스값 설정
		//spn_inv_gunsu.max = ds_accnt_base_info.getColumn(0, "tot_pay_cnt") - ds_accnt_base_info.getColumn(0, "req_pay_no") + 1;
		
		g_max_pay_cnt = 0;
		// 회원별 최대 청구납입횟수 설정
		g_max_pay_cnt = ds_accnt_base_info.getColumn(0, "tot_pay_cnt") - ds_accnt_base_info.getColumn(0, "req_pay_no") + 1;
		stc_alert3.text = "(잔여 : " + g_max_pay_cnt + ")";
				
		// (산출) 회원현황 조회
		fn_commSearch(gfn_getCommTypeInit(), "getWdrwAccntInfo");
		
	} else {  // 회원 기본정보 없으면 clear
		alert("회원정보가 없습니다.");
		fn_clear("Y");
	}
	
}


/* Components 사용여부 SET */
function fn_setComponentsUseYN() {

	btn_realtime.visible = false;
	btn_addWdrw.enable = false;
	ckb_virtualYn.enable = false;
	btn_delWdrw.enable = false;
	spn_inv_gunsu.enable = false;
	this.getOwnerFrame().position.height = 325;
	this.stc_popup_free.position.height = 325;
	
	var nFindWdrwRow = ds_wdrw_accnt_info.findRowExpr("del_fg == 'N'");
	var rFindWdrwRow = ds_wdrw_accnt_info.findRowExpr("del_fg == 'R'");
	
	//산출(청구)된 데이터가 가상계좌인지 산출인지 청구인지 확인
	var reqGbn = ds_wdrw_accnt_info.getColumn(0,"req_temp");
		
	// 산출데이터가 있고		
	if(nFindWdrwRow != -1 && ds_accnt_base_info.rowcount == 1) {							
		// 임의등록 불가, 삭제 가능
		btn_addWdrw.enable = false;
		ckb_virtualYn.enable = false;
		btn_delWdrw.enable = true;		
		cal_req_day.enable = false;
		
		//산출된 데이터가 가상계좌인 경우 처리 
		if (reqGbn == "01"){
			btn_open_virtual_onclick();
			ckb_virtualYn.value = "100";
			ckb_virtualYn.enable = false;
			btn_realtime.visible = false;
		} else {		
			// 카드회원인 경우만 실시간결제 open
			if(ds_accnt_base_info.getColumn(0, "pay_mthd") == "06") 
				btn_realtime.visible = true;
		}				
	}
	// 산출정보가 없고, 해당 회원의 오류내역이 없는 경우
	else if(ds_wdrw_accnt_info.rowcount == 0 && ds_accnt_base_info.rowcount == 1 && gfn_isNull(stc_errorMsg.text)) {		
		// 등록, 청구납입횟수, 요청일자 사용가능 
		btn_addWdrw.enable = true;
		ckb_virtualYn.enable = true;
		spn_inv_gunsu.enable = true;
		cal_req_day.enable = true;
		btn_open_virtual.enable = true;
		ckb_virtualYn.enable = true;
	}	
	else {
		//청구된 데이터가 가상계좌인 경우 처리 
		if (reqGbn == "01"){
			btn_open_virtual_onclick();
			ckb_virtualYn.value = "100";
		}
	    btn_realtime.visible = false;
		btn_delWdrw.enable = false;
		btn_open_free_realtime.visible = false;
		btn_open_virtual.visible = false;
		ckb_virtualYn.enable = true;
	}
	// 자유결제 별도 프로세스 
	var sKstbit = ds_accnt_base_info.getColumn(0,"kstbit");		
	if(ds_wdrw_accnt_info.rowcount == 0 && ds_accnt_base_info.rowcount == 1){
		btn_open_free_realtime.visible = true;		
	} else {
		if (sKstbit == '04') {
			btn_open_free_realtime.visible = true;
		} else {
			btn_open_free_realtime.visible = false;
		}		
	}		
	//btn_open_virtual.visible = true;
}


/********************************************************************************************/
/**   4. Validation 처리                                                                   	*/
/********************************************************************************************/
function fn_preSearch(sType, svcid, gbn) {
	
	trace("[fn_preSearch] svcid : " +  svcid);

	switch (svcid) {
	
		// 회원기본정보 조회전 SET
		case "srchInvAmt":
			var reqGunsu = gbn;
			var srch_vl = edt_accnt_no.value;			
			ds_accntInqCndt.setColumn(0, "srch_typ", "accnt_no");
			ds_accntInqCndt.setColumn(0, "srch_vl", srch_vl);
			ds_accntInqCndt.setColumn(0, "orderBy", "mem_nm");
			ds_accntInqCndt.setColumn(0, "orderDirection", "asc");
			ds_accntInqCndt.setColumn(0, "req_gunsu", reqGunsu);
			

			
			return_bool = true;
			
		break;
		
	    case "getAccntBaseInfo":
			ds_accntInqCndt.keystring = ""; // 정렬컬럼 초기화
			ds_accntInqCndt.clearData();
			ds_accntInqCndt.addRow();
			
			var srch_typ = ""
			var srch_vl = "";
			
			// 회원번호 또는 회원명으로 조회
			if (gbn == "accnt_no") {
				srch_typ = gbn;
				srch_vl = edt_accnt_no.value;
			} else if (gbn == "mem_nm"){
				srch_typ = gbn;
				srch_vl = edt_mem_nm.value;
			}
			
			reqGunsu = 1;
							
			ds_accntInqCndt.setColumn(0, "srch_typ", srch_typ);
			ds_accntInqCndt.setColumn(0, "srch_vl", srch_vl);
			ds_accntInqCndt.setColumn(0, "popup_yn", "N"); // 회원정보 팝업여부 (임의등록 : N / 회원정보 조회팝업 : )
			ds_accntInqCndt.setColumn(0, "orderBy", "mem_nm");
			ds_accntInqCndt.setColumn(0, "orderDirection", "asc");
			ds_accntInqCndt.setColumn(0, "req_gunsu", reqGunsu);
			return_bool = true;
		break;
		
		// 산출회원정보 조회전 SET
	    case "getWdrwAccntInfo":
			ds_accntInqCndt_2.keystring = ""; // 정렬컬럼 초기화
			ds_accntInqCndt_2.clearData();
			ds_accntInqCndt_2.addRow();
			ds_accntInqCndt_2.setColumn(0, "accnt_no", edt_accnt_no.value);
			ds_accntInqCndt_2.setColumn(0, "orderBy", "reg_dm desc, req_pay_no desc"); // 최근 산출데이터 순으로 정렬
			//ds_accntInqCndt_2.setColumn(0, "orderBy", "req_day, req_pay_no");
			//ds_accntInqCndt_2.setColumn(0, "orderDirection", "asc");
			//ds_accntInqCndt_2.setColumn(0, "req_month", g_req_month); // 요청월
			return_bool = true;
	    break;
	}
	
	return true;
}



function fn_preSave(svcid, consTyp) {
    
    var return_bool = false;
    switch(svcid) {
        
        // 임의등록
        case "addWdrwTemp":
        
        
        var accnt_no = ds_accnt_base_info.getColumn(0,"accnt_no");
        //var prod_cd = ds_accnt_base_info.getColumn(0,"prod_cd");
        var pay_mthd = ds_accnt_base_info.getColumn(0,"pay_mthd");
        //var prod_cd = ds_accnt_base_info.getColumn(0,"prod_cd");
        var pay_mthd = ds_accnt_base_info.getColumn(0,"pay_mthd");
        var ichae_cd = ds_accnt_base_info.getColumn(0,"ichae_cd");
        var ichae_no = ds_accnt_base_info.getColumn(0,"ichae_no");
        
        var req_day = cal_req_day.value;
        
        ds_tempAccnt_info.clearData(); 
        ds_tempAccnt_info.addRow(); 
        ds_tempAccnt_info.setColumn(0,"accnt_no", accnt_no);             // 회원번호
		//ds_tempAccnt_info.setColumn(0,"prod_cd", prod_cd);               // 상품코드
		ds_tempAccnt_info.setColumn(0,"pay_mthd", pay_mthd);             // 납입방법
		ds_tempAccnt_info.setColumn(0,"ichae_cd", ichae_cd);             // 이체코드
		ds_tempAccnt_info.setColumn(0,"ichae_no", ichae_no);             // 이체번호
		ds_tempAccnt_info.setColumn(0,"req_day", req_day);               // 요청일
		ds_tempAccnt_info.setColumn(0,"inv_gunsu", spn_inv_gunsu.value); // 청구납입횟수

		return_bool = true;
        break;
        
        // 가상계좌 등록
        case "addVtrTemp":
			var accnt_no = ds_accnt_base_info.getColumn(0,"accnt_no");			
			var pay_mthd = ds_accnt_base_info.getColumn(0,"pay_mthd");									
			ds_tempAccnt_info.clearData(); 
			ds_tempAccnt_info.addRow(); 
			ds_tempAccnt_info.setColumn(0,"accnt_no", accnt_no);             // 회원번호
			ds_tempAccnt_info.setColumn(0,"pay_mthd", pay_mthd);             // 납입방법		
			ds_tempAccnt_info.setColumn(0,"inv_gunsu", spn_inv_gunsu.value); // 청구납입횟수
			return_bool = true;
        break;
        
        // 가상계좌 전송
        case "sendVtrTemp":
			var accnt_no = ds_accnt_base_info.getColumn(0,"accnt_no");			
			var mem_no = ds_accnt_base_info.getColumn(0,"mem_no");
			var mem_nm = ds_accnt_base_info.getColumn(0,"mem_nm");									
			var end_day = cal_vir_day.value;	
			var ichae_cd = cbo_bankCd.value;		
			
			//가상계좌 산출된 합계금액 계산
			var pay_amt = 0;
			for(var i=0;i<ds_wdrw_accnt_info.rowcount;i++)  {
				pay_amt += toNumber(ds_wdrw_accnt_info.getColumn(i,"pay_amt"));
			}										
			ds_send_info.clearData(); 
			ds_send_info.addRow(); 
			ds_send_info.setColumn(0,"cell",ds_accnt_base_info.getColumn(0,"cell"));
			ds_send_info.setColumn(0,"accnt_no", accnt_no);         // 
			ds_send_info.setColumn(0,"mem_no", mem_no);             // 
			ds_send_info.setColumn(0,"mem_nm", mem_nm);             // 
			ds_send_info.setColumn(0,"end_day", end_day);           // 
			ds_send_info.setColumn(0,"ichae_cd", ichae_cd);         // 
			ds_send_info.setColumn(0,"pay_amt", pay_amt);           // 
			return_bool = true;
        break;
                
		// 임의삭제
        case "deleteWdrwTemp":
        ds_delWdrwAccnt.clearData();
		ds_delWdrwAccnt.addRow();
		ds_delWdrwAccnt.setColumn(0, "accnt_no", edt_accnt_no.value);
		ds_delWdrwAccnt.setColumn(0, "req_day", ds_wdrw_accnt_info.getColumn(ds_wdrw_accnt_info.rowposition, "req_day"));
		return_bool = true;
        break;
                
        // 자유결제 유효성 체크 및 DS 설정
        case "free-realtime":        
			// 1. 자유결제 입력유효성 체크
			if (gfn_isNull(edt_accnt_no.value)) {
				alert("회원번호를 입력하십시오.");
				return false;
			}				
			if(gfn_isNull(cbo_cardCd.value)) {
				alert("카드사를 선택하십시오.");
				cbo_cardCd.setFocus();
				return false;
			}
			
			if (gfn_isNull(edt_card_no.value)) {
				alert("카드번호를 입력하십시오.");
				edt_card_no.setFocus();
				return false;
			} else {
				var card_no = edt_card_no.value;
				if (card_no.length < 14) {
					alert("카드번호는 14자리 이상이어야 합니다.");
					edt_card_no.setFocus();
					return false;
				}
			}
			
			if (gfn_isNull(edt_card_mon.value)) {
				alert("유효기간 [월]을 입력하십시오.");
				edt_card_mon.setFocus();
				return false;
			} else {
				var emp_mon = edt_card_mon.value;
				if(gfn_transNullToNumber(emp_mon)>12) {
					alert("유효기간 [월]은 12보다 클 수 없습니다.");
					edt_card_mon.setFocus();
					return false;
				}
			}
			
			if (gfn_isNull(edt_card_year.value)) {
				alert("유효기간 [년]을 입력하십시오.");
				edt_card_year.setFocus();
				return false;
			} 
			
			if (gfn_isNull(spn_dc_no.value)) {
				alert("할부기간을 입력하십시오.");
				spn_dc_no.setFocus();
				return false;
			} 
			//if (gfn_isNull(edt_pay_amt.value)) {
			if (gfn_isNull(edt_free_pay_amt.value)) {
				alert("결제금액을 입력하십시오.");
				edt_free_pay_amt.setFocus();
				return false;
			} else {
				//var pay_amt = edt_pay_amt.value;
				var spinCnt = toNumber(spn_dc_no.value);
				var free_pay_amt = edt_free_pay_amt.value;	
											
				if (gfn_transNullToNumber(free_pay_amt) < 1000) {
					alert("결제금액은 1,000원 이상이어야 합니다.");
					edt_free_pay_amt.setFocus();
					return false;
				}
				if (gfn_transNullToNumber(free_pay_amt) > 10000000) {
					alert("결제금액은 10,000,000원 이하여야 합니다.");
					edt_free_pay_amt.setFocus();
					return false;
				}							
				if (gfn_transNullToNumber(free_pay_amt) < 50000 && gfn_transNullToNumber(spinCnt) > 1){
					alert("할부금액은 50,000원 이상이여야 합니다.");
					return false;
				}
			}
			
			///////////////////////////////////////////////////////////////////////////////////			
			// 2. 자유결제 DS 설정
			// 2-1. 회원기본정보 가져오기
			ds_wdrw_accnt_freeInfo.addRow();
			ds_wdrw_accnt_freeInfo.copyData(ds_accnt_base_info);
			//alert(ds_wdrw_accnt_freeInfo.saveXML());
			
			// 2-2. 자유결제 추가 입력컬럼
			ds_wdrw_accnt_freeInfo.addColumn("ichae_cd"    , "string");   // 이체코드
			//ds_wdrw_accnt_freeInfo.addColumn("ichae_no"    , "string" );  // 이체번호
			ds_wdrw_accnt_freeInfo.addColumn("card_no"    , "string" );  // 이체번호
			ds_wdrw_accnt_freeInfo.addColumn("exp_year"   , "string" );   // 유효기간(년)
			ds_wdrw_accnt_freeInfo.addColumn("exp_mon"    , "string" );   // 유효기간(월)
			ds_wdrw_accnt_freeInfo.addColumn("card_idn_no" , "string" );  // 생년월일
			ds_wdrw_accnt_freeInfo.addColumn("card_quota"  , "string" );  // 할부기간
			ds_wdrw_accnt_freeInfo.addColumn("inv_gunsu"  , "string" );   // 건수
	
			//ds_wdrw_accnt_freeInfo.addColumn("ichae_pay_amt", "int" );     // 자유금액
			//ds_wdrw_accnt_freeInfo.addColumn("free_pay_amt", "int" );     // 자유금액
			
			
			// 2-3. 입력값 재설정
			// 이체코드, 자유금액, 유효기간(년, 월), 할부기간
			var ichaeCardNo = edt_card_no.value;
			ichaeCardNo = ichaeCardNo.replace("-", "");
			
			var ichaePayAmt = edt_free_pay_amt.value;
			
			var exp_year = edt_card_year.value;
			var exp_mon = edt_card_mon.value;
			var card_quota = spn_dc_no.value;
			
			/* 추후 조건 수정해서 사용할 가능성 있음 */
			/*
				if (isNaN(exp_year) && gfn_transNullToNumber(exp_year) > 0 && exp_year.length == 1) {
					exp_year = "0"+exp_year;
				}
				if (isNaN(exp_mon) && gfn_transNullToNumber(exp_mon) > 0 && exp_mon.length == 1) {
					exp_mon = "0"+exp_mon;
				}
				if (isNaN(card_quota) && gfn_transNullToNumber(card_quota) > 0 && card_quota.length == 1) {
					card_quota = "0"+card_quota;
				}
			*/
						
			// 2-4. 입력값 SET
			ds_wdrw_accnt_freeInfo.setColumn(0, "ichae_cd", cbo_cardCd.value);
			ds_wdrw_accnt_freeInfo.setColumn(0, "card_no", ichaeCardNo);
			ds_wdrw_accnt_freeInfo.setColumn(0, "exp_year", exp_year);
			ds_wdrw_accnt_freeInfo.setColumn(0, "exp_mon", exp_mon);
			ds_wdrw_accnt_freeInfo.setColumn(0, "card_idn_no", edt_idn_no.value); 
			ds_wdrw_accnt_freeInfo.setColumn(0, "card_quota", card_quota ); 
			ds_wdrw_accnt_freeInfo.setColumn(0, "inv_gunsu", spn_free_gunsu.value); 
			ds_wdrw_accnt_freeInfo.setColumn(0, "pay_amt", ichaePayAmt); // 자유금액
						
			return_bool = true;						
        break;
    }
    return return_bool;    
}

/********************************************************************************************/
/**   5. 서비스 호출(gfn_Transaction)                                                   	*/
/********************************************************************************************/
//조회
function fn_commSearch(sType, searchInfo, mth_spin, spin_val) {
	
	var szSvcid       = "";
    var szController  = "";
    var szInDs        = "";
    var szOutDs       = "";
    var szParam       = "";
    var szRetCallback = "";
    
    switch(searchInfo) {
		
		// 회원기본정보 조회
		case "getAccntBaseInfo":		
		    //trace(ds_accntInqCndt.saveXML());
		    		    
		    var gbn = mth_spin;		
			if (!fn_preSearch(sType,"getAccntBaseInfo", gbn)) return false;
			
			szSvcid       = "getAccntBaseInfo";
			szController  = "/req/reqCust/acnt-base-info";
			szInDs        = "ds_input=ds_accntInqCndt";
			szOutDs       = "ds_accnt_base_info=ds_output";
			szParam       = "";
			szRetCallback = "fn_callBack";			
		break;
		
        
        // 산출 회원정보 조회
        case "getWdrwAccntInfo":
        
			var gbn = mth_spin;
			
			if (!fn_preSearch(sType,"getWdrwAccntInfo", gbn)) return false;
			szSvcid       = "getWdrwAccntInfo";
			szController  = "/req/reqCust/wdrw-acnt-info";
			szInDs        = "ds_input=ds_accntInqCndt_2";
			szOutDs       = "ds_wdrw_accnt_info=ds_output";
			szParam       = "";
			szRetCallback = "fn_callBack";
			
		break;
		
		
		// 청구납입금액 계산
		case "srchInvAmt":
			
			var inv_gunsu = 0;
			
			if(spin_val != "undefined") {
				inv_gunsu = spin_val;
			} else {
				inv_gunsu = 0;
			}
			
			if(mth_spin == "onSpin") { // onspin이벤트사용시 수정후 값 적용			
				szSvcid       = "srchInvAmt";				
			} else {
				szSvcid       = "srchFreeInvAmt";
			}
			
			if (!fn_preSearch(sType,"srchInvAmt", inv_gunsu)) return false;
			
			szController  = "/req/reqCust/acnt-base-info";
			szInDs        = "ds_input=ds_accntInqCndt";
			szOutDs       = "ds_accnt_base_info=ds_output";
			szParam       = "";
			szRetCallback = "fn_callBack";	
			break;
		
		break;
    
    }
    
    // 트랜젝션 공통함수 호출
    gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback, false);
    //gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback, true); // 동기
}

//저장
function fn_commSave(saveInfo) {

    var szSvcid = "";
    var szController = "";
    var szInDs = "";
    var szOutDs = "";
    var szParam = "";
    var szRetCallback = "";
    
    trace("saveInfo : " + saveInfo);

    switch(saveInfo) {
		// 임의등록
		case "addWdrwTemp":
		
			if(!fn_preSave("addWdrwTemp")) return false;
			
			//alert(ds_tempAccnt_info.saveXML());
			
			szSvcid       = "addWdrwTemp";
			szController  = "/req/reqCust/wdrw-temp/add";
			szInDs        = "ds_input=ds_tempAccnt_info";
			szOutDs       = "";
			szParam       = "";
			szRetCallback = "fn_callBack";
		break;
		
		// 가상계좌 등록
		case "addVtrTemp":		
			if(!fn_preSave("addVtrTemp")) return false;			
			szSvcid       = "addVtrTemp";
			szController  = "/req/reqCust/virtual/ext";
			szInDs        = "ds_input=ds_tempAccnt_info";
			szOutDs       = "";
			szParam       = "";
			szRetCallback = "fn_callBack";
		break;
		
		// 가상계좌 전송
		case "sendVtrTemp":	
			if(!fn_preSave("sendVtrTemp")) return false;
			szSvcid       = "sendVtrTemp";
			szController  = "/req/reqCust/virtual/inicis-send";
			szInDs        = "ds_input=ds_send_info";
			szOutDs       = "";
			szParam       = "";
			szRetCallback = "fn_callBack";
		break;		
		
		// 임의삭제
		case "deleteWdrwTemp":
			if(!fn_preSave("deleteWdrwTemp")) return false;
			szSvcid       = "deleteWdrwTemp";
			szController  = "/req/reqCust/wdrw-temp/delete";
			szInDs        = "ds_input=ds_delWdrwAccnt";
			szOutDs       = "";
			szParam       = "";
			szRetCallback = "fn_callBack";
		break;
		
		// 카드 실시간 결제 
		case "realTimeReq":
			//if(!fn_preSave("realTimeReq")) return false;
			szSvcid       = "realTimeReq";
			szController  = "/req/reqCust/realtime-batch";
			szInDs        = "ds_input=ds_wdrw_accnt_info";
			szOutDs       = "";
			szParam       = "";
			szRetCallback = "fn_callBack";
		break;
		
		// 카드 자유 결제 (실시간)
		case "free-realtime":
			// 자유결제 유효성 체크 및 DS 설정
			if(!fn_preSave("free-realtime")) return false;			
			szSvcid       = "free-realtime";
			
			// 나이스 전용 결제 체크 	
			//szController  = "/req/reqCust/free-realtime";
			szController  = "/req/reqCust/free-inicis-realtime";
			
			szInDs        = "ds_input=ds_wdrw_accnt_freeInfo";
			szOutDs       = "";
			szParam       = "";
			szRetCallback = "fn_callBack";
		break;
		
		// 카드 청구회차 자유 결제 (실시간)
		case "req_free-realtime":
		
			if(!fn_preSave("free-realtime")) return false;	
					
				szSvcid       = "req_free-realtime";
				szController  = "/req/reqCust/free-req-realtime";			
				szInDs        = "ds_input=ds_wdrw_accnt_freeInfo";
				szOutDs       = "";
				szParam       = "";
				szRetCallback = "fn_callBack";
		break;				
    }

	// 트랜젝션 공통함수 호출
	gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback, false);
}


/********************************************************************************************/
/**   6. 사용자 함수                                                                   	*/
/********************************************************************************************/
//초기화
function fn_init()
{
	fn_clear();
	
	//cal_req_day.value = gfn_getToday();
	cal_req_day.value = gfn_addDate(gfn_getToday(),1);
	
	// 상담메인 화면단에서 open시
	//if (p_mode == "Main") {
	    // 회원번호가 있으면
	    if(!gfn_isNull(p_accnt_no)) {
			edt_accnt_no.value = p_accnt_no;
		}
	//}
	
	// 회원번호 FOCUS
	edt_accnt_no.setFocus();
}


//빈값처리
function fn_clear(gbn) {
	trace("gbn : " + gbn);
	
	edt_accnt_no.value = "";
	edt_mem_nm.value = "";
	//spn_inv_gunsu.value = 0;
	edt_pay_amt.value = "";
	edt_ichaeCd.value = "";
	edt_ichaeNo.value = "";
	stc_alert1.text = "";
	stc_alert2.text = "";
	stc_alert3.text = "";
	edit_pay_bit.value = "";
	edit_pay_mthd.value = ""; // 납입구분 초기화
	stc_errorMsg.text = ""; // 오류내역 초기화
	
	/*
	if (gbn != "Y") {
		//cal_req_day.value = gfn_getToday();
		cal_req_day.value = gfn_addDate(gfn_getToday(),1);
	}*/
	
	// 요청월 전역변수
	//g_req_month_changeYN = false;
	//g_req_month = "";
	//g_req_month = String(cal_req_day.value).substr(0, 6);
	//trace("요청월 : " + g_req_month);
		
	// 회원기본정보 초기화
	ds_accntInqCndt.clearData();
	ds_accnt_base_info.clearData();
	
	// 산출회원정보 초기화
	ds_accntInqCndt_2.clearData();
	ds_wdrw_accnt_info.clearData();
	
	// 자유결제, 실시간 결제버튼, 등록버튼, 삭제버튼, 청구납입횟수 spin, 요청일자 초기화 (사용불가)
	btn_open_free_realtime.visible = false;
	btn_realtime.visible = false;
	btn_open_virtual.visible = false;
	btn_addWdrw.enable = false;
	ckb_virtualYn.enable = false;
	btn_delWdrw.enable = false;
	spn_inv_gunsu.enable = false;
	cal_req_day.enable = false;
	edt_accnt_no.setFocus();
	
}

//청구건수 변경시 
/*
function fn_changedSpin(current_row) {
	var new_inv_gunsu = ds_list.getColumn(current_row,"inv_gunsu");
	
	if(old_spin_inv_gunsu != new_inv_gunsu) {
		
		//alert("old_spin_inv_gunsu: " + old_spin_inv_gunsu+"\nnew_inv_gunsu: " + new_inv_gunsu);
		//이체한도 횟수 설정 
		if (spn_invGunsu.max < gfn_transNullToNumber(new_inv_gunsu)) {
			alert("이체한도 횟수는 " + spn_invGunsu.max + "입니다.");
			ds_list.setColumn(current_row,"inv_gunsu",old_spin_inv_gunsu);
			return false;
		}
		ds_list.setRowType(current_row,"U");
		
		fn_commSave("updateInvGunsu");
		old_spin_inv_gunsu = new_inv_gunsu;
	}
}*/

function fn_dupAccntNo(accnt_no) {
	var dup_fg = true;
	if (opener.ds_list != null){
		for(var i=0;i<opener.ds_list.rowcount;i++)
		{
			var parent_accnt_no = opener.ds_list.getColumn(i, "accnt_no");
			if(accnt_no == parent_accnt_no){
				dup_fg = false;
			}
		}
	}
	return dup_fg
}


/* 청구납입금액 계산 */
function fn_setTotalAmt(spn_gubun, val) {

	var spn_gubun_p = "";
	var val_p = 0;
	var send_Gbn = "";
	
	spn_gubun_p = spn_gubun;
	val_p = val;
		
	fn_commSearch(gfn_getCommTypeInit(), "srchInvAmt", spn_gubun_p, val_p);
	//fn_commSearch(gfn_getCommTypeInit(), "srchInvAmt");
	
}

/********************************************************************************************/
/**   7. 이벤트(Event) Function                                                          	*/
/********************************************************************************************/
//조회 버튼 이벤트
function btn_Search_onclick(obj:Button,  e:ClickEventInfo)
{

}
//초기화 버튼 이벤트
function btn_Init_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_init();
}

//그리드내 스핀값 변경시
function spn_onkillfocus(obj:Spin, e:KillFocusEventInfo)
{	
   //obj.visible = false;
	if (old_spin_inv_gunsu != obj.value) {
		ds_list.setColumn(current_row,"inv_gunsu",obj.value);
		//fn_changedSpin(current_row);
	}
}

function spn_onmouseleave(obj:Spin, e:MouseEventInfo)
{
	obj.visible = false;
	spn_onkillfocus(obj);
}

function spn_onkeydown(obj:Spin, e:KeyEventInfo)
{	
	if (e.keycode == 9) // tab키 동작 시 
    { 
		obj.setCellPos(obj.position -1); //현재 포지션 이전 위치 이동 
    } 
	if (e.keycode == 13) {
		spn_onmouseleave(obj);
	}
}


/********************************************************************************************/
/**   7-0. 팝업 관련 이벤트(Event) Function                                                          	*/
/********************************************************************************************/
// 회원 조회 버튼 클릭
function btn_accnt_onclick(obj, typ) {
	var srch_typ = "";
	var option = "";
	var gubun_mode = "";
	var srch_vl = "";
	
	if (obj != null) {
		if ("btn_mem_nm" == obj.name || "edt_mem_nm" == obj.name) { // 회원명
			srch_typ = "mem_nm";
		} else if ("btn_accnt_no" == obj.name || "edt_accnt_no" == obj.name){ // 회원번호
			srch_typ = "accnt_no";
		}
	}
	
	if (typ == "Y") {
		srch_typ = ds_accntInqCndt.getColumn(0,"srch_typ");
		srch_vl = ds_accntInqCndt.getColumn(0,"srch_vl");
	}
	
	/*if (p_mode == "call") {
		option = "call";
	} else {
		if ("Card" == p_wdrw_gubun) {
			option = "card";
		} else {
			option = "cms";
		}
	}*/
	
	//var sPrmr = {p_srch_typ:srch_typ, p_srch_vl:srch_vl, p_gubun_mode:"addWdrwTemp", p_option:option};
	//var sPrmr = {p_srch_typ:srch_typ, p_srch_vl:srch_vl, p_gubun_mode:"insertAddTemp"};
	var sPrmr = {p_srch_typ:srch_typ, p_srch_vl:srch_vl, p_gubun_mode:"insertAddTemp", p_option:""};
	
	//gfn_diaLog("회원 조회", -1, -1, 884, 601, "PS990000::PS992400.xfdl", false, sPrmr, true, false, true, null, null, true);
	gfn_diaLog("회원 조회_NEW", -1, -1, 884, 601, "PS990000::PS992402.xfdl", false, sPrmr, true, false, true, null, null, true);
}


function btn_close_onclick(obj:Button,  e:ClickEventInfo)
{
	//종료시 구분자에따라 처리 (cms, card)
	//부모창 있을경우 부모창 재조회
	close();
	
}

/* 임의등록 */
function btn_addWdrw_onclick(obj:Button,  e:ClickEventInfo)
{
	var svid = "";
	// 청구일자 유효성 체크
	if(gfn_isNull(cal_req_day.value)) {
		alert("청구일자를 입력해주세요.");
		cal_req_day.setFocus();
		return false;
	}
	
	//if (gfn_getToday() > cal_req_day.value ) {
	if (gfn_getToday() >= cal_req_day.value ) {
		alert("청구일자를 금일날짜를 포함하여 이전 날짜로 설정할 수 없습니다.");
		cal_req_day.setFocus();
		return false;
	}
	
	if(confirm("등록 하시겠습니까?")) {
	
		// 실행가능여부 체크
		if(!fn_chk_practicable()) return false;
		
		//가상계좌 여부 체크 확인
		if (ckb_virtualYn.value == "100"){
			svid = "addVtrTemp";
		} else {
			svid = "addWdrwTemp";
		}
		
		fn_commSave(svid);
	}
}

/* 삭제처리 */
function btn_delWdrw_onclick(obj:Button,  e:ClickEventInfo)
{
	if(confirm("산출데이터를 삭제 하시겠습니까?")) {
		// 실행가능여부 체크
		if(!fn_chk_practicable()) return false;
		
		fn_commSave("deleteWdrwTemp");
	}
}


/* 회원번호 엔터조회시 */
function edt_accnt_onkeydown(obj:Edit, e:KeyEventInfo)
{
	if (e.keycode == "13") {
		if (obj.value == "") {
			btn_accnt_onclick(obj);
		} else {
			var srch_typ = "";
			if (obj.name == "edt_accnt_no") {
				srch_typ = "accnt_no";
			} else if (obj.name == "edt_mem_nm"){
				srch_typ = "mem_nm"
			}
			
			fn_commSearch(gfn_getCommTypeInit(), "getAccntBaseInfo", srch_typ); // 회원기본정보 조회
		}
	}
}

/* 실시간 결제 */
function btn_realtime_onclick(obj:Button,  e:ClickEventInfo)
{	
	if(confirm("실시간 결제 하시겠습니까?")) {
		// 실행가능여부 체크
		if(!fn_chk_practicable()) return false;
	
		fn_commSave("realTimeReq");
	}
}

/* 회원정보 조회팝업에서 회원선택시 */
function fn_setAccntNo(){

	trace(" : : : 회원조회 팝업 내용 SET");
	edt_accnt_no.value = ds_accnt_base_info.getColumn(0, "accnt_no");
	
	/*
	trace(ds_accnt_base_info.saveXML());
	
	if(ds_accnt_base_info.getColumn(0, "accnt_no") != ""){
			edt_accnt_no.value = ds_accnt_base_info.getColumn(0, "accnt_no");
			edt_mem_nm.value = ds_accnt_base_info.getColumn(0, "mem_nm");
	}
	*/
	
	if(ds_accnt_base_info.getColumn(0, "accnt_no") != ""){	    
		edt_accnt_no.value = ds_accnt_base_info.getColumn(0, "accnt_no");
		edt_mem_nm.value = ds_accnt_base_info.getColumn(0, "mem_nm");

		// 회원기본정보 조회
		//fn_commSearch(gfn_getCommTypeInit(), "getAccntBaseInfo");
		fn_commSearch(gfn_getCommTypeInit(), "getAccntBaseInfo", "accnt_no");

		// (산출) 회원현황 조회
		fn_commSearch(gfn_getCommTypeInit(), "getWdrwAccntInfo");
	}

//trace(ds_accnt_info.saveXML());

/*
	if(ds_accnt_info.getColumn(0, "accnt_no") != ""){
		edt_accnt_no.value = ds_accnt_info.getColumn(0, "accnt_no");
		edt_mem_nm.value = ds_accnt_info.getColumn(0, "mem_nm");
				
		//이미산출된 회원인지 검사
		if(!fn_dupAccntNo(edt_accnt_no.value)) {
			stc_alert.text = "*이미 산출된 구좌입니다.";
			stc_alert.visible = true;
			btn_addWdrw.enable = false;
		} else {
			//산출구분카드일경우 빌키있는회원검사
			if ("Card" == p_wdrw_gubun) {
				//빌키검사
				fn_commSearch(gfn_getCommTypeInit(), "srchChkBid");
			} else {
				//추가정보 조회
				fn_commSearch(gfn_getCommTypeInit(), "srchWdrwAddData");
			}
		}
	
*/
}


/* 요청월로 산출 및 청구조회 */
/*
function cal_req_day_ontextchanged(obj:Calendar, e:TextChangedEventInfo)
{
	// 요청월 구하기
	g_req_month = e.posttext.replace("-", "");
	g_req_month = g_req_month.replace(" ","");
	
	if(g_req_month.length == 8) {
		// 요청월로 산출 및 청구조회
		g_req_month = g_req_month.substr(0, 6);
		//trace("g_req_month : " + g_req_month);
		
		//fn_commSearch(gfn_getCommTypeInit(), "getWdrwAccntInfo");
	}
}
*/




function spn_inv_gunsu_onkeydown(obj:Spin, e:KeyEventInfo)
{	
	// 청구납입횟수 초과입력 체크
	fn_chkPayCnt(obj.value);
	
	if (e.keycode == "13") {
		
		// 청구납입횟수 유효성 체크 
		// 0 또는 빈 값 들어올 경우 무조건 1회로 SET
		if(obj.value == 0 || gfn_isNull(obj.value))  {
			spn_inv_gunsu.value = 0;
			spn_inv_gunsu.value = 1;
		}
		
		trace("spin_value : " + obj.value);
		fn_setTotalAmt("onSpin",obj.value);
	}
}


function spn_inv_gunsu_onspin(obj:Spin, e:SpinEventInfo)
{
	// 청구납입횟수 초과입력 체크
	fn_chkPayCnt(e.postvalue);
	
	fn_setTotalAmt("onSpin",e.postvalue);
}

/* 청구납입횟수 초과입력 체크 */
function fn_chkPayCnt(val) {
	
	//if(g_max_pay_cnt < obj.value) {
	if(g_max_pay_cnt < val) {
		stc_errorMsg.text = "청구납입횟수를 확인하세요.";
		btn_addWdrw.enable = false;
	} else {
		stc_errorMsg.text = "";
		btn_addWdrw.enable = true;
	}
	
}

/* 자유결제 폼 open */
function btn_open_free_realtime_onclick(obj:Button,  e:ClickEventInfo)
{	
	//자유결제 spin관련 변수
	iFreeAmt = 0;   //초기화
	iFreePreNo = 0;	//과거청구회차
	iFreePreAmt = 0 //과거청구금액	
		
	// 실행가능여부 체크
	if(!fn_chk_practicable()) return false;
	
	// (자유결제) 입력정보 초기화
	btn_free_realtime_init_onclick();		
	
	this.getOwnerFrame().position.height = 445;
	this.stc_popup_free.position.height = 445;
	stc_popup.visible = false;
	stc_popup_free.visible = true;
	
	/*가상계좌와 함께 사용하기 위한 컴퍼넌 조정*/	
	stc_16.text = "카드 결제 정보";
	btn_free_realtime.text = "자유결제"
	
	stc_22.visible = false;
	cbo_bankCd.visible = false;
	cal_vir_day.visible = false;
	
	/************************************************/	
	gfn_getList("dlwCd","0120","fn_callBack",false);   // 대명코드조회
	cbo_cardCd.setFocus();
	
	var objDate = new Date();
 	strDate = objDate.toFormatString("%Y/%m/%d");
 	edt_pay_dt.value = strDate; 	
 	
 	//회차기준 자유결제 프로세스
 	var sKstbit = ds_accnt_base_info.getColumn(0,"kstbit");
 	var sIdnNo = ds_accnt_base_info.getColumn(0,"brth_mon_day");
 	sIdnNo =  gfn_SubStr(sIdnNo,2,6);
 	
 	if (sKstbit ==	"04"){
		edt_free_pay_amt.enable = true;
		ckb_event.visible = true;
		stc_alert_free.visible = false;
		spn_free_gunsu.enable = false;		
		edt_idn_no.enable = true;
 	} else {		
		btn_free_realtime.text = "회차자유결제"
		edt_free_pay_amt.enable = false;
		ckb_event.visible = false;
		spn_free_gunsu.enable = true;
		stc_alert_free.visible = true;
		edt_idn_no.enable = false;
		edt_idn_no.value = sIdnNo;
		spn_free_gunsu.value = 1;
		iFreeAmt = toNumber(edt_pay_amt.value);
		edt_free_pay_amt.value = iFreeAmt;		
 	}

 	/*테스트*/ 	
 	edt_card_no.value = "";
 	edt_card_year.value="";
 	edt_card_mon.value = "";
}

/* 자유결제 */
function btn_free_realtime_onclick(obj:Button,  e:ClickEventInfo)
{			
	// 실행가능여부 체크
	if(!fn_chk_practicable()) return false;
	
	if(obj.text == "가상계좌전송"){
		if(cal_vir_day.value == "" || cal_vir_day.value == null){
			alert("가상계좌 필수 정보를 입력 하십시요!!");
			return false;
		}
		
		if(confirm("가상 계좌를 전송 하시겠습니까?")) {		
			fn_commSave("sendVtrTemp");
		}
	} else if (obj.text == "회차자유결제"){
		if(confirm("회차기준 자유 결제 하시겠습니까?")) {		
			fn_commSave("req_free-realtime");
		}
	} else {
		if(confirm("자유 결제 하시겠습니까?")) {		
			fn_commSave("free-realtime");
		}
	}			
}

/* (자유결제) 입력정보 초기화 */
function btn_free_realtime_init_onclick(obj:Button,  e:ClickEventInfo)
{
	cbo_cardCd.value = "";
	edt_card_no.value = "";
	edt_card_year.value = "";
	edt_card_mon.value = "";
	edt_idn_no.value = "";
	spn_dc_no.value = 0;
	edt_free_pay_amt.value = "";
}

/* (자유결제) 금액 ,(컴마) 표시 */
function edt_free_pay_amt_onkillfocus(obj:Edit, e:KillFocusEventInfo)
{
	obj.value = gfn_commaStr(obj.value);
}

/* (자유결제) 금액 ,(컴마) 표시 */
function edt_free_pay_amt_ontextchanged(obj:Edit,  e:TextChangedEventInfo)
{
	obj.value = gfn_commaStr(obj.value);
	obj.setCaretPos(-1);
}

/* (자유결제) 카드번호 형태로 표시 */
function card_onkillfocus(obj:Edit, e:KillFocusEventInfo)
{
	obj.value = gfn_CardStr(obj.value);
}

/* (자유결제) 카드번호 형태로 표시 */
function card_ontextchanged(obj:Edit,  e:TextChangedEventInfo)
{
	obj.value = gfn_CardStr(obj.value);
	obj.setCaretPos(-1);
	var card_no = obj.value;
	if(card_no.replace("-","").length == 16) {
		edt_card_year.setFocus();
	}
}

/* (자유결제) 입력 컴포넌트 포커스 설정 */
function common_ontextchanged(obj:Edit,  e:TextChangedEventInfo) {
	if(obj.name == "edt_card_mon") {
		if(obj.value.length == 2) edt_idn_no.setFocus();
	} else if (obj.name == "edt_idn_no") {
		if(obj.value.length == 6) edt_free_pay_amt.setFocus();
	} else if (obj.name == "edt_card_year") {
		if(obj.value.length == 2) edt_card_mon.setFocus();
	}
}

/* 자유결제정보 초기화 및 표시안함 */
function fn_freeInit() {
	ds_wdrw_accnt_freeInfo.clearData();
	this.getOwnerFrame().position.width = 558; 
	this.getOwnerFrame().position.height = 325;
	stc_popup.visible = true;
	stc_popup_free.visible = false;
}

function fn_postProcess(svcId)
{
	switch (svcId) 
	{
		case "getWdrwAccntInfo":
			if(sPostProcessBit == "saveProcess")
			{
				edt_accnt_no.value  = "";
				edt_mem_nm.value    = "";
				spn_inv_gunsu.value = 0;
				edt_pay_amt.value   = "";
				cal_req_day.value   = "";
				edit_pay_bit.value  = "";
				edit_pay_mthd.value = "";
				stc_errorMsg.value  = "";
				stc_alert2.text = "(0)";		
				stc_alert1.text = "(0)";
			
				cbo_cardCd.index        = 0;
				edt_card_no.value       = "";
				edt_card_year.value     = "";
				edt_card_mon.value      = ""; 
				edt_idn_no.value        = ""; 
				spn_dc_no.value         = ""; 
				edt_free_pay_amt.value  = ""; 
				edt_pay_dt.value        = ""; 
				
				ds_wdrw_accnt_info.clearData();
				
				sPostProcessBit = "";
			}
		break;
	}
}


   
// 실행가능여부 체크 (16시 30분부터 17시 30분 이전까지 실행불가)
/*******************************************************
 <체크부분>
   1. 임의등록
   2. 임의삭제
   3. 실시간결제
   4. 자유결제
   5. 자유결제 폼 poen 
*******************************************************/
function fn_chk_practicable() {

	var objDate1 = new Date();
	var yyyymmdd = objDate1.toFormatString("%Y%m%d"); // 현재일자 가져오기
	var dayNm = gfn_getDayH(yyyymmdd, false); // 요일명 return
	
	var objDate2 = new Date();
	var hourM = objDate2.toFormatString("%H%M"); // 현재 시간 가져오기
	
	// 평일 16:30 ~ 17:30 에는 다음 작업 불가
    // (** 임의등록, 삭제, 실시간결제 및 자유결제 작업 불가)
// 	if(dayNm == "월" || dayNm == "화" || dayNm == "수" || dayNm == "목" || dayNm == "금") {
// 		if(hourM >= 1620 && hourM < 1720) {
// 			alert("실행 불가시간 [ 16:20 ~ 17:20 ] 입니다.");
// 			return false;
// 		}
// 	}

	//임시 2022년 2월 정기 일만 임시로 제한
	if(yyyymmdd == "20220218" || yyyymmdd == "20220224") {
		if(dayNm == "월" || dayNm == "화" || dayNm == "수" || dayNm == "목" || dayNm == "금") {
			if(hourM >= 1620 && hourM < 1820) {
				alert("실행 불가시간 [ 16:20 ~ 18:20 ] 입니다.");
				return false;
			}
		}
	} else {
		if(dayNm == "월" || dayNm == "화" || dayNm == "수" || dayNm == "목" || dayNm == "금") {
			if(hourM >= 1620 && hourM < 1720) {
				alert("실행 불가시간 [ 16:20 ~ 17:20 ] 입니다.");
				return false;
			}
		}
	}
	return true;
}

function cbo_cardCd_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
{
	/*
	if (e.postvalue == "04" || e.postvalue == "05" || e.postvalue == "08" || e.postvalue == "16"){		
		ckb_niceBillkey.value = 100;
		ckb_niceBillkey.enable = false;
	} else {
		ckb_niceBillkey.value = 1;
		ckb_niceBillkey.enable = true;
	}
	*/
}

function btn_open_virtual_onclick(obj:Button,  e:ClickEventInfo)
{
	// 실행가능여부 체크	
	this.getOwnerFrame().position.height = 356;
	this.stc_popup_free.position.height = 356;
	stc_popup.visible = false;
	stc_popup_free.visible = true;
		
	/*가상계좌와 함께 사용하기 위한 컴퍼넌 조정*/	
	stc_16.text = "가상계좌 전송";
	btn_free_realtime.text = "가상계좌전송";
	cbo_bankCd.index = 0;
	
	stc_22.visible = true;
	cbo_bankCd.visible = true;
	cal_vir_day.visible = true;
	btn_addWdrw.enable = false;
	
	//가상계좌 산출 여부 (전송O,X)
	var reqYn = ds_wdrw_accnt_info.getColumn(0,"del_fg");	
	var reqDay = ds_wdrw_accnt_info.getColumn(0,"req_day");	
	var ichaeCd = ds_wdrw_accnt_info.getColumn(0,"ichae_cd");	
	
	if (reqYn == "N"){
		 cal_vir_day.value = gfn_getLastDay();  //입금마감일
		cbo_bankCd.enable = true;
		cal_vir_day.enable = true;
		btn_free_realtime.enable = true;
		btn_free_realtime_init.enable = true;
	} else {
		cal_vir_day.value = reqDay;
		cbo_bankCd.value = ichaeCd;
		cbo_bankCd.enable = false;
		cal_vir_day.enable = false;	
		btn_free_realtime.enable = false;
		btn_free_realtime_init.enable = false;
	}
		
	/************************************************/			
	gfn_getList("dlwCd","0120","fn_callBack",false);   // 대명코드조회
	cbo_bankCd.setFocus();
}

function grdList_oncellclick(obj:Grid, e:GridClickEventInfo)
{
	if(ckb_virtualYn.value == "100"){
		btn_open_virtual_onclick();
	}
}

function spn_free_gunsu_onspin(obj:Spin, e:SpinEventInfo)
{
	var val = e.postvalue;		
	if(g_max_pay_cnt < val) {
		alert("청구회차를 확인하세요(청구>만기)");
		btn_FreeReq.enable = false;
		btn_free_realtime.enable = false;
		return;
	}		
	fn_setTotalAmt("onSpin_free",val);
}

function spn_free_gunsu_ontextchanged(obj:Spin, e:TextChangedEventInfo)
{	
	var val = obj.text;		
	
	trace(val);
	
	if(g_max_pay_cnt < val) {
		alert("청구회차를 확인하세요(청구>만기)");
		btn_FreeReq.enable = false;
		btn_free_realtime.enable = false;
		return;
	}		
	fn_setTotalAmt("onSpin",val);
}

function ckb_virtualYn_onchanged(obj:CheckBox, e:CheckBoxChangeEventInfo)
{
	var rFindWdrwRow = ds_wdrw_accnt_info.findRowExpr("del_fg == 'R'");
	
	trace(rFindWdrwRow); 
	
	if (rFindWdrwRow != -1){
		btn_addWdrw.enable = false;
		ckb_virtualYn.enable = false;	
	} else {
		if(obj.value == "100"){
			btn_addWdrw.enable = true;
		} else {
			btn_addWdrw.enable = false;
		}
	}		
}
]]></Script>
  </Form>
</FDL>
