<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="DL420700" classname="캠페인관리" inheritanceid="" position="absolute 0 0 989 795" titletext="온라인 결제계좌 변경정보" onload="DL420700_onload" scrollbars="none">
    <Layouts>
      <Layout>
        <Edit id="edt_cpdcTitlNm08" taborder="1" position="absolute 756 -531 889 -511"/>
        <Button id="btn_onln_pymn_acnt_chng" taborder="1" text="선택건 일괄변환" class="btn_WF_Common" style="padding:0 0 0 0;" position2="absolute r:2 w:104 t:79 h:20" positiontype="position2" onclick="btn_onln_pymn_acnt_chng_onclick" visible="false"/>
        <Grid id="grd_list" taborder="1" binddataset="ds_list" useinputpanel="false" autofittype="none" onheadclick="grd_onheadclick" onvscrolllastover="fn_Grid_onvscrolllastover" position2="absolute l:0 r:0 t:101 b:4" positiontype="position2" autosizingtype="none" cellsizingtype="col">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="40"/>
                <Column size="44"/>
                <Column size="104"/>
                <Column size="95"/>
                <Column size="87"/>
                <Column size="65"/>
                <Column size="103"/>
                <Column size="125"/>
                <Column size="137"/>
                <Column size="105"/>
                <Column size="128"/>
                <Column size="135"/>
                <Column size="98"/>
                <Column size="73"/>
                <Column size="88"/>
                <Column size="87"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="checkbox" edittype="checkbox"/>
                <Cell col="1" text="순번"/>
                <Cell col="2" text="회원번호" id="accnt_no"/>
                <Cell col="3" text="회원명"/>
                <Cell col="4" text="전화번호"/>
                <Cell col="5" text="신청번호" id="mem_no"/>
                <Cell col="6" text="변경전결제구분"/>
                <Cell col="7" text="변경전은행/카드사"/>
                <Cell col="8" text="변경전계좌/카드번호"/>
                <Cell col="9" text="변경후결제구분"/>
                <Cell col="10" text="변경후은행/카드사"/>
                <Cell col="11" text="변경후계좌/카드번호"/>
                <Cell col="12" text="해피콜가능시간"/>
                <Cell col="13" text="처리여부"/>
                <Cell col="14" text="최종수정자ID"/>
                <Cell col="15" text="최종수정일시"/>
              </Band>
              <Band id="body">
                <Cell displaytype="expr:prcs_yn == 'Y' ? 'none' : 'checkbox'" edittype="expr:prcs_yn == 'Y' ? 'none' : 'checkbox'" text="bind:_chk"/>
                <Cell col="1" expr="currow+1"/>
                <Cell col="2" displaytype="text" edittype="readonly" text="bind:accnt_no" editdisplay="display"/>
                <Cell col="3" text="bind:name" expr="expr:gfn_SetNameGrdSecu(name)"/>
                <Cell col="4" text="bind:hp" expr="gfn_phoneNumStr(hp)" mask="expr:gfn_SetTelNoGrdMaskSecu(hp)"/>
                <Cell col="5" text="bind:chng_seq"/>
                <Cell col="6" text="bind:bfr_pmt_gb" expr="fn_pymnNm(bfr_pmt_gb)"/>
                <Cell col="7" expr="expr:fn_checkText(bfr_pmt_gb == '04' ? bfr_bank_nm : bfr_pmt_gb == '06' ?bfr_card_nm : '')"/>
                <Cell col="8" expr="expr:fn_checkText(bfr_pmt_gb == '04' ? bfr_acnt_no : bfr_pmt_gb == '06' ? bfr_card_no+'('+bfr_card_expr_yr+'/'+bfr_card_expr_mm+')' : '')" mask="expr:bfr_pmt_gb == '04' ? gfn_SetCmsNoGrdSecu(bfr_acnt_no) : '####{####}#### ({##}/{##})'"/>
                <Cell col="9" text="bind:aft_pmt_gb" expr="fn_pymnNm(aft_pmt_gb)"/>
                <Cell col="10" expr="fn_checkText(aft_pmt_gb == '04' ? aft_bank_nm : aft_pmt_gb == '06' ? aft_card_nm : '')"/>
                <Cell col="11" expr="fn_checkText(aft_pmt_gb == '04' ? aft_acnt_no : aft_pmt_gb == '06' ? aft_card_no+'('+aft_card_expr_yr+'/'+aft_card_expr_mm+')' : '')" mask="expr:aft_pmt_gb == '04' ? gfn_SetCmsNoGrdSecu(aft_acnt_no) :'####{####}#### ({##}/{##})'"/>
                <Cell col="12" text="bind:hycl_able_time" expr="fn_hpclTm(hycl_able_time)"/>
                <Cell col="13" text="bind:prcs_yn"/>
                <Cell col="14" text="bind:mod_id"/>
                <Cell col="15" text="bind:mod_dtm" mask="####-##-##"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="stc_23" class="sta_workSrcBg" position2="absolute l:0 r:0 t:10 h:66" positiontype="position2"/>
        <Button id="btn_Init00" taborder="3" onclick="btn_Init_onclick" class="btn_WF_Return" position2="absolute r:5 w:72 t:21 h:20" positiontype="position2" tooltiptext="초기화"/>
        <Button id="btn_Search" taborder="4" onclick="btn_Search_onclick" class="btn_WF_Search" position2="absolute r:79 w:72 t:21 h:20" positiontype="position2" tooltiptext="조회" style="shadow:drop 0,0 0 #00000033;"/>
        <Static id="sta_TotalCnt" text="검색결과   &lt;fs v='9'&gt;&lt;fc v='#f0850c'&gt;&lt;b v='true'&gt;0&lt;/b&gt;&lt;/fc&gt;&lt;/fs&gt; &lt;fc v='#a1a1a1'&gt;건&lt;/fc&gt; / 전체   &lt;fs v='9'&gt;&lt;fc v='#f0850c'&gt;&lt;b v='true'&gt;0&lt;/b&gt;&lt;/fc&gt;&lt;/fs&gt; &lt;fc v='#a1a1a1'&gt;건&lt;/fc&gt;" usedecorate="true" class="sta_workTitle5" position2="absolute l:6 w:218 t:81 h:20" positiontype="position2"/>
        <Static id="stc_22" text="전송일자" class="sta_workSrcLabel1" position="absolute 24 21 86 41"/>
        <Static id="stc_00" text="회원번호" class="sta_workSrcLabel1" position="absolute 331 21 415 41"/>
        <Edit id="edt_accnt_no" taborder="5" enable="true" position="absolute 395 21 500 42" onkeydown="edt_accnt_onkeydown"/>
        <Button id="btn_accnt_no" taborder="6" onclick="btn_accnt_onclick" class="btn_workSrcPop" position="absolute 501 21 521 41"/>
        <Static id="sta_Dash01" text="~" position="absolute 195 25 208 40"/>
        <Calendar id="cal_stt_dt" taborder="8" dateformat="yyyy-MM-dd" onchanged="cal_00_onchanged" oneditclick="cal_00_oneditclick" position="absolute 96 21 191 41"/>
        <Calendar id="cal_end_dt" taborder="9" dateformat="yyyy-MM-dd" onchanged="cal_00_onchanged" oneditclick="cal_00_oneditclick" position="absolute 209 21 304 41"/>
        <Combo id="cbo_prcs_yn" taborder="10" codecolumn="codecolumn" datacolumn="datacolumn" position="absolute 96 46 191 66" index="0" text="전체" onitemchanged="cbo_prcs_yn_onitemchanged">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn"/>
                <Col id="datacolumn">전체</Col>
              </Row>
              <Row>
                <Col id="codecolumn">Y</Col>
                <Col id="datacolumn">예</Col>
              </Row>
              <Row>
                <Col id="codecolumn">N</Col>
                <Col id="datacolumn">아니오</Col>
              </Row>
            </Rows>
          </Dataset>
        </Combo>
        <Edit id="edt_mem_nm" taborder="11" position="absolute 591 22 696 43" onkeydown="edt_mem_nm_onkeyup"/>
        <Static id="stc_01" text="회원명" class="sta_workSrcLabel1" position="absolute 543 22 603 42"/>
        <Static id="stc_02" text="결과상태" class="sta_workSrcLabel1" position="absolute 24 46 86 66"/>
        <Edit id="edt_mem_hp" taborder="13" onkeydown="edt_mem_nm_onkeyup" position="absolute 265 46 370 67"/>
        <Static id="stc_05" text="휴대폰" class="sta_workSrcLabel1" position="absolute 210 46 262 66"/>
        <ActiveX id="CMSCommAX" visible="false" progid="{60601393-834E-44DA-84BE-99E08C9734FE}" useautobitmapcache="1" position2="absolute l:1008 w:138 t:40 h:27" positiontype="position2" taborder="14"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_trans_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="strSvcID" type="STRING" size="256"/>
          <Column id="strURL" type="STRING" size="256"/>
          <Column id="strInDatasets" type="STRING" size="256"/>
          <Column id="strOutDatasets" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_inqCndt" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="stt_dt" type="STRING" size="256"/>
          <Column id="end_dt" type="STRING" size="256"/>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="mem_nm" type="STRING" size="256"/>
          <Column id="prcs_yn" type="STRING" size="256"/>
          <Column id="mem_hp" type="STRING" size="256"/>
          <Column id="orderBy" type="STRING" size="256"/>
          <Column id="orderDirection" type="STRING" size="256"/>
          <Column id="sController" type="STRING" size="256"/>
          <Column id="dsName" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="_chk" type="STRING" size="256"/>
          <Column id="page_indx" type="STRING" size="256"/>
          <Column id="unq_no" type="STRING" size="256"/>
          <Column id="name" type="STRING" size="256"/>
          <Column id="chng_seq" type="STRING" size="256"/>
          <Column id="id" type="STRING" size="256"/>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="bfr_pmt_gb" type="STRING" size="256"/>
          <Column id="bfr_bank_cd" type="STRING" size="256"/>
          <Column id="bfr_bank_nm" type="STRING" size="256"/>
          <Column id="bfr_acnt_no" type="STRING" size="256"/>
          <Column id="bfr_card_cd" type="STRING" size="256"/>
          <Column id="bfr_card_nm" type="STRING" size="256"/>
          <Column id="bfr_card_no" type="STRING" size="256"/>
          <Column id="bfr_card_expr_yr" type="STRING" size="256"/>
          <Column id="bfr_card_expr_mm" type="STRING" size="256"/>
          <Column id="bfr_pmt_day" type="STRING" size="256"/>
          <Column id="aft_pmt_gb" type="STRING" size="256"/>
          <Column id="aft_bank_cd" type="STRING" size="256"/>
          <Column id="aft_bank_nm" type="STRING" size="256"/>
          <Column id="aft_acnt_no" type="STRING" size="256"/>
          <Column id="aft_card_cd" type="STRING" size="256"/>
          <Column id="aft_card_nm" type="STRING" size="256"/>
          <Column id="aft_card_no" type="STRING" size="256"/>
          <Column id="aft_card_expr_yr" type="STRING" size="256"/>
          <Column id="aft_card_expr_mm" type="STRING" size="256"/>
          <Column id="aft_pmt_day" type="STRING" size="256"/>
          <Column id="hycl_able_time" type="STRING" size="256"/>
          <Column id="prcs_yn" type="STRING" size="256"/>
          <Column id="reg_id" type="STRING" size="256"/>
          <Column id="reg_ip" type="STRING" size="256"/>
          <Column id="reg_dtm" type="STRING" size="256"/>
          <Column id="mod_id" type="STRING" size="256"/>
          <Column id="mod_ip" type="STRING" size="256"/>
          <Column id="mod_dtm" type="STRING" size="256"/>
          <Column id="hp" type="STRING" size="256"/>
          <Column id="idn_no" type="STRING" size="256"/>
          <Column id="email" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list_tmp" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="seq" type="STRING" size="256"/>
          <Column id="mem_nm" type="STRING" size="256"/>
          <Column id="mem_no" type="STRING" size="256"/>
          <Column id="ocb_gubun" type="STRING" size="256"/>
          <Column id="result" type="STRING" size="256"/>
          <Column id="message" type="STRING" size="256"/>
          <Column id="reg_man" type="STRING" size="256"/>
          <Column id="reg_dt" type="STRING" size="256"/>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="ocb_point" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_accntInqCndt" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="srch_typ" type="STRING" size="256"/>
          <Column id="srch_vl" type="STRING" size="256"/>
          <Column id="option" type="STRING" size="256"/>
          <Column id="ns_yn" type="STRING" size="256"/>
          <Column id="popup_yn" type="STRING" size="256"/>
          <Column id="orderBy" type="STRING" size="256"/>
          <Column id="orderDirection" type="STRING" size="256"/>
          <Column id="sController" type="STRING" size="256"/>
          <Column id="dsName" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_accnt_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="page_indx" type="STRING" size="6"/>
          <Column id="accnt_no" type="STRING" size="100"/>
          <Column id="mem_no" type="STRING" size="100"/>
          <Column id="mem_nm" type="STRING" size="100"/>
          <Column id="home_tel" type="STRING" size="100"/>
          <Column id="cell" type="STRING" size="100"/>
          <Column id="wrpl_tel" type="STRING" size="100"/>
          <Column id="idn_no" type="STRING" size="100"/>
          <Column id="prod_cd" type="STRING" size="100"/>
          <Column id="prod_nm" type="STRING" size="100"/>
          <Column id="prod_amt" type="STRING" size="100"/>
          <Column id="mon_pay_amt" type="STRING" size="100"/>
          <Column id="expr_no" type="STRING" size="100"/>
          <Column id="emple_no" type="STRING" size="100"/>
          <Column id="emple_nm" type="STRING" size="100"/>
          <Column id="appfm_no" type="STRING" size="100"/>
          <Column id="join_dt" type="STRING" size="100"/>
          <Column id="compt_dt" type="STRING" size="100"/>
          <Column id="bef_emple_cd" type="STRING" size="100"/>
          <Column id="pay_perd" type="STRING" size="100"/>
          <Column id="pay_mthd" type="STRING" size="100"/>
          <Column id="join_prod" type="STRING" size="100"/>
          <Column id="new_chan_gunsu" type="STRING" size="100"/>
          <Column id="certf_rcv_chk" type="STRING" size="100"/>
          <Column id="pay_stat_1no" type="STRING" size="100"/>
          <Column id="ichae_dt" type="STRING" size="100"/>
          <Column id="bank_accnt_no" type="STRING" size="100"/>
          <Column id="old_mid" type="STRING" size="100"/>
          <Column id="reg_dm" type="STRING" size="100"/>
          <Column id="reg_man" type="STRING" size="100"/>
          <Column id="upd_dm" type="STRING" size="100"/>
          <Column id="upd_man" type="STRING" size="100"/>
          <Column id="accnt_stat" type="STRING" size="100"/>
          <Column id="total_pay" type="STRING" size="100"/>
          <Column id="last_no" type="STRING" size="100"/>
          <Column id="real_pay_no" type="STRING" size="100"/>
          <Column id="ded_no" type="STRING" size="100"/>
          <Column id="join_cl" type="STRING" size="100"/>
          <Column id="trans_gubun" type="STRING" size="100"/>
          <Column id="brth_mon_day" type="STRING" size="100"/>
          <Column id="pay_mthd" type="STRING" size="100"/>
          <Column id="emp_cell" type="STRING" size="100"/>
          <Column id="join_stat" type="STRING" size="100"/>
          <Column id="pay_stat" type="STRING" size="100"/>
          <Column id="pay_no" type="STRING" size="100"/>
          <Column id="pay_allt_no" type="STRING" size="100"/>
          <Column id="pay_add_no" type="STRING" size="100"/>
          <Column id="pay_amt" type="STRING" size="100"/>
          <Column id="pay_allt_amt" type="STRING" size="100"/>
          <Column id="pay_add_amt" type="STRING" size="100"/>
          <Column id="model_cl_nm" type="STRING" size="100"/>
        </ColumnInfo>
      </Dataset>
      <ExportObject id="ExportObject00" exporttype="0" exporteventtype="itemrecord" onexport="ExportObject00_onexport"/>
      <Dataset id="ds_pymn_typ" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="256"/>
          <Column id="cd_nm" type="STRING" size="256"/>
          <Column id="adtl_cd" type="STRING" size="256"/>
          <Column id="adtl_cd_nm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_hpclTm_typ" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="256"/>
          <Column id="cd_nm" type="STRING" size="256"/>
          <Column id="adtl_cd" type="STRING" size="256"/>
          <Column id="adtl_cd_nm" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="cd">HC2</Col>
            <Col id="cd_nm">09:00~10:00</Col>
          </Row>
          <Row>
            <Col id="cd">HC3</Col>
            <Col id="cd_nm">10:00~11:00</Col>
          </Row>
          <Row>
            <Col id="cd">HC4</Col>
            <Col id="cd_nm">11:00~12:00</Col>
          </Row>
          <Row>
            <Col id="cd">HC5</Col>
            <Col id="cd_nm">12:00~13:00</Col>
          </Row>
          <Row>
            <Col id="cd">HC6</Col>
            <Col id="cd_nm">13:00~14:00</Col>
          </Row>
          <Row>
            <Col id="cd">HC7</Col>
            <Col id="cd_nm">14:00~15:00</Col>
          </Row>
          <Row>
            <Col id="cd">HC8</Col>
            <Col id="cd_nm">15:00~16:00</Col>
          </Row>
          <Row>
            <Col id="cd">HC9</Col>
            <Col id="cd_nm">16:00~17:00</Col>
          </Row>
          <Row>
            <Col id="cd">HC10</Col>
            <Col id="cd_nm">17:00~18:00</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_resl_cd" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="256"/>
          <Column id="cd_nm" type="STRING" size="256"/>
          <Column id="adtl_cd" type="STRING" size="256"/>
          <Column id="adtl_cd_nm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_rgsnCard" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="mem_no" type="STRING" size="256"/>
          <Column id="mem_nm" type="STRING" size="256"/>
          <Column id="prdt_cd" type="STRING" size="256"/>
          <Column id="prdt_nm" type="STRING" size="256"/>
          <Column id="card_cd" type="STRING" size="256"/>
          <Column id="card_no" type="STRING" size="256"/>
          <Column id="exp_dt" type="STRING" size="256"/>
          <Column id="exp_year" type="STRING" size="256"/>
          <Column id="exp_mon" type="STRING" size="256"/>
          <Column id="inv_tg_dt" type="STRING" size="256"/>
          <Column id="idn_no" type="STRING" size="256"/>
          <Column id="emil" type="STRING" size="256"/>
          <Column id="cell" type="STRING" size="256"/>
          <Column id="rgsn_dt" type="STRING" size="256"/>
          <Column id="acpt_mthd" type="STRING" size="256"/>
          <Column id="app_cl" type="STRING" size="256"/>
          <Column id="bid" type="STRING" size="256"/>
          <Column id="card_apcl" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_rgsnCms" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="mem_no" type="STRING" size="256"/>
          <Column id="mem_nm" type="STRING" size="256"/>
          <Column id="idn_no" type="STRING" size="256"/>
          <Column id="bank_cd" type="STRING" size="256"/>
          <Column id="bank_accnt_no" type="STRING" size="256"/>
          <Column id="inv_tg_dt" type="STRING" size="256"/>
          <Column id="depr_nm" type="STRING" size="256"/>
          <Column id="rltn_cd" type="STRING" size="256"/>
          <Column id="depr_cell" type="STRING" size="256"/>
          <Column id="rgsn_dt" type="STRING" size="256"/>
          <Column id="acpt_mthd" type="STRING" size="256"/>
          <Column id="app_cl" type="STRING" size="256"/>
          <Column id="rltm_web_module" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_rgsnCons" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="mem_no" type="STRING" size="256"/>
          <Column id="mem_nm" type="STRING" size="256"/>
          <Column id="cons_memo" type="STRING" size="256"/>
          <Column id="cnsl_con" type="STRING" size="256"/>
          <Column id="gubn" type="STRING" size="256"/>
          <Column id="cnsl_cd" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/********************************************************************************************/
/* 1. Include Library include, variables Declaration 영역                                  */
/********************************************************************************************/
include "LIB::lib_All.xjs";

var tc_onlnAcntChng = 0;    //전체 건수

var success_cnt = 0;        //변환 성공건수
var fail_cnt = 0;			//변환 실패건수

var cur_seq = "";           //현재위치

//결제관련
var niceVldInspMsg = "";    //나이스페이유효성검사 메세지
var cmsVldInspMsg = "";     //CMS유효성검사 메세지
var cmsWdrwChk = "";        //CMS 산출여부 결과
var cardWdrwChk = "";       //Card 산출여부 결과

//웹모듈
var tmp_aplc_div = "";      //웹모듈 요청시 저장(신규,해지 구분)
var tmp_tmpr_resl = "";     //웹모듈 요청시 저장(웹모듈요청결과)

var cmsReslMsg = "";
var cardReslMsg = "";


//고객조회관련
var tc_custAcnt = 0;

//권한
var rgsnYn; //등록권한
var inqYn; //조회권한
var amntYn; //수정권한
var dltnYn; //삭제권한
var pritYn; //출력권한
var xlsYn; //엑셀권한
var athrPpupYn; //팝업오픈권한
var xlsRrnoYn; //엑셀 개인정보 권한 여부 

var gvMenuId;  // 프로그램 로그 추가 2017.12.04
/********************************************************************************************/
/* 2. Form 관련(onload 및 Form 이벤트) 처리                                           	*/
/********************************************************************************************/
function DL420700_onload(obj:Form, e:LoadEventInfo)
{
	//////////////////////////////////////////////////////////////////////////////////////////
	// 프로그램 로그 추가 2017.12.04 정승철
	gvMenuId = GV_LOGMENUID;
	//////////////////////////////////////////////////////////////////////////////////////////
	
	gfn_initForm(obj);
	gfn_createPagingDataset(obj); // 페이징처리 위한 데이터셋 설정
	
	fn_setAthrPgmBtn();
	
	gfn_getList("dlwCd","01,84","fn_callBack",false);   // 대명코드조회 (01:납입방법)
}



/********************************************************************************************/
/* 3. Callback(gfn_Transaction 호출 후 처리내용)                                   		*/
/********************************************************************************************/
function fn_callBack(svcid, errcd, errmsg) 
{
	if (errcd != 0) {
	} else {
		switch (svcid) {
			case "selectDlwCode": // 공통코드 조회 callBack Service ID
			gfn_getCode("01", "", ds_pymn_typ, gds_DmlCd); // 코드조회결과 필터
			gfn_getCode("84", "", ds_resl_cd, gds_DmlCd); // 코드조회결과 필터
			fn_init("Y"); // 검색부 초기화
			break;
			
			case "srchOnlnAcntChngList":
		    gfn_appendSearchDs(ds_list, ds_list_tmp);
		    gfn_setTotalRowCount(ds_list, sta_TotalCnt, tc_onlnAcntChng, null, true, null); 
			fn_postSearch();
			break;
			
			case "selectCustaccntList":
			if(tc_custAcnt == 1) {
				fn_setAccntNo();
			} else if (tc_custAcnt > 1) {
				btn_accnt_onclick(null, "Y");
			} else {
				edt_accnt_no.value = "";
			}			
			break;
			
			case "srchNiceVldInsp": // 나이스페이 유효성검사
			trace("[" + cur_seq + "] --- 7");
			trace("niceVldInspMsg : " + niceVldInspMsg);
			if ("success" == niceVldInspMsg) {
				// 변경전값으로 해지 후 변경후값으로 부가서비스등록
				fn_aftChngRgsn(cur_seq);
			} else {
				trace("[" + cur_seq + "] --- 7-1");
				fail_cnt++;
			}
			break;
			
			case "srchCmsVldInsp": // CMS 유효성검사
			trace("[" + cur_seq + "] --- 7");
			trace("cmsVldInspMsg : " + cmsVldInspMsg);
			if ("" == cmsVldInspMsg) {
				// 변경전값으로 해지 후 변경후값으로 부가서비스등록
				fn_aftChngRgsn(cur_seq);
			} else {
				trace("[" + cur_seq + "] --- 7-1");
				fail_cnt++;
			}
			break;
			
			case "srchCmsWdrwChk":
			if ("" == cmsWdrwChk) {
				fn_commSave("saveCmsRgsnAnxtSrvc", "can", cur_seq);
			} else {
				fail_cnt++;
			}
			break;
			
			case "srchCardWdrwChk":
			if ("" == cardWdrwChk) {
				fn_commSave("saveCardRgsnAnxtSrvc", "can", cur_seq);
			} else {
				fail_cnt++;
			}
			break;
			
			case "saveCmsRgsnAnxtSrvcBfr": // CMS 부가서비스등록 (변경전정보-해지)
			trace(cmsReslMsg);
			if ("success" == cmsReslMsg || "proxy" == cmsReslMsg) {
				fn_commSave("saveCons", "can", cur_seq, "cms");
			} else if ("empty" == cmsReslMsg) { // 해지시도 후 기존 없는 회원 > 상담저장없이 신규등록
				fn_addService(cur_seq);
			} else {
				fail_cnt++;
			}
			break;
			
			case "saveCmsRgsnAnxtSrvcAft": // CMS 부가서비스등록 (변경후정보-신규)
			trace(cmsReslMsg);
			if ("success" == cmsReslMsg || "proxy" == cmsReslMsg) {
				fn_commSave("saveCons", "new", cur_seq, "cms");
			} else {
				fail_cnt++;
			}
			break;
			
			case "saveCardRgsnAnxtSrvcBfr":  // 카드 부가서비스등록 (변경전정보-해지)
			trace(cardReslMsg);
			if ("success" == cardReslMsg || "proxy" == cardReslMsg) {
				fn_commSave("saveCons", "can", cur_seq, "card");
			} else if ("empty" == cardReslMsg) { // 해지시도 후 기존 없는 회원 > 상담저장없이 신규등록
				fn_addService(cur_seq);
			} else {
				fail_cnt++;
			}
			break;
			
			case "saveCardRgsnAnxtSrvcAft": // 카드 부가서비스등록 (변경후정보-신규)
			trace(cardReslMsg);
			if ("success" == cardReslMsg || "proxy" == cardReslMsg ) {
				fn_commSave("saveCons", "new", cur_seq, "card");
			} else {
				fail_cnt++;
			}
			break;
			
			
			
			case "saveConsBfr": //상담저장(변경전정보 해지)
			//변경후정보로 부가서비스등록
			fn_addService(cur_seq);
			
			break;
			
			case "saveConsAft": //상담저장(변경후정보 신규)
			//변환완료여부 업데이트
			
			//임시 처리.. (개발기간 온라인운영DB전환관련)
			fn_commSave("updateOnlnTrntCmpl", "new", cur_seq);
			success_cnt++;//임시처리
			break;
			
			case "updateOnlnTrntCmpl": //변환완료여부 업데이트
			success_cnt++;
			break;
		}
	}
}



/********************************************************************************************/
/**   4. Validation 처리                                                                   	*/
/********************************************************************************************/
function fn_preSearch(sType,svcid, i) {
	if (sType == gfn_getCommTypeInit())
	{
		switch(svcid) {
			case "srchOnlnAcntChngList": 
			// 조회조건 및 default 정렬
			ds_inqCndt.keystring = ""; // 정렬컬럼 초기화
			
			ds_inqCndt.clearData();
			ds_inqCndt.addRow();
			
			ds_inqCndt.setColumn(0, "stt_dt", cal_stt_dt.value);
			ds_inqCndt.setColumn(0, "end_dt", cal_end_dt.value);
			ds_inqCndt.setColumn(0, "accnt_no", edt_accnt_no.value);
			ds_inqCndt.setColumn(0, "mem_nm", edt_mem_nm.value);
			ds_inqCndt.setColumn(0, "prcs_yn", cbo_prcs_yn.value);
			var mem_hp = edt_mem_hp.value;
			ds_inqCndt.setColumn(0, "mem_hp", mem_hp.replace("-",""));
		
			ds_inqCndt.setColumn(0, "orderBy", "reg_dtm");
			ds_inqCndt.setColumn(0, "orderDirection", "asc");
			break;
			
			case "selectCustaccntList":
			ds_accntInqCndt.keystring = ""; // 정렬컬럼 초기화
			ds_accntInqCndt.clearData();
			ds_accntInqCndt.addRow();
			
			var srch_typ = ""
			var srch_vl = "";
			var option = "";
			
			if (i == "accnt_no") {
				srch_typ = i;
				srch_vl = edt_accnt_no.value;
			} else if (i == "mem_nm"){
				srch_typ = i;
				srch_vl = edt_mem_nm.value;
			}
			
			ds_accntInqCndt.setColumn(0, "srch_typ", srch_typ);
			ds_accntInqCndt.setColumn(0, "srch_vl", srch_vl);
			ds_accntInqCndt.setColumn(0, "option", option);
			ds_accntInqCndt.setColumn(0, "ns_yn", "N");
			ds_accntInqCndt.setColumn(0, "popup_yn", "N");
			ds_accntInqCndt.setColumn(0, "orderBy", "mem_nm");
			ds_accntInqCndt.setColumn(0, "orderDirection", "asc");
			return_bool = true;
			break;
			
			case "srchNiceVldInsp":
			var app_cl = "";  // 처리구분
			var acpt_mthd = ""  // 처리방법
			var card_apcl = "";
			
			//신규 (변경후)
			app_cl = "1";   
			acpt_mthd = "06"
			card_apcl = "new";
			
			var accnt_no = ds_list.getColumn(i, "accnt_no");
			var mem_no = ds_list.getColumn(i, "unq_no");
			var mem_nm = ds_list.getColumn(i, "name");
			var idn_no = ds_list.getColumn(i, "idn_no");
			
			var email = ds_list.getColumn(i, "email");
			var hp = ds_list.getColumn(i, "hp");
			
			var aft_pmt_day = ds_list.getColumn(i, "aft_pmt_day");
			var aft_card_cd = ds_list.getColumn(i, "aft_card_cd");
			var aft_card_no = ds_list.getColumn(i, "aft_card_no");
			var aft_card_expr_yr = ds_list.getColumn(i, "aft_card_expr_yr");
			var aft_card_expr_mm = ds_list.getColumn(i, "aft_card_expr_mm");
			
			ds_rgsnCard.keystring = ""; // 정렬컬럼 초기화
			ds_rgsnCard.clearData();
			ds_rgsnCard.addRow();
			ds_rgsnCard.setColumn(0, "accnt_no", accnt_no);
			ds_rgsnCard.setColumn(0, "mem_no", mem_no);
			ds_rgsnCard.setColumn(0, "mem_nm", mem_nm);
			ds_rgsnCard.setColumn(0, "prdt_cd", "");
			ds_rgsnCard.setColumn(0, "prdt_nm", "");
			ds_rgsnCard.setColumn(0, "card_cd", aft_card_no);
			ds_rgsnCard.setColumn(0, "card_no", aft_card_no);
			ds_rgsnCard.setColumn(0, "exp_dt", aft_card_expr_yr+""+aft_card_expr_mm);
			ds_rgsnCard.setColumn(0, "exp_year", aft_card_expr_yr);
			ds_rgsnCard.setColumn(0, "exp_mon", aft_card_expr_mm);
			ds_rgsnCard.setColumn(0, "inv_tg_dt", aft_pmt_day);
			ds_rgsnCard.setColumn(0, "idn_no", idn_no);
			ds_rgsnCard.setColumn(0, "emil", email);
			ds_rgsnCard.setColumn(0, "cell", hp);
			ds_rgsnCard.setColumn(0, "rgsn_dt", gfn_getToday());
			ds_rgsnCard.setColumn(0, "app_cl", app_cl);
			ds_rgsnCard.setColumn(0, "acpt_mthd", acpt_mthd);
			ds_rgsnCard.setColumn(0, "card_apcl", card_apcl);
			break;
		}
	}
	return true;
}

//저장
function fn_preSave(svcid, gbn, i) {

    var return_bool = false;
    
    switch(svcid) {
		// CMS 부가서비스 등록
        case "saveCmsRgsnAnxtSrvc":
		var accnt_no = ds_list.getColumn(i, "accnt_no");
		var mem_no = ds_list.getColumn(i, "unq_no");
		var mem_nm = ds_list.getColumn(i, "name");
		var idn_no = ds_list.getColumn(i, "idn_no");
		
		var depr_cell = ds_list.getColumn(i, "hp");
	        
		var acpt_mthd = ""; // 처리방법
		var app_cl = "";  // 처리구분
		
		var bank_cd = "";
		var inv_tg_dt = "";
		var bank_accnt_no = "";
		
		if("new" == gbn) {    //신규
		    acpt_mthd = "03";  //부가신규 
		    app_cl = "1";      //신규
			bank_cd = ds_list.getColumn(i, "aft_bank_cd");
			inv_tg_dt = ds_list.getColumn(i, "aft_pmt_day");
			bank_accnt_no = ds_list.getColumn(i, "aft_acnt_no");
		} else {              //해지
			acpt_mthd = "04"; //정상부가해지
			app_cl = "3";     //해지
			bank_cd = ds_list.getColumn(i, "bfr_bank_cd");
			inv_tg_dt = ds_list.getColumn(i, "bfr_pmt_day");
			bank_accnt_no = ds_list.getColumn(i, "bfr_acnt_no");
		}
	
		ds_rgsnCms.clearData();
		ds_rgsnCms.addRow();
		ds_rgsnCms.setColumn(0, "accnt_no", accnt_no);
		ds_rgsnCms.setColumn(0, "mem_no", mem_no);
		ds_rgsnCms.setColumn(0, "mem_nm", mem_nm);
		ds_rgsnCms.setColumn(0, "idn_no", idn_no);
		ds_rgsnCms.setColumn(0, "bank_cd",  bank_cd);
		ds_rgsnCms.setColumn(0, "bank_accnt_no", bank_accnt_no);
		ds_rgsnCms.setColumn(0, "inv_tg_dt", inv_tg_dt);
		ds_rgsnCms.setColumn(0, "depr_nm", mem_nm);   //본인...
		ds_rgsnCms.setColumn(0, "rltn_cd", "20");     //본인...
		ds_rgsnCms.setColumn(0, "depr_cell", depr_cell);
		ds_rgsnCms.setColumn(0, "rgsn_dt", gfn_getToday());
		ds_rgsnCms.setColumn(0, "acpt_mthd", acpt_mthd);
		ds_rgsnCms.setColumn(0, "app_cl", app_cl);
		ds_rgsnCms.setColumn(0, "rltm_web_module", "N");	
		return_bool =  true;
        break;
        
        // Card 부가서비스 등록
        case "saveCardRgsnAnxtSrvc":
		var accnt_no = ds_list.getColumn(i, "accnt_no");
		var mem_no = ds_list.getColumn(i, "unq_no");
		var mem_nm = ds_list.getColumn(i, "name");
		var idn_no = ds_list.getColumn(i, "idn_no");
		
		var cell = ds_list.getColumn(i, "hp");
		var email = ds_list.getColumn(i, "email");
		
		var app_cl = "";    // 처리구분
		var acpt_mthd = ""  // 처리방법
		var card_apcl = "";
		
		var inv_tg_dt = "";
		var card_cd = "";
		var card_no = "";
		var card_expr_yr = "";
		var card_expr_mm = "";
		
		if("new" == gbn) {//신규
			app_cl = "1";   //신규
			acpt_mthd = "06"
			inv_tg_dt = ds_list.getColumn(i, "aft_pmt_day");
			card_cd = ds_list.getColumn(i, "aft_card_cd");
			card_no = ds_list.getColumn(i, "aft_card_no");
			card_expr_yr = ds_list.getColumn(i, "aft_card_expr_yr");
			card_expr_mm = ds_list.getColumn(i, "aft_card_expr_mm");
		} else {//해지
			app_cl = "3";   //해지
			acpt_mthd = "01"
			inv_tg_dt = ds_list.getColumn(i, "bfr_pmt_day");
			card_cd = ds_list.getColumn(i, "bfr_card_cd");
			card_no = ds_list.getColumn(i, "bfr_card_no");
			card_expr_yr = ds_list.getColumn(i, "bfr_card_expr_yr");
			card_expr_mm = ds_list.getColumn(i, "bfr_card_expr_mm");
		};

		ds_rgsnCard.clearData();
		ds_rgsnCard.addRow();
		ds_rgsnCard.setColumn(0, "accnt_no", accnt_no);
		ds_rgsnCard.setColumn(0, "mem_no", mem_no);
		ds_rgsnCard.setColumn(0, "mem_nm", mem_nm);
		ds_rgsnCard.setColumn(0, "prdt_cd", "");
		ds_rgsnCard.setColumn(0, "prdt_nm", "");
		ds_rgsnCard.setColumn(0, "card_cd", card_cd);
		ds_rgsnCard.setColumn(0, "card_no", card_no);
		ds_rgsnCard.setColumn(0, "exp_dt", card_expr_yr+""+card_expr_mm);
		ds_rgsnCard.setColumn(0, "exp_year", card_expr_yr);
		ds_rgsnCard.setColumn(0, "exp_mon", card_expr_mm);
		ds_rgsnCard.setColumn(0, "inv_tg_dt", inv_tg_dt);
		ds_rgsnCard.setColumn(0, "idn_no", idn_no);
		ds_rgsnCard.setColumn(0, "emil", email);
		ds_rgsnCard.setColumn(0, "cell", cell);
		ds_rgsnCard.setColumn(0, "rgsn_dt", gfn_getToday());
		ds_rgsnCard.setColumn(0, "app_cl", app_cl);
		ds_rgsnCard.setColumn(0, "acpt_mthd", acpt_mthd);
		ds_rgsnCard.setColumn(0, "card_apcl", gbn);
			
		return_bool =  true;
        break;
        

        //상담저장 (CMS)
        case "saveCmsCons":
        var accnt_no = ds_list.getColumn(i, "accnt_no");
		var mem_no = ds_list.getColumn(i, "unq_no");
        var depr_nm = ds_list.getColumn(i, "name");
        var rntn_nm = "본인";
        var idn_no = ds_list.getColumn(i, "idn_no");
        
        var bank_nm = "";
        var bank_cd = "";
        var bank_accnt_no = "";
        var inv_tg_dt = "";
	
		var cons_cntn = "";
		var cons_dtbt_cntn = "";
		
        if("new" == gbn) {//신규
            cons_cntn = "CMS등록";
            cons_dtbt_cntn = '[신청]';
            bank_nm = ds_list.getColumn(i, "aft_bank_nm");
            bank_cd = ds_list.getColumn(i, "aft_bank_cd");
            bank_accnt_no = ds_list.getColumn(i, "aft_acnt_no");
            inv_tg_dt = ds_list.getColumn(i, "aft_pmt_day");
        } else {
			cons_cntn = "CMS해지";
            cons_dtbt_cntn = '[해지]';
            bank_nm = ds_list.getColumn(i, "bfr_bank_nm");
            bank_cd = ds_list.getColumn(i, "bfr_bank_cd");
            bank_accnt_no = ds_list.getColumn(i, "bfr_acnt_no");
            inv_tg_dt = ds_list.getColumn(i, "bfr_pmt_day");
        }
        
        cons_dtbt_cntn += '['+ bank_nm +'/'+ bank_cd +']'
    				   +' 계좌번호:'+ bank_accnt_no
	     			   +' 예금주명 :'+ depr_nm +'('+ rntn_nm +'|'+ idn_no + ')'
		     		   +' 이체일 :'+ inv_tg_dt;       
        
        ds_rgsnCons.clearData();
        ds_rgsnCons.addRow();
        ds_rgsnCons.setColumn(0, "accnt_no", accnt_no);
        ds_rgsnCons.setColumn(0, "mem_no", mem_no);
        ds_rgsnCons.setColumn(0, "mem_nm", depr_nm);
        ds_rgsnCons.setColumn(0, "cons_memo", cons_cntn);
		ds_rgsnCons.setColumn(0, "cnsl_con", cons_dtbt_cntn);
		ds_rgsnCons.setColumn(0, "gubn", "80");
		ds_rgsnCons.setColumn(0, "cnsl_cd", "01");
		
        return_bool =  true;
        break;
        
        
        //상담저장 (Card)
        case "saveCardCons":
        var accnt_no = ds_list.getColumn(i, "accnt_no");
        var mem_no = ds_list.getColumn(i, "unq_no");
        var mem_nm = ds_list.getColumn(i, "name");
        
        var inv_tg_dt = "";
        var card_nm = "";
        var card_no = "";
		var vld_yr = "";
		var vld_mnth = "";
		var vld_dt = "";
        
		var cons_cntn = "";
		var cons_dtbt_cntn = "";
		
        if("new" == gbn) {//신규
            cons_cntn = "CARD등록";
            cons_dtbt_cntn = '[신청]';
			inv_tg_dt = ds_list.getColumn(i, "aft_pmt_day");
			card_cd = ds_list.getColumn(i, "aft_card_cd");
			card_nm = ds_list.getColumn(i, "aft_card_nm");
			card_no = ds_list.getColumn(i, "aft_card_no");
			card_expr_yr = ds_list.getColumn(i, "aft_card_expr_yr");
			card_expr_mm = ds_list.getColumn(i, "aft_card_expr_mm");
        } else {
			cons_cntn = "CARD해지";
            cons_dtbt_cntn = '[해지]';
			inv_tg_dt = ds_list.getColumn(i, "bfr_pmt_day");
			card_cd = ds_list.getColumn(i, "bfr_card_cd");
			card_nm = ds_list.getColumn(i, "bfr_card_nm");
			card_no = ds_list.getColumn(i, "bfr_card_no");
			card_expr_yr = ds_list.getColumn(i, "bfr_card_expr_yr");
			card_expr_mm = ds_list.getColumn(i, "bfr_card_expr_mm");
        }
        //[신청][신한] 카드번호 :5428796648283998 결제일 :20 유효일 :19/06
        cons_dtbt_cntn += '['+ card_nm +']' 
    				   +' 카드번호:'+ card_no
	     			   +' 결제일 :'+ inv_tg_dt
		     		   +' 유효일 :'+ card_expr_yr+""+card_expr_mm;        
        
        ds_rgsnCons.clearData();
        ds_rgsnCons.addRow();
        ds_rgsnCons.setColumn(0, "accnt_no", accnt_no);
        ds_rgsnCons.setColumn(0, "mem_no", mem_no);
        ds_rgsnCons.setColumn(0, "mem_nm", mem_nm);
        ds_rgsnCons.setColumn(0, "cons_memo", cons_cntn);
		ds_rgsnCons.setColumn(0, "cnsl_con", cons_dtbt_cntn);
		ds_rgsnCons.setColumn(0, "gubn", "80");
		ds_rgsnCons.setColumn(0, "cnsl_cd", "01");

        return_bool =  true;
        break;
    }
    
    return return_bool;
}



//체크여부 확인
function fn_preCheck()
{
	var chkfg = false;
	
	for(var i=0;i<ds_list.rowcount;i++) {
		if(ds_list.getColumn(i, "_chk") == 1) { // 체크 여부 확인
			chkfg = true;
		}
	}
	return chkfg;
}
/********************************************************************************************/
/**   5. 서비스 호출(gfn_Transaction)                                                   	*/
/********************************************************************************************/
//조회
function fn_commSearch(sType, searchInfo, i) {
	
	var szSvcid       = "";
    var szController  = "";
    var szInDs        = "";
    var szOutDs       = "";
    var szParam       = "";
    var szRetCallback = "";
    
    switch(searchInfo) {
        case "srchOnlnAcntChngList": 
        if (!fn_preSearch(sType,"srchOnlnAcntChngList")) return false;
	    if(!gfn_pageSearch(sType, ds_list, sta_TotalCnt, 500, tc_onlnAcntChng)) return;
	    szSvcid       = "srchOnlnAcntChngList";
		szController  = "/dlw-onln/pymn-acnt/chng-list";
		szInDs        = "ds_input=ds_inqCndt";
		szOutDs       = "ds_list_tmp=ds_output";
		szParam       = "";
		szRetCallback = "fn_callBack";
        break;
		case "selectCustaccntList":
        if (!fn_preSearch(sType,"selectCustaccntList", i)) return false;
		szSvcid       = "selectCustaccntList";
		szController  = "/dlw/cust/cust-acnt/list";
		szInDs        = "ds_input=ds_accntInqCndt";
		szOutDs       = "ds_accnt_info=ds_output";
		szParam       = "";
		szRetCallback = "fn_callBack";
		break;
		case "srchNiceVldInsp":
		if (!fn_preSearch(sType,"srchNiceVldInsp", i)) return false;
		szSvcid       = "srchNiceVldInsp";
		szController  = "/dlw/card/vld-insp";
		szInDs        = "ds_input=ds_rgsnCard";
		szOutDs       = "";
		szParam       = "";
		szRetCallback = "fn_callBack";
		break;
		case "srchCmsWdrwChk": // CMS 산출중 여부 확인
	    szSvcid       = "srchCmsWdrwChk";
		szController  = "/dlw/cms/cms-wdrw-chk";
		szInDs        = "";
		szOutDs       = "";
		szParam       = "accnt_no=" + ds_list.getColumn(i, "accnt_no");
		szRetCallback = "fn_callBack";
		case "srchCardWdrwChk": //카드 산출중여부확인
		szSvcid       = "srchCardWdrwChk";
		szController  = "/dlw/card/card-wdrw-chk";
		szInDs        = "";
		szOutDs       = "";
		szParam       = "accnt_no=" + ds_list.getColumn(i, "accnt_no");
		szRetCallback = "fn_callBack";
        break;
        case "srchCmsVldInsp": //CMS 회원여부 확인
		szSvcid       = "srchCmsVldInsp";
		szController  = "/dlw/cms/vld-insp";
		szInDs        = "";
		szOutDs       = "";
		szParam       = "accnt_no=" + ds_list.getColumn(i, "accnt_no");
		szRetCallback = "fn_callBack";
        break;
    }
    // 트랜젝션 공통함수 호출
    gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback,"","","S",gvMenuId);
}


//저장
function fn_commSave(saveInfo, gbn, i, consTyp) {

    var szSvcid = "";
    var szController = "";
    var szInDs = "";
    var szOutDs = "";
    var szParam = "";
    var szRetCallback = "";
    
    var pass_fg = true;

    switch(saveInfo) {
        case "saveCmsRgsnAnxtSrvc": //CMS 부가서비스 등록
        
		if (!fn_preSave("saveCmsRgsnAnxtSrvc", gbn, i)) return false;   
		//웹모듈 연동		
		gfn_setWaitCursor(true);
		var resl = fn_rltmWebModuleRequest(gbn, i);
		gfn_setWaitCursor(false);
		if (!resl) {
			fail_cnt++;
			pass_fg = false;
		}
		if ("new" == gbn) {
			szSvcid       = "saveCmsRgsnAnxtSrvcAft";
			trace("[" + i + "] --- CMS등록-신규");
		} else {
			szSvcid       = "saveCmsRgsnAnxtSrvcBfr";
			trace("[" + i + "] --- CMS등록-해지");
		}
		szController  = "/dlw/cms/cms-anxt-srvc/save";
		szInDs        = "ds_input=ds_rgsnCms";
		szOutDs       = "";
		szParam       = "";
		szRetCallback = "fn_callBack";   
		    
        break;
        
        case "saveCardRgsnAnxtSrvc": //Card 등록
		if (!fn_preSave("saveCardRgsnAnxtSrvc", gbn, i)) return false;
		if ("new" == gbn) {
			szSvcid       = "saveCardRgsnAnxtSrvcAft";
			trace("[" + i + "] --- Card등록-신규");
		} else {
			szSvcid       = "saveCardRgsnAnxtSrvcBfr";
			trace("[" + i + "] --- Card등록-해지");
		}
		szController  = "/dlw/card/card-anxt-srvc/save";
		szInDs        = "ds_input=ds_rgsnCard";
		szOutDs       = "";
		szParam       = "";
		szRetCallback = "fn_callBack";
        break;
        
        case "saveCons": //상담등록
        if ("cms" == consTyp) {
			if (!fn_preSave("saveCmsCons", gbn, i)) return false;
        } else if ("card" == consTyp) {
			if (!fn_preSave("saveCardCons", gbn, i)) return false;
        } else {return false;}
        //구분값에따라 상담저장 분기..
        if ("new" == gbn) {
			szSvcid       = "saveConsAft";
			trace("[" + i + "] --- 상담등록-신규");
        } else {
			szSvcid       = "saveConsBfr";
			trace("[" + i + "] --- 상담등록-해지");
        }
		szController  = "/dlw/cms/save-cons";
		szInDs        = "ds_input=ds_rgsnCons";
		szOutDs       = "";
		szParam       = "";
		szRetCallback = "fn_callBack";  
        break;
        
        case "updateOnlnTrntCmpl": //온라인 결제계좌변경 변환완료여부 업데이트
		szSvcid       = "updateOnlnTrntCmpl";
		szController  = "/dlw-onln/pymn-acnt/trnt-cmpl/update";
		szInDs        = "ds_input=ds_rgsnCard";
		szOutDs       = "";
		szParam       = "chng_seq="+ds_list.getColumn(i, "chng_seq");
		szRetCallback = "fn_callBack";
        break;

              
    }

	// 트랜젝션 공통함수 호출
	if (pass_fg) {
		gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback);
	}
}


/********************************************************************************************/
/**   6. 사용자 함수                                                                   	*/
/********************************************************************************************/
//초기화
function fn_init(typ)
{
	ds_list.clearData();
	cal_stt_dt.value = gfn_getToday();
	cal_end_dt.value = gfn_getToday();
	edt_accnt_no.value = "";
	edt_mem_nm.value = "";
	cbo_prcs_yn.value = "";
	edt_mem_hp.value = "";
	
	var fv_emple_no = gfn_getUserInfo("user_id");
//	trace(fv_emple_no);
	if (	fv_emple_no == '2017080002' // 김찬영 
			||fv_emple_no == '2017080003' // 김준호
		)
		{
	}else{	
		//CMS 실시간웹모듈 초기화
		if(gfn_CmsInit() != 1) {
			alert("CMS WebModule 초기화 실패\n관리자에게 문의하세요.");
		}
	}
	if(typ == "Y") {
		//fn_commSearch(gfn_getCommTypeInit(), "srchOnlnAcntChngList"); // 조회	
	}
}

//조회 결과
function fn_postSearch()
{
	if(ds_list.rowcount < 1) {
		alert("조회된 자료가 없습니다.");
		ds_list.clearData();
	}
}

function fn_checkText(str) {
	if(gfn_isNull(str)) {
		str = '';
	}
	return str
}


function fn_pymnNm(cd) 
{
	var cd_nm = ""
	ds_pymn_typ.filter("(cd=='"+ cd +"')");
	if (ds_pymn_typ.rowcount > 0 ) {
		cd_nm = ds_pymn_typ.getColumn(0,"cd_nm");
	}
	ds_pymn_typ.filter("");

	return cd_nm;
}


function fn_hpclTm(cd)
{
	var cd_nm = ""
	ds_hpclTm_typ.filter("(cd=='"+ cd +"')");
	if (ds_hpclTm_typ.rowcount > 0 ) {
		cd_nm = ds_hpclTm_typ.getColumn(0,"cd_nm");
	}
	ds_hpclTm_typ.filter("");

	return cd_nm;
}

/********************************************************************************************/
/**   7. 이벤트(Event) Function                                                          	*/
/********************************************************************************************/
//조회 버튼 이벤트
function btn_Search_onclick(obj:Button,  e:ClickEventInfo)
{
	fn_commSearch(gfn_getCommTypeInit(), "srchOnlnAcntChngList"); // 조회
}


// 스크롤 페이징
function fn_Grid_onvscrolllastover(obj:Grid, e:ScrollEventInfo)
{
	fn_commSearch(gfn_getCommTypeAppend(),"srchOnlnAcntChngList");
}


// 그리드 헤더 클릭
function grd_onheadclick(obj:Grid, e:GridClickEventInfo)
{ 
	//등록순으로 순차적용되어야 하므로 정렬불가
    if (e.cell != 0) return false;
    gfn_grdHeadClick(obj, e);
}


//회원번호 엔터 입력시
function edt_accnt_no_onkeydown(obj:Edit, e:KeyEventInfo)
{
	if (e.keycode == "13") {
		if (edt_accnt_no.value == "") {
			btn_accnt_onclick();
		} else {
			fn_commSearch(gfn_getCommTypeInit(), "selectCustaccntList"); // 조회
		}
	}
}

//회원명 엔터 입력시
function edt_mem_nm_onkeyup(obj:Edit, e:KeyEventInfo)
{
	if (e.keycode == "13") {
		fn_commSearch(gfn_getCommTypeInit(), "srchOnlnAcntChngList"); // 조회
	}
}





//1. 선택건 일괄변환 클릭시
function btn_onln_pymn_acnt_chng_onclick(obj:Button,  e:ClickEventInfo)
{
	//실패건수, 성공건수 초기화
	success_cnt = 0;
	fail_cnt = 0;
	
	//체크확인
	if(!fn_preCheck()) {
		alert("변환할 정보를 선택해주세요.");
		return false;
	}

	for(var i=0;i<ds_list.rowcount;i++) {
		if(ds_list.getColumn(i, "_chk") == 1 && ds_list.getColumn(i, "prcs_yn") == "N") {
			trace("[" + i + "] --- START FOR");
			var prgr_fg = false; //진행 플래그
			
			//현재위치 저장..
			cur_seq = i;
			
			//2. 변경전/후 입력값 확인
			var accnt_no = ds_list.getColumn(i, "accnt_no");
			var mem_no = ds_list.getColumn(i, "unq_no");
			var mem_nm = ds_list.getColumn(i, "name");
			var idn_no = ds_list.getColumn(i, "idn_no");
			
			var bfr_pmt_gb = ds_list.getColumn(i, "bfr_pmt_gb");
			var bfr_pmt_day = ds_list.getColumn(i, "bfr_pmt_day");
			var bfr_bank_cd = ds_list.getColumn(i, "bfr_bank_cd");
			var bfr_acnt_no = ds_list.getColumn(i, "bfr_acnt_no");
			var bfr_card_cd = ds_list.getColumn(i, "bfr_card_cd");
			var bfr_card_no = ds_list.getColumn(i, "bfr_card_no");
			var bfr_card_expr_yr = ds_list.getColumn(i, "bfr_card_expr_yr");
			var bfr_card_expr_mm = ds_list.getColumn(i, "bfr_card_expr_mm");
			
			var aft_pmt_gb = ds_list.getColumn(i, "aft_pmt_gb");
			var aft_pmt_day = ds_list.getColumn(i, "aft_pmt_day");
			var aft_bank_cd = ds_list.getColumn(i, "aft_bank_cd");
			var aft_acnt_no = ds_list.getColumn(i, "aft_acnt_no");
			var aft_card_cd = ds_list.getColumn(i, "aft_card_cd");
			var aft_card_no = ds_list.getColumn(i, "aft_card_no");
			var aft_card_expr_yr = ds_list.getColumn(i, "aft_card_expr_yr");
			var aft_card_expr_mm = ds_list.getColumn(i, "aft_card_expr_mm");

			//3. 고객정보 입력값 확인
			if (gfn_isNull(accnt_no) || gfn_isNull(mem_no) || gfn_isNull(mem_nm)) {
				fail_cnt++;
				trace("[" + i + "] --- Continue-1");
				continue;
			}
			
			//4. 변경전 납입방법에 따라 입력값 확인(04:CMS, 06:카드)
			if ("04" == bfr_pmt_gb) { //CMS
				if(gfn_isNull(bfr_bank_cd) || gfn_isNull(bfr_acnt_no) || gfn_isNull(bfr_pmt_day)) {
					fail_cnt++;
					trace("[" + i + "] --- Continue-2");
					continue;
				} 
			} else if ("06" == bfr_pmt_gb){ //카드
				if(gfn_isNull(bfr_card_cd) || gfn_isNull(bfr_card_no) || gfn_isNull(bfr_card_expr_yr) || gfn_isNull(bfr_card_expr_mm) || gfn_isNull(bfr_pmt_day)) {
					fail_cnt++;
					trace("[" + i + "] --- Continue-3");
					continue;
				} 
			} 
			
			//5. 변경후 납입방법에 따라 입력값 확인(04:CMS,06:카드)
			if ("04" == aft_pmt_gb) { //CMS
				if(gfn_isNull(aft_bank_cd) || gfn_isNull(aft_acnt_no) || gfn_isNull(aft_pmt_day)) {
					fail_cnt++;
					trace("[" + i + "] --- Continue-4");
					continue;
				} 
			} else if ("06" == aft_pmt_gb) { //카드
				if(gfn_isNull(aft_card_cd) || gfn_isNull(aft_card_no) || gfn_isNull(aft_card_expr_yr) || gfn_isNull(aft_card_expr_mm) || gfn_isNull(aft_pmt_day)) {
					fail_cnt++;
					trace("[" + i + "] --- Continue-5");
					continue;
				} 
			} else {
				fail_cnt++;
				trace("[" + i + "] --- Continue-6");
				continue;
			}
			
			//6. 변경후 결제구분 입력값 유효여부 확인
			if ("04" == aft_pmt_gb) { //CMS
				trace("[" + i + "] --- CMS");
				// 웹모듈 유효검사
				gfn_setWaitCursor(true);
				var resl = fn_rltmWebModuleRequest("check",i);
				gfn_setWaitCursor(false);
				if (!resl) {
					fail_cnt++;
					trace("[" + i + "] --- Continue-CMS");
					continue;
				} else {
					if ("04" != bfr_pmt_gb) {
						//변경전 결제구분이 CMS가 아닐 경우 CMS회원 추가확인 (CMS회원여부)
						fn_commSearch(gfn_getCommTypeInit(), "srchCmsVldInsp", i);
					} else {
						// 변경전값으로 해지 후 변경후값으로 부가서비스등록
						fn_aftChngRgsn(i);
					}
				}
			} else if ("06" == aft_pmt_gb){
				trace("[" + i + "] --- CARD");
				// 나이스페이 유효검사
				fn_commSearch(gfn_getCommTypeInit(), "srchNiceVldInsp", i);
			}
			trace("[" + i + "] --- END IF");
		}//end if
	}// end for
	//결과...
	fn_result();
}

//7. 변경후 정보로 유효검사 후 [변경전정보_해지 ->  변경후정보_신규]
function fn_aftChngRgsn(i)
{
	trace("[" + i + "] --- 유효검사 끝");
	var accnt_no = ds_list.getColumn(i, "accnt_no");
	var mem_no = ds_list.getColumn(i, "unq_no");
	var mem_nm = ds_list.getColumn(i, "name");
	var idn_no = ds_list.getColumn(i, "idn_no");
	
	var bfr_pmt_gb = ds_list.getColumn(i, "bfr_pmt_gb");
	var bfr_pmt_day = ds_list.getColumn(i, "bfr_pmt_day");
	var bfr_bank_cd = ds_list.getColumn(i, "bfr_bank_cd");
	var bfr_acnt_no = ds_list.getColumn(i, "bfr_acnt_no");
	var bfr_card_cd = ds_list.getColumn(i, "bfr_card_cd");
	var bfr_card_no = ds_list.getColumn(i, "bfr_card_no");
	var bfr_card_expr_yr = ds_list.getColumn(i, "bfr_card_expr_yr");
	var bfr_card_expr_mm = ds_list.getColumn(i, "bfr_card_expr_mm");
	
	//변경전 정보로 해지.. 
	if ("04" == bfr_pmt_gb) {         //CMS 해지
		//CMS 산출여부 확인
		trace("[" + i + "] --- CMS해지");
		fn_commSearch(gfn_getCommTypeInit(), "srchCmsWdrwChk", i);
	} else if ("06" == bfr_pmt_gb) {  //카드 해지
		//카드 산출여부 확인
		trace("[" + i + "] --- 카드해지");
		fn_commSearch(gfn_getCommTypeInit(),"srchCardWdrwChk", i);
	} else {
		//변경전결제구분이 CMS/카드가 아닐경우 바로 변경후정보로 신규신청
		trace("[" + i + "] --- 바로신청");
		fn_addService(i)
	}
}

//변경후 정보로 신규등록
function fn_addService(i)
{
	var accnt_no = ds_list.getColumn(i, "accnt_no");
	var mem_no = ds_list.getColumn(i, "unq_no");
	var mem_nm = ds_list.getColumn(i, "name");
	var idn_no = ds_list.getColumn(i, "idn_no");
	
	var aft_pmt_gb = ds_list.getColumn(i, "aft_pmt_gb");
	var aft_pmt_day = ds_list.getColumn(i, "aft_pmt_day");
	var aft_bank_cd = ds_list.getColumn(i, "aft_bank_cd");
	var aft_acnt_no = ds_list.getColumn(i, "aft_acnt_no");
	var aft_card_cd = ds_list.getColumn(i, "aft_card_cd");
	var aft_card_no = ds_list.getColumn(i, "aft_card_no");
	var aft_card_expr_yr = ds_list.getColumn(i, "aft_card_expr_yr");
	var aft_card_expr_mm = ds_list.getColumn(i, "aft_card_expr_mm");
	
	if ("06" != aft_pmt_gb) { //CMS
		fn_commSave("saveCmsRgsnAnxtSrvc", "new", i);
	} else { //카드
		fn_commSave("saveCardRgsnAnxtSrvc", "new", i);
	}
}



function fn_result() 
{
	alert("성공 : " + success_cnt + "건, 실패 : " + fail_cnt + "건 완료되었습니다.");
	fn_commSearch(gfn_getCommTypeInit(), "srchOnlnAcntChngList");
}

/********************************************************************************************/
/**   7-1. CMS 웹모듈 관련 이벤트(Event) Function                                                          	*/
/********************************************************************************************/
//웹모듈 결과 요청
function fn_rltmWebModuleRequest(gbn,i)
{
	//결과조회에 사용할 변수 초기화
    var tmpr_resl = ""; //임시결과  
    var aplc_div = "";  //신규, 해지 구분
    
    var idn_no = "";        //개인식별번호
    var accnt_no = "";      //회원번호(구좌)
    var bank_cd = "";       //은행코드
    var bank_accnt_no = ""; //계좌번호
    
    idn_no = ds_list.getColumn(i, "idn_no");
    accnt_no = ds_list.getColumn(i, "accnt_no");

    if (gbn == "new") {
		aplc_div = "3"; //신규, 변경후 값
		bank_cd = ds_list.getColumn(i, "aft_bank_cd");
		bank_accnt_no = ds_list.getColumn(i, "aft_acnt_no");
    } else if (gbn == "can") {
		aplc_div = "4"; //해지, 변경전 값
		bank_cd = ds_list.getColumn(i, "bfr_bank_cd");
		bank_accnt_no = ds_list.getColumn(i, "bfr_acnt_no");
    } else {
		aplc_div = "2"; //유효검사, 변경후 값
		bank_cd = ds_list.getColumn(i, "aft_bank_cd");
		bank_accnt_no = ds_list.getColumn(i, "aft_acnt_no");
    }
    
    //임시값(유효검사)
    //aplc_div = "2";
    
    //웹모듈 부가서비스요청
	tmpr_resl = gfn_AdditionalServiceReq(aplc_div,bank_cd,bank_accnt_no,accnt_no,idn_no);
	trace(tmpr_resl);
	
	//결과조회에 사용할 변수 저장
	tmp_aplc_div = aplc_div;
	tmp_tmpr_resl = tmpr_resl;
	
    //결과 조회
    var resl_bool = fn_rltmWebModuleResult();
    
    return resl_bool;
}

//웹모듈 결과 조회
function fn_rltmWebModuleResult()
{
    if(gfn_isNull(tmp_aplc_div) && gfn_isNull(tmp_tmpr_resl)){
		alert("결과 저장이 완료되지 않았습니다. 재호출 해주세요.");
		return false;
    }

    var FlReslCd = gfn_AdditionalServiceRes(tmp_aplc_div,tmp_tmpr_resl);
    var RlReslCd = FlReslCd.substring(0,4);
    trace(RlReslCd);
    
    if(RlReslCd == "0000") {    
        return true;
    }
     /*else {
		ds_resl_cd.filter("(cd=='"+ RlReslCd +"')");
		alert(ds_resl_cd.getColumn(0,"cd_nm"));
		ds_resl_cd.filter("");
		return false;

    }
    */
}

/********************************************************************************************/
/**   8. 팝업 관련 이벤트(Event) Function                                                          	*/
/********************************************************************************************/
// 회원 조회 버튼 클릭
function btn_accnt_onclick (obj, typ) {
	var srch_typ = "";
	var option = "";
	var gubun_mode = "";
	var srch_vl = "";
	if (obj != null) {
		if ("btn_mem_nm" == obj.name || "edt_mem_nm" == obj.name) { // 회원명
			srch_typ = "mem_nm";
		} else if ("btn_accnt_no" == obj.name || "edt_accnt_no" == obj.name){ // 회원번호
			srch_typ = "accnt_no";
		} 
	}
	
	if (typ == "Y") {
		srch_typ = ds_accntInqCndt.getColumn(0,"srch_typ");
		srch_vl = ds_accntInqCndt.getColumn(0,"srch_vl");
	}

	var sPrmr = {p_srch_typ:srch_typ, p_srch_vl:srch_vl, p_gubun_mode:gubun_mode, p_option:option};
	gfn_diaLog("회원 조회", -1, -1, 884, 601, "PS990000::PS992400.xfdl", false, sPrmr, true, false, true, null, null, true);
}
function fn_setAccntNo(){
	if(ds_accnt_info.getColumn(0, "accnt_no") != ""){	
		var accnt_no = ds_accnt_info.getColumn(0, "accnt_no");
		edt_accnt_no.value = accnt_no;
	}
}

function edt_accnt_onkeydown(obj:Edit, e:KeyEventInfo)
{
	if (e.keycode == "13") {
		if (obj.value == "") {
			btn_accnt_onclick(obj);
		} else {
			var srch_typ = "";
			if (obj.name == "edt_accnt_no") {
				srch_typ = "accnt_no";
			} else if (obj.name == "edt_mem_nm"){
				srch_typ = "mem_nm"
			}
			fn_commSearch(gfn_getCommTypeInit(), "selectCustaccntList", srch_typ); // 조회
		}
	}
}

// 권한에 따른 버튼 설정
function fn_setAthrPgmBtn()
{
	gfn_athrPgm(gfn_gdsCd_admin());
	
	if (inqYn == "N") {
		btn_Search.visible = false;
	}
	
	for (var i=0; i<ds_indvFnctAthrPgmFilter.rowcount; i++) {
		if (ds_indvFnctAthrPgmFilter.getColumn(i, "cnpn_id") == "bndeTrnt") {
			if (ds_indvFnctAthrPgmFilter.getColumn(i, "amnt_yn") == "1") {
				btn_onln_pymn_acnt_chng.visible = true;
			}
		}
	}
}]]></Script>
  </Form>
</FDL>
