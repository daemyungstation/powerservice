<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="PS220401_02" classname="팝업가이드" inheritanceid="" position="absolute 0 0 746 304" titletext="단일건 추가" onload="PS220401_02_onload">
    <Layouts>
      <Layout>
        <Static id="stc_31" class="sta_popupBg1" enable="false" position="absolute 0 0 746 304"/>
        <Button id="btn_close" taborder="4" onclick="btn_onclick" class="btn_popupClose" position="absolute 719 8 739 27"/>
        <Static id="stc_30" text="단일건 추가" class="sta_popupTitle" transparenthittest="true" position="absolute 10 8 234 28"/>
        <Static id="stc_34" class="sta_workData" position2="absolute l:16.22% r:1.47% t:89 h:26" positiontype="position2"/>
        <Static id="stc_32" class="sta_workData" position2="absolute l:16.22% r:1.47% t:64 h:26" positiontype="position2"/>
        <Static id="stc_41" class="sta_workData" position2="absolute l:16.22% r:1.47% t:114 h:26" positiontype="position2"/>
        <Static id="stc_02" class="sta_workData" position2="absolute l:16.35% r:1.47% t:139 h:26" positiontype="position2"/>
        <Static id="stc_06" class="sta_workData" position2="absolute l:16.35% r:1.47% t:164 h:26" positiontype="position2"/>
        <Static id="stc_08" class="sta_workData" position2="absolute l:16.22% r:1.47% t:189 h:26" positiontype="position2"/>
        <Static id="stc_18" class="sta_workData" position2="absolute l:16.35% r:1.47% t:239 h:26" positiontype="position2"/>
        <Static id="stc_19" class="sta_workData" position2="absolute l:16.35% r:1.47% t:264 h:26" positiontype="position2"/>
        <Static id="stc_23" class="sta_workData" position2="absolute l:16.35% r:1.47% t:214 h:26" positiontype="position2"/>
        <Static id="stc_43" text="단일건 추가" class="sta_workTitle2" position2="absolute l:11 w:281 t:45 h:20" positiontype="position2" titletext="단일건추가"/>
        <Static id="stc_16" text="고객번호" class="sta_workLabel1_P" position2="absolute l:53.35% w:16.89% t:89 h:26" positiontype="position2" style="font:Dotum,8;" validate=""/>
        <Static id="stc_07" text="서브목록명" class="sta_workLabel1" position2="absolute l:10 w:16.89% t:64 h:26" positiontype="position2" style="font:Dotum,8;" validate=""/>
        <Static id="stc_09" text="회원번호" class="sta_workLabel1" position2="absolute l:10 w:16.89% t:114 h:26" positiontype="position2" style="font:Dotum,8;" validate=""/>
        <Static id="stc_36" text="고객명" class="sta_workLabel1_P" position2="absolute l:10 w:16.89% t:89 h:26" positiontype="position2" style="font:Dotum,8;" validate=""/>
        <Static id="sta_GrayLine01" class="sta_WF_Line1" position2="absolute l:11 r:11 t:64 h:1" positiontype="position2"/>
        <Static id="stc_00" text="휴대전화" class="sta_workLabel1" position2="absolute l:53.35% w:16.89% t:114 h:26" positiontype="position2" style="font:Dotum,8;" validate=""/>
        <Static id="stc_01" text="일반전화" class="sta_workLabel1" position2="absolute l:10 w:16.89% t:139 h:26" positiontype="position2" style="font:Dotum,8;" validate=""/>
        <Static id="stc_03" text="회사전화" class="sta_workLabel1" position2="absolute l:53.35% w:16.89% t:139 h:26" positiontype="position2" style="font:Dotum,8;" validate=""/>
        <Static id="stc_04" text="사용자정의3" class="sta_workLabel1" position2="absolute l:10 w:16.89% t:189 h:26" positiontype="position2" style="font:Dotum,8;" validate=""/>
        <Static id="stc_05" text="사용자정의1" class="sta_workLabel1" position2="absolute l:10 w:16.89% t:164 h:26" positiontype="position2" style="font:Dotum,8;" validate=""/>
        <Static id="stc_10" text="사용자정의4" class="sta_workLabel1" position2="absolute l:53.35% w:16.89% t:189 h:26" positiontype="position2" style="font:Dotum,8;" validate=""/>
        <Static id="stc_11" text="사용자정의2" class="sta_workLabel1" position2="absolute l:53.35% w:16.89% t:164 h:26" positiontype="position2" style="font:Dotum,8;" validate=""/>
        <Static id="stc_15" text="사용자정의9" class="sta_workLabel1" position2="absolute l:10 w:16.89% t:264 h:26" positiontype="position2" style="font:Dotum,8;" validate=""/>
        <Static id="stc_17" text="사용자정의7" class="sta_workLabel1" position2="absolute l:10 w:16.89% t:239 h:26" positiontype="position2" style="font:Dotum,8;" validate=""/>
        <Static id="stc_20" text="사용자정의10" class="sta_workLabel1" position2="absolute l:53.35% w:16.89% t:264 h:26" positiontype="position2" style="font:Dotum,8;" validate=""/>
        <Static id="stc_21" text="사용자정의8" class="sta_workLabel1" position2="absolute l:53.35% w:16.89% t:239 h:26" positiontype="position2" style="font:Dotum,8;" validate=""/>
        <Static id="stc_22" text="사용자정의6" class="sta_workLabel1" position2="absolute l:53.35% w:16.89% t:214 h:26" positiontype="position2" style="font:Dotum,8;" validate=""/>
        <Static id="stc_24" text="사용자정의5" class="sta_workLabel1" position2="absolute l:10 w:16.89% t:214 h:26" positiontype="position2" style="font:Dotum,8;" validate=""/>
        <Edit id="edt_sub_trgt_nm" taborder="5" inputtype="number,symbol" lengthunit="utf8" maxlength="13" onkillfocus="phone_onkillfocus" ontextchanged="phone_ontextchanged" position2="absolute l:18.36% r:1.74% t:67 h:20" positiontype="position2" readonly="true"/>
        <Edit id="edt_cust_nm" taborder="0" lengthunit="utf8" maxlength="13" position2="absolute l:18.36% r:46.92% t:92 h:20" positiontype="position2" inputfilter="space"/>
        <Edit id="edt_accnt_no" taborder="2" lengthunit="utf8" position2="absolute l:18.36% r:46.92% t:117 h:20" positiontype="position2"/>
        <Edit id="edt_home_tlno" taborder="6" lengthunit="utf8" onkillfocus="phone_onkillfocus" ontextchanged="phone_ontextchanged" position2="absolute l:18.36% r:46.92% t:142 h:20" positiontype="position2" inputtype="number,symbol" maxlength="13"/>
        <Edit id="edt_user_defn1_cntn" taborder="7" lengthunit="utf8" position2="absolute l:18.36% r:46.92% t:167 h:20" positiontype="position2"/>
        <Edit id="edt_user_defn3_cntn" taborder="8" lengthunit="utf8" maxlength="13" position2="absolute l:18.36% r:46.92% t:192 h:20" positiontype="position2"/>
        <Edit id="edt_user_defn5_cntn" taborder="9" lengthunit="utf8" position2="absolute l:18.36% r:46.92% t:217 h:20" positiontype="position2"/>
        <Edit id="edt_user_defn7_cntn" taborder="10" lengthunit="utf8" position2="absolute l:18.36% r:46.92% t:242 h:20" positiontype="position2"/>
        <Edit id="edt_user_defn9_cntn" taborder="11" lengthunit="utf8" position2="absolute l:18.36% r:46.92% t:267 h:20" positiontype="position2"/>
        <Edit id="edt_user_defn10_cntn" taborder="12" lengthunit="utf8" position2="absolute l:70.38% r:1.74% t:267 h:20" positiontype="position2"/>
        <Edit id="edt_user_defn8_cntn" taborder="13" lengthunit="utf8" position2="absolute l:70.38% r:1.74% t:242 h:20" positiontype="position2"/>
        <Edit id="edt_user_defn6_cntn" taborder="14" lengthunit="utf8" position2="absolute l:70.38% r:1.74% t:217 h:20" positiontype="position2"/>
        <Edit id="edt_user_defn4_cntn" taborder="15" lengthunit="utf8" position2="absolute l:70.38% r:1.74% t:192 h:20" positiontype="position2"/>
        <Edit id="edt_user_defn2_cntn" taborder="16" lengthunit="utf8" position2="absolute l:70.38% r:1.74% t:167 h:20" positiontype="position2"/>
        <Edit id="edt_comp_tlno" taborder="17" lengthunit="utf8" onkillfocus="phone_onkillfocus" ontextchanged="phone_ontextchanged" position2="absolute l:70.38% r:1.74% t:142 h:20" positiontype="position2" inputtype="number,symbol" maxlength="13"/>
        <Edit id="edt_clph_tlno" taborder="3" lengthunit="utf8" onkillfocus="phone_onkillfocus" ontextchanged="phone_ontextchanged" position2="absolute l:70.38% r:1.74% t:117 h:20" positiontype="position2" inputtype="number,symbol" maxlength="13"/>
        <Edit id="edt_mem_no" taborder="1" lengthunit="utf8" maxlength="20" position2="absolute l:70.38% r:1.74% t:92 h:20" positiontype="position2"/>
        <Button id="btn_save" taborder="18" onclick="btn_onclick" class="btn_WF_Save" position2="absolute r:12 w:72 t:42 h:20" positiontype="position2" tooltiptext="신규" style="padding:0 0 0 0;"/>
      </Layout>
    </Layouts>
    <Bind>
      <BindItem id="item7" compid="edt_sub_trgt_nm" propid="value" datasetid="ds_member" columnid="wrpl_tel"/>
      <BindItem id="item0" compid="edt_cust_nm" propid="value" datasetid="ds_trgtCustDtPt" columnid="cust_nm"/>
      <BindItem id="item1" compid="edt_accnt_no" propid="value" datasetid="ds_trgtCustDtPt" columnid="accnt_no"/>
      <BindItem id="item2" compid="edt_home_tlno" propid="value" datasetid="ds_trgtCustDtPt" columnid="home_tlno"/>
      <BindItem id="item3" compid="edt_user_defn1_cntn" propid="value" datasetid="ds_trgtCustDtPt" columnid="user_defn1_cntn"/>
      <BindItem id="item4" compid="edt_user_defn3_cntn" propid="value" datasetid="ds_trgtCustDtPt" columnid="user_defn3_cntn"/>
      <BindItem id="item5" compid="edt_user_defn5_cntn" propid="value" datasetid="ds_trgtCustDtPt" columnid="user_defn5_cntn"/>
      <BindItem id="item6" compid="edt_user_defn7_cntn" propid="value" datasetid="ds_trgtCustDtPt" columnid="user_defn7_cntn"/>
      <BindItem id="item8" compid="edt_user_defn9_cntn" propid="value" datasetid="ds_trgtCustDtPt" columnid="user_defn9_cntn"/>
      <BindItem id="item9" compid="edt_user_defn10_cntn" propid="value" datasetid="ds_trgtCustDtPt" columnid="user_defn10_cntn"/>
      <BindItem id="item10" compid="edt_user_defn8_cntn" propid="value" datasetid="ds_trgtCustDtPt" columnid="user_defn8_cntn"/>
      <BindItem id="item11" compid="edt_user_defn6_cntn" propid="value" datasetid="ds_trgtCustDtPt" columnid="user_defn6_cntn"/>
      <BindItem id="item12" compid="edt_user_defn4_cntn" propid="value" datasetid="ds_trgtCustDtPt" columnid="user_defn4_cntn"/>
      <BindItem id="item13" compid="edt_user_defn2_cntn" propid="value" datasetid="ds_trgtCustDtPt" columnid="user_defn2_cntn"/>
      <BindItem id="item14" compid="edt_comp_tlno" propid="value" datasetid="ds_trgtCustDtPt" columnid="comp_tlno"/>
      <BindItem id="item15" compid="edt_clph_tlno" propid="value" datasetid="ds_trgtCustDtPt" columnid="clph_tlno"/>
      <BindItem id="item16" compid="edt_mem_no" propid="value" datasetid="ds_trgtCustDtPt" columnid="mem_no"/>
    </Bind>
    <Objects>
      <Dataset id="ds_trans_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="strSvcID" type="STRING" size="256"/>
          <Column id="strURL" type="STRING" size="256"/>
          <Column id="strInDatasets" type="STRING" size="256"/>
          <Column id="strOutDatasets" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_trgtCustDtPt" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="_chk" type="INT" size="1"/>
          <Column id="xRowStatusType" type="STRING" size="1"/>
          <Column id="cntr_cd" type="STRING" size="256"/>
          <Column id="trgt_list_id" type="STRING" size="256"/>
          <Column id="sub_trgt_list_id" type="STRING" size="256"/>
          <Column id="trgt_cust_dtpt_id" type="STRING" size="256"/>
          <Column id="cust_nm" type="STRING" size="256"/>
          <Column id="mem_no" type="STRING" size="256"/>
          <Column id="accnt_no" type="STRING" size="256"/>
          <Column id="clph_tlno" type="STRING" size="256"/>
          <Column id="home_tlno" type="STRING" size="256"/>
          <Column id="comp_tlno" type="STRING" size="256"/>
          <Column id="unty_case_adtl_yn" type="STRING" size="256"/>
          <Column id="user_defn1_cntn" type="STRING" size="256"/>
          <Column id="user_defn2_cntn" type="STRING" size="256"/>
          <Column id="user_defn3_cntn" type="STRING" size="256"/>
          <Column id="user_defn4_cntn" type="STRING" size="256"/>
          <Column id="user_defn5_cntn" type="STRING" size="256"/>
          <Column id="user_defn6_cntn" type="STRING" size="256"/>
          <Column id="user_defn7_cntn" type="STRING" size="256"/>
          <Column id="user_defn8_cntn" type="STRING" size="256"/>
          <Column id="user_defn9_cntn" type="STRING" size="256"/>
          <Column id="user_defn10_cntn" type="STRING" size="256"/>
          <Column id="rgsr_id" type="STRING" size="256"/>
          <Column id="rgsn_dttm" type="STRING" size="256"/>
          <Column id="amnd_id" type="STRING" size="256"/>
          <Column id="amnt_dttm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Script type="xscript4.0"><![CDATA[/***************************************************************************
 * Program ID    : PS220401_02.xfdl
 * Program Name  : 단일건 추가
 * Author        : 정 훈
 * Created On    : 2016.03.07
 * 개    요 	 : 
 *
 * =========================================================================
 * 변경일자     수정자       내    용
 * =========================================================================
 * 2016.03.07    정   훈      최초작성
 
 **************************************************************************/


/********************************************************************************************/
/* 1. Include Library include                                                               */
/********************************************************************************************/
include "LIB::lib_All.xjs";




/********************************************************************************************/
/* 2. Form 관련(onload 및 Form 이벤트,전역변수,초기화) 처리                         	*/
/********************************************************************************************/
var total_cust_data_extc_cnt = 0;
function PS220401_02_onload(obj:Form, e:LoadEventInfo)
{
	edt_sub_trgt_nm.value = sub_trgt_list_nm;
	ds_trgtCustDtPt.clearData();
	ds_trgtCustDtPt.addRow();
}




/********************************************************************************************/
/* 3. Callback(gfn_Transaction 호출 후 처리내용)                                   		*/
/********************************************************************************************/
function fn_callBack(svcid, errcd, errmsg) {
	if(errcd != 0){
		trace("에러발생 svcid : "+svcid+"   errmsg :"+errmsg+ "   errcd :"+errcd);
	}else{
		switch(svcid){
			case "saveOneTrgtList": //저장
				opener.ds_list_trgtList.setColumn(opener.ds_list_trgtList.rowposition, 'cust_data_extc_cnt', total_cust_data_extc_cnt);
				opener.edt_cust_data_extc_cnt.value = gfn_commaStr(opener.ds_list_trgtList.getColumn(opener.ds_list_trgtList.rowposition, 'cust_data_extc_cnt'))+" 건"; //목록건수
				opener.ds_list_subTrgtList.setColumn(opener.ds_list_subTrgtList.rowposition,'cust_data_extc_cnt',
													parseInt(opener.ds_list_subTrgtList.getColumn(opener.ds_list_subTrgtList.rowposition,'cust_data_extc_cnt')) + 1);
				opener.fn_copyRow_sub();
				opener.fn_changeComponent_sub("R");
				
				close();
			break;
		}
	}
}

/********************************************************************************************/
/**   4. Validation 처리                                                                   	*/
/********************************************************************************************/
//대상고객목록 저장전 처리
function fn_preSaveData(){
	if(gfn_isNull(edt_cust_nm.value)){ //고객명
		alert("고객명을 입력하세요.");
		return false;
	}
	
	if(gfn_isNull(edt_mem_no.value)){ //회원번호
		alert("회원번호를 선택하세요.");
		return false;
	}
	
	if(gfn_isNull(edt_clph_tlno.value)&&gfn_isNull(edt_home_tlno.value)&&gfn_isNull(edt_comp_tlno.value)){ //전화번호
		alert("전화번호를 입력하세요");
		return false;
	}
	
	ds_trgtCustDtPt.setColumn(ds_trgtCustDtPt.rowposition, 'trgt_list_id' , trgt_list_id);
	ds_trgtCustDtPt.setColumn(ds_trgtCustDtPt.rowposition, 'sub_trgt_list_id' , sub_trgt_list_id);
	
	return true;
}

/********************************************************************************************/
/**   5. 서비스 호출(gfn_Transaction)                                                   	*/
/********************************************************************************************/

//추출
function fn_saveData(){
	if(!fn_preSaveData()) return false;
	
	if(confirm("해당 내용을 저장 하시겠습니까?")){
		var szSvcid       = "saveOneTrgtList";
		var szController  = "/cmpg/sub-trgt-list/one/save";
		var szInDs        = "ds_input=ds_trgtCustDtPt";
		var szOutDs       = "";
		var szParam       = "";
		var szRetCallback = "fn_callBack";

		// 트랜젝션 공통함수 호출
		gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback,true);
    }
}


/********************************************************************************************/
/**   6. 사용자 함수                                                                   	*/
/********************************************************************************************/


/********************************************************************************************/
/**   7. 이벤트(Event) Function                                                          	*/
/********************************************************************************************/
//버튼 클릭이벤트
function btn_onclick(obj:Button,  e:ClickEventInfo)
{
	switch(obj){
		case btn_close : //타이틀바 닫기버튼
			close();
		break;
		
		case btn_save ://저장버튼
			fn_saveData();	
		break;
		
		default : 
			trace("btn을 확인하세요");
		break;
	}
}

// 전화번호 설정
function phone_ontextchanged(obj:Edit,  e:TextChangedEventInfo)
{
	obj.value = gfn_phoneNumStr(obj.value);
	obj.setCaretPos(-1);
}

function phone_onkillfocus(obj:Edit, e:KillFocusEventInfo)
{
	obj.value = gfn_phoneNumStr(obj.value);
}



]]></Script>
  </Form>
</FDL>
