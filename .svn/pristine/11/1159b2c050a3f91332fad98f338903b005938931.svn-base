<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="srch_prod_pop" classname="srch_prod_pop" inheritanceid="" position="absolute 0 0 347 308" titletext="마케팅항목" onload="prod_onload" scrollbars="none" onactivate="PS992200_onactivate">
    <Layouts>
      <Layout>
        <Static id="stc_31" class="sta_popupBg1" enable="false" position="absolute 0 -1 346 306" onclick="stc_31_onclick"/>
        <Button id="btn_Close" taborder="4" onclick="btn_close_onclick" class="btn_popupClose" position="absolute 316 5 336 24"/>
        <Static id="stc_30" text="마케팅항목" class="sta_popupTitle" transparenthittest="true" position="absolute 10 8 112 28"/>
        <Button id="btn_exit" taborder="14" text="닫기" onclick="btn_close_onclick" class="btn_WF_Common" position2="absolute l:128 w:74 t:278 h:20" positiontype="position2" style="padding:0 0 0 0;"/>
        <Static id="stc_13" class="sta_workData" anchor="default" position="absolute 99 42 336 68" positiontype="position"/>
        <Static id="stc_118" text="마케팅동의" class="sta_workLabel1" position="absolute 10 42 100 68" style="padding:6 1 0 15;font:Dotum,8;" validate=""/>
        <Static id="stc_121" class="sta_workData" anchor="default" position="absolute 99 67 336 93" positiontype="position"/>
        <Static id="stc_18" text="DM동의" class="sta_workLabel1" position="absolute 10 67 100 93" style="font:Dotum,8;" validate=""/>
        <Static id="stc_00" text="자녀수" class="sta_workLabel1" position="absolute 697 193 787 219" style="font:Dotum,8;" validate="" visible="false"/>
        <CheckBox id="dm_yn" taborder="27" text="우편" value="Y" truevalue="Y" falsevalue="N" visible="false" position="absolute 706 104 757 124" style="border:0 none #808080ff ;" onchanged="info_onchanged"/>
        <CheckBox id="email_yn" taborder="28" text="이메일" value="Y" truevalue="Y" falsevalue="N" visible="false" position="absolute 640 104 698 124" style="border:0 none #808080ff ;" onchanged="info_onchanged"/>
        <CheckBox id="sms_yn" taborder="29" text="문자" value="Y" truevalue="Y" falsevalue="N" visible="false" position="absolute 581 104 623 124" style="border:0 none #808080ff ;" onchanged="info_onchanged"/>
        <CheckBox id="tel_yn" taborder="30" text="전화" value="Y" truevalue="Y" falsevalue="N" visible="false" position="absolute 525 104 567 124" style="border:0 none #808080ff ;" onchanged="info_onchanged"/>
        <Combo id="cbo_marry_yn" taborder="31" displaynulltext="선택" codecolumn="codecolumn" datacolumn="datacolumn" anchor="default" position="absolute 581 196 661 216" positiontype="position" onitemchanged="cbo_marry_yn_onitemchanged" visible="false">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn"/>
                <Col id="datacolumn">선택</Col>
              </Row>
              <Row>
                <Col id="codecolumn">Y</Col>
                <Col id="datacolumn">예</Col>
              </Row>
              <Row>
                <Col id="codecolumn">N</Col>
                <Col id="datacolumn">아니오</Col>
              </Row>
            </Rows>
          </Dataset>
        </Combo>
        <Combo id="cbo_child_cnt" taborder="32" displaynulltext="선택" codecolumn="codecolumn" datacolumn="datacolumn" anchor="default" position="absolute 794 196 874 216" positiontype="position" enable="false" onitemchanged="cbo_child_cnt_onitemchanged" visible="false">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn"/>
                <Col id="datacolumn">선택</Col>
              </Row>
              <Row>
                <Col id="codecolumn">0</Col>
                <Col id="datacolumn">없음</Col>
              </Row>
              <Row>
                <Col id="codecolumn">1</Col>
                <Col id="datacolumn">1명</Col>
              </Row>
              <Row>
                <Col id="codecolumn">2</Col>
                <Col id="datacolumn">2명</Col>
              </Row>
              <Row>
                <Col id="codecolumn">3</Col>
                <Col id="datacolumn">3명</Col>
              </Row>
              <Row>
                <Col id="codecolumn">4</Col>
                <Col id="datacolumn">4명</Col>
              </Row>
            </Rows>
          </Dataset>
        </Combo>
        <Static id="stc_01" text="EM동의" class="sta_workLabel1" position="absolute 10 92 100 118" style="font:Dotum,8;" validate=""/>
        <Static id="stc_02" class="sta_workData" position="absolute 99 92 336 118"/>
        <Combo id="cbo_mkt_yn" taborder="33" displaynulltext="선택" codecolumn="codecolumn" datacolumn="datacolumn" visible="true" position="absolute 105 45 185 65" onitemchanged="cbo_mkt_yn_onitemchanged">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn"/>
                <Col id="datacolumn">선택</Col>
              </Row>
              <Row>
                <Col id="codecolumn">Y</Col>
                <Col id="datacolumn">예</Col>
              </Row>
              <Row>
                <Col id="codecolumn">N</Col>
                <Col id="datacolumn">아니오</Col>
              </Row>
            </Rows>
          </Dataset>
        </Combo>
        <Combo id="cbo_dm_yn" taborder="34" displaynulltext="선택" codecolumn="codecolumn" datacolumn="datacolumn" visible="true" position="absolute 105 70 185 90" onitemchanged="cbo_dm_yn_onitemchanged">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn"/>
                <Col id="datacolumn">선택</Col>
              </Row>
              <Row>
                <Col id="codecolumn">Y</Col>
                <Col id="datacolumn">예</Col>
              </Row>
              <Row>
                <Col id="codecolumn">N</Col>
                <Col id="datacolumn">아니오</Col>
              </Row>
            </Rows>
          </Dataset>
        </Combo>
        <Combo id="cbo_em_yn" taborder="35" displaynulltext="선택" codecolumn="codecolumn" datacolumn="datacolumn" visible="true" position="absolute 104 95 184 115" onitemchanged="cbo_em_yn_onitemchanged">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn"/>
                <Col id="datacolumn">선택</Col>
              </Row>
              <Row>
                <Col id="codecolumn">Y</Col>
                <Col id="datacolumn">예</Col>
              </Row>
              <Row>
                <Col id="codecolumn">N</Col>
                <Col id="datacolumn">아니오</Col>
              </Row>
            </Rows>
          </Dataset>
        </Combo>
        <Static id="stc_25" onclick="stc_25_onclick" position="absolute 193 46 343 66"/>
        <Static id="stc_03" onclick="stc_25_onclick" position="absolute 193 71 343 91"/>
        <Static id="stc_04" onclick="stc_25_onclick" position="absolute 193 96 343 116"/>
        <Button id="btn_save" taborder="36" tabstop="false" onclick="btn_save_onclick" class="btn_WF_Save" position2="absolute r:-202 w:71 t:196 h:20" positiontype="position2" tooltiptext="저장" style="padding:0 0 0 0;" visible="false"/>
        <Grid id="grd_srchUser" class="grd_list" taborder="37" binddataset="ds_mkt_hstr" useinputpanel="false" autofittype="col" onvscrolllastover="grd_onvscrolllastover" oncellclick="grd_srchUser_oncellclick" onheadclick="grd_onheadclick" oncelldblclick="grd_srchUser_oncelldblclick" position="absolute 10 144 336 271">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="30"/>
                <Column size="60"/>
                <Column size="60"/>
                <Column size="80"/>
                <Column size="90"/>
              </Columns>
              <Rows>
                <Row size="25" band="head"/>
                <Row size="25"/>
              </Rows>
              <Band id="head">
                <Cell text="NO"/>
                <Cell col="1" text="정보구분" id="team_nm"/>
                <Cell col="2" text="동의여부" id="user_nm"/>
                <Cell col="3" text="등록자"/>
                <Cell col="4" text="동의일자" id="duty_nm"/>
              </Band>
              <Band id="body">
                <Cell expr="currow+1"/>
                <Cell col="1" style="align:left;" text="bind:markt_info_gbn"/>
                <Cell col="2" displaytype="combo" text="bind:del_fg" combodataset="ds_agree" combocodecol="cd" combodatacol="nm"/>
                <Cell col="3" text="bind:reg_man"/>
                <Cell col="4" text="bind:reg_dm"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="stc_05" text="마케팅 정보 이력" onclick="stc_25_onclick" class="sta_workTitle2" position="absolute 8 125 158 145"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_mem_mktlist" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="mem_no" type="STRING" size="256"/>
          <Column id="markt_yn" type="STRING" size="256"/>
          <Column id="em_yn" type="STRING" size="256"/>
          <Column id="dm_yn" type="STRING" size="256"/>
          <Column id="markt_dt" type="DATE" size="256"/>
          <Column id="em_dt" type="DATE" size="256"/>
          <Column id="dm_dt" type="DATE" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_trans_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="strSvcID" type="STRING" size="256"/>
          <Column id="strURL" type="STRING" size="256"/>
          <Column id="strInDatasets" type="STRING" size="256"/>
          <Column id="strOutDatasets" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_old_mktlist" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="mem_no" type="STRING" size="256"/>
          <Column id="markt_yn" type="STRING" size="256"/>
          <Column id="em_yn" type="STRING" size="256"/>
          <Column id="dm_yn" type="STRING" size="256"/>
          <Column id="markt_dt" type="DATE" size="256"/>
          <Column id="em_dt" type="DATE" size="256"/>
          <Column id="dm_dt" type="DATE" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_mkt_hstr" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="mem_no" type="STRING" size="256"/>
          <Column id="markt_info_gbn" type="STRING" size="256"/>
          <Column id="del_fg" type="STRING" size="256"/>
          <Column id="reg_man" type="STRING" size="256"/>
          <Column id="reg_dm" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_agree" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="256"/>
          <Column id="nm" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="cd">N</Col>
            <Col id="nm">동의</Col>
          </Row>
          <Row>
            <Col id="cd">Y</Col>
            <Col id="nm">비동의</Col>
          </Row>
        </Rows>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item1" compid="dm_yn" propid="value" datasetid="ds_mem_mktlist" columnid="dm_yn"/>
      <BindItem id="item16" compid="email_yn" propid="value" datasetid="ds_mem_mktlist" columnid="email_yn"/>
      <BindItem id="item18" compid="sms_yn" propid="value" datasetid="ds_mem_mktlist" columnid="sms_yn"/>
      <BindItem id="item20" compid="tel_yn" propid="value" datasetid="ds_mem_mktlist" columnid="tel_yn"/>
      <BindItem id="item0" compid="cbo_marry_yn" propid="value" datasetid="ds_mem_mktlist" columnid="marry_yn"/>
      <BindItem id="item2" compid="cbo_child_cnt" propid="value" datasetid="ds_mem_mktlist" columnid="child_cnt"/>
      <BindItem id="item3" compid="cbo_mkt_yn" propid="value" datasetid="ds_mem_mktlist" columnid="markt_yn"/>
      <BindItem id="item4" compid="cbo_dm_yn" propid="value" datasetid="ds_mem_mktlist" columnid="dm_yn"/>
      <BindItem id="item5" compid="cbo_em_yn" propid="value" datasetid="ds_mem_mktlist" columnid="em_yn"/>
      <BindItem id="item6" compid="stc_25" propid="text" datasetid="ds_mem_mktlist" columnid="markt_dt"/>
      <BindItem id="item7" compid="stc_03" propid="text" datasetid="ds_mem_mktlist" columnid="dm_dt"/>
      <BindItem id="item8" compid="stc_04" propid="text" datasetid="ds_mem_mktlist" columnid="em_dt"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[/**************************************************************************
 [ PART 1 ]공통 js 파일 include
***************************************************************************/
include "LIB::lib_All.xjs";

/**************************************************************************
 [ PART 2 ] Form에서 사용될 전역변수를 선언
**************************************************************************/
var tc_prod = 0;
var xMemNo;
var gv_updData ="";

function prod_onload(obj:Form, e:LoadEventInfo)
{		
	fn_init();
}

//초기화
function fn_init(){
	xMemNo = p_MemNo;
	fn_srch_maketingInfo(xMemNo); //마케팅 조회	
}

/********************************************************************************************/
/* 3. Callback(gfn_Transaction 호출 후 처리내용)                                   		*/
/********************************************************************************************/
function fn_callBack(svcid, errcd, errmsg) 
{
	if (errcd != 0) {
		trace(errcd)
		return false;
	} else {
		switch (svcid) {
			
			// MEMBER + 상품조회
			case "insert_maketingInfo":
				fn_srch_maketingInfo(xMemNo);	
			break;			
		}
	}
}

function fn_srch_maketingInfo(xMemNo)
{
	if (xMemNo == undefined || xMemNo == "") return;

	var szSvcid       = "srch_maketingInfo";
	var szController  = "/dlw/newTypeCons/marketinginfo";
    var szInDs        = "";
    var szOutDs       = "ds_mem_mktlist=ds_output ds_mkt_hstr=ds_output2";
    var szParam       = "mem_no=" + xMemNo;
    var szRetCallback = "fn_callBack";
	
    // 트랜젝션 공통함수 호출
    gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback);
}

//마케팅 정보 저장
function fn_update_maketingInfo(name, value)
{
	if (xMemNo == undefined || xMemNo == "") return;
	
	var gubun = "";
	switch(name){
		case "cbo_mkt_yn" :
			gubun = "01";
		break;
		case "cbo_dm_yn" :
			gubun = "02";
		break;
		case "cbo_em_yn" :
			gubun = "03";
		break;
	}

	var szSvcid       = "insert_maketingInfo";
	var szController  = "/dlw/newTypeCons/insertmarketing";
    var szInDs        = "";
    var szOutDs       = "ds_mem_mktlist=ds_output";
    var szParam       = "mem_no=" + xMemNo + " gubun=" + gubun + " gubun_val=" + value;
    var szRetCallback = "fn_callBack";
	
    // 트랜젝션 공통함수 호출
    gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback);
}


/***************************************************************************
 * 함  수  명		: btn_close_onclick()
 * 기      능		: x 버튼 이벤트
 * 수  정  일      : 2016.01.21 
 ***************************************************************************/
function btn_close_onclick(obj:Button,  e:ClickEventInfo)
{
	close();
}

function cbo_mkt_yn_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
{
	fn_update_maketingInfo(obj.name, obj.value); //업데이트 
}

function cbo_dm_yn_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
{
	fn_update_maketingInfo(obj.name, obj.value); //업데이트 
}

function cbo_em_yn_onitemchanged(obj:Combo, e:ItemChangeEventInfo)
{
	fn_update_maketingInfo(obj.name, obj.value); //업데이트 
}
]]></Script>
  </Form>
</FDL>
