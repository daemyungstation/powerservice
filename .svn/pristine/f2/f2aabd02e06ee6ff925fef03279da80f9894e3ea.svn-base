<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="PS996300" classname="PS993700" inheritanceid="" position="absolute 0 0 577 327" titletext="공연혜택등록" onload="PS996300_onload" scrollbars="none">
    <Layouts>
      <Layout>
        <Static id="stc_popup" class="sta_popupBg1" enable="false" position="absolute 0 -2 570 323"/>
        <Button id="btn_close" taborder="0" onclick="btn_close_onclick" class="btn_popupClose" position="absolute 541 8 561 27"/>
        <Static id="stc_30" text="공연혜택등록" class="sta_popupTitle" transparenthittest="true" position="absolute 10 8 248 28"/>
        <Static id="sta_GrayLine" class="sta_WF_Line1" position="absolute 11 65 563 66"/>
        <Static id="stc_01" onclick="div_Work_tab_02_tabpage1_stc_01_onclick" class="sta_workData" position="absolute 104 66 562 92"/>
        <Button id="btn_cancel" taborder="15" text="닫기" onclick="btn_close_onclick" position="absolute 486 42 558 62" tooltiptext="닫기" style="border:0 none #000000ff ;padding:0 0 0 0;"/>
        <Button id="btn_save" taborder="18" text="저장" position="absolute 411 42 485 62" style="border:0 none #000000ff ;padding:0 0 0 0;" onclick="btn_onclick"/>
        <Static id="stc_accnt_no" text="회원코드" class="sta_workLabel1" position="absolute 11 66 105 92" style="font:Dotum,8;" validate=""/>
        <Edit id="edt_accnt_no" taborder="39" inputtype="number" readonly="true" maxlength="16" position="absolute 107 69 273 89"/>
        <Static id="stc_stat" text="공 연 명" class="sta_workLabel1" position="absolute 11 93 129 119" style="font:Dotum,8;" validate=""/>
        <Static id="stc_stat00" text="연 락 처" class="sta_workLabel1" position="absolute 11 120 129 146" style="font:Dotum,8;" validate=""/>
        <Static id="stc_stat01" text="관람좌석" class="sta_workLabel1" position="absolute 11 147 129 173" style="font:Dotum,8;" validate=""/>
        <Static id="stc_stat02" text="예약일시1순위" class="sta_workLabel1" position="absolute 11 174 129 200" style="font:Dotum,8;" validate=""/>
        <Static id="stc_stat03" text="예약일시2순위" class="sta_workLabel1" position="absolute 11 201 129 227" style="font:Dotum,8;" validate=""/>
        <Static id="stc_stat04" text="요청사항" class="sta_workLabel1" position="absolute 11 228 129 254" style="font:Dotum,8;" validate=""/>
        <Static id="stc_stat05" text="예약 현황" class="sta_workLabel1" position="absolute 11 255 129 284" style="font:Dotum,8;" validate=""/>
        <Static id="stc_stat06" text="접수일" class="sta_workLabel1" position="absolute 11 285 129 314" style="font:Dotum,8;" validate=""/>
        <Static id="stc_accnt_no00" text="회원명" class="sta_workLabel1" position="absolute 279 66 373 92" style="font:Dotum,8;" validate=""/>
        <Edit id="accnt_nm" taborder="43" maxlength="30" ontextchanged="fn_ontextchanged" position="absolute 375 69 558 89" style="align:center middle;" readonly="true"/>
        <Static id="stc_00" class="sta_workData" enable="false" position="absolute 104 120 562 146"/>
        <Static id="stc_03" class="sta_workData" enable="false" position="absolute 104 147 562 173"/>
        <Static id="stc_04" class="sta_workData" enable="false" position="absolute 104 174 562 200"/>
        <Static id="stc_05" class="sta_workData" enable="false" position="absolute 104 201 562 227"/>
        <Static id="reqn" class="sta_workData" enable="false" position="absolute 104 228 562 254"/>
        <Static id="stc_07" class="sta_workData" enable="false" position="absolute 104 255 562 284"/>
        <Static id="stc_08" class="sta_workData" enable="false" position="absolute 104 285 562 314"/>
        <Static id="stc_02" class="sta_workData" enable="false" position="absolute 104 93 562 119"/>
        <Static id="stc_accnt_no01" text="관람인원" class="sta_workLabel1" position="absolute 280 120 374 146" style="font:Dotum,8;" validate=""/>
        <Radio id="prcs_cd" taborder="41" columncount="0" rowcount="1" position="absolute 112 257 550 283" codecolumn="codecolumn" datacolumn="datacolumn" index="-1">
          <Dataset id="innerdataset">
            <ColumnInfo>
              <Column id="codecolumn" size="256"/>
              <Column id="datacolumn" size="256"/>
            </ColumnInfo>
            <Rows>
              <Row>
                <Col id="codecolumn">00</Col>
                <Col id="datacolumn">예약취소</Col>
              </Row>
              <Row>
                <Col id="codecolumn">01</Col>
                <Col id="datacolumn">예약접수</Col>
              </Row>
              <Row>
                <Col id="codecolumn">02</Col>
                <Col id="datacolumn">확인중</Col>
              </Row>
              <Row>
                <Col id="codecolumn">03</Col>
                <Col id="datacolumn">예약완료</Col>
              </Row>
              <Row>
                <Col id="codecolumn">04</Col>
                <Col id="datacolumn">예약불가(조기매진)</Col>
              </Row>
            </Rows>
          </Dataset>
        </Radio>
        <Edit id="accnt_no" taborder="40" maxlength="30" ontextchanged="fn_ontextchanged" position="absolute 107 69 275 89" style="align:center middle;" readonly="true"/>
        <Edit id="tel" taborder="44" maxlength="30" ontextchanged="fn_ontextchanged" position="absolute 107 123 275 143" style="align:center middle;" readonly="true"/>
        <Edit id="seat_cnt" taborder="45" maxlength="2" ontextchanged="fn_ontextchanged" position="absolute 377 123 558 143" style="align:center middle;"/>
        <Edit id="showname" taborder="46" maxlength="30" ontextchanged="fn_ontextchanged" position="absolute 107 96 342 116" style="align:center middle;"/>
        <Edit id="authgrpnm07" taborder="50" maxlength="30" ontextchanged="fn_ontextchanged" position="absolute 107 230 559 250" style="align:center middle;"/>
        <Edit id="authgrpnm08" taborder="51" maxlength="30" ontextchanged="fn_ontextchanged" position="absolute 107 290 275 310" style="align:center middle;" enable="false"/>
        <Calendar id="fst_dtm" taborder="52" dateformat="yyyy-MM-dd HH:00:00" oneditclick="cal_join_dt_oneditclick" enable="true" position2="absolute l:18.74% w:167 t:177 h:20" positiontype="position2" value="null" editformat="yyyy-MM-dd HH:00:00"/>
        <Calendar id="secn_dtm" taborder="53" dateformat="yyyy-MM-dd HH:00:00" editformat="yyyy-MM-dd HH:00:00" oneditclick="cal_join_dt_oneditclick" position2="absolute l:18.74% w:167 t:204 h:20" positiontype="position2" value="null"/>
        <CheckBox id="check1" taborder="54" position="absolute 281 178 295 198" onclick="check1_onclick" truevalue="1"/>
        <CheckBox id="check2" taborder="55" position="absolute 281 204 295 224" onclick="check2_onclick" truevalue="1"/>
        <Combo id="Combo00" taborder="56" position="absolute 108 150 258 170" index="-1" innerdataset="@ds_seat_gb" datacolumn="nm" codecolumn="cd"/>
        <Button id="btn_showlist_no" taborder="58" onclick="btn_showlist_no_onclick" class="btn_workSrcPop" position2="absolute l:344 w:20 t:96 h:20" positiontype="position2"/>
        <Edit id="pfmc_seq" taborder="59" maxlength="2" ontextchanged="fn_ontextchanged" position="absolute 369 96 550 116" style="align:center middle;"/>
        <Button id="btn_s" taborder="60" text="예약일시확인" position="absolute 399 176 487 197" onclick="btn_s_onclick"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_trans_info" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="strSvcID" type="STRING" size="256"/>
          <Column id="strURL" type="STRING" size="256"/>
          <Column id="strInDatasets" type="STRING" size="256"/>
          <Column id="strOutDatasets" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_in" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="authgrpcd" type="STRING" size="256"/>
          <Column id="authgrpnm" type="STRING" size="256"/>
          <Column id="useyn" type="STRING" size="256"/>
          <Column id="gubun" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_dept_grp" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false"/>
      <Dataset id="ds_in00" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="authgrpcd" type="STRING" size="256"/>
          <Column id="authgrpnm" type="STRING" size="256"/>
          <Column id="useyn" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_show" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="page_indx" type="STRING" size="6"/>
          <Column id="pfmc_seq" type="STRING" size="100"/>
          <Column id="accnt_no" type="STRING" size="100"/>
          <Column id="seat_cnt" type="STRING" size="100"/>
          <Column id="seat_gb" type="STRING" size="256"/>
          <Column id="fst_rsvtn_dtm" type="STRING" size="256"/>
          <Column id="secn_rsvtn_dtm" type="STRING" size="256"/>
          <Column id="last_rsvtn_dtm" type="STRING" size="256"/>
          <Column id="reqn" type="STRING" size="256"/>
          <Column id="prcs_cd" type="STRING" size="256"/>
          <Column id="reg_id" type="STRING" size="256"/>
          <Column id="reg_ip" type="STRING" size="256"/>
          <Column id="reg_dtm" type="STRING" size="256"/>
          <Column id="mod_id" type="STRING" size="256"/>
          <Column id="mod_ip" type="STRING" size="256"/>
          <Column id="mod_dtm" type="STRING" size="256"/>
          <Column id="gubun" type="STRING" size="256"/>
          <Column id="rsvtn_seq" type="STRING" size="256"/>
          <Column id="mem_nm" type="STRING" size="256"/>
          <Column id="cell" type="STRING" size="256"/>
          <Column id="chk1" type="STRING" size="256"/>
          <Column id="chk2" type="STRING" size="256"/>
          <Column id="pfmc_nm" type="STRING" size="256"/>
          <Column id="rebit" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list_tmp" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="page_indx" type="STRING" size="6"/>
          <Column id="pfmc_seq" type="STRING" size="100"/>
          <Column id="accnt_no" type="STRING" size="100"/>
          <Column id="seat_cnt" type="STRING" size="100"/>
          <Column id="seat_gb" type="STRING" size="256"/>
          <Column id="fst_rsvtn_dtm" type="STRING" size="256"/>
          <Column id="secn_rsvtn_dtm" type="STRING" size="256"/>
          <Column id="last_rsvtn_dtm" type="STRING" size="256"/>
          <Column id="reqn" type="STRING" size="256"/>
          <Column id="prcs_cd" type="STRING" size="256"/>
          <Column id="reg_id" type="STRING" size="256"/>
          <Column id="reg_ip" type="STRING" size="256"/>
          <Column id="reg_dtm" type="STRING" size="256"/>
          <Column id="mod_id" type="STRING" size="256"/>
          <Column id="mod_ip" type="STRING" size="256"/>
          <Column id="mod_dtm" type="STRING" size="256"/>
          <Column id="gubun" type="STRING" size="256"/>
          <Column id="rsvtn_seq" type="STRING" size="256"/>
          <Column id="mem_nm" type="STRING" size="256"/>
          <Column id="cell" type="STRING" size="256"/>
          <Column id="chk1" type="STRING" size="256"/>
          <Column id="chk2" type="STRING" size="256"/>
          <Column id="pfmc_nm" type="STRING" size="256"/>
          <Column id="rebit" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_seat_gb" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="cd" type="STRING" size="256"/>
          <Column id="nm" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="cd">R</Col>
            <Col id="nm">R석</Col>
          </Row>
          <Row>
            <Col id="cd">S</Col>
            <Col id="nm">S석</Col>
          </Row>
          <Row>
            <Col id="cd">A</Col>
            <Col id="nm">A석</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_inqCndt" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="pfmc_seq" type="STRING" size="100"/>
          <Column id="accnt_no" type="STRING" size="100"/>
          <Column id="seat_cnt" type="STRING" size="100"/>
          <Column id="seat_gb" type="STRING" size="256"/>
          <Column id="fst_rsvtn_dtm" type="STRING" size="256"/>
          <Column id="secn_rsvtn_dtm" type="STRING" size="256"/>
          <Column id="last_rsvtn_dtm" type="STRING" size="256"/>
          <Column id="reqn" type="STRING" size="4000"/>
          <Column id="prcs_cd" type="STRING" size="256"/>
          <Column id="reg_id" type="STRING" size="256"/>
          <Column id="reg_ip" type="STRING" size="256"/>
          <Column id="reg_dtm" type="STRING" size="256"/>
          <Column id="mod_id" type="STRING" size="256"/>
          <Column id="mod_ip" type="STRING" size="256"/>
          <Column id="mod_dtm" type="STRING" size="256"/>
          <Column id="gubun" type="STRING" size="256"/>
          <Column id="rsvtn_seq" type="STRING" size="256"/>
          <Column id="mem_nm" type="STRING" size="256"/>
          <Column id="cell" type="STRING" size="256"/>
          <Column id="chk1" type="STRING" size="256"/>
          <Column id="chk2" type="STRING" size="256"/>
          <Column id="pfmc_nm" type="STRING" size="256"/>
          <Column id="kgubun" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item3" compid="fst_dtm" propid="value" datasetid="ds_show" columnid="fst_rsvtn_dtm"/>
      <BindItem id="item0" compid="secn_dtm" propid="value" datasetid="ds_show" columnid="secn_rsvtn_dtm"/>
      <BindItem id="item1" compid="accnt_no" propid="value" datasetid="ds_show" columnid="accnt_no"/>
      <BindItem id="item2" compid="accnt_nm" propid="value" datasetid="ds_show" columnid="mem_nm"/>
      <BindItem id="item4" compid="showname" propid="value" datasetid="ds_show" columnid="pfmc_nm"/>
      <BindItem id="item5" compid="tel" propid="value" datasetid="ds_show" columnid="cell"/>
      <BindItem id="item6" compid="seat_cnt" propid="value" datasetid="ds_show" columnid="seat_cnt"/>
      <BindItem id="item8" compid="authgrpnm07" propid="value" datasetid="ds_show" columnid="reqn"/>
      <BindItem id="item9" compid="prcs_cd" propid="value" datasetid="ds_show" columnid="prcs_cd"/>
      <BindItem id="item10" compid="authgrpnm08" propid="value" datasetid="ds_show" columnid="reg_dtm"/>
      <BindItem id="item11" compid="check1" propid="value" datasetid="ds_show" columnid="chk1"/>
      <BindItem id="item12" compid="check2" propid="value" datasetid="ds_show" columnid="chk2"/>
      <BindItem id="item13" compid="Combo00" propid="value" datasetid="ds_show" columnid="seat_gb"/>
      <BindItem id="item7" compid="pfmc_seq" propid="value" datasetid="ds_show" columnid="pfmc_seq"/>
    </Bind>
    <Script type="xscript4.0"><![CDATA[/********************************************************************************************/
/* 1. Include Library include, variables Declaration 영역                                  */
/********************************************************************************************/
include "LIB::lib_All.xjs";

var gv_rslMsg = "";
var Pv_gubun ="";
var Pv_rsvtn_seq ="";
/********************************************************************************************/
/* 2. Form 관련(onload 및 Form 이벤트) 처리                                           	*/
/********************************************************************************************/
function PS996300_onload(obj:Form, e:LoadEventInfo)
{
	 if ( p_gubun =="2" ) {    // 값이있으면 조회
	     accnt_no.value =p_accnt_no;
	     Pv_gubun=p_gubun;
	     Pv_rsvtn_seq = p_rsvtn_seq
	     stc_30.text="공연혜택조회"
	     fn_commSearch(""); // 조회
	     
	     
	 } else {                   // 값이없으면 신규
		 ds_show.clearData();
		 ds_show.addRow();
	     accnt_no.value =p_accnt_no;
	   //  alert(p_memnm);
	      accnt_nm.value =p_memnm;
	       tel.value =p_cell;
	     Pv_gubun=p_gubun;
	     Pv_rsvtn_seq = p_rsvtn_seq
	     stc_30.text="공연혜택등록"
	    
	 }

 } 

function fn_callBack(svcid, errcd, errmsg) 
{   
     
	if (errcd != 0) {
		return;
	}
     
	switch (svcid) {
		
		case "show_list_1":	//
				 gfn_appendSearchDs(ds_show, ds_list_tmp); // 조회된 결과를 실제보여줄 데이타셋으로 Append처리
				//gfn_setTotalRowCount(ds_show, sta_TotalCnt, tc_empl); // 페이지건수 조회 처리
				fn_postSearch();	
			break;
			
		case "show_insert":	//
				alert("저장완료했습니다.");
				opener.btn_Search_onclick();
				close();
		break;	
	}
}



/***************************************************************************
 * 함  수  명		: fn_postSearch()
 * 기      능		: 처리결과
 ***************************************************************************/
function fn_postSearch()
{
	if (ds_show.rowcount < 1) {
		alert("조회 결과가 없습니다.");
	} else if (ds_show.rowcount == 1) { // 1건인 경우 바로 선택
	    //fn_selEmployeeChk();
	}
	return;
}
/***************************************************************************
 * 함  수  명		: fn_preSearch()
 * 기      능		: 조회 전 처리 조회조건 설정
 * 수  정  일      : 2016.01.22 
 ***************************************************************************/
function fn_preSearch(sType)
{
	if (sType == gfn_getCommTypeInit())
	{
		// 조회조건 및 default 정렬
		ds_inqCndt.clearData();
		ds_inqCndt.addRow();
		/*
		ds_inqCndt.setColumn(0, "pfmc_seq", Pv_rsvtn_seq);
		ds_inqCndt.setColumn(0, "accnt_no", ds_show.getColumn(0,"accnt_no"));
		ds_inqCndt.setColumn(0, "seat_cnt", Pv_rsvtn_seq);
		ds_inqCndt.setColumn(0, "seat_gb", Pv_rsvtn_seq);
		ds_inqCndt.setColumn(0, "fst_rsvtn_dtm", Pv_rsvtn_seq);
		ds_inqCndt.setColumn(0, "secn_rsvtn_dtm", Pv_rsvtn_seq);
		ds_inqCndt.setColumn(0, "last_rsvtn_dtm", Pv_rsvtn_seq);
		ds_inqCndt.setColumn(0, "reqn", Pv_rsvtn_seq);
		ds_inqCndt.setColumn(0, "prcs_cd", Pv_rsvtn_seq);*/
		ds_inqCndt.copyRow(0,ds_show,0);
		ds_inqCndt.setColumn(0, "kgubun", Pv_gubun);
		
     //   trace(Pv_gubun); 
    //    trace(ds_inqCndt.saveXML());
      //  return;
     
	} else {
		ds_inqCndt.clearData();
	    ds_inqCndt.addRow();
		ds_inqCndt.setColumn(0, "rsvtn_seq", Pv_rsvtn_seq);
	}
	return true;
}
/***************************************************************************
 * 함  수  명		: fn_commSearch()
 * 기      능 		: 조회
 * 수  정  일      : 2016.01.21 
 ***************************************************************************/
function fn_commSearch(sType)
{	
    if (!fn_preSearch(sType)) return false;	
	
	// 호출 레코드 수
	//if(!gfn_pageSearch(sType, ds_show, sta_TotalCnt, 10, tc_empl)) return; 
	
	var szSvcid       = "show_list_1";
    var szController  = "/dlw/show/list";
    var szInDs        = "ds_input=ds_inqCndt";
    var szOutDs       = "ds_list_tmp=ds_output";
    var szParam       = "";
    var szRetCallback = "fn_callBack";


    // 트랜젝션 공통함수 호출
    gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback);
}

function btn_onclick(obj:Button,  e:ClickEventInfo)
{
	 
    var szSvcid = ""
    var szController = ""
    var szInDs = ""
    var szOutDs = ""
    var szParam = ""
    var szRetCallback = ""
    
  //  nRowType = 
   var nRowType = ds_show.getRowType(0);
   
   
    if (   ds_show.getColumn(0,"rebit") == "3" ) {
        alert("취소된 공연은 수정 할 수 없습니다.");
		return;
    }
    
    if (p_gubun == 2) {
		if (nRowType != 4) { 
		 alert("수정한내역이 없습니다.");
		 return ;
		} 
    }
    
//    alert("aa");
    
     if (!fn_preSearch(gfn_getCommTypeInit())) return false;

	 szSvcid       = "show_insert";
	 szController  ="/dlw/show/showinsert";
	 szInDs        = "ds_input=ds_inqCndt";
	 szOutDs        = "ds_list_tmp=ds_output";
	 szParam       = "";
	 szRetCallback = "fn_callBack";
		
		// 트랜젝션 공통함수 호출
	gfn_transaction(this, szSvcid, szController, szInDs, szOutDs, szParam, szRetCallback);
}



//조회 결과
function fn_postSearch()
{
	
		if(ds_in.rowcount < 1) {
			ds_in.clearData();
		}
}	
function btn_close_onclick(obj:Button,  e:ClickEventInfo)
{
	close();
}


function check1_onclick(obj:CheckBox,  e:ClickEventInfo)
{
	check1.value =true;
	check2.value =false;
}

function check2_onclick(obj:CheckBox,  e:ClickEventInfo)
{
      check2.value =true;
	  check1.value =false;
 	
}


/////공연조회 
function btn_showlist_no_onclick(obj:Button,  e:ClickEventInfo)
{
    var option ="";
	var sPrmr = { p_option:option};
	gfn_diaLog("공연 조회", -1, -1, 884, 601, "PS990000::PS996310.xfdl", false, sPrmr, true, false, true, null, null, true);
}

function btn_s_onclick(obj:Button,  e:ClickEventInfo)
{
	var v_pfmc_seq =pfmc_seq.value;
	var sPrmr = { p_pfmc_seq:v_pfmc_seq};
	gfn_diaLog("공연예약일시LIST", -1, -1, 884, 601, "PS990000::PS996320.xfdl", false, sPrmr, true, false, true, null, null, true);
}
]]></Script>
  </Form>
</FDL>
